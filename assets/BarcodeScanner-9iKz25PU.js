import{c as D,v as z,q as B,r as H,s as R,t as q,Z as T,n as F,B as m,y as O,z as Q}from"./index-Jh_c0kYy.js";import{j as e}from"./ui-vendor-DWmIoBIJ.js";import{r}from"./react-vendor-ylmX0jv_.js";import{H as U}from"./scanner-D4NToCeH.js";import{S as V}from"./switch-1BmPklHy.js";import{L as Z}from"./label-DXZvYhL3.js";import{A as _,m as G}from"./animation-Ch0GoCcm.js";import{L as J}from"./jspdf.es.min-CHkB5dJ4.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=D("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=D("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);function W(){return{trigger:r.useCallback((x="light")=>{if(!("vibrate"in navigator))return;const c={light:10,medium:20,heavy:30,selection:[5,10],success:[10,50,10],warning:[20,100,20],error:[30,100,30,100,30]}[x];try{Array.isArray(c),navigator.vibrate(c)}catch(v){console.warn("Haptic feedback failed:",v)}},[])}}function ie({open:i,onOpenChange:x,onScan:p,onBatchScan:c}){const[v,j]=r.useState(!1),[y,d]=r.useState(null),[u,o]=r.useState(null),[b,w]=r.useState(!1),n=r.useRef(null),N="barcode-reader",{trigger:A}=W(),[l,C]=r.useState(!1),[t,h]=r.useState([]);r.useEffect(()=>(i&&!n.current&&!b&&E(),()=>{k()}),[i,b]),r.useEffect(()=>{i&&(h([]),C(!1))},[i]);const I=async()=>{try{return(await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})).getTracks().forEach(a=>a.stop()),!0}catch(s){return console.error("Error requesting camera permission:",s),s instanceof DOMException&&(s.name==="NotAllowedError"||s.name==="PermissionDeniedError"?(w(!0),o("Permisos de cámara denegados. Por favor, habilita los permisos en la configuración de tu navegador.")):o("Error al acceder a la cámara. Intenta nuevamente.")),!1}},E=async()=>{try{if(o(null),!await I())return;const a=new U(N);n.current=a;const S={fps:15,qrbox:{width:280,height:280},aspectRatio:1,experimentalFeatures:{useBarCodeDetectorIfSupported:!0}};await a.start({facingMode:"environment"},S,g=>{L(g)},()=>{}),j(!0)}catch(s){console.error("Error starting scanner:",s),o("Error al iniciar la cámara."),z.error("Error al iniciar la cámara")}},k=async()=>{if(n.current)try{n.current.isScanning&&await n.current.stop(),n.current.clear()}catch(s){console.error("Error stopping scanner:",s)}finally{n.current=null,j(!1)}},L=s=>{l&&t.length>0&&t[t.length-1],A("success"),l?(h(a=>[s,...a]),d(s),setTimeout(()=>d(null),1e3)):(d(s),setTimeout(()=>{p(s),f()},800))},f=async()=>{await k(),d(null),o(null),w(!1),x(!1)},M=()=>{c&&c(t),f()},P=s=>{h(a=>a.filter((S,g)=>g!==s))};return e.jsx(B,{open:i,onOpenChange:f,children:e.jsxs(H,{className:"sm:max-w-[500px] max-h-[90vh] flex flex-col p-0 gap-0 overflow-hidden",children:[e.jsxs(R,{className:"p-4 pb-2",children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-primary"}),"Escanear Código"]}),e.jsx(T,{children:u?"Error de cámara":"Apunta al código de barras"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pt-0 space-y-4",children:[!u&&e.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-black min-h-[250px] shrink-0",children:[e.jsx("div",{id:N,className:"w-full"}),e.jsx(_,{children:y&&e.jsx(G.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-success/80 flex items-center justify-center z-10",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(F,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{className:"font-mono font-bold",children:y})]})})})]}),e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(Z,{htmlFor:"batch-mode",className:"cursor-pointer",children:"Modo Ráfaga"})]}),e.jsx(V,{id:"batch-mode",checked:l,onCheckedChange:C})]}),l&&t.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Items Escaneados (",t.length,")"]}),e.jsx(m,{variant:"ghost",size:"sm",className:"h-6 text-xs text-destructive",onClick:()=>h([]),children:"Limpiar"})]}),e.jsx("div",{className:"max-h-[150px] overflow-y-auto space-y-1 border rounded-md p-2 bg-background",children:t.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between text-sm p-1 hover:bg-muted rounded",children:[e.jsx("span",{className:"font-mono",children:s}),e.jsx(m,{variant:"ghost",size:"icon",className:"h-6 w-6 text-muted-foreground hover:text-destructive",onClick:()=>P(a),children:e.jsx(O,{className:"w-3 h-3"})})]},a))})]}),u&&e.jsxs("div",{className:"p-4 bg-destructive/10 text-destructive rounded-lg text-sm",children:[u,e.jsx(m,{onClick:()=>E(),variant:"outline",size:"sm",className:"mt-2 w-full",children:"Reintentar"})]})]}),e.jsxs(Q,{className:"p-4 pt-2 border-t bg-muted/20 flex-row gap-2 sm:justify-end",children:[e.jsx(m,{variant:"outline",onClick:f,className:"flex-1 sm:flex-none",children:"Cancelar"}),l&&e.jsxs(m,{onClick:M,disabled:t.length===0,className:"flex-1 sm:flex-none",children:["Procesar (",t.length,")"]})]})]})})}export{ne as A,ie as B,K as C,W as u};
