import{j as e,M as ae,N as re,Q as T,U as A,W as oe,X as R,Y as U,Z as E,$ as P,a0 as $,a1 as z,a2 as B}from"./ui-vendor-lsEhpTbO.js";import{r as l,u as ne}from"./react-vendor-ylmX0jv_.js";import{c as le,g as v,k as ie,e as O,n as F,a as u,u as ce,C as de,S as me,B as V,p as ue,m as xe}from"./index-Bf7eI8nq.js";import{I as pe}from"./input-BeyIuFGC.js";import{B as fe}from"./badge-kJnZ7vkS.js";import{a as Z,P as ge,M as he,A as be}from"./progress-CQXOXfUm.js";import{C as p}from"./CounterAnimation-GIE2m9HH.js";import{C as Ne}from"./clock-CAC-0zD3.js";import{C as ve}from"./check-Pcgvqjb0.js";import{L as je}from"./loader-circle-D9N-YAvQ.js";import{D as ye}from"./dollar-sign-etYseVn-.js";import{T as we}from"./trending-down-DlIlOPRG.js";import{T as Ce}from"./trending-up-D_vHEjcD.js";import"./utils-CUsTgaRG.js";import"./animation-DZFErbwn.js";import"./excel-uoQkVabA.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=le("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);function Me({name:o,negativeValue:a,positiveValue:r,differenceValue:n,status:i,progress:j=0,onClick:f}){const c=(h=>{switch(h){case"controlado":return{color:"text-success",bgColor:"bg-success/10",borderColor:"border-success/20",icon:F,label:"Controlado",barColor:"bg-success"};case"por_controlar":return{color:"text-warning",bgColor:"bg-warning/10",borderColor:"border-warning/20",icon:Ne,label:"En Proceso",barColor:"bg-warning"};case"pendiente":return{color:"text-muted-foreground",bgColor:"bg-muted",borderColor:"border-muted",icon:O,label:"Pendiente",barColor:"bg-muted-foreground"}}})(i),y=c.icon,N=i==="controlado"?100:i==="pendiente"?0:j||0;return e.jsxs(v,{className:"group hover:shadow-md transition-all duration-200 border cursor-pointer overflow-hidden relative",onClick:f,children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 ${c.barColor}`}),e.jsxs(ie,{className:"p-4 pl-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:`p-1.5 rounded-full ${c.bgColor}`,children:e.jsx(y,{className:`w-4 h-4 ${c.color}`})}),e.jsx("h3",{className:"font-semibold text-base truncate",title:o,children:o})]}),e.jsx(Z,{className:"w-4 h-4 text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground font-medium uppercase tracking-wider",children:"Valorizado (Diferencias)"}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:`text-lg font-bold font-mono tracking-tight ${n<0?"text-destructive":n>0?"text-success":"text-foreground"}`,children:[n>0?"+":"",e.jsx(p,{value:n,prefix:"$"})]})}),e.jsxs("div",{className:"flex items-center gap-3 text-xs font-mono mt-1",children:[e.jsxs("span",{className:"text-destructive flex items-center",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-destructive mr-1"}),e.jsx(p,{value:a,prefix:"$"})]}),e.jsxs("span",{className:"text-success flex items-center",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-success mr-1"}),"+",e.jsx(p,{value:r,prefix:"$"})]})]})]}),e.jsxs("div",{className:"space-y-1.5 pt-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(fe,{variant:"outline",className:`${c.color} ${c.borderColor} bg-transparent h-5 px-1.5 text-[10px]`,children:c.label})}),e.jsxs("span",{children:[N,"%"]})]}),e.jsx(ge,{value:N,className:"h-1.5",indicatorClassName:c.barColor})]})]})]})]})}const Ie=ae,Le=re,ke=l.forwardRef(({className:o,inset:a,children:r,...n},i)=>e.jsxs(T,{ref:i,className:u("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",a&&"pl-8",o),...n,children:[r,e.jsx(Z,{className:"ml-auto h-4 w-4"})]}));ke.displayName=T.displayName;const De=l.forwardRef(({className:o,...a},r)=>e.jsx(A,{ref:r,className:u("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",o),...a}));De.displayName=A.displayName;const G=l.forwardRef(({className:o,sideOffset:a=4,...r},n)=>e.jsx(oe,{children:e.jsx(R,{ref:n,sideOffset:a,className:u("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",o),...r})}));G.displayName=R.displayName;const b=l.forwardRef(({className:o,inset:a,...r},n)=>e.jsx(U,{ref:n,className:u("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",a&&"pl-8",o),...r}));b.displayName=U.displayName;const Ve=l.forwardRef(({className:o,children:a,checked:r,...n},i)=>e.jsxs(E,{ref:i,className:u("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",o),checked:r,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(P,{children:e.jsx(ve,{className:"h-4 w-4"})})}),a]}));Ve.displayName=E.displayName;const Te=l.forwardRef(({className:o,children:a,...r},n)=>e.jsxs($,{ref:n,className:u("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",o),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(P,{children:e.jsx(Se,{className:"h-2 w-2 fill-current"})})}),a]}));Te.displayName=$.displayName;const Ae=l.forwardRef(({className:o,inset:a,...r},n)=>e.jsx(z,{ref:n,className:u("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",o),...r}));Ae.displayName=z.displayName;const Re=l.forwardRef(({className:o,...a},r)=>e.jsx(B,{ref:r,className:u("-mx-1 my-1 h-px bg-muted",o),...a}));Re.displayName=B.displayName;function He(){const o=ne(),{user:a}=ce(),[r,n]=l.useState(""),[i,j]=l.useState("MEDICAMENTOS"),[f,g]=l.useState("name-asc"),[c,y]=l.useState([]),[N,h]=l.useState(!0);l.useEffect(()=>{(async()=>{if(!(a!=null&&a.branchSheet)){h(!1);return}h(!0);try{const t=await ue(a.branchSheet),m=await xe.getAllCyclicInventories(a.branchSheet),se=new Map(m.map(x=>[x.labName,x])),te=t.map(x=>{const D=se.get(x.name);return D?{...D,category:x.category}:{labName:x.name,category:x.category,status:"pendiente",totalItems:0,controlledItems:0,progress:0,negativeValue:0,positiveValue:0,netValue:0,differenceValue:0,totalSystemUnits:0,negativeUnits:0,positiveUnits:0,netUnits:0}});y(te)}catch(t){console.error("Error loading laboratories:",t)}finally{h(!1)}})()},[a]);const d=c.filter(s=>s.category===i),w=d.length,C=d.filter(s=>s.status==="controlado").length,Q=d.filter(s=>s.status==="pendiente").length,S=d.reduce((s,t)=>s+t.differenceValue,0),W=d.reduce((s,t)=>s+t.negativeValue,0),X=d.reduce((s,t)=>s+t.positiveValue,0),M=d.reduce((s,t)=>s+t.totalSystemUnits,0),L=d.reduce((s,t)=>s+t.negativeUnits,0),k=d.reduce((s,t)=>s+t.positiveUnits,0),I=(s,t)=>{if(t===0)return{value:0,isPositive:!0};const m=s/t*100;return{value:Math.abs(Number(m.toFixed(1))),isPositive:m>=0}},Y=I(L+k,M),_=I(L,M),q=I(k,M),H=w>0?Math.round(C/w*100):0,J=l.useMemo(()=>{let s=[...c];return r&&(s=s.filter(t=>t.labName.toLowerCase().includes(r.toLowerCase()))),s=s.filter(t=>t.category===i),s.sort((t,m)=>{switch(f){case"name-asc":return t.labName.localeCompare(m.labName);case"name-desc":return m.labName.localeCompare(t.labName);case"value-asc":return t.differenceValue-m.differenceValue;case"value-desc":return m.differenceValue-t.differenceValue;default:return 0}}),s},[r,i,f,c]),K=s=>{switch(s){case"name-asc":return"Nombre (A-Z)";case"name-desc":return"Nombre (Z-A)";case"value-asc":return"Valor (Menor a Mayor)";case"value-desc":return"Valor (Mayor a Menor)"}},ee=["MEDICAMENTOS","PERFUMERIA","ACCESORIOS","VARIOS"];return N?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(je,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"p-4 md:p-6 space-y-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(v,{className:"p-4 flex flex-col justify-between bg-primary/5 border-primary/10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary mb-2",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Avance Global"})]}),e.jsxs("div",{className:"text-2xl font-bold",children:[e.jsx(p,{value:H}),"%"]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[C," de ",w," laboratorios"]})]}),e.jsxs(v,{className:"p-4 flex flex-col justify-between bg-success/5 border-success/10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-success mb-2",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Controlados"})]}),e.jsx("div",{className:"text-2xl font-bold text-success",children:e.jsx(p,{value:C})})]}),e.jsxs(v,{className:"p-4 flex flex-col justify-between bg-muted/50 border-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-2",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Pendientes"})]}),e.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:e.jsx(p,{value:Q})})]}),e.jsx(he,{items:[{id:"net",label:"Diferencia Neta",value:S,color:S<0?"text-destructive":S>0?"text-success":"text-foreground",icon:ye,prefix:"$",trend:Y},{id:"negative",label:"Negativo Total",value:W,color:"text-destructive",icon:we,prefix:"$",trend:_},{id:"positive",label:"Positivo Total",value:X,color:"text-success",icon:Ce,prefix:"$",trend:q}]})]}),e.jsxs("div",{className:"flex flex-col gap-4 sticky top-0 bg-background/95 backdrop-blur z-10 py-2",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(pe,{placeholder:"Buscar laboratorio...",value:r,onChange:s=>n(s.target.value),className:"pl-9"})]}),e.jsxs(Ie,{children:[e.jsx(Le,{asChild:!0,children:e.jsxs(V,{variant:"outline",size:"sm",className:"whitespace-nowrap",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),K(f)]})}),e.jsxs(G,{align:"end",children:[e.jsx(b,{onClick:()=>g("name-asc"),children:"Nombre (A-Z)"}),e.jsx(b,{onClick:()=>g("name-desc"),children:"Nombre (Z-A)"}),e.jsx(b,{onClick:()=>g("value-asc"),children:"Valor (Menor a Mayor)"}),e.jsx(b,{onClick:()=>g("value-desc"),children:"Valor (Mayor a Menor)"})]})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:ee.map(s=>e.jsx(V,{variant:i===s?"default":"outline",size:"sm",onClick:()=>j(s),className:"whitespace-nowrap rounded-full px-4",children:s==="MEDICAMENTOS"?"Medicamentos":s.charAt(0)+s.slice(1).toLowerCase()},s))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:J.map(s=>e.jsx(Me,{name:s.labName,negativeValue:s.negativeValue,positiveValue:s.positiveValue,differenceValue:s.differenceValue,status:s.status,progress:s.progress,onClick:()=>o(`/cyclic-inventory/${encodeURIComponent(s.labName)}`)},s.labName))})]})}export{He as default};
