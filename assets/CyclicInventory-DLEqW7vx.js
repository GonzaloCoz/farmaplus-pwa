import{j as e}from"./ui-vendor-CwIRxpyq.js";import{u as H,r as i}from"./react-vendor-ylmX0jv_.js";import{i as b,m as J,y as K,h as Q,a as T,p as I,u as W,C as X,S as Y,B as V,x as L,w as ee}from"./index-CRCrhKU4.js";import{I as se}from"./input-DJmmUFgp.js";import{P as ae,M as te,D as re,a as oe,A as ne,b as ce,c as v}from"./progress-DDOFxFPs.js";import{C as u}from"./CounterAnimation-DSOCKTOo.js";import{C as le}from"./clock-BTk_q2A-.js";import{D as ie,c as k}from"./cyclicInventoryService-BO2R7mmW.js";import{L as de}from"./loader-circle-DVdQsWNG.js";import{T as me}from"./trending-down-Co7a-Bcz.js";import{T as ue}from"./trending-up-CTSS2IcW.js";import{D as xe}from"./database-Csvbj3kG.js";import"./utils-DNiwW225.js";import"./animation-DbfETv0H.js";import"./excel-uoQkVabA.js";import"./check-BnCQlVy3.js";import"./circle-D73eJr_k.js";import"./chevron-left-LKOD8GbL.js";function pe({name:g,negativeValue:n,positiveValue:d,differenceValue:m,status:c,progress:j=0,onClick:x}){const t=(f=>{switch(f){case"controlado":return{color:"text-success",bgColor:"bg-success/10",borderColor:"border-success/20",icon:I,label:"Controlado",barColor:"bg-success"};case"por_controlar":return{color:"text-warning",bgColor:"bg-warning/10",borderColor:"border-warning/20",icon:le,label:"En Proceso",barColor:"bg-warning"};case"pendiente":return{color:"text-muted-foreground",bgColor:"bg-muted",borderColor:"border-muted",icon:T,label:"Pendiente",barColor:"bg-muted-foreground"}}})(c),N=t.icon,h=c==="controlado"?100:c==="pendiente"?0:j||0;return e.jsxs(b,{className:"group hover:shadow-md transition-all duration-200 border cursor-pointer overflow-hidden relative",onClick:x,children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 ${t.barColor}`}),e.jsxs(J,{className:"p-4 pl-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:`p-1.5 rounded-full ${t.bgColor}`,children:e.jsx(N,{className:`w-4 h-4 ${t.color}`})}),e.jsx("h3",{className:"font-semibold text-base truncate",title:g,children:g})]}),e.jsx(K,{className:"w-4 h-4 text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground font-medium uppercase tracking-wider",children:"Valorizado (Diferencias)"}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:`text-lg font-bold font-mono tracking-tight ${m<0?"text-destructive":m>0?"text-success":"text-foreground"}`,children:[m>0?"+":"",e.jsx(u,{value:m,prefix:"$"})]})}),e.jsxs("div",{className:"flex items-center gap-3 text-xs font-mono mt-1",children:[e.jsxs("span",{className:"text-destructive flex items-center",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-destructive mr-1"}),e.jsx(u,{value:n,prefix:"$"})]}),e.jsxs("span",{className:"text-success flex items-center",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-success mr-1"}),"+",e.jsx(u,{value:d,prefix:"$"})]})]})]}),e.jsxs("div",{className:"space-y-1.5 pt-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Q,{variant:"outline",className:`${t.color} ${t.borderColor} bg-transparent h-5 px-1.5 text-[10px]`,children:t.label})}),e.jsxs("span",{children:[h,"%"]})]}),e.jsx(ae,{value:h,className:"h-1.5",indicatorClassName:t.barColor})]})]})]})]})}function Te(){const g=H(),{user:n}=W(),[d,m]=i.useState(""),[c,j]=i.useState("MEDICAMENTOS"),[x,p]=i.useState("name-asc"),[t,N]=i.useState([]),[h,f]=i.useState(!0);i.useEffect(()=>{(async()=>{if(!(n!=null&&n.branchSheet)){f(!1);return}f(!0);try{const a=await ee(n.branchSheet),o=await k.getAllCyclicInventories(n.branchSheet),_=new Map(o.map(l=>[l.labName,l])),q=a.map(l=>{const E=_.get(l.name);return E?{...E,category:l.category}:{labName:l.name,category:l.category,status:"pendiente",totalItems:0,controlledItems:0,progress:0,negativeValue:0,positiveValue:0,netValue:0,differenceValue:0,totalSystemUnits:0,negativeUnits:0,positiveUnits:0,netUnits:0}});N(q)}catch(a){console.error("Error loading laboratories:",a)}finally{f(!1)}})()},[n]);const r=t.filter(s=>s.category===c),w=r.length,C=r.filter(s=>s.status==="controlado").length,U=r.filter(s=>s.status==="pendiente").length,y=r.reduce((s,a)=>s+a.differenceValue,0),P=r.reduce((s,a)=>s+a.negativeValue,0),$=r.reduce((s,a)=>s+a.positiveValue,0),S=r.reduce((s,a)=>s+a.totalSystemUnits,0),A=r.reduce((s,a)=>s+a.negativeUnits,0),D=r.reduce((s,a)=>s+a.positiveUnits,0),M=(s,a)=>{if(a===0)return{value:0,isPositive:!0};const o=s/a*100;return{value:Math.abs(Number(o.toFixed(1))),isPositive:o>=0}},z=M(A+D,S),B=M(A,S),O=M(D,S),R=w>0?Math.round(C/w*100):0,F=i.useMemo(()=>{let s=[...t];return d&&(s=s.filter(a=>a.labName.toLowerCase().includes(d.toLowerCase()))),s=s.filter(a=>a.category===c),s.sort((a,o)=>{switch(x){case"name-asc":return a.labName.localeCompare(o.labName);case"name-desc":return o.labName.localeCompare(a.labName);case"value-asc":return a.differenceValue-o.differenceValue;case"value-desc":return o.differenceValue-a.differenceValue;default:return 0}}),s},[d,c,x,t]),Z=s=>{switch(s){case"name-asc":return"Nombre (A-Z)";case"name-desc":return"Nombre (Z-A)";case"value-asc":return"Valor (Menor a Mayor)";case"value-desc":return"Valor (Mayor a Menor)"}},G=["MEDICAMENTOS","PERFUMERIA","ACCESORIOS","VARIOS"];return h?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(de,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"p-4 md:p-6 space-y-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(b,{className:"p-4 flex flex-col justify-between bg-primary/5 border-primary/10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary mb-2",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Avance Global"})]}),e.jsxs("div",{className:"text-2xl font-bold",children:[e.jsx(u,{value:R}),"%"]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[C," de ",w," laboratorios"]})]}),e.jsxs(b,{className:"p-4 flex flex-col justify-between bg-success/5 border-success/10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-success mb-2",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Controlados"})]}),e.jsx("div",{className:"text-2xl font-bold text-success",children:e.jsx(u,{value:C})})]}),e.jsxs(b,{className:"p-4 flex flex-col justify-between bg-muted/50 border-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-2",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Pendientes"})]}),e.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:e.jsx(u,{value:U})})]}),e.jsx(te,{items:[{id:"net",label:"Diferencia Neta",value:y,color:y<0?"text-destructive":y>0?"text-success":"text-foreground",icon:ie,prefix:"$",trend:z},{id:"negative",label:"Negativo Total",value:P,color:"text-destructive",icon:me,prefix:"$",trend:B},{id:"positive",label:"Positivo Total",value:$,color:"text-success",icon:ue,prefix:"$",trend:O}]})]}),e.jsxs("div",{className:"flex flex-col gap-4 sticky top-0 bg-background/95 backdrop-blur z-10 py-2",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(se,{placeholder:"Buscar laboratorio...",value:d,onChange:s=>m(s.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(V,{variant:"secondary",size:"sm",onClick:async()=>{if(confirm("¿Sincronizar metas desde el Excel maestro a la base de datos?")){L.info("Información","Sincronizando metas...");try{await k.migrateGoalsFromExcel(),L.success("Operación exitosa","Metas sincronizadas con éxito."),window.location.reload()}catch{L.error("Error","Error al sincronizar metas.")}}},children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Sincronizar Metas"]}),e.jsxs(re,{children:[e.jsx(oe,{asChild:!0,children:e.jsxs(V,{variant:"outline",size:"sm",className:"whitespace-nowrap",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),Z(x)]})}),e.jsxs(ce,{align:"end",children:[e.jsx(v,{onClick:()=>p("name-asc"),children:"Nombre (A-Z)"}),e.jsx(v,{onClick:()=>p("name-desc"),children:"Nombre (Z-A)"}),e.jsx(v,{onClick:()=>p("value-asc"),children:"Valor (Menor a Mayor)"}),e.jsx(v,{onClick:()=>p("value-desc"),children:"Valor (Mayor a Menor)"})]})]})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:G.map(s=>e.jsx(V,{variant:c===s?"default":"outline",size:"sm",onClick:()=>j(s),className:"whitespace-nowrap rounded-full px-4",children:s==="MEDICAMENTOS"?"Medicamentos":s.charAt(0)+s.slice(1).toLowerCase()},s))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:F.map(s=>e.jsx(pe,{name:s.labName,negativeValue:s.negativeValue,positiveValue:s.positiveValue,differenceValue:s.differenceValue,status:s.status,progress:s.progress,onClick:()=>g(`/cyclic-inventory/${encodeURIComponent(s.labName)}`)},s.labName))})]})}export{Te as default};
