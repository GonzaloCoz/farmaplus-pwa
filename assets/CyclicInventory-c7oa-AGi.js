import{j as e,s as oe,v as ne,w as E,x as R,y as le,z,B as U,E as P,G as $,H as B,L as F,J as O}from"./ui-vendor-DWmIoBIJ.js";import{r as l,u as ie}from"./react-vendor-ylmX0jv_.js";import{c as ce,d as N,h as de,n as Z,a as G,i as H,b as u,u as me,C as ue,S as xe,B as I,r as L,k as A,m as pe}from"./index-DbwJGGea.js";import{I as fe}from"./input-BacYCGan.js";import{B as ge}from"./badge-DKLc_DLM.js";import{P as he,M as be,A as ve}from"./progress-Bg3zQE63.js";import{C as p}from"./CounterAnimation-BByUy0p8.js";import{C as Ne}from"./clock-DaLBEFtK.js";import{C as je}from"./check-NosJ0AKa.js";import{L as we}from"./loader-circle-wQrOqgPS.js";import{D as ye}from"./dollar-sign-3C4PX9Wr.js";import{T as Ce}from"./trending-down-DmLsS8rq.js";import{T as Se}from"./trending-up-BTBHZGPd.js";import{D as Me}from"./database-CB8slYzH.js";import"./utils-CUsTgaRG.js";import"./animation-Ch0GoCcm.js";import"./excel-uoQkVabA.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=ce("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);function Ie({name:o,negativeValue:t,positiveValue:r,differenceValue:n,status:i,progress:j=0,onClick:f}){const c=(h=>{switch(h){case"controlado":return{color:"text-success",bgColor:"bg-success/10",borderColor:"border-success/20",icon:H,label:"Controlado",barColor:"bg-success"};case"por_controlar":return{color:"text-warning",bgColor:"bg-warning/10",borderColor:"border-warning/20",icon:Ne,label:"En Proceso",barColor:"bg-warning"};case"pendiente":return{color:"text-muted-foreground",bgColor:"bg-muted",borderColor:"border-muted",icon:G,label:"Pendiente",barColor:"bg-muted-foreground"}}})(i),w=c.icon,v=i==="controlado"?100:i==="pendiente"?0:j||0;return e.jsxs(N,{className:"group hover:shadow-md transition-all duration-200 border cursor-pointer overflow-hidden relative",onClick:f,children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 ${c.barColor}`}),e.jsxs(de,{className:"p-4 pl-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:`p-1.5 rounded-full ${c.bgColor}`,children:e.jsx(w,{className:`w-4 h-4 ${c.color}`})}),e.jsx("h3",{className:"font-semibold text-base truncate",title:o,children:o})]}),e.jsx(Z,{className:"w-4 h-4 text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground font-medium uppercase tracking-wider",children:"Valorizado (Diferencias)"}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:`text-lg font-bold font-mono tracking-tight ${n<0?"text-destructive":n>0?"text-success":"text-foreground"}`,children:[n>0?"+":"",e.jsx(p,{value:n,prefix:"$"})]})}),e.jsxs("div",{className:"flex items-center gap-3 text-xs font-mono mt-1",children:[e.jsxs("span",{className:"text-destructive flex items-center",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-destructive mr-1"}),e.jsx(p,{value:t,prefix:"$"})]}),e.jsxs("span",{className:"text-success flex items-center",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-success mr-1"}),"+",e.jsx(p,{value:r,prefix:"$"})]})]})]}),e.jsxs("div",{className:"space-y-1.5 pt-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ge,{variant:"outline",className:`${c.color} ${c.borderColor} bg-transparent h-5 px-1.5 text-[10px]`,children:c.label})}),e.jsxs("span",{children:[v,"%"]})]}),e.jsx(he,{value:v,className:"h-1.5",indicatorClassName:c.barColor})]})]})]})]})}const Le=oe,ke=ne,Ve=l.forwardRef(({className:o,inset:t,children:r,...n},i)=>e.jsxs(E,{ref:i,className:u("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",t&&"pl-8",o),...n,children:[r,e.jsx(Z,{className:"ml-auto h-4 w-4"})]}));Ve.displayName=E.displayName;const Te=l.forwardRef(({className:o,...t},r)=>e.jsx(R,{ref:r,className:u("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",o),...t}));Te.displayName=R.displayName;const J=l.forwardRef(({className:o,sideOffset:t=4,...r},n)=>e.jsx(le,{children:e.jsx(z,{ref:n,sideOffset:t,className:u("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",o),...r})}));J.displayName=z.displayName;const b=l.forwardRef(({className:o,inset:t,...r},n)=>e.jsx(U,{ref:n,className:u("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t&&"pl-8",o),...r}));b.displayName=U.displayName;const Ae=l.forwardRef(({className:o,children:t,checked:r,...n},i)=>e.jsxs(P,{ref:i,className:u("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",o),checked:r,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx($,{children:e.jsx(je,{className:"h-4 w-4"})})}),t]}));Ae.displayName=P.displayName;const Ee=l.forwardRef(({className:o,children:t,...r},n)=>e.jsxs(B,{ref:n,className:u("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",o),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx($,{children:e.jsx(De,{className:"h-2 w-2 fill-current"})})}),t]}));Ee.displayName=B.displayName;const Re=l.forwardRef(({className:o,inset:t,...r},n)=>e.jsx(F,{ref:n,className:u("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",o),...r}));Re.displayName=F.displayName;const ze=l.forwardRef(({className:o,...t},r)=>e.jsx(O,{ref:r,className:u("-mx-1 my-1 h-px bg-muted",o),...t}));ze.displayName=O.displayName;function es(){const o=ie(),{user:t}=me(),[r,n]=l.useState(""),[i,j]=l.useState("MEDICAMENTOS"),[f,g]=l.useState("name-asc"),[c,w]=l.useState([]),[v,h]=l.useState(!0);l.useEffect(()=>{(async()=>{if(!(t!=null&&t.branchSheet)){h(!1);return}h(!0);try{const a=await pe(t.branchSheet),m=await A.getAllCyclicInventories(t.branchSheet),te=new Map(m.map(x=>[x.labName,x])),re=a.map(x=>{const T=te.get(x.name);return T?{...T,category:x.category}:{labName:x.name,category:x.category,status:"pendiente",totalItems:0,controlledItems:0,progress:0,negativeValue:0,positiveValue:0,netValue:0,differenceValue:0,totalSystemUnits:0,negativeUnits:0,positiveUnits:0,netUnits:0}});w(re)}catch(a){console.error("Error loading laboratories:",a)}finally{h(!1)}})()},[t]);const d=c.filter(s=>s.category===i),y=d.length,C=d.filter(s=>s.status==="controlado").length,_=d.filter(s=>s.status==="pendiente").length,S=d.reduce((s,a)=>s+a.differenceValue,0),q=d.reduce((s,a)=>s+a.negativeValue,0),K=d.reduce((s,a)=>s+a.positiveValue,0),M=d.reduce((s,a)=>s+a.totalSystemUnits,0),k=d.reduce((s,a)=>s+a.negativeUnits,0),V=d.reduce((s,a)=>s+a.positiveUnits,0),D=(s,a)=>{if(a===0)return{value:0,isPositive:!0};const m=s/a*100;return{value:Math.abs(Number(m.toFixed(1))),isPositive:m>=0}},Q=D(k+V,M),W=D(k,M),X=D(V,M),Y=y>0?Math.round(C/y*100):0,ee=l.useMemo(()=>{let s=[...c];return r&&(s=s.filter(a=>a.labName.toLowerCase().includes(r.toLowerCase()))),s=s.filter(a=>a.category===i),s.sort((a,m)=>{switch(f){case"name-asc":return a.labName.localeCompare(m.labName);case"name-desc":return m.labName.localeCompare(a.labName);case"value-asc":return a.differenceValue-m.differenceValue;case"value-desc":return m.differenceValue-a.differenceValue;default:return 0}}),s},[r,i,f,c]),se=s=>{switch(s){case"name-asc":return"Nombre (A-Z)";case"name-desc":return"Nombre (Z-A)";case"value-asc":return"Valor (Menor a Mayor)";case"value-desc":return"Valor (Mayor a Menor)"}},ae=["MEDICAMENTOS","PERFUMERIA","ACCESORIOS","VARIOS"];return v?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(we,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"p-4 md:p-6 space-y-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(N,{className:"p-4 flex flex-col justify-between bg-primary/5 border-primary/10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary mb-2",children:[e.jsx(ue,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Avance Global"})]}),e.jsxs("div",{className:"text-2xl font-bold",children:[e.jsx(p,{value:Y}),"%"]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[C," de ",y," laboratorios"]})]}),e.jsxs(N,{className:"p-4 flex flex-col justify-between bg-success/5 border-success/10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-success mb-2",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Controlados"})]}),e.jsx("div",{className:"text-2xl font-bold text-success",children:e.jsx(p,{value:C})})]}),e.jsxs(N,{className:"p-4 flex flex-col justify-between bg-muted/50 border-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-2",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Pendientes"})]}),e.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:e.jsx(p,{value:_})})]}),e.jsx(be,{items:[{id:"net",label:"Diferencia Neta",value:S,color:S<0?"text-destructive":S>0?"text-success":"text-foreground",icon:ye,prefix:"$",trend:Q},{id:"negative",label:"Negativo Total",value:q,color:"text-destructive",icon:Ce,prefix:"$",trend:W},{id:"positive",label:"Positivo Total",value:K,color:"text-success",icon:Se,prefix:"$",trend:X}]})]}),e.jsxs("div",{className:"flex flex-col gap-4 sticky top-0 bg-background/95 backdrop-blur z-10 py-2",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(fe,{placeholder:"Buscar laboratorio...",value:r,onChange:s=>n(s.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(I,{variant:"secondary",size:"sm",onClick:async()=>{if(!confirm("¿Sincronizar metas desde el Excel maestro a la base de datos?"))return;const s=L.loading("Sincronizando metas...");try{await A.migrateGoalsFromExcel(),L.success("Metas sincronizadas con éxito.",{id:s}),window.location.reload()}catch{L.error("Error al sincronizar metas.",{id:s})}},children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Sincronizar Metas"]}),e.jsxs(Le,{children:[e.jsx(ke,{asChild:!0,children:e.jsxs(I,{variant:"outline",size:"sm",className:"whitespace-nowrap",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),se(f)]})}),e.jsxs(J,{align:"end",children:[e.jsx(b,{onClick:()=>g("name-asc"),children:"Nombre (A-Z)"}),e.jsx(b,{onClick:()=>g("name-desc"),children:"Nombre (Z-A)"}),e.jsx(b,{onClick:()=>g("value-asc"),children:"Valor (Menor a Mayor)"}),e.jsx(b,{onClick:()=>g("value-desc"),children:"Valor (Mayor a Menor)"})]})]})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:ae.map(s=>e.jsx(I,{variant:i===s?"default":"outline",size:"sm",onClick:()=>j(s),className:"whitespace-nowrap rounded-full px-4",children:s==="MEDICAMENTOS"?"Medicamentos":s.charAt(0)+s.slice(1).toLowerCase()},s))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:ee.map(s=>e.jsx(Ie,{name:s.labName,negativeValue:s.negativeValue,positiveValue:s.positiveValue,differenceValue:s.differenceValue,status:s.status,progress:s.progress,onClick:()=>o(`/cyclic-inventory/${encodeURIComponent(s.labName)}`)},s.labName))})]})}export{es as default};
