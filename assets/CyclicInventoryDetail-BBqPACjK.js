const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DmgfIT01.js","assets/ui-vendor-DRrTorv9.js","assets/react-vendor-DdjUaGoS.js","assets/utils-CUsTgaRG.js","assets/animation-CcVxqPrn.js","assets/excel-uoQkVabA.js","assets/index-CZH_woK4.css"])))=>i.map(i=>d[i]);
import{c as be,B as L,X as st,o as z,P as ke,Q as ot,q as ye,C as J,D as Te,h as Me,i as Qe,j as He,r as ze,R as rt,v as T,U as Ee,M as it,S as at,N as lt,_ as ct}from"./index-DmgfIT01.js";import{j as e}from"./ui-vendor-DRrTorv9.js";import{r as S,h as dt,u as ut}from"./react-vendor-DdjUaGoS.js";import{I as K}from"./input-hk0yPGID.js";import{T as pt,a as vt,b as ve,c as me}from"./tabs-CEXQO-kW.js";import{r as mt,u as ne,w as ht}from"./excel-uoQkVabA.js";import{E as ft}from"./jspdf.es.min-DYdSAFu0.js";import{B as xt}from"./badge-DwCaL2_Z.js";import{S as gt,P as _e,B as yt}from"./SwipeableItem-0BEsaO6u.js";import{A as Pe,m as Ae}from"./animation-CcVxqPrn.js";import{C as he}from"./circle-check-CFczltht.js";import{D as wt}from"./dollar-sign-BjHCeV-H.js";import{C as bt,F as jt,S as Ct}from"./save-CXPNDQod.js";import{C as se}from"./CounterAnimation-gX326jcK.js";import{S as Nt}from"./switch-BzPrkFJ7.js";import{L as fe}from"./label-gFGSqa09.js";import{A as St}from"./arrow-left-DR4nFpsi.js";import{S as kt}from"./search-DvLV0TiT.js";import"./utils-CUsTgaRG.js";import"./scanner-ThRrwOEs.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=be("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=be("Delete",[["path",{d:"M10 5a2 2 0 0 0-1.344.519l-6.328 5.74a1 1 0 0 0 0 1.481l6.328 5.741A2 2 0 0 0 10 19h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2z",key:"1yo7s0"}],["path",{d:"m12 9 6 6",key:"anjzzh"}],["path",{d:"m18 9-6 6",key:"1fp51s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=be("ScanBarcode",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M8 7v10",key:"23sfjj"}],["path",{d:"M12 7v10",key:"jspqdw"}],["path",{d:"M17 7v10",key:"578dap"}]]);function At({onResult:t,onClose:n,initialValue:o=""}){const[r,s]=S.useState(o),[a,p]=S.useState(""),x=c=>{s(h=>h==="0"?c:h+c)},u=c=>{p(r+" "+c+" "),s("")},w=()=>{s(""),p("")},g=()=>{try{const c=a+r;if(!/^[0-9+\-*/. ]+$/.test(c)){s("Error");return}const h=new Function("return "+c)();s(String(h)),p(""),t(Number(h))}catch{s("Error")}},P=()=>{s(c=>c.slice(0,-1))},d=[{label:"C",onClick:w,variant:"destructive",className:"col-span-1"},{label:"/",onClick:()=>u("/"),variant:"secondary"},{label:"*",onClick:()=>u("*"),variant:"secondary"},{label:e.jsx(_t,{className:"w-4 h-4"}),onClick:P,variant:"secondary"},{label:"7",onClick:()=>x("7"),variant:"outline"},{label:"8",onClick:()=>x("8"),variant:"outline"},{label:"9",onClick:()=>x("9"),variant:"outline"},{label:"-",onClick:()=>u("-"),variant:"secondary"},{label:"4",onClick:()=>x("4"),variant:"outline"},{label:"5",onClick:()=>x("5"),variant:"outline"},{label:"6",onClick:()=>x("6"),variant:"outline"},{label:"+",onClick:()=>u("+"),variant:"secondary"},{label:"1",onClick:()=>x("1"),variant:"outline"},{label:"2",onClick:()=>x("2"),variant:"outline"},{label:"3",onClick:()=>x("3"),variant:"outline"},{label:"=",onClick:g,variant:"default",className:"row-span-2 h-full"},{label:"0",onClick:()=>x("0"),variant:"outline",className:"col-span-2"},{label:".",onClick:()=>x("."),variant:"outline"}];return e.jsxs("div",{className:"p-4 bg-card rounded-lg border shadow-lg max-w-xs mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground font-mono h-4 block",children:a}),e.jsx(L,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:n,children:e.jsx(st,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"bg-muted p-3 rounded-md mb-4 text-right font-mono text-2xl font-bold tracking-wider overflow-hidden",children:r||"0"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:d.map((c,h)=>e.jsx(L,{variant:c.variant,onClick:c.onClick,className:z("h-12 text-lg font-medium",c.className),children:c.label},h))})]})}const xe=S.memo(function({items:n,onUpdateQuantity:o,onCheck:r,onRevert:s,readOnly:a=!1}){const[p,x]=S.useState(null),[u,w]=S.useState(""),[g,P]=S.useState(!1),d=i=>{x(i.id),w(i.countedQuantity.toString()),P(!1)},c=()=>{if(p){const i=parseInt(u,10);!isNaN(i)&&i>=0&&(o(p,i),x(null))}},h=()=>{x(null),w(""),P(!1)},b=i=>{w(Math.floor(i).toString())};return n.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ke,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No hay productos en esta lista"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3",children:e.jsx(Pe,{mode:"popLayout",children:n.map(i=>{const y=i.countedQuantity-i.systemQuantity,C=y!==0,_=i.status==="controlled",D=y===0;return e.jsx(Ae.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-100},transition:{duration:.2},children:e.jsx(gt,{disabled:a,..._?{leftAction:{label:"Editar",icon:e.jsx(_e,{className:"w-5 h-5"}),color:"text-blue-500",bgColor:"rgba(59, 130, 246, 0.2)",onAction:()=>d(i)},rightAction:s?{label:"Revertir",icon:e.jsx(ye,{className:"w-5 h-5"}),color:"text-red-500",bgColor:"rgba(239, 68, 68, 0.2)",onAction:()=>s(i.id)}:void 0}:{leftAction:{label:"Confirmar",icon:e.jsx(he,{className:"w-5 h-5"}),color:"text-green-600",bgColor:"rgba(22, 163, 74, 0.2)",onAction:()=>r(i.id)},rightAction:{label:"Diferencia",icon:e.jsx(ot,{className:"w-5 h-5"}),color:"text-orange-500",bgColor:"rgba(249, 115, 22, 0.2)",onAction:()=>d(i)}},children:e.jsx(J,{className:z("p-4 hover:shadow-md transition-shadow border-0 rounded-none sm:rounded-xl sm:border"),onClick:()=>d(i),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:z("p-2 rounded-lg flex-shrink-0 transition-colors",_?"bg-success/10":"bg-primary/10"),children:_?e.jsx(he,{className:"w-5 h-5 text-success"}):e.jsx(ke,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-foreground truncate",title:i.name,children:i.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-mono bg-muted px-1.5 py-0.5 rounded",children:i.ean}),i.cost>0&&e.jsxs("span",{className:"flex items-center text-muted-foreground",children:[e.jsx(wt,{className:"w-3 h-3 mr-0.5"}),i.cost.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Sistema"}),e.jsx("span",{className:"text-sm font-medium",children:i.systemQuantity})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Físico"}),e.jsx("span",{className:z("text-sm font-bold",C?"text-warning":"text-success"),children:i.countedQuantity})]}),C&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Diferencia"}),e.jsx(xt,{variant:y>0?"default":"destructive",className:"h-5 px-1.5 text-[10px]",children:y>0?`+${y}`:y})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:k=>{k.stopPropagation(),d(i)},children:e.jsx(_e,{className:"w-4 h-4"})}),i.status==="pending"&&e.jsx(L,{size:"icon",variant:D?"default":"secondary",className:z("h-10 w-10 rounded-full shadow-sm flex-shrink-0 transition-all ml-1",D?"bg-success hover:bg-success/90 text-white":"hover:bg-warning/20 text-warning"),onClick:k=>{k.stopPropagation(),r(i.id)},children:e.jsx(he,{className:"w-5 h-5"})}),i.status==="controlled"&&s&&e.jsx(L,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive hover:bg-destructive/10",onClick:k=>{k.stopPropagation(),s(i.id)},title:"Volver a pendientes",children:e.jsx(ye,{className:"w-4 h-4"})})]})]})})})},i.id)})})}),e.jsx(Te,{open:p!==null,onOpenChange:i=>!i&&h(),children:e.jsxs(Me,{className:"sm:max-w-md",children:[e.jsx(Qe,{children:e.jsx(He,{children:"Editar Cantidad"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Cantidad Física"}),e.jsx(K,{type:"number",min:"0",value:u,onChange:i=>w(i.target.value),onKeyDown:i=>{i.key==="Enter"&&c()},placeholder:"Ingresa la cantidad",autoFocus:!0})]}),e.jsx(L,{variant:g?"secondary":"outline",size:"icon",onClick:()=>P(!g),title:"Calculadora",children:e.jsx(bt,{className:"w-4 h-4"})})]}),e.jsx(Pe,{children:g&&e.jsx(Ae.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx(At,{onResult:b,onClose:()=>P(!1)})})})]}),e.jsxs(ze,{children:[e.jsx(L,{variant:"outline",onClick:h,children:"Cancelar"}),e.jsx(L,{onClick:c,children:"Guardar"})]})]})})]})}),Dt=rt("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Fe=S.forwardRef(({className:t,variant:n,...o},r)=>e.jsx("div",{ref:r,role:"alert",className:z(Dt({variant:n}),t),...o}));Fe.displayName="Alert";const Re=S.forwardRef(({className:t,...n},o)=>e.jsx("h5",{ref:o,className:z("mb-1 font-medium leading-none tracking-tight",t),...n}));Re.displayName="AlertTitle";const Oe=S.forwardRef(({className:t,...n},o)=>e.jsx("div",{ref:o,className:z("text-sm [&_p]:leading-relaxed",t),...n}));Oe.displayName="AlertDescription";let we={},We;function ge(t={}){we={animate:!0,allowClose:!0,overlayClickBehavior:"close",overlayOpacity:.7,smoothScroll:!1,disableActiveInteraction:!1,showProgress:!1,stagePadding:10,stageRadius:5,popoverOffset:10,showButtons:["next","previous","close"],disableButtons:[],overlayColor:"#000",...t}}function v(t){return t?we[t]:we}function It(t){We=t}function Q(){return We}let ie={};function oe(t,n){ie[t]=n}function W(t){var n;(n=ie[t])==null||n.call(ie)}function Lt(){ie={}}function re(t,n,o,r){return(t/=r/2)<1?o/2*t*t+n:-o/2*(--t*(t-2)-1)+n}function qe(t){const n='a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])';return t.flatMap(o=>{const r=o.matches(n),s=Array.from(o.querySelectorAll(n));return[...r?[o]:[],...s]}).filter(o=>getComputedStyle(o).pointerEvents!=="none"&&Tt(o))}function Ve(t){if(!t||Bt(t))return;const n=v("smoothScroll"),o=t.offsetHeight>window.innerHeight;t.scrollIntoView({behavior:!n||$t(t)?"auto":"smooth",inline:"center",block:o?"start":"center"})}function $t(t){if(!t||!t.parentElement)return;const n=t.parentElement;return n.scrollHeight>n.clientHeight}function Bt(t){const n=t.getBoundingClientRect();return n.top>=0&&n.left>=0&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&n.right<=(window.innerWidth||document.documentElement.clientWidth)}function Tt(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)}let ae={};function $(t,n){ae[t]=n}function m(t){return t?ae[t]:ae}function De(){ae={}}function Mt(t,n,o,r){let s=m("__activeStagePosition");const a=s||o.getBoundingClientRect(),p=r.getBoundingClientRect(),x=re(t,a.x,p.x-a.x,n),u=re(t,a.y,p.y-a.y,n),w=re(t,a.width,p.width-a.width,n),g=re(t,a.height,p.height-a.height,n);s={x,y:u,width:w,height:g},Xe(s),$("__activeStagePosition",s)}function Ue(t){if(!t)return;const n=t.getBoundingClientRect(),o={x:n.x,y:n.y,width:n.width,height:n.height};$("__activeStagePosition",o),Xe(o)}function Qt(){const t=m("__activeStagePosition"),n=m("__overlaySvg");if(!t)return;if(!n){console.warn("No stage svg found.");return}const o=window.innerWidth,r=window.innerHeight;n.setAttribute("viewBox",`0 0 ${o} ${r}`)}function Ht(t){const n=zt(t);document.body.appendChild(n),Ye(n,o=>{o.target.tagName==="path"&&W("overlayClick")}),$("__overlaySvg",n)}function Xe(t){const n=m("__overlaySvg");if(!n){Ht(t);return}const o=n.firstElementChild;if((o==null?void 0:o.tagName)!=="path")throw new Error("no path element found in stage svg");o.setAttribute("d",Je(t))}function zt(t){const n=window.innerWidth,o=window.innerHeight,r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("driver-overlay","driver-overlay-animated"),r.setAttribute("viewBox",`0 0 ${n} ${o}`),r.setAttribute("xmlSpace","preserve"),r.setAttribute("xmlnsXlink","http://www.w3.org/1999/xlink"),r.setAttribute("version","1.1"),r.setAttribute("preserveAspectRatio","xMinYMin slice"),r.style.fillRule="evenodd",r.style.clipRule="evenodd",r.style.strokeLinejoin="round",r.style.strokeMiterlimit="2",r.style.zIndex="10000",r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.width="100%",r.style.height="100%";const s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("d",Je(t)),s.style.fill=v("overlayColor")||"rgb(0,0,0)",s.style.opacity=`${v("overlayOpacity")}`,s.style.pointerEvents="auto",s.style.cursor="auto",r.appendChild(s),r}function Je(t){const n=window.innerWidth,o=window.innerHeight,r=v("stagePadding")||0,s=v("stageRadius")||0,a=t.width+r*2,p=t.height+r*2,x=Math.min(s,a/2,p/2),u=Math.floor(Math.max(x,0)),w=t.x-r+u,g=t.y-r,P=a-u*2,d=p-u*2;return`M${n},0L0,0L0,${o}L${n},${o}L${n},0Z
    M${w},${g} h${P} a${u},${u} 0 0 1 ${u},${u} v${d} a${u},${u} 0 0 1 -${u},${u} h-${P} a${u},${u} 0 0 1 -${u},-${u} v-${d} a${u},${u} 0 0 1 ${u},-${u} z`}function Ft(){const t=m("__overlaySvg");t&&t.remove()}function Rt(){const t=document.getElementById("driver-dummy-element");if(t)return t;let n=document.createElement("div");return n.id="driver-dummy-element",n.style.width="0",n.style.height="0",n.style.pointerEvents="none",n.style.opacity="0",n.style.position="fixed",n.style.top="50%",n.style.left="50%",document.body.appendChild(n),n}function Ie(t){const{element:n}=t;let o=typeof n=="function"?n():typeof n=="string"?document.querySelector(n):n;o||(o=Rt()),Wt(o,t)}function Ot(){const t=m("__activeElement"),n=m("__activeStep");t&&(Ue(t),Qt(),Ze(t,n))}function Wt(t,n){var o;const r=Date.now(),s=m("__activeStep"),a=m("__activeElement")||t,p=!a||a===t,x=t.id==="driver-dummy-element",u=a.id==="driver-dummy-element",w=v("animate"),g=n.onHighlightStarted||v("onHighlightStarted"),P=(n==null?void 0:n.onHighlighted)||v("onHighlighted"),d=(s==null?void 0:s.onDeselected)||v("onDeselected"),c=v(),h=m();!p&&d&&d(u?void 0:a,s,{config:c,state:h,driver:Q()}),g&&g(x?void 0:t,n,{config:c,state:h,driver:Q()});const b=!p&&w;let i=!1;Jt(),$("previousStep",s),$("previousElement",a),$("activeStep",n),$("activeElement",t);const y=()=>{if(m("__transitionCallback")!==y)return;const C=Date.now()-r,_=400-C<=400/2;n.popover&&_&&!i&&b&&(Le(t,n),i=!0),v("animate")&&C<400?Mt(C,400,a,t):(Ue(t),P&&P(x?void 0:t,n,{config:v(),state:m(),driver:Q()}),$("__transitionCallback",void 0),$("__previousStep",s),$("__previousElement",a),$("__activeStep",n),$("__activeElement",t)),window.requestAnimationFrame(y)};$("__transitionCallback",y),window.requestAnimationFrame(y),Ve(t),!b&&n.popover&&Le(t,n),a.classList.remove("driver-active-element","driver-no-interaction"),a.removeAttribute("aria-haspopup"),a.removeAttribute("aria-expanded"),a.removeAttribute("aria-controls"),((o=n.disableActiveInteraction)!=null?o:v("disableActiveInteraction"))&&t.classList.add("driver-no-interaction"),t.classList.add("driver-active-element"),t.setAttribute("aria-haspopup","dialog"),t.setAttribute("aria-expanded","true"),t.setAttribute("aria-controls","driver-popover-content")}function qt(){var t;(t=document.getElementById("driver-dummy-element"))==null||t.remove(),document.querySelectorAll(".driver-active-element").forEach(n=>{n.classList.remove("driver-active-element","driver-no-interaction"),n.removeAttribute("aria-haspopup"),n.removeAttribute("aria-expanded"),n.removeAttribute("aria-controls")})}function Z(){const t=m("__resizeTimeout");t&&window.cancelAnimationFrame(t),$("__resizeTimeout",window.requestAnimationFrame(Ot))}function Vt(t){var n;if(!m("isInitialized")||!(t.key==="Tab"||t.keyCode===9))return;const o=m("__activeElement"),r=(n=m("popover"))==null?void 0:n.wrapper,s=qe([...r?[r]:[],...o?[o]:[]]),a=s[0],p=s[s.length-1];if(t.preventDefault(),t.shiftKey){const x=s[s.indexOf(document.activeElement)-1]||p;x==null||x.focus()}else{const x=s[s.indexOf(document.activeElement)+1]||a;x==null||x.focus()}}function Ke(t){var n;((n=v("allowKeyboardControl"))==null||n)&&(t.key==="Escape"?W("escapePress"):t.key==="ArrowRight"?W("arrowRightPress"):t.key==="ArrowLeft"&&W("arrowLeftPress"))}function Ye(t,n,o){const r=(s,a)=>{const p=s.target;t.contains(p)&&((!o||o(p))&&(s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation()),a==null||a(s))};document.addEventListener("pointerdown",r,!0),document.addEventListener("mousedown",r,!0),document.addEventListener("pointerup",r,!0),document.addEventListener("mouseup",r,!0),document.addEventListener("click",s=>{r(s,n)},!0)}function Ut(){window.addEventListener("keyup",Ke,!1),window.addEventListener("keydown",Vt,!1),window.addEventListener("resize",Z),window.addEventListener("scroll",Z)}function Xt(){window.removeEventListener("keyup",Ke),window.removeEventListener("resize",Z),window.removeEventListener("scroll",Z)}function Jt(){const t=m("popover");t&&(t.wrapper.style.display="none")}function Le(t,n){var o,r;let s=m("popover");s&&document.body.removeChild(s.wrapper),s=Yt(),document.body.appendChild(s.wrapper);const{title:a,description:p,showButtons:x,disableButtons:u,showProgress:w,nextBtnText:g=v("nextBtnText")||"Next &rarr;",prevBtnText:P=v("prevBtnText")||"&larr; Previous",progressText:d=v("progressText")||"{current} of {total}"}=n.popover||{};s.nextButton.innerHTML=g,s.previousButton.innerHTML=P,s.progress.innerHTML=d,a?(s.title.innerHTML=a,s.title.style.display="block"):s.title.style.display="none",p?(s.description.innerHTML=p,s.description.style.display="block"):s.description.style.display="none";const c=x||v("showButtons"),h=w||v("showProgress")||!1,b=(c==null?void 0:c.includes("next"))||(c==null?void 0:c.includes("previous"))||h;s.closeButton.style.display=c.includes("close")?"block":"none",b?(s.footer.style.display="flex",s.progress.style.display=h?"block":"none",s.nextButton.style.display=c.includes("next")?"block":"none",s.previousButton.style.display=c.includes("previous")?"block":"none"):s.footer.style.display="none";const i=u||v("disableButtons")||[];i!=null&&i.includes("next")&&(s.nextButton.disabled=!0,s.nextButton.classList.add("driver-popover-btn-disabled")),i!=null&&i.includes("previous")&&(s.previousButton.disabled=!0,s.previousButton.classList.add("driver-popover-btn-disabled")),i!=null&&i.includes("close")&&(s.closeButton.disabled=!0,s.closeButton.classList.add("driver-popover-btn-disabled"));const y=s.wrapper;y.style.display="block",y.style.left="",y.style.top="",y.style.bottom="",y.style.right="",y.id="driver-popover-content",y.setAttribute("role","dialog"),y.setAttribute("aria-labelledby","driver-popover-title"),y.setAttribute("aria-describedby","driver-popover-description");const C=s.arrow;C.className="driver-popover-arrow";const _=((o=n.popover)==null?void 0:o.popoverClass)||v("popoverClass")||"";y.className=`driver-popover ${_}`.trim(),Ye(s.wrapper,M=>{var F,q,V;const R=M.target,U=((F=n.popover)==null?void 0:F.onNextClick)||v("onNextClick"),H=((q=n.popover)==null?void 0:q.onPrevClick)||v("onPrevClick"),X=((V=n.popover)==null?void 0:V.onCloseClick)||v("onCloseClick");if(R.closest(".driver-popover-next-btn"))return U?U(t,n,{config:v(),state:m(),driver:Q()}):W("nextClick");if(R.closest(".driver-popover-prev-btn"))return H?H(t,n,{config:v(),state:m(),driver:Q()}):W("prevClick");if(R.closest(".driver-popover-close-btn"))return X?X(t,n,{config:v(),state:m(),driver:Q()}):W("closeClick")},M=>!(s!=null&&s.description.contains(M))&&!(s!=null&&s.title.contains(M))&&typeof M.className=="string"&&M.className.includes("driver-popover")),$("popover",s);const D=((r=n.popover)==null?void 0:r.onPopoverRender)||v("onPopoverRender");D&&D(s,{config:v(),state:m(),driver:Q()}),Ze(t,n),Ve(y);const k=t.classList.contains("driver-dummy-element"),E=qe([y,...k?[]:[t]]);E.length>0&&E[0].focus()}function Ge(){const t=m("popover");if(!(t!=null&&t.wrapper))return;const n=t.wrapper.getBoundingClientRect(),o=v("stagePadding")||0,r=v("popoverOffset")||0;return{width:n.width+o+r,height:n.height+o+r,realWidth:n.width,realHeight:n.height}}function $e(t,n){const{elementDimensions:o,popoverDimensions:r,popoverPadding:s,popoverArrowDimensions:a}=n;return t==="start"?Math.max(Math.min(o.top-s,window.innerHeight-r.realHeight-a.width),a.width):t==="end"?Math.max(Math.min(o.top-(r==null?void 0:r.realHeight)+o.height+s,window.innerHeight-(r==null?void 0:r.realHeight)-a.width),a.width):t==="center"?Math.max(Math.min(o.top+o.height/2-(r==null?void 0:r.realHeight)/2,window.innerHeight-(r==null?void 0:r.realHeight)-a.width),a.width):0}function Be(t,n){const{elementDimensions:o,popoverDimensions:r,popoverPadding:s,popoverArrowDimensions:a}=n;return t==="start"?Math.max(Math.min(o.left-s,window.innerWidth-r.realWidth-a.width),a.width):t==="end"?Math.max(Math.min(o.left-(r==null?void 0:r.realWidth)+o.width+s,window.innerWidth-(r==null?void 0:r.realWidth)-a.width),a.width):t==="center"?Math.max(Math.min(o.left+o.width/2-(r==null?void 0:r.realWidth)/2,window.innerWidth-(r==null?void 0:r.realWidth)-a.width),a.width):0}function Ze(t,n){const o=m("popover");if(!o)return;const{align:r="start",side:s="left"}=(n==null?void 0:n.popover)||{},a=r,p=t.id==="driver-dummy-element"?"over":s,x=v("stagePadding")||0,u=Ge(),w=o.arrow.getBoundingClientRect(),g=t.getBoundingClientRect(),P=g.top-u.height;let d=P>=0;const c=window.innerHeight-(g.bottom+u.height);let h=c>=0;const b=g.left-u.width;let i=b>=0;const y=window.innerWidth-(g.right+u.width);let C=y>=0;const _=!d&&!h&&!i&&!C;let D=p;if(p==="top"&&d?C=i=h=!1:p==="bottom"&&h?C=i=d=!1:p==="left"&&i?C=d=h=!1:p==="right"&&C&&(i=d=h=!1),p==="over"){const k=window.innerWidth/2-u.realWidth/2,E=window.innerHeight/2-u.realHeight/2;o.wrapper.style.left=`${k}px`,o.wrapper.style.right="auto",o.wrapper.style.top=`${E}px`,o.wrapper.style.bottom="auto"}else if(_){const k=window.innerWidth/2-(u==null?void 0:u.realWidth)/2,E=10;o.wrapper.style.left=`${k}px`,o.wrapper.style.right="auto",o.wrapper.style.bottom=`${E}px`,o.wrapper.style.top="auto"}else if(i){const k=Math.min(b,window.innerWidth-(u==null?void 0:u.realWidth)-w.width),E=$e(a,{elementDimensions:g,popoverDimensions:u,popoverPadding:x,popoverArrowDimensions:w});o.wrapper.style.left=`${k}px`,o.wrapper.style.top=`${E}px`,o.wrapper.style.bottom="auto",o.wrapper.style.right="auto",D="left"}else if(C){const k=Math.min(y,window.innerWidth-(u==null?void 0:u.realWidth)-w.width),E=$e(a,{elementDimensions:g,popoverDimensions:u,popoverPadding:x,popoverArrowDimensions:w});o.wrapper.style.right=`${k}px`,o.wrapper.style.top=`${E}px`,o.wrapper.style.bottom="auto",o.wrapper.style.left="auto",D="right"}else if(d){const k=Math.min(P,window.innerHeight-u.realHeight-w.width);let E=Be(a,{elementDimensions:g,popoverDimensions:u,popoverPadding:x,popoverArrowDimensions:w});o.wrapper.style.top=`${k}px`,o.wrapper.style.left=`${E}px`,o.wrapper.style.bottom="auto",o.wrapper.style.right="auto",D="top"}else if(h){const k=Math.min(c,window.innerHeight-(u==null?void 0:u.realHeight)-w.width);let E=Be(a,{elementDimensions:g,popoverDimensions:u,popoverPadding:x,popoverArrowDimensions:w});o.wrapper.style.left=`${E}px`,o.wrapper.style.bottom=`${k}px`,o.wrapper.style.top="auto",o.wrapper.style.right="auto",D="bottom"}_?o.arrow.classList.add("driver-popover-arrow-none"):Kt(a,D,t)}function Kt(t,n,o){const r=m("popover");if(!r)return;const s=o.getBoundingClientRect(),a=Ge(),p=r.arrow,x=a.width,u=window.innerWidth,w=s.width,g=s.left,P=a.height,d=window.innerHeight,c=s.top,h=s.height;p.className="driver-popover-arrow";let b=n,i=t;if(n==="top"?(g+w<=0?(b="right",i="end"):g+w-x<=0&&(b="top",i="start"),g>=u?(b="left",i="end"):g+x>=u&&(b="top",i="end")):n==="bottom"?(g+w<=0?(b="right",i="start"):g+w-x<=0&&(b="bottom",i="start"),g>=u?(b="left",i="start"):g+x>=u&&(b="bottom",i="end")):n==="left"?(c+h<=0?(b="bottom",i="end"):c+h-P<=0&&(b="left",i="start"),c>=d?(b="top",i="end"):c+P>=d&&(b="left",i="end")):n==="right"&&(c+h<=0?(b="bottom",i="start"):c+h-P<=0&&(b="right",i="start"),c>=d?(b="top",i="start"):c+P>=d&&(b="right",i="end")),!b)p.classList.add("driver-popover-arrow-none");else{p.classList.add(`driver-popover-arrow-side-${b}`),p.classList.add(`driver-popover-arrow-align-${i}`);const y=o.getBoundingClientRect(),C=p.getBoundingClientRect(),_=v("stagePadding")||0,D=y.left-_<window.innerWidth&&y.right+_>0&&y.top-_<window.innerHeight&&y.bottom+_>0;n==="bottom"&&D&&(C.x>y.x&&C.x+C.width<y.x+y.width?r.wrapper.style.transform="translateY(0)":(p.classList.remove(`driver-popover-arrow-align-${i}`),p.classList.add("driver-popover-arrow-none"),r.wrapper.style.transform=`translateY(-${_/2}px)`))}}function Yt(){const t=document.createElement("div");t.classList.add("driver-popover");const n=document.createElement("div");n.classList.add("driver-popover-arrow");const o=document.createElement("header");o.id="driver-popover-title",o.classList.add("driver-popover-title"),o.style.display="none",o.innerText="Popover Title";const r=document.createElement("div");r.id="driver-popover-description",r.classList.add("driver-popover-description"),r.style.display="none",r.innerText="Popover description is here";const s=document.createElement("button");s.type="button",s.classList.add("driver-popover-close-btn"),s.setAttribute("aria-label","Close"),s.innerHTML="&times;";const a=document.createElement("footer");a.classList.add("driver-popover-footer");const p=document.createElement("span");p.classList.add("driver-popover-progress-text"),p.innerText="";const x=document.createElement("span");x.classList.add("driver-popover-navigation-btns");const u=document.createElement("button");u.type="button",u.classList.add("driver-popover-prev-btn"),u.innerHTML="&larr; Previous";const w=document.createElement("button");return w.type="button",w.classList.add("driver-popover-next-btn"),w.innerHTML="Next &rarr;",x.appendChild(u),x.appendChild(w),a.appendChild(p),a.appendChild(x),t.appendChild(s),t.appendChild(n),t.appendChild(o),t.appendChild(r),t.appendChild(a),{wrapper:t,arrow:n,title:o,description:r,footer:a,previousButton:u,nextButton:w,closeButton:s,footerButtons:x,progress:p}}function Gt(){var t;const n=m("popover");n&&((t=n.wrapper.parentElement)==null||t.removeChild(n.wrapper))}function Zt(t={}){ge(t);function n(){v("allowClose")&&g()}function o(){const d=v("overlayClickBehavior");if(v("allowClose")&&d==="close"){g();return}if(typeof d=="function"){const c=m("__activeStep"),h=m("__activeElement");d(h,c,{config:v(),state:m(),driver:Q()});return}d==="nextStep"&&r()}function r(){const d=m("activeIndex"),c=v("steps")||[];if(typeof d>"u")return;const h=d+1;c[h]?w(h):g()}function s(){const d=m("activeIndex"),c=v("steps")||[];if(typeof d>"u")return;const h=d-1;c[h]?w(h):g()}function a(d){(v("steps")||[])[d]?w(d):g()}function p(){var d;if(m("__transitionCallback"))return;const c=m("activeIndex"),h=m("__activeStep"),b=m("__activeElement");if(typeof c>"u"||typeof h>"u"||typeof m("activeIndex")>"u")return;const i=((d=h.popover)==null?void 0:d.onPrevClick)||v("onPrevClick");if(i)return i(b,h,{config:v(),state:m(),driver:Q()});s()}function x(){var d;if(m("__transitionCallback"))return;const c=m("activeIndex"),h=m("__activeStep"),b=m("__activeElement");if(typeof c>"u"||typeof h>"u")return;const i=((d=h.popover)==null?void 0:d.onNextClick)||v("onNextClick");if(i)return i(b,h,{config:v(),state:m(),driver:Q()});r()}function u(){m("isInitialized")||($("isInitialized",!0),document.body.classList.add("driver-active",v("animate")?"driver-fade":"driver-simple"),Ut(),oe("overlayClick",o),oe("escapePress",n),oe("arrowLeftPress",p),oe("arrowRightPress",x))}function w(d=0){var c,h,b,i,y,C,_,D;const k=v("steps");if(!k){console.error("No steps to drive through"),g();return}if(!k[d]){g();return}$("__activeOnDestroyed",document.activeElement),$("activeIndex",d);const E=k[d],M=k[d+1],F=k[d-1],q=((c=E.popover)==null?void 0:c.doneBtnText)||v("doneBtnText")||"Done",V=v("allowClose"),R=typeof((h=E.popover)==null?void 0:h.showProgress)<"u"?(b=E.popover)==null?void 0:b.showProgress:v("showProgress"),U=(((i=E.popover)==null?void 0:i.progressText)||v("progressText")||"{{current}} of {{total}}").replace("{{current}}",`${d+1}`).replace("{{total}}",`${k.length}`),H=((y=E.popover)==null?void 0:y.showButtons)||v("showButtons"),X=["next","previous",...V?["close"]:[]].filter(de=>!(H!=null&&H.length)||H.includes(de)),ee=((C=E.popover)==null?void 0:C.onNextClick)||v("onNextClick"),le=((_=E.popover)==null?void 0:_.onPrevClick)||v("onPrevClick"),ce=((D=E.popover)==null?void 0:D.onCloseClick)||v("onCloseClick");Ie({...E,popover:{showButtons:X,nextBtnText:M?void 0:q,disableButtons:[...F?[]:["previous"]],showProgress:R,progressText:U,onNextClick:ee||(()=>{M?w(d+1):g()}),onPrevClick:le||(()=>{w(d-1)}),onCloseClick:ce||(()=>{g()}),...(E==null?void 0:E.popover)||{}}})}function g(d=!0){const c=m("__activeElement"),h=m("__activeStep"),b=m("__activeOnDestroyed"),i=v("onDestroyStarted");if(d&&i){const _=!c||(c==null?void 0:c.id)==="driver-dummy-element";i(_?void 0:c,h,{config:v(),state:m(),driver:Q()});return}const y=(h==null?void 0:h.onDeselected)||v("onDeselected"),C=v("onDestroyed");if(document.body.classList.remove("driver-active","driver-fade","driver-simple"),Xt(),Gt(),qt(),Ft(),Lt(),De(),c&&h){const _=c.id==="driver-dummy-element";y&&y(_?void 0:c,h,{config:v(),state:m(),driver:Q()}),C&&C(_?void 0:c,h,{config:v(),state:m(),driver:Q()})}b&&b.focus()}const P={isActive:()=>m("isInitialized")||!1,refresh:Z,drive:(d=0)=>{u(),w(d)},setConfig:ge,setSteps:d=>{De(),ge({...v(),steps:d})},getConfig:v,getState:m,getActiveIndex:()=>m("activeIndex"),isFirstStep:()=>m("activeIndex")===0,isLastStep:()=>{const d=v("steps")||[],c=m("activeIndex");return c!==void 0&&c===d.length-1},getActiveStep:()=>m("activeStep"),getActiveElement:()=>m("activeElement"),getPreviousElement:()=>m("previousElement"),getPreviousStep:()=>m("previousStep"),moveNext:r,movePrevious:s,moveTo:a,hasNextStep:()=>{const d=v("steps")||[],c=m("activeIndex");return c!==void 0&&!!d[c+1]},hasPreviousStep:()=>{const d=v("steps")||[],c=m("activeIndex");return c!==void 0&&!!d[c-1]},highlight:d=>{u(),Ie({...d,popover:d.popover?{showButtons:[],showProgress:!1,progressText:"",...d.popover}:void 0})},destroy:()=>{g(!1)}};return It(P),P}function en(){const t=()=>{Zt({showProgress:!0,steps:[{element:"#diff-mode",popover:{title:"Solo Diferencias",description:"Activa este interruptor para ver solo los productos que tienen diferencias entre el stock físico y el del sistema.",side:"bottom",align:"start"}},{element:'[role="tablist"]',popover:{title:"Pestañas de Estado",description:'Navega entre "Pendientes" y "Controlados" para organizar tu trabajo.',side:"bottom",align:"start"}},{element:".bg-card.relative",popover:{title:"Acciones Rápidas",description:"Desliza a la derecha para Confirmar/Editar o a la izquierda para reportar Diferencia/Revertir.",side:"top",align:"start"}},{element:"button:has(.lucide-save)",popover:{title:"Finalizar Inventario",description:"Cuando termines, guarda el estado del inventario aquí.",side:"left",align:"start"}}]}).drive()};return S.useEffect(()=>{localStorage.getItem("has_seen_inventory_tour")||setTimeout(()=>{t(),localStorage.setItem("has_seen_inventory_tour","true")},1e3)},[]),e.jsx(L,{variant:"ghost",size:"icon",onClick:t,title:"Ver Tutorial",children:e.jsx(Et,{className:"w-5 h-5"})})}function jn(){const{id:t}=dt(),n=ut(),[o,r]=S.useState(!1),[s,a]=S.useState([]),[p,x]=S.useState(""),[u,w]=S.useState(""),[g,P]=S.useState(!1),[d,c]=S.useState(!1),[h,b]=S.useState(""),[i,y]=S.useState("");S.useEffect(()=>{t&&x(decodeURIComponent(t))},[t]),S.useEffect(()=>{if(p){const l=localStorage.getItem(`cyclic_inventory_${p}`);if(l)try{const f=JSON.parse(l);if(Array.isArray(f)){const N=f.filter(j=>j&&typeof j=="object"&&typeof j.id=="string"&&typeof j.name=="string"&&typeof j.systemQuantity=="number"&&typeof j.countedQuantity=="number");N.length!==f.length&&console.warn(`Filtered out ${f.length-N.length} invalid items.`),a(N)}else console.warn("Invalid inventory data format in localStorage, resetting."),a([])}catch(f){console.error("Failed to load saved inventory",f),a([])}}},[p]),S.useEffect(()=>{p&&s.length>0&&localStorage.setItem(`cyclic_inventory_${p}`,JSON.stringify(s))},[s,p]);const C=S.useMemo(()=>s.filter(l=>{if(u){const f=u.toLowerCase();if(!l.name.toLowerCase().includes(f)&&!l.ean.includes(f))return!1}return g?l.countedQuantity!==l.systemQuantity:!0}),[s,u,g]),_=S.useMemo(()=>C.filter(l=>l.status==="pending"),[C]),D=S.useMemo(()=>C.filter(l=>l.status==="controlled"),[C]),k=S.useMemo(()=>C.filter(l=>l.status==="adjusted"),[C]),E=async l=>{var j;const f=(j=l.target.files)==null?void 0:j[0];if(!f)return;r(!0);const N=new FileReader;N.onload=I=>{var B,A;try{const Y=(B=I.target)==null?void 0:B.result,je=mt(Y,{type:"binary"}),tt=je.SheetNames[0],nt=je.Sheets[tt],Ce=ne.sheet_to_json(nt,{header:1}),Ne=[...s],Se=new Set(s.map(G=>G.ean));let ue=0,pe=0;for(let G=1;G<Ce.length;G++){const O=Ce[G];if(!O||!O[3])continue;const te=(A=O[2])==null?void 0:A.toString().trim();if(te){if(Se.has(te)){pe++;continue}Ne.push({id:crypto.randomUUID(),ean:te,name:O[3],systemQuantity:Number(O[4])||0,countedQuantity:Number(O[4])||0,cost:Number(O[12])||0,status:"pending"}),Se.add(te),ue++}}a(Ne),pe>0?T.success(`Procesado. ${ue} nuevos, ${pe} ignorados (ya existentes/ajustados).`):T.success(`Archivo procesado. Se agregaron ${ue} items nuevos.`)}catch(Y){console.error("Error reading file:",Y),T.error("Error al procesar el archivo Excel.")}finally{r(!1),l.target.value=""}},N.readAsBinaryString(f)},M=S.useCallback((l,f)=>{a(N=>N.map(j=>j.id===l?(f-j.systemQuantity!==0&&navigator.vibrate?navigator.vibrate([50,50,50]):navigator.vibrate&&navigator.vibrate(50),{...j,countedQuantity:f,status:"controlled"}):j))},[]),F=S.useCallback(l=>{navigator.vibrate&&navigator.vibrate(50),a(f=>f.map(N=>N.id===l?{...N,status:"controlled",countedQuantity:N.systemQuantity}:N)),T.success("Producto controlado")},[]),q=S.useCallback(l=>{a(f=>f.map(N=>N.id===l?{...N,status:"pending"}:N)),T.info("Producto devuelto a pendientes")},[]),V=()=>{const l=D.filter(A=>A.countedQuantity<A.systemQuantity),f=D.filter(A=>A.countedQuantity>A.systemQuantity),N=l.length>0,j=f.length>0;if(N&&!h.trim()){T.error("Por favor ingresa el ID de ajuste para Faltantes");return}if(j&&!i.trim()){T.error("Por favor ingresa el ID de ajuste para Sobrantes");return}const I=s.map(A=>A.status==="controlled"?{...A,status:"adjusted"}:A).filter(A=>A.status==="adjusted");a(I);const B={status:"controlado",lastUpdated:Date.now(),shortageId:h,surplusId:i,items:I};localStorage.setItem(`cyclic_inventory_status_${p}`,JSON.stringify(B)),ct(async()=>{const{OfflineQueue:A}=await import("./index-DmgfIT01.js").then(Y=>Y.ad);return{OfflineQueue:A}},__vite__mapDeps([0,1,2,3,4,5,6])).then(({OfflineQueue:A})=>{A.enqueue("SAVE_INVENTORY",{labName:p,shortageId:h,surplusId:i,items:I}),navigator.onLine?T.success("Ajustes guardados correctamente. Los items pendientes han sido limpiados."):T.info("Guardado en cola. Se sincronizará cuando recuperes la conexión.")}),c(!1),b(""),y("")},R=D.filter(l=>l.countedQuantity<l.systemQuantity).reduce((l,f)=>l+(f.systemQuantity-f.countedQuantity)*f.cost,0),U=D.filter(l=>l.countedQuantity>l.systemQuantity).reduce((l,f)=>l+(f.countedQuantity-f.systemQuantity)*f.cost,0),H=()=>{const l=s.map(j=>({EAN:j.ean,Producto:j.name,Laboratorio:p,"Cantidad Sistema":j.systemQuantity,"Cantidad Física":j.countedQuantity,Diferencia:j.countedQuantity-j.systemQuantity,Costo:j.cost,Estado:j.status==="controlled"?"CONTROLADO":j.status==="adjusted"?"AJUSTADO":"PENDIENTE"})),f=ne.json_to_sheet(l),N=ne.book_new();ne.book_append_sheet(N,f,"Inventario"),ht(N,`Inventario_${p}.xlsx`),T.success("Excel generado")},[X,ee]=S.useState(!1),le=S.useCallback(l=>{const f=s.find(N=>N.ean===l);f?(M(f.id,f.countedQuantity+1),T.success(`Producto encontrado: ${f.name}`)):T.error(`Producto no encontrado: ${l}`)},[s,M]),ce=S.useCallback(l=>{let f=0,N=0;const j=new Map;s.forEach(I=>j.set(I.id,I.countedQuantity)),l.forEach(I=>{const B=s.find(A=>A.ean===I);if(B){const A=j.get(B.id)||0;j.set(B.id,A+1),f++}else N++}),f>0&&(a(I=>I.map(B=>{if(j.has(B.id)){const A=j.get(B.id);if(A!==B.countedQuantity)return{...B,countedQuantity:A,status:"controlled"}}return B})),T.success(`Procesados ${f} items correctamente.`)),N>0&&T.warning(`${N} códigos no encontrados.`)},[s]),de=()=>{const l=new ft;l.setFontSize(16),l.text(`Inventario Cíclico: ${p}`,10,10),l.setFontSize(10),l.text(`Fecha: ${new Date().toLocaleDateString()}`,10,18);let f=30;const N=10,j=l.internal.pageSize.height;l.setFont("helvetica","bold"),l.text("Producto",10,f),l.text("Sistema",100,f),l.text("Físico",130,f),l.text("Dif",160,f),l.text("Estado",180,f),f+=N,l.setFont("helvetica","normal"),s.forEach(I=>{f>j-20&&(l.addPage(),f=20);const B=I.countedQuantity-I.systemQuantity;l.text(I.name.substring(0,40),10,f),l.text(I.systemQuantity.toString(),100,f),l.text(I.countedQuantity.toString(),130,f),l.setTextColor(B===0?0:255,0,0),l.text(B.toString(),160,f),l.setTextColor(0),l.text(I.status==="controlled"?"OK":I.status==="adjusted"?"Ajust":"Pend",180,f),f+=N}),l.save(`Inventario_${p}_${new Date().toISOString().split("T")[0]}.pdf`),T.success("Reporte PDF generado")},et=()=>{confirm("¿Estás seguro de que quieres reiniciar los datos de este laboratorio? Se perderán los cambios no guardados.")&&(localStorage.removeItem(`cyclic_inventory_${p}`),localStorage.removeItem(`cyclic_inventory_status_${p}`),a([]),T.success("Datos reiniciados correctamente."),n("/cyclic-inventory"))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{variant:"ghost",size:"icon",onClick:()=>n("/cyclic-inventory"),children:e.jsx(St,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:p}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Control de Inventario Cíclico"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(en,{}),s.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsxs(L,{variant:"outline",size:"sm",disabled:o,className:"cursor-pointer",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Cargar Excel"]}),e.jsx(K,{type:"file",accept:".xlsx, .xls",className:"absolute inset-0 opacity-0 cursor-pointer w-full h-full",onChange:E,disabled:o,title:"Importar archivo adicional"})]}),e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>ee(!0),children:[e.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Escanear"]}),e.jsxs(L,{variant:"outline",size:"sm",onClick:H,children:[e.jsx(jt,{className:"w-4 h-4 mr-2"}),"Excel"]}),e.jsxs(L,{variant:"outline",size:"sm",onClick:de,children:[e.jsx(it,{className:"w-4 h-4 mr-2"}),"PDF"]}),e.jsxs(L,{variant:"default",size:"sm",onClick:()=>c(!0),children:[e.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Finalizar"]})]})]})]}),s.length===0?e.jsxs(J,{className:"p-12 border-dashed border-2 flex flex-col items-center justify-center text-center space-y-4 bg-muted/20",children:[e.jsx("div",{className:"p-4 bg-primary/10 rounded-full",children:e.jsx(Ee,{className:"w-8 h-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Cargar Archivo de Inventario"}),e.jsxs("p",{className:"text-muted-foreground max-w-md mx-auto mt-2",children:["Sube el archivo Excel (.xlsx) descargado del sistema para comenzar el control de ",p,"."]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{disabled:o,children:o?"Procesando...":"Seleccionar Archivo"}),e.jsx(K,{type:"file",accept:".xlsx, .xls",className:"absolute inset-0 opacity-0 cursor-pointer",onChange:E,disabled:o})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-4",children:"Columnas requeridas: C (EAN), D (Producto), E (Cantidad), O (Laboratorio)"})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-3 grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(J,{className:"p-4 flex flex-col items-center justify-center bg-warning/5 border-warning/20",children:[e.jsx("span",{className:"text-muted-foreground text-xs uppercase font-bold",children:"Pendientes"}),e.jsx("span",{className:"text-2xl font-bold text-warning",children:e.jsx(se,{value:s.filter(l=>l.status==="pending").length})})]}),e.jsxs(J,{className:"p-4 flex flex-col items-center justify-center bg-success/5 border-success/20",children:[e.jsx("span",{className:"text-muted-foreground text-xs uppercase font-bold",children:"Controlados"}),e.jsx("span",{className:"text-2xl font-bold text-success",children:e.jsx(se,{value:s.filter(l=>l.status==="controlled").length})})]}),e.jsxs(J,{className:"p-4 flex flex-col items-center justify-center bg-blue-500/5 border-blue-500/20",children:[e.jsx("span",{className:"text-muted-foreground text-xs uppercase font-bold",children:"Ajustados"}),e.jsx("span",{className:"text-2xl font-bold text-blue-500",children:e.jsx(se,{value:s.filter(l=>l.status==="adjusted").length})})]}),e.jsxs(J,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-muted-foreground text-xs uppercase font-bold",children:"Avance"}),e.jsxs("span",{className:"text-2xl font-bold",children:[e.jsx(se,{value:Math.round(s.filter(l=>l.status==="controlled"||l.status==="adjusted").length/s.length*100)}),"%"]})]})]}),e.jsxs("div",{className:"lg:col-span-3",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(kt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(K,{placeholder:"Buscar por nombre o EAN...",value:u,onChange:l=>w(l.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex items-center space-x-2 bg-card p-2 rounded-lg border",children:[e.jsx(Nt,{id:"diff-mode",checked:g,onCheckedChange:P}),e.jsx(fe,{htmlFor:"diff-mode",className:"cursor-pointer",children:"Solo Diferencias"})]}),e.jsxs(L,{variant:"destructive",size:"sm",onClick:et,className:"ml-2",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Reiniciar Datos"]})]}),e.jsxs(pt,{defaultValue:"pending",className:"w-full",children:[e.jsxs(vt,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsxs(ve,{value:"pending",className:"relative",children:["Pendientes",_.length>0&&e.jsx("span",{className:"ml-2 bg-warning text-warning-foreground text-[10px] px-1.5 py-0.5 rounded-full",children:_.length})]}),e.jsxs(ve,{value:"controlled",children:["Controlados",D.length>0&&e.jsx("span",{className:"ml-2 bg-success text-success-foreground text-[10px] px-1.5 py-0.5 rounded-full",children:D.length})]}),e.jsxs(ve,{value:"adjusted",children:["Ajustados",k.length>0&&e.jsx("span",{className:"ml-2 bg-blue-500 text-white text-[10px] px-1.5 py-0.5 rounded-full",children:k.length})]})]}),e.jsxs(me,{value:"pending",className:"space-y-4",children:[e.jsxs(Fe,{className:"bg-muted/50 border-none mb-4",children:[e.jsx(at,{className:"h-4 w-4"}),e.jsx(Re,{children:"Instrucciones"}),e.jsx(Oe,{children:"Desliza a la derecha para confirmar (verde) o a la izquierda para reportar diferencia (naranja)."})]}),e.jsx(xe,{items:_,onUpdateQuantity:M,onCheck:F})]}),e.jsx(me,{value:"controlled",className:"space-y-4",children:e.jsx(xe,{items:D,onUpdateQuantity:M,onCheck:F,onRevert:q,readOnly:!1})}),e.jsx(me,{value:"adjusted",className:"space-y-4",children:e.jsx(xe,{items:k,onUpdateQuantity:()=>{},onCheck:()=>{},readOnly:!0})})]})]})]}),e.jsx(Te,{open:d,onOpenChange:c,children:e.jsxs(Me,{children:[e.jsxs(Qe,{children:[e.jsx(He,{children:"Finalizar Inventario"}),e.jsx(lt,{children:"Ingresa el ID del ajuste generado en PLEX para guardar el estado de este inventario."})]}),e.jsxs("div",{className:"py-4 space-y-6",children:[e.jsxs("div",{className:"space-y-2 p-4 bg-destructive/5 rounded-lg border border-destructive/10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(fe,{className:"text-destructive font-bold",children:"Faltantes (Negativos)"}),e.jsxs("span",{className:"font-mono font-bold text-destructive",children:["$",R.toLocaleString("es-AR",{minimumFractionDigits:2})]})]}),e.jsx(K,{value:h,onChange:l=>b(l.target.value),placeholder:"ID Ajuste Faltantes (PLEX)"})]}),e.jsxs("div",{className:"space-y-2 p-4 bg-success/5 rounded-lg border border-success/10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(fe,{className:"text-success font-bold",children:"Sobrantes (Positivos)"}),e.jsxs("span",{className:"font-mono font-bold text-success",children:["$",U.toLocaleString("es-AR",{minimumFractionDigits:2})]})]}),e.jsx(K,{value:i,onChange:l=>y(l.target.value),placeholder:"ID Ajuste Sobrantes (PLEX)"})]})]}),e.jsxs(ze,{children:[e.jsx(L,{variant:"outline",onClick:()=>c(!1),children:"Cancelar"}),e.jsx(L,{onClick:V,children:"Guardar y Finalizar"})]})]})}),e.jsx(yt,{open:X,onOpenChange:ee,onScan:le,onBatchScan:ce})]})}export{jn as default};
