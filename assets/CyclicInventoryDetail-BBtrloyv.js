const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-79gJsbWV.js","assets/ui-vendor-Bb_mGnpn.js","assets/react-vendor-DdjUaGoS.js","assets/utils-CUsTgaRG.js","assets/animation-_rLC-yhr.js","assets/excel-uoQkVabA.js","assets/index-B09VdGZv.css"])))=>i.map(i=>d[i]);
import{c as se,B as A,X as Je,o as Q,P as ge,Q as Ze,q as pe,C as K,D as De,h as Le,i as Ae,j as Ie,r as $e,R as et,v as $,M as tt,U as nt,S as ot,N as rt,_ as st}from"./index-79gJsbWV.js";import{j as t}from"./ui-vendor-Bb_mGnpn.js";import{r as E,h as it,u as at}from"./react-vendor-DdjUaGoS.js";import{I as ne}from"./input-B4Qg--CR.js";import{T as lt,a as ct,b as xe,c as ye}from"./tabs-DQh7vMXO.js";import{r as dt,u as J,w as pt}from"./excel-uoQkVabA.js";import{E as ut}from"./jspdf.es.min-DSvf6SN5.js";import{B as vt}from"./badge-DZ4OAlY8.js";import{S as ht,P as we,B as mt}from"./SwipeableItem-DtFLKLal.js";import{A as be,m as Ce}from"./animation-_rLC-yhr.js";import{C as ce}from"./circle-check-CkBJYZ1s.js";import{D as ft}from"./dollar-sign-nxU0mCEA.js";import{C as Z}from"./CounterAnimation-DLyiKbvL.js";import{S as gt}from"./switch-CtVpFNTc.js";import{L as je}from"./label-DS6fhhCU.js";import{A as xt}from"./arrow-left-lkDLjamV.js";import{F as yt,S as wt}from"./save-Btjph4ei.js";import{S as bt}from"./search-CQKPkt0l.js";import"./utils-CUsTgaRG.js";import"./scanner-ThRrwOEs.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=se("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=se("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=se("Delete",[["path",{d:"M10 5a2 2 0 0 0-1.344.519l-6.328 5.74a1 1 0 0 0 0 1.481l6.328 5.741A2 2 0 0 0 10 19h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2z",key:"1yo7s0"}],["path",{d:"m12 9 6 6",key:"anjzzh"}],["path",{d:"m18 9-6 6",key:"1fp51s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=se("ScanBarcode",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M8 7v10",key:"23sfjj"}],["path",{d:"M12 7v10",key:"jspqdw"}],["path",{d:"M17 7v10",key:"578dap"}]]);function St({onResult:e,onClose:n,initialValue:r=""}){const[s,o]=E.useState(r),[a,p]=E.useState(""),g=l=>{o(h=>h==="0"?l:h+l)},d=l=>{p(s+" "+l+" "),o("")},w=()=>{o(""),p("")},x=()=>{try{const l=a+s;if(!/^[0-9+\-*/. ]+$/.test(l)){o("Error");return}const h=new Function("return "+l)();o(String(h)),p(""),e(Number(h))}catch{o("Error")}},P=()=>{o(l=>l.slice(0,-1))},c=[{label:"C",onClick:w,variant:"destructive",className:"col-span-1"},{label:"/",onClick:()=>d("/"),variant:"secondary"},{label:"*",onClick:()=>d("*"),variant:"secondary"},{label:t.jsx(Nt,{className:"w-4 h-4"}),onClick:P,variant:"secondary"},{label:"7",onClick:()=>g("7"),variant:"outline"},{label:"8",onClick:()=>g("8"),variant:"outline"},{label:"9",onClick:()=>g("9"),variant:"outline"},{label:"-",onClick:()=>d("-"),variant:"secondary"},{label:"4",onClick:()=>g("4"),variant:"outline"},{label:"5",onClick:()=>g("5"),variant:"outline"},{label:"6",onClick:()=>g("6"),variant:"outline"},{label:"+",onClick:()=>d("+"),variant:"secondary"},{label:"1",onClick:()=>g("1"),variant:"outline"},{label:"2",onClick:()=>g("2"),variant:"outline"},{label:"3",onClick:()=>g("3"),variant:"outline"},{label:"=",onClick:x,variant:"default",className:"row-span-2 h-full"},{label:"0",onClick:()=>g("0"),variant:"outline",className:"col-span-2"},{label:".",onClick:()=>g("."),variant:"outline"}];return t.jsxs("div",{className:"p-4 bg-card rounded-lg border shadow-lg max-w-xs mx-auto",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-xs text-muted-foreground font-mono h-4 block",children:a}),t.jsx(A,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:n,children:t.jsx(Je,{className:"w-4 h-4"})})]}),t.jsx("div",{className:"bg-muted p-3 rounded-md mb-4 text-right font-mono text-2xl font-bold tracking-wider overflow-hidden",children:s||"0"}),t.jsx("div",{className:"grid grid-cols-4 gap-2",children:c.map((l,h)=>t.jsx(A,{variant:l.variant,onClick:l.onClick,className:Q("h-12 text-lg font-medium",l.className),children:l.label},h))})]})}const Ne=E.memo(function({items:n,onUpdateQuantity:r,onCheck:s,onRevert:o,readOnly:a=!1}){const[p,g]=E.useState(null),[d,w]=E.useState(""),[x,P]=E.useState(!1),c=i=>{g(i.id),w(i.countedQuantity.toString()),P(!1)},l=()=>{if(p){const i=parseInt(d,10);!isNaN(i)&&i>=0&&(r(p,i),g(null))}},h=()=>{g(null),w(""),P(!1)},b=i=>{w(Math.floor(i).toString())};return n.length===0?t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(ge,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),t.jsx("p",{children:"No hay productos en esta lista"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"space-y-3",children:t.jsx(be,{mode:"popLayout",children:n.map(i=>{const y=i.countedQuantity-i.systemQuantity,k=y!==0,_=i.status==="controlled",D=y===0;return t.jsx(Ce.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-100},transition:{duration:.2},children:t.jsx(ht,{disabled:a,..._?{leftAction:{label:"Editar",icon:t.jsx(we,{className:"w-5 h-5"}),color:"text-blue-500",bgColor:"rgba(59, 130, 246, 0.2)",onAction:()=>c(i)},rightAction:o?{label:"Revertir",icon:t.jsx(pe,{className:"w-5 h-5"}),color:"text-red-500",bgColor:"rgba(239, 68, 68, 0.2)",onAction:()=>o(i.id)}:void 0}:{leftAction:{label:"Confirmar",icon:t.jsx(ce,{className:"w-5 h-5"}),color:"text-green-600",bgColor:"rgba(22, 163, 74, 0.2)",onAction:()=>s(i.id)},rightAction:{label:"Diferencia",icon:t.jsx(Ze,{className:"w-5 h-5"}),color:"text-orange-500",bgColor:"rgba(249, 115, 22, 0.2)",onAction:()=>c(i)}},children:t.jsx(K,{className:Q("p-4 hover:shadow-md transition-shadow border-0 rounded-none sm:rounded-xl sm:border"),onClick:()=>c(i),children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:Q("p-2 rounded-lg flex-shrink-0 transition-colors",_?"bg-success/10":"bg-primary/10"),children:_?t.jsx(ce,{className:"w-5 h-5 text-success"}):t.jsx(ge,{className:"w-5 h-5 text-primary"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h4",{className:"font-medium text-foreground truncate",title:i.name,children:i.name}),t.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-muted-foreground",children:[t.jsx("span",{className:"font-mono bg-muted px-1.5 py-0.5 rounded",children:i.ean}),i.cost>0&&t.jsxs("span",{className:"flex items-center text-muted-foreground",children:[t.jsx(ft,{className:"w-3 h-3 mr-0.5"}),i.cost.toFixed(2)]})]}),t.jsxs("div",{className:"flex items-center gap-4 mt-3",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Sistema"}),t.jsx("span",{className:"text-sm font-medium",children:i.systemQuantity})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Físico"}),t.jsx("span",{className:Q("text-sm font-bold",k?"text-warning":"text-success"),children:i.countedQuantity})]}),k&&t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Diferencia"}),t.jsx(vt,{variant:y>0?"default":"destructive",className:"h-5 px-1.5 text-[10px]",children:y>0?`+${y}`:y})]})]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:j=>{j.stopPropagation(),c(i)},children:t.jsx(we,{className:"w-4 h-4"})}),i.status==="pending"&&t.jsx(A,{size:"icon",variant:D?"default":"secondary",className:Q("h-10 w-10 rounded-full shadow-sm flex-shrink-0 transition-all ml-1",D?"bg-success hover:bg-success/90 text-white":"hover:bg-warning/20 text-warning"),onClick:j=>{j.stopPropagation(),s(i.id)},children:t.jsx(ce,{className:"w-5 h-5"})}),i.status==="controlled"&&o&&t.jsx(A,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive hover:bg-destructive/10",onClick:j=>{j.stopPropagation(),o(i.id)},title:"Volver a pendientes",children:t.jsx(pe,{className:"w-4 h-4"})})]})]})})})},i.id)})})}),t.jsx(De,{open:p!==null,onOpenChange:i=>!i&&h(),children:t.jsxs(Le,{className:"sm:max-w-md",children:[t.jsx(Ae,{children:t.jsx(Ie,{children:"Editar Cantidad"})}),t.jsxs("div",{className:"space-y-4 py-4",children:[t.jsxs("div",{className:"flex gap-2 items-end",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Cantidad Física"}),t.jsx(ne,{type:"number",min:"0",value:d,onChange:i=>w(i.target.value),onKeyDown:i=>{i.key==="Enter"&&l()},placeholder:"Ingresa la cantidad",autoFocus:!0})]}),t.jsx(A,{variant:x?"secondary":"outline",size:"icon",onClick:()=>P(!x),title:"Calculadora",children:t.jsx(Ct,{className:"w-4 h-4"})})]}),t.jsx(be,{children:x&&t.jsx(Ce.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:t.jsx(St,{onResult:b,onClose:()=>P(!1)})})})]}),t.jsxs($e,{children:[t.jsx(A,{variant:"outline",onClick:h,children:"Cancelar"}),t.jsx(A,{onClick:l,children:"Guardar"})]})]})})]})}),Et=et("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Be=E.forwardRef(({className:e,variant:n,...r},s)=>t.jsx("div",{ref:s,role:"alert",className:Q(Et({variant:n}),e),...r}));Be.displayName="Alert";const Me=E.forwardRef(({className:e,...n},r)=>t.jsx("h5",{ref:r,className:Q("mb-1 font-medium leading-none tracking-tight",e),...n}));Me.displayName="AlertTitle";const Te=E.forwardRef(({className:e,...n},r)=>t.jsx("div",{ref:r,className:Q("text-sm [&_p]:leading-relaxed",e),...n}));Te.displayName="AlertDescription";let ue={},He;function de(e={}){ue={animate:!0,allowClose:!0,overlayClickBehavior:"close",overlayOpacity:.7,smoothScroll:!1,disableActiveInteraction:!1,showProgress:!1,stagePadding:10,stageRadius:5,popoverOffset:10,showButtons:["next","previous","close"],disableButtons:[],overlayColor:"#000",...e}}function v(e){return e?ue[e]:ue}function _t(e){He=e}function T(){return He}let oe={};function ee(e,n){oe[e]=n}function O(e){var n;(n=oe[e])==null||n.call(oe)}function Pt(){oe={}}function te(e,n,r,s){return(e/=s/2)<1?r/2*e*e+n:-r/2*(--e*(e-2)-1)+n}function ze(e){const n='a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])';return e.flatMap(r=>{const s=r.matches(n),o=Array.from(r.querySelectorAll(n));return[...s?[r]:[],...o]}).filter(r=>getComputedStyle(r).pointerEvents!=="none"&&At(r))}function Fe(e){if(!e||Lt(e))return;const n=v("smoothScroll"),r=e.offsetHeight>window.innerHeight;e.scrollIntoView({behavior:!n||Dt(e)?"auto":"smooth",inline:"center",block:r?"start":"center"})}function Dt(e){if(!e||!e.parentElement)return;const n=e.parentElement;return n.scrollHeight>n.clientHeight}function Lt(e){const n=e.getBoundingClientRect();return n.top>=0&&n.left>=0&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&n.right<=(window.innerWidth||document.documentElement.clientWidth)}function At(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}let re={};function L(e,n){re[e]=n}function m(e){return e?re[e]:re}function ke(){re={}}function It(e,n,r,s){let o=m("__activeStagePosition");const a=o||r.getBoundingClientRect(),p=s.getBoundingClientRect(),g=te(e,a.x,p.x-a.x,n),d=te(e,a.y,p.y-a.y,n),w=te(e,a.width,p.width-a.width,n),x=te(e,a.height,p.height-a.height,n);o={x:g,y:d,width:w,height:x},Qe(o),L("__activeStagePosition",o)}function Re(e){if(!e)return;const n=e.getBoundingClientRect(),r={x:n.x,y:n.y,width:n.width,height:n.height};L("__activeStagePosition",r),Qe(r)}function $t(){const e=m("__activeStagePosition"),n=m("__overlaySvg");if(!e)return;if(!n){console.warn("No stage svg found.");return}const r=window.innerWidth,s=window.innerHeight;n.setAttribute("viewBox",`0 0 ${r} ${s}`)}function Bt(e){const n=Mt(e);document.body.appendChild(n),qe(n,r=>{r.target.tagName==="path"&&O("overlayClick")}),L("__overlaySvg",n)}function Qe(e){const n=m("__overlaySvg");if(!n){Bt(e);return}const r=n.firstElementChild;if((r==null?void 0:r.tagName)!=="path")throw new Error("no path element found in stage svg");r.setAttribute("d",Oe(e))}function Mt(e){const n=window.innerWidth,r=window.innerHeight,s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.classList.add("driver-overlay","driver-overlay-animated"),s.setAttribute("viewBox",`0 0 ${n} ${r}`),s.setAttribute("xmlSpace","preserve"),s.setAttribute("xmlnsXlink","http://www.w3.org/1999/xlink"),s.setAttribute("version","1.1"),s.setAttribute("preserveAspectRatio","xMinYMin slice"),s.style.fillRule="evenodd",s.style.clipRule="evenodd",s.style.strokeLinejoin="round",s.style.strokeMiterlimit="2",s.style.zIndex="10000",s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%";const o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("d",Oe(e)),o.style.fill=v("overlayColor")||"rgb(0,0,0)",o.style.opacity=`${v("overlayOpacity")}`,o.style.pointerEvents="auto",o.style.cursor="auto",s.appendChild(o),s}function Oe(e){const n=window.innerWidth,r=window.innerHeight,s=v("stagePadding")||0,o=v("stageRadius")||0,a=e.width+s*2,p=e.height+s*2,g=Math.min(o,a/2,p/2),d=Math.floor(Math.max(g,0)),w=e.x-s+d,x=e.y-s,P=a-d*2,c=p-d*2;return`M${n},0L0,0L0,${r}L${n},${r}L${n},0Z
    M${w},${x} h${P} a${d},${d} 0 0 1 ${d},${d} v${c} a${d},${d} 0 0 1 -${d},${d} h-${P} a${d},${d} 0 0 1 -${d},-${d} v-${c} a${d},${d} 0 0 1 ${d},-${d} z`}function Tt(){const e=m("__overlaySvg");e&&e.remove()}function Ht(){const e=document.getElementById("driver-dummy-element");if(e)return e;let n=document.createElement("div");return n.id="driver-dummy-element",n.style.width="0",n.style.height="0",n.style.pointerEvents="none",n.style.opacity="0",n.style.position="fixed",n.style.top="50%",n.style.left="50%",document.body.appendChild(n),n}function Se(e){const{element:n}=e;let r=typeof n=="function"?n():typeof n=="string"?document.querySelector(n):n;r||(r=Ht()),Ft(r,e)}function zt(){const e=m("__activeElement"),n=m("__activeStep");e&&(Re(e),$t(),Ve(e,n))}function Ft(e,n){var r;const s=Date.now(),o=m("__activeStep"),a=m("__activeElement")||e,p=!a||a===e,g=e.id==="driver-dummy-element",d=a.id==="driver-dummy-element",w=v("animate"),x=n.onHighlightStarted||v("onHighlightStarted"),P=(n==null?void 0:n.onHighlighted)||v("onHighlighted"),c=(o==null?void 0:o.onDeselected)||v("onDeselected"),l=v(),h=m();!p&&c&&c(d?void 0:a,o,{config:l,state:h,driver:T()}),x&&x(g?void 0:e,n,{config:l,state:h,driver:T()});const b=!p&&w;let i=!1;qt(),L("previousStep",o),L("previousElement",a),L("activeStep",n),L("activeElement",e);const y=()=>{if(m("__transitionCallback")!==y)return;const k=Date.now()-s,_=400-k<=400/2;n.popover&&_&&!i&&b&&(Ee(e,n),i=!0),v("animate")&&k<400?It(k,400,a,e):(Re(e),P&&P(g?void 0:e,n,{config:v(),state:m(),driver:T()}),L("__transitionCallback",void 0),L("__previousStep",o),L("__previousElement",a),L("__activeStep",n),L("__activeElement",e)),window.requestAnimationFrame(y)};L("__transitionCallback",y),window.requestAnimationFrame(y),Fe(e),!b&&n.popover&&Ee(e,n),a.classList.remove("driver-active-element","driver-no-interaction"),a.removeAttribute("aria-haspopup"),a.removeAttribute("aria-expanded"),a.removeAttribute("aria-controls"),((r=n.disableActiveInteraction)!=null?r:v("disableActiveInteraction"))&&e.classList.add("driver-no-interaction"),e.classList.add("driver-active-element"),e.setAttribute("aria-haspopup","dialog"),e.setAttribute("aria-expanded","true"),e.setAttribute("aria-controls","driver-popover-content")}function Rt(){var e;(e=document.getElementById("driver-dummy-element"))==null||e.remove(),document.querySelectorAll(".driver-active-element").forEach(n=>{n.classList.remove("driver-active-element","driver-no-interaction"),n.removeAttribute("aria-haspopup"),n.removeAttribute("aria-expanded"),n.removeAttribute("aria-controls")})}function Y(){const e=m("__resizeTimeout");e&&window.cancelAnimationFrame(e),L("__resizeTimeout",window.requestAnimationFrame(zt))}function Qt(e){var n;if(!m("isInitialized")||!(e.key==="Tab"||e.keyCode===9))return;const r=m("__activeElement"),s=(n=m("popover"))==null?void 0:n.wrapper,o=ze([...s?[s]:[],...r?[r]:[]]),a=o[0],p=o[o.length-1];if(e.preventDefault(),e.shiftKey){const g=o[o.indexOf(document.activeElement)-1]||p;g==null||g.focus()}else{const g=o[o.indexOf(document.activeElement)+1]||a;g==null||g.focus()}}function We(e){var n;((n=v("allowKeyboardControl"))==null||n)&&(e.key==="Escape"?O("escapePress"):e.key==="ArrowRight"?O("arrowRightPress"):e.key==="ArrowLeft"&&O("arrowLeftPress"))}function qe(e,n,r){const s=(o,a)=>{const p=o.target;e.contains(p)&&((!r||r(p))&&(o.preventDefault(),o.stopPropagation(),o.stopImmediatePropagation()),a==null||a(o))};document.addEventListener("pointerdown",s,!0),document.addEventListener("mousedown",s,!0),document.addEventListener("pointerup",s,!0),document.addEventListener("mouseup",s,!0),document.addEventListener("click",o=>{s(o,n)},!0)}function Ot(){window.addEventListener("keyup",We,!1),window.addEventListener("keydown",Qt,!1),window.addEventListener("resize",Y),window.addEventListener("scroll",Y)}function Wt(){window.removeEventListener("keyup",We),window.removeEventListener("resize",Y),window.removeEventListener("scroll",Y)}function qt(){const e=m("popover");e&&(e.wrapper.style.display="none")}function Ee(e,n){var r,s;let o=m("popover");o&&document.body.removeChild(o.wrapper),o=Vt(),document.body.appendChild(o.wrapper);const{title:a,description:p,showButtons:g,disableButtons:d,showProgress:w,nextBtnText:x=v("nextBtnText")||"Next &rarr;",prevBtnText:P=v("prevBtnText")||"&larr; Previous",progressText:c=v("progressText")||"{current} of {total}"}=n.popover||{};o.nextButton.innerHTML=x,o.previousButton.innerHTML=P,o.progress.innerHTML=c,a?(o.title.innerHTML=a,o.title.style.display="block"):o.title.style.display="none",p?(o.description.innerHTML=p,o.description.style.display="block"):o.description.style.display="none";const l=g||v("showButtons"),h=w||v("showProgress")||!1,b=(l==null?void 0:l.includes("next"))||(l==null?void 0:l.includes("previous"))||h;o.closeButton.style.display=l.includes("close")?"block":"none",b?(o.footer.style.display="flex",o.progress.style.display=h?"block":"none",o.nextButton.style.display=l.includes("next")?"block":"none",o.previousButton.style.display=l.includes("previous")?"block":"none"):o.footer.style.display="none";const i=d||v("disableButtons")||[];i!=null&&i.includes("next")&&(o.nextButton.disabled=!0,o.nextButton.classList.add("driver-popover-btn-disabled")),i!=null&&i.includes("previous")&&(o.previousButton.disabled=!0,o.previousButton.classList.add("driver-popover-btn-disabled")),i!=null&&i.includes("close")&&(o.closeButton.disabled=!0,o.closeButton.classList.add("driver-popover-btn-disabled"));const y=o.wrapper;y.style.display="block",y.style.left="",y.style.top="",y.style.bottom="",y.style.right="",y.id="driver-popover-content",y.setAttribute("role","dialog"),y.setAttribute("aria-labelledby","driver-popover-title"),y.setAttribute("aria-describedby","driver-popover-description");const k=o.arrow;k.className="driver-popover-arrow";const _=((r=n.popover)==null?void 0:r.popoverClass)||v("popoverClass")||"";y.className=`driver-popover ${_}`.trim(),qe(o.wrapper,H=>{var W,q,U;const F=H.target,V=((W=n.popover)==null?void 0:W.onNextClick)||v("onNextClick"),R=((q=n.popover)==null?void 0:q.onPrevClick)||v("onPrevClick"),X=((U=n.popover)==null?void 0:U.onCloseClick)||v("onCloseClick");if(F.closest(".driver-popover-next-btn"))return V?V(e,n,{config:v(),state:m(),driver:T()}):O("nextClick");if(F.closest(".driver-popover-prev-btn"))return R?R(e,n,{config:v(),state:m(),driver:T()}):O("prevClick");if(F.closest(".driver-popover-close-btn"))return X?X(e,n,{config:v(),state:m(),driver:T()}):O("closeClick")},H=>!(o!=null&&o.description.contains(H))&&!(o!=null&&o.title.contains(H))&&typeof H.className=="string"&&H.className.includes("driver-popover")),L("popover",o);const D=((s=n.popover)==null?void 0:s.onPopoverRender)||v("onPopoverRender");D&&D(o,{config:v(),state:m(),driver:T()}),Ve(e,n),Fe(y);const j=e.classList.contains("driver-dummy-element"),S=ze([y,...j?[]:[e]]);S.length>0&&S[0].focus()}function Ue(){const e=m("popover");if(!(e!=null&&e.wrapper))return;const n=e.wrapper.getBoundingClientRect(),r=v("stagePadding")||0,s=v("popoverOffset")||0;return{width:n.width+r+s,height:n.height+r+s,realWidth:n.width,realHeight:n.height}}function _e(e,n){const{elementDimensions:r,popoverDimensions:s,popoverPadding:o,popoverArrowDimensions:a}=n;return e==="start"?Math.max(Math.min(r.top-o,window.innerHeight-s.realHeight-a.width),a.width):e==="end"?Math.max(Math.min(r.top-(s==null?void 0:s.realHeight)+r.height+o,window.innerHeight-(s==null?void 0:s.realHeight)-a.width),a.width):e==="center"?Math.max(Math.min(r.top+r.height/2-(s==null?void 0:s.realHeight)/2,window.innerHeight-(s==null?void 0:s.realHeight)-a.width),a.width):0}function Pe(e,n){const{elementDimensions:r,popoverDimensions:s,popoverPadding:o,popoverArrowDimensions:a}=n;return e==="start"?Math.max(Math.min(r.left-o,window.innerWidth-s.realWidth-a.width),a.width):e==="end"?Math.max(Math.min(r.left-(s==null?void 0:s.realWidth)+r.width+o,window.innerWidth-(s==null?void 0:s.realWidth)-a.width),a.width):e==="center"?Math.max(Math.min(r.left+r.width/2-(s==null?void 0:s.realWidth)/2,window.innerWidth-(s==null?void 0:s.realWidth)-a.width),a.width):0}function Ve(e,n){const r=m("popover");if(!r)return;const{align:s="start",side:o="left"}=(n==null?void 0:n.popover)||{},a=s,p=e.id==="driver-dummy-element"?"over":o,g=v("stagePadding")||0,d=Ue(),w=r.arrow.getBoundingClientRect(),x=e.getBoundingClientRect(),P=x.top-d.height;let c=P>=0;const l=window.innerHeight-(x.bottom+d.height);let h=l>=0;const b=x.left-d.width;let i=b>=0;const y=window.innerWidth-(x.right+d.width);let k=y>=0;const _=!c&&!h&&!i&&!k;let D=p;if(p==="top"&&c?k=i=h=!1:p==="bottom"&&h?k=i=c=!1:p==="left"&&i?k=c=h=!1:p==="right"&&k&&(i=c=h=!1),p==="over"){const j=window.innerWidth/2-d.realWidth/2,S=window.innerHeight/2-d.realHeight/2;r.wrapper.style.left=`${j}px`,r.wrapper.style.right="auto",r.wrapper.style.top=`${S}px`,r.wrapper.style.bottom="auto"}else if(_){const j=window.innerWidth/2-(d==null?void 0:d.realWidth)/2,S=10;r.wrapper.style.left=`${j}px`,r.wrapper.style.right="auto",r.wrapper.style.bottom=`${S}px`,r.wrapper.style.top="auto"}else if(i){const j=Math.min(b,window.innerWidth-(d==null?void 0:d.realWidth)-w.width),S=_e(a,{elementDimensions:x,popoverDimensions:d,popoverPadding:g,popoverArrowDimensions:w});r.wrapper.style.left=`${j}px`,r.wrapper.style.top=`${S}px`,r.wrapper.style.bottom="auto",r.wrapper.style.right="auto",D="left"}else if(k){const j=Math.min(y,window.innerWidth-(d==null?void 0:d.realWidth)-w.width),S=_e(a,{elementDimensions:x,popoverDimensions:d,popoverPadding:g,popoverArrowDimensions:w});r.wrapper.style.right=`${j}px`,r.wrapper.style.top=`${S}px`,r.wrapper.style.bottom="auto",r.wrapper.style.left="auto",D="right"}else if(c){const j=Math.min(P,window.innerHeight-d.realHeight-w.width);let S=Pe(a,{elementDimensions:x,popoverDimensions:d,popoverPadding:g,popoverArrowDimensions:w});r.wrapper.style.top=`${j}px`,r.wrapper.style.left=`${S}px`,r.wrapper.style.bottom="auto",r.wrapper.style.right="auto",D="top"}else if(h){const j=Math.min(l,window.innerHeight-(d==null?void 0:d.realHeight)-w.width);let S=Pe(a,{elementDimensions:x,popoverDimensions:d,popoverPadding:g,popoverArrowDimensions:w});r.wrapper.style.left=`${S}px`,r.wrapper.style.bottom=`${j}px`,r.wrapper.style.top="auto",r.wrapper.style.right="auto",D="bottom"}_?r.arrow.classList.add("driver-popover-arrow-none"):Ut(a,D,e)}function Ut(e,n,r){const s=m("popover");if(!s)return;const o=r.getBoundingClientRect(),a=Ue(),p=s.arrow,g=a.width,d=window.innerWidth,w=o.width,x=o.left,P=a.height,c=window.innerHeight,l=o.top,h=o.height;p.className="driver-popover-arrow";let b=n,i=e;if(n==="top"?(x+w<=0?(b="right",i="end"):x+w-g<=0&&(b="top",i="start"),x>=d?(b="left",i="end"):x+g>=d&&(b="top",i="end")):n==="bottom"?(x+w<=0?(b="right",i="start"):x+w-g<=0&&(b="bottom",i="start"),x>=d?(b="left",i="start"):x+g>=d&&(b="bottom",i="end")):n==="left"?(l+h<=0?(b="bottom",i="end"):l+h-P<=0&&(b="left",i="start"),l>=c?(b="top",i="end"):l+P>=c&&(b="left",i="end")):n==="right"&&(l+h<=0?(b="bottom",i="start"):l+h-P<=0&&(b="right",i="start"),l>=c?(b="top",i="start"):l+P>=c&&(b="right",i="end")),!b)p.classList.add("driver-popover-arrow-none");else{p.classList.add(`driver-popover-arrow-side-${b}`),p.classList.add(`driver-popover-arrow-align-${i}`);const y=r.getBoundingClientRect(),k=p.getBoundingClientRect(),_=v("stagePadding")||0,D=y.left-_<window.innerWidth&&y.right+_>0&&y.top-_<window.innerHeight&&y.bottom+_>0;n==="bottom"&&D&&(k.x>y.x&&k.x+k.width<y.x+y.width?s.wrapper.style.transform="translateY(0)":(p.classList.remove(`driver-popover-arrow-align-${i}`),p.classList.add("driver-popover-arrow-none"),s.wrapper.style.transform=`translateY(-${_/2}px)`))}}function Vt(){const e=document.createElement("div");e.classList.add("driver-popover");const n=document.createElement("div");n.classList.add("driver-popover-arrow");const r=document.createElement("header");r.id="driver-popover-title",r.classList.add("driver-popover-title"),r.style.display="none",r.innerText="Popover Title";const s=document.createElement("div");s.id="driver-popover-description",s.classList.add("driver-popover-description"),s.style.display="none",s.innerText="Popover description is here";const o=document.createElement("button");o.type="button",o.classList.add("driver-popover-close-btn"),o.setAttribute("aria-label","Close"),o.innerHTML="&times;";const a=document.createElement("footer");a.classList.add("driver-popover-footer");const p=document.createElement("span");p.classList.add("driver-popover-progress-text"),p.innerText="";const g=document.createElement("span");g.classList.add("driver-popover-navigation-btns");const d=document.createElement("button");d.type="button",d.classList.add("driver-popover-prev-btn"),d.innerHTML="&larr; Previous";const w=document.createElement("button");return w.type="button",w.classList.add("driver-popover-next-btn"),w.innerHTML="Next &rarr;",g.appendChild(d),g.appendChild(w),a.appendChild(p),a.appendChild(g),e.appendChild(o),e.appendChild(n),e.appendChild(r),e.appendChild(s),e.appendChild(a),{wrapper:e,arrow:n,title:r,description:s,footer:a,previousButton:d,nextButton:w,closeButton:o,footerButtons:g,progress:p}}function Xt(){var e;const n=m("popover");n&&((e=n.wrapper.parentElement)==null||e.removeChild(n.wrapper))}function Kt(e={}){de(e);function n(){v("allowClose")&&x()}function r(){const c=v("overlayClickBehavior");if(v("allowClose")&&c==="close"){x();return}if(typeof c=="function"){const l=m("__activeStep"),h=m("__activeElement");c(h,l,{config:v(),state:m(),driver:T()});return}c==="nextStep"&&s()}function s(){const c=m("activeIndex"),l=v("steps")||[];if(typeof c>"u")return;const h=c+1;l[h]?w(h):x()}function o(){const c=m("activeIndex"),l=v("steps")||[];if(typeof c>"u")return;const h=c-1;l[h]?w(h):x()}function a(c){(v("steps")||[])[c]?w(c):x()}function p(){var c;if(m("__transitionCallback"))return;const l=m("activeIndex"),h=m("__activeStep"),b=m("__activeElement");if(typeof l>"u"||typeof h>"u"||typeof m("activeIndex")>"u")return;const i=((c=h.popover)==null?void 0:c.onPrevClick)||v("onPrevClick");if(i)return i(b,h,{config:v(),state:m(),driver:T()});o()}function g(){var c;if(m("__transitionCallback"))return;const l=m("activeIndex"),h=m("__activeStep"),b=m("__activeElement");if(typeof l>"u"||typeof h>"u")return;const i=((c=h.popover)==null?void 0:c.onNextClick)||v("onNextClick");if(i)return i(b,h,{config:v(),state:m(),driver:T()});s()}function d(){m("isInitialized")||(L("isInitialized",!0),document.body.classList.add("driver-active",v("animate")?"driver-fade":"driver-simple"),Ot(),ee("overlayClick",r),ee("escapePress",n),ee("arrowLeftPress",p),ee("arrowRightPress",g))}function w(c=0){var l,h,b,i,y,k,_,D;const j=v("steps");if(!j){console.error("No steps to drive through"),x();return}if(!j[c]){x();return}L("__activeOnDestroyed",document.activeElement),L("activeIndex",c);const S=j[c],H=j[c+1],W=j[c-1],q=((l=S.popover)==null?void 0:l.doneBtnText)||v("doneBtnText")||"Done",U=v("allowClose"),F=typeof((h=S.popover)==null?void 0:h.showProgress)<"u"?(b=S.popover)==null?void 0:b.showProgress:v("showProgress"),V=(((i=S.popover)==null?void 0:i.progressText)||v("progressText")||"{{current}} of {{total}}").replace("{{current}}",`${c+1}`).replace("{{total}}",`${j.length}`),R=((y=S.popover)==null?void 0:y.showButtons)||v("showButtons"),X=["next","previous",...U?["close"]:[]].filter(C=>!(R!=null&&R.length)||R.includes(C)),ie=((k=S.popover)==null?void 0:k.onNextClick)||v("onNextClick"),u=((_=S.popover)==null?void 0:_.onPrevClick)||v("onPrevClick"),f=((D=S.popover)==null?void 0:D.onCloseClick)||v("onCloseClick");Se({...S,popover:{showButtons:X,nextBtnText:H?void 0:q,disableButtons:[...W?[]:["previous"]],showProgress:F,progressText:V,onNextClick:ie||(()=>{H?w(c+1):x()}),onPrevClick:u||(()=>{w(c-1)}),onCloseClick:f||(()=>{x()}),...(S==null?void 0:S.popover)||{}}})}function x(c=!0){const l=m("__activeElement"),h=m("__activeStep"),b=m("__activeOnDestroyed"),i=v("onDestroyStarted");if(c&&i){const _=!l||(l==null?void 0:l.id)==="driver-dummy-element";i(_?void 0:l,h,{config:v(),state:m(),driver:T()});return}const y=(h==null?void 0:h.onDeselected)||v("onDeselected"),k=v("onDestroyed");if(document.body.classList.remove("driver-active","driver-fade","driver-simple"),Wt(),Xt(),Rt(),Tt(),Pt(),ke(),l&&h){const _=l.id==="driver-dummy-element";y&&y(_?void 0:l,h,{config:v(),state:m(),driver:T()}),k&&k(_?void 0:l,h,{config:v(),state:m(),driver:T()})}b&&b.focus()}const P={isActive:()=>m("isInitialized")||!1,refresh:Y,drive:(c=0)=>{d(),w(c)},setConfig:de,setSteps:c=>{ke(),de({...v(),steps:c})},getConfig:v,getState:m,getActiveIndex:()=>m("activeIndex"),isFirstStep:()=>m("activeIndex")===0,isLastStep:()=>{const c=v("steps")||[],l=m("activeIndex");return l!==void 0&&l===c.length-1},getActiveStep:()=>m("activeStep"),getActiveElement:()=>m("activeElement"),getPreviousElement:()=>m("previousElement"),getPreviousStep:()=>m("previousStep"),moveNext:s,movePrevious:o,moveTo:a,hasNextStep:()=>{const c=v("steps")||[],l=m("activeIndex");return l!==void 0&&!!c[l+1]},hasPreviousStep:()=>{const c=v("steps")||[],l=m("activeIndex");return l!==void 0&&!!c[l-1]},highlight:c=>{d(),Se({...c,popover:c.popover?{showButtons:[],showProgress:!1,progressText:"",...c.popover}:void 0})},destroy:()=>{x(!1)}};return _t(P),P}function Yt(){const e=()=>{Kt({showProgress:!0,steps:[{element:"#diff-mode",popover:{title:"Solo Diferencias",description:"Activa este interruptor para ver solo los productos que tienen diferencias entre el stock físico y el del sistema.",side:"bottom",align:"start"}},{element:'[role="tablist"]',popover:{title:"Pestañas de Estado",description:'Navega entre "Pendientes" y "Controlados" para organizar tu trabajo.',side:"bottom",align:"start"}},{element:".bg-card.relative",popover:{title:"Acciones Rápidas",description:"Desliza a la derecha para Confirmar/Editar o a la izquierda para reportar Diferencia/Revertir.",side:"top",align:"start"}},{element:"button:has(.lucide-save)",popover:{title:"Finalizar Inventario",description:"Cuando termines, guarda el estado del inventario aquí.",side:"left",align:"start"}}]}).drive()};return E.useEffect(()=>{localStorage.getItem("has_seen_inventory_tour")||setTimeout(()=>{e(),localStorage.setItem("has_seen_inventory_tour","true")},1e3)},[]),t.jsx(A,{variant:"ghost",size:"icon",onClick:e,title:"Ver Tutorial",children:t.jsx(jt,{className:"w-5 h-5"})})}function xn(){const{id:e}=it(),n=at(),[r,s]=E.useState(!1),[o,a]=E.useState([]),[p,g]=E.useState(""),[d,w]=E.useState(""),[x,P]=E.useState(!1),[c,l]=E.useState(!1),[h,b]=E.useState("");E.useEffect(()=>{e&&g(decodeURIComponent(e))},[e]),E.useEffect(()=>{if(p){const u=localStorage.getItem(`cyclic_inventory_${p}`);if(u)try{const f=JSON.parse(u);if(Array.isArray(f)){const C=f.filter(N=>N&&typeof N=="object"&&typeof N.id=="string"&&typeof N.name=="string"&&typeof N.systemQuantity=="number"&&typeof N.countedQuantity=="number");C.length!==f.length&&console.warn(`Filtered out ${f.length-C.length} invalid items.`),a(C)}else console.warn("Invalid inventory data format in localStorage, resetting."),a([])}catch(f){console.error("Failed to load saved inventory",f),a([])}}},[p]),E.useEffect(()=>{p&&o.length>0&&localStorage.setItem(`cyclic_inventory_${p}`,JSON.stringify(o))},[o,p]);const i=u=>u.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase().trim(),y=E.useMemo(()=>o.filter(u=>{if(d){const f=d.toLowerCase();if(!u.name.toLowerCase().includes(f)&&!u.ean.includes(f))return!1}return x?u.countedQuantity!==u.systemQuantity:!0}),[o,d,x]),k=E.useMemo(()=>y.filter(u=>u.status==="pending"),[y]),_=E.useMemo(()=>y.filter(u=>u.status==="controlled"),[y]),D=async u=>{var N;const f=(N=u.target.files)==null?void 0:N[0];if(!f)return;s(!0);const C=new FileReader;C.onload=I=>{var B;try{const z=(B=I.target)==null?void 0:B.result,ve=dt(z,{type:"binary"}),Xe=ve.SheetNames[0],Ke=ve.Sheets[Xe],he=J.sheet_to_json(Ke,{header:1}),G=[];let me=!1,fe="";for(let ae=1;ae<he.length;ae++){const M=he[ae];if(!M||M.length===0)continue;const le=M[14];if(M[3]){if(le&&p){const Ye=i(le.toString()),Ge=i(p);if(Ye!==Ge){me=!0,fe=le.toString();break}}G.push({id:crypto.randomUUID(),ean:M[2]?M[2].toString():"S/C",name:M[3]?M[3].toString():"Desconocido",systemQuantity:M[4]?parseInt(M[4]):0,countedQuantity:M[4]?parseInt(M[4]):0,cost:M[12]?parseFloat(M[12]):0,status:"pending"})}}me?($.error(`Error: El archivo contiene productos de otro laboratorio (${fe}).`),a([])):G.length===0?$.error("No se encontraron productos válidos en el archivo."):(a(G),$.success(`Se cargaron ${G.length} productos correctamente.`))}catch(z){console.error("Error reading file:",z),$.error("Error al procesar el archivo Excel.")}finally{s(!1),u.target.value=""}},C.readAsBinaryString(f)},j=E.useCallback((u,f)=>{a(C=>C.map(N=>N.id===u?(f-N.systemQuantity!==0&&navigator.vibrate?navigator.vibrate([50,50,50]):navigator.vibrate&&navigator.vibrate(50),{...N,countedQuantity:f,status:"controlled"}):N))},[]),S=E.useCallback(u=>{navigator.vibrate&&navigator.vibrate(50),a(f=>f.map(C=>C.id===u?{...C,status:"controlled",countedQuantity:C.systemQuantity}:C)),$.success("Producto controlado")},[]),H=E.useCallback(u=>{a(f=>f.map(C=>C.id===u?{...C,status:"pending"}:C)),$.info("Producto devuelto a pendientes")},[]),W=()=>{if(!h.trim()){$.error("Por favor ingresa el ID del ajuste de PLEX");return}const u={status:"controlado",lastUpdated:Date.now(),plexId:h,items:o};localStorage.setItem(`cyclic_inventory_status_${p}`,JSON.stringify(u)),st(async()=>{const{OfflineQueue:f}=await import("./index-79gJsbWV.js").then(C=>C.ad);return{OfflineQueue:f}},__vite__mapDeps([0,1,2,3,4,5,6])).then(({OfflineQueue:f})=>{f.enqueue("SAVE_INVENTORY",{labName:p,plexId:h,items:o}),navigator.onLine?$.success(`Inventario guardado con ID PLEX: ${h}`):$.info("Guardado en cola. Se sincronizará cuando recuperes la conexión.")}),l(!1),b(""),n("/cyclic-inventory")},q=()=>{const u=o.map(N=>({EAN:N.ean,Producto:N.name,Laboratorio:p,"Cantidad Sistema":N.systemQuantity,"Cantidad Física":N.countedQuantity,Diferencia:N.countedQuantity-N.systemQuantity,Costo:N.cost,Estado:N.status==="controlled"?"CONTROLADO":"PENDIENTE"})),f=J.json_to_sheet(u),C=J.book_new();J.book_append_sheet(C,f,"Inventario"),pt(C,`Inventario_${p}.xlsx`),$.success("Excel generado")},[U,F]=E.useState(!1),V=E.useCallback(u=>{const f=o.find(C=>C.ean===u);f?(j(f.id,f.countedQuantity+1),$.success(`Producto encontrado: ${f.name}`)):$.error(`Producto no encontrado: ${u}`)},[o,j]),R=E.useCallback(u=>{let f=0,C=0;const N=new Map;o.forEach(I=>N.set(I.id,I.countedQuantity)),u.forEach(I=>{const B=o.find(z=>z.ean===I);if(B){const z=N.get(B.id)||0;N.set(B.id,z+1),f++}else C++}),f>0&&(a(I=>I.map(B=>{if(N.has(B.id)){const z=N.get(B.id);if(z!==B.countedQuantity)return{...B,countedQuantity:z,status:"controlled"}}return B})),$.success(`Procesados ${f} items correctamente.`)),C>0&&$.warning(`${C} códigos no encontrados.`)},[o]),X=()=>{const u=new ut;u.setFontSize(16),u.text(`Inventario Cíclico: ${p}`,10,10),u.setFontSize(10),u.text(`Fecha: ${new Date().toLocaleDateString()}`,10,18);let f=30;const C=10,N=u.internal.pageSize.height;u.setFont("helvetica","bold"),u.text("Producto",10,f),u.text("Sistema",100,f),u.text("Físico",130,f),u.text("Dif",160,f),u.text("Estado",180,f),f+=C,u.setFont("helvetica","normal"),o.forEach(I=>{f>N-20&&(u.addPage(),f=20);const B=I.countedQuantity-I.systemQuantity;u.text(I.name.substring(0,40),10,f),u.text(I.systemQuantity.toString(),100,f),u.text(I.countedQuantity.toString(),130,f),u.setTextColor(B===0?0:255,0,0),u.text(B.toString(),160,f),u.setTextColor(0),u.text(I.status==="controlled"?"OK":"Pend",180,f),f+=C}),u.save(`Inventario_${p}_${new Date().toISOString().split("T")[0]}.pdf`),$.success("Reporte PDF generado")},ie=()=>{confirm("¿Estás seguro de que quieres reiniciar los datos de este laboratorio? Se perderán los cambios no guardados.")&&(localStorage.removeItem(`cyclic_inventory_${p}`),localStorage.removeItem(`cyclic_inventory_status_${p}`),a([]),$.success("Datos reiniciados correctamente."),n("/cyclic-inventory"))};return t.jsxs("div",{className:"p-4 md:p-6 space-y-6 max-w-7xl mx-auto",children:[t.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(A,{variant:"ghost",size:"icon",onClick:()=>n("/cyclic-inventory"),children:t.jsx(xt,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:p}),t.jsx("p",{className:"text-muted-foreground text-sm",children:"Control de Inventario Cíclico"})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(Yt,{}),o.length>0&&t.jsxs(t.Fragment,{children:[t.jsxs(A,{variant:"outline",size:"sm",onClick:()=>F(!0),children:[t.jsx(kt,{className:"w-4 h-4 mr-2"}),"Escanear"]}),t.jsxs(A,{variant:"outline",size:"sm",onClick:q,children:[t.jsx(yt,{className:"w-4 h-4 mr-2"}),"Excel"]}),t.jsxs(A,{variant:"outline",size:"sm",onClick:X,children:[t.jsx(tt,{className:"w-4 h-4 mr-2"}),"PDF"]}),t.jsxs(A,{variant:"default",size:"sm",onClick:()=>l(!0),children:[t.jsx(wt,{className:"w-4 h-4 mr-2"}),"Finalizar"]})]})]})]}),o.length===0?t.jsxs(K,{className:"p-12 border-dashed border-2 flex flex-col items-center justify-center text-center space-y-4 bg-muted/20",children:[t.jsx("div",{className:"p-4 bg-primary/10 rounded-full",children:t.jsx(nt,{className:"w-8 h-8 text-primary"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Cargar Archivo de Inventario"}),t.jsxs("p",{className:"text-muted-foreground max-w-md mx-auto mt-2",children:["Sube el archivo Excel (.xlsx) descargado del sistema para comenzar el control de ",p,"."]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(A,{disabled:r,children:r?"Procesando...":"Seleccionar Archivo"}),t.jsx(ne,{type:"file",accept:".xlsx, .xls",className:"absolute inset-0 opacity-0 cursor-pointer",onChange:D,disabled:r})]}),t.jsx("p",{className:"text-xs text-muted-foreground mt-4",children:"Columnas requeridas: C (EAN), D (Producto), E (Cantidad), O (Laboratorio)"})]}):t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-3 grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs(K,{className:"p-4 flex flex-col items-center justify-center bg-primary/5 border-primary/20",children:[t.jsx("span",{className:"text-muted-foreground text-xs uppercase font-bold",children:"Total Items"}),t.jsx("span",{className:"text-2xl font-bold",children:t.jsx(Z,{value:o.length})})]}),t.jsxs(K,{className:"p-4 flex flex-col items-center justify-center bg-warning/5 border-warning/20",children:[t.jsx("span",{className:"text-muted-foreground text-xs uppercase font-bold",children:"Pendientes"}),t.jsx("span",{className:"text-2xl font-bold text-warning",children:t.jsx(Z,{value:o.filter(u=>u.status==="pending").length})})]}),t.jsxs(K,{className:"p-4 flex flex-col items-center justify-center bg-success/5 border-success/20",children:[t.jsx("span",{className:"text-muted-foreground text-xs uppercase font-bold",children:"Controlados"}),t.jsx("span",{className:"text-2xl font-bold text-success",children:t.jsx(Z,{value:o.filter(u=>u.status==="controlled").length})})]}),t.jsxs(K,{className:"p-4 flex flex-col items-center justify-center",children:[t.jsx("span",{className:"text-muted-foreground text-xs uppercase font-bold",children:"Avance"}),t.jsxs("span",{className:"text-2xl font-bold",children:[t.jsx(Z,{value:Math.round(o.filter(u=>u.status==="controlled").length/o.length*100)}),"%"]})]})]}),t.jsxs("div",{className:"lg:col-span-3",children:[t.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(bt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),t.jsx(ne,{placeholder:"Buscar por nombre o EAN...",value:d,onChange:u=>w(u.target.value),className:"pl-9"})]}),t.jsxs("div",{className:"flex items-center space-x-2 bg-card p-2 rounded-lg border",children:[t.jsx(gt,{id:"diff-mode",checked:x,onCheckedChange:P}),t.jsx(je,{htmlFor:"diff-mode",className:"cursor-pointer",children:"Solo Diferencias"})]}),t.jsxs(A,{variant:"destructive",size:"sm",onClick:ie,className:"ml-2",children:[t.jsx(pe,{className:"w-4 h-4 mr-2"}),"Reiniciar Datos"]})]}),t.jsxs(lt,{defaultValue:"pending",className:"w-full",children:[t.jsxs(ct,{className:"grid w-full grid-cols-2 mb-4",children:[t.jsxs(xe,{value:"pending",className:"relative",children:["Pendientes",k.length>0&&t.jsx("span",{className:"ml-2 bg-warning text-warning-foreground text-[10px] px-1.5 py-0.5 rounded-full",children:k.length})]}),t.jsxs(xe,{value:"controlled",children:["Controlados",_.length>0&&t.jsx("span",{className:"ml-2 bg-success text-success-foreground text-[10px] px-1.5 py-0.5 rounded-full",children:_.length})]})]}),t.jsxs(ye,{value:"pending",className:"space-y-4",children:[t.jsxs(Be,{className:"bg-muted/50 border-none mb-4",children:[t.jsx(ot,{className:"h-4 w-4"}),t.jsx(Me,{children:"Instrucciones"}),t.jsx(Te,{children:"Desliza a la derecha para confirmar (verde) o a la izquierda para reportar diferencia (naranja)."})]}),t.jsx(Ne,{items:k,onUpdateQuantity:j,onCheck:S})]}),t.jsx(ye,{value:"controlled",className:"space-y-4",children:t.jsx(Ne,{items:_,onUpdateQuantity:j,onCheck:S,onRevert:H,readOnly:!1})})]})]})]}),t.jsx(De,{open:c,onOpenChange:l,children:t.jsxs(Le,{children:[t.jsxs(Ae,{children:[t.jsx(Ie,{children:"Finalizar Inventario"}),t.jsx(rt,{children:"Ingresa el ID del ajuste generado en PLEX para guardar el estado de este inventario."})]}),t.jsxs("div",{className:"py-4",children:[t.jsx(je,{htmlFor:"plexId",className:"mb-2 block",children:"ID Ajuste PLEX"}),t.jsx(ne,{id:"plexId",value:h,onChange:u=>b(u.target.value),placeholder:"Ej: 123456"})]}),t.jsxs($e,{children:[t.jsx(A,{variant:"outline",onClick:()=>l(!1),children:"Cancelar"}),t.jsx(A,{onClick:W,children:"Guardar y Finalizar"})]})]})}),t.jsx(mt,{open:U,onOpenChange:F,onScan:V,onBatchScan:R})]})}export{xn as default};
