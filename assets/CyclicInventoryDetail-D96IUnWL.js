const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cx5CSyws.js","assets/ui-vendor-Bb_mGnpn.js","assets/react-vendor-DdjUaGoS.js","assets/utils-CUsTgaRG.js","assets/animation-_rLC-yhr.js","assets/excel-uoQkVabA.js","assets/index-qjWIobZv.css"])))=>i.map(i=>d[i]);
import{c as ce,B as L,X as Ve,o as R,P as ue,Q as Ue,q as ae,C as X,D as ke,h as Se,i as Ee,j as _e,r as Pe,R as Xe,v as B,M as Ke,U as Ye,S as Ge,N as Je,_ as Ze}from"./index-Cx5CSyws.js";import{j as t}from"./ui-vendor-Bb_mGnpn.js";import{r as S,h as et,u as tt}from"./react-vendor-DdjUaGoS.js";import{I as te}from"./input-CKdEYsrz.js";import{T as nt,a as ot,b as ve,c as me}from"./tabs-C-eLwW1V.js";import{r as st,u as G,w as rt}from"./excel-uoQkVabA.js";import{E as it}from"./jspdf.es.min-B4PfCBs6.js";import{B as at}from"./badge-D74dagLF.js";import{S as lt,P as he,B as ct}from"./SwipeableItem-gPgIFNjv.js";import{A as fe,m as xe}from"./animation-_rLC-yhr.js";import{C as re}from"./circle-check-7woYpnM4.js";import{D as dt}from"./dollar-sign-KVbMBtA7.js";import{C as pt,F as ut,S as vt}from"./save-DRoO364s.js";import{C as J}from"./CounterAnimation-DLyiKbvL.js";import{S as mt}from"./switch-Cju9QJug.js";import{L as ge}from"./label-DckSz3ni.js";import{A as ht}from"./arrow-left-BvHHof8G.js";import{S as ft}from"./search-CR-bKmG0.js";import"./utils-CUsTgaRG.js";import"./scanner-ThRrwOEs.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=ce("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=ce("Delete",[["path",{d:"M10 5a2 2 0 0 0-1.344.519l-6.328 5.74a1 1 0 0 0 0 1.481l6.328 5.741A2 2 0 0 0 10 19h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2z",key:"1yo7s0"}],["path",{d:"m12 9 6 6",key:"anjzzh"}],["path",{d:"m18 9-6 6",key:"1fp51s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=ce("ScanBarcode",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M8 7v10",key:"23sfjj"}],["path",{d:"M12 7v10",key:"jspqdw"}],["path",{d:"M17 7v10",key:"578dap"}]]);function wt({onResult:e,onClose:n,initialValue:s=""}){const[r,o]=S.useState(s),[l,p]=S.useState(""),x=a=>{o(m=>m==="0"?a:m+a)},d=a=>{p(r+" "+a+" "),o("")},w=()=>{o(""),p("")},g=()=>{try{const a=l+r;if(!/^[0-9+\-*/. ]+$/.test(a)){o("Error");return}const m=new Function("return "+a)();o(String(m)),p(""),e(Number(m))}catch{o("Error")}},_=()=>{o(a=>a.slice(0,-1))},c=[{label:"C",onClick:w,variant:"destructive",className:"col-span-1"},{label:"/",onClick:()=>d("/"),variant:"secondary"},{label:"*",onClick:()=>d("*"),variant:"secondary"},{label:t.jsx(gt,{className:"w-4 h-4"}),onClick:_,variant:"secondary"},{label:"7",onClick:()=>x("7"),variant:"outline"},{label:"8",onClick:()=>x("8"),variant:"outline"},{label:"9",onClick:()=>x("9"),variant:"outline"},{label:"-",onClick:()=>d("-"),variant:"secondary"},{label:"4",onClick:()=>x("4"),variant:"outline"},{label:"5",onClick:()=>x("5"),variant:"outline"},{label:"6",onClick:()=>x("6"),variant:"outline"},{label:"+",onClick:()=>d("+"),variant:"secondary"},{label:"1",onClick:()=>x("1"),variant:"outline"},{label:"2",onClick:()=>x("2"),variant:"outline"},{label:"3",onClick:()=>x("3"),variant:"outline"},{label:"=",onClick:g,variant:"default",className:"row-span-2 h-full"},{label:"0",onClick:()=>x("0"),variant:"outline",className:"col-span-2"},{label:".",onClick:()=>x("."),variant:"outline"}];return t.jsxs("div",{className:"p-4 bg-card rounded-lg border shadow-lg max-w-xs mx-auto",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-xs text-muted-foreground font-mono h-4 block",children:l}),t.jsx(L,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:n,children:t.jsx(Ve,{className:"w-4 h-4"})})]}),t.jsx("div",{className:"bg-muted p-3 rounded-md mb-4 text-right font-mono text-2xl font-bold tracking-wider overflow-hidden",children:r||"0"}),t.jsx("div",{className:"grid grid-cols-4 gap-2",children:c.map((a,m)=>t.jsx(L,{variant:a.variant,onClick:a.onClick,className:R("h-12 text-lg font-medium",a.className),children:a.label},m))})]})}const ye=S.memo(function({items:n,onUpdateQuantity:s,onCheck:r,onRevert:o,readOnly:l=!1}){const[p,x]=S.useState(null),[d,w]=S.useState(""),[g,_]=S.useState(!1),c=i=>{x(i.id),w(i.countedQuantity.toString()),_(!1)},a=()=>{if(p){const i=parseInt(d,10);!isNaN(i)&&i>=0&&(s(p,i),x(null))}},m=()=>{x(null),w(""),_(!1)},b=i=>{w(Math.floor(i).toString())};return n.length===0?t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(ue,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),t.jsx("p",{children:"No hay productos en esta lista"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"space-y-3",children:t.jsx(fe,{mode:"popLayout",children:n.map(i=>{const y=i.countedQuantity-i.systemQuantity,N=y!==0,P=i.status==="controlled",D=y===0;return t.jsx(xe.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-100},transition:{duration:.2},children:t.jsx(lt,{disabled:l,...P?{leftAction:{label:"Editar",icon:t.jsx(he,{className:"w-5 h-5"}),color:"text-blue-500",bgColor:"rgba(59, 130, 246, 0.2)",onAction:()=>c(i)},rightAction:o?{label:"Revertir",icon:t.jsx(ae,{className:"w-5 h-5"}),color:"text-red-500",bgColor:"rgba(239, 68, 68, 0.2)",onAction:()=>o(i.id)}:void 0}:{leftAction:{label:"Confirmar",icon:t.jsx(re,{className:"w-5 h-5"}),color:"text-green-600",bgColor:"rgba(22, 163, 74, 0.2)",onAction:()=>r(i.id)},rightAction:{label:"Diferencia",icon:t.jsx(Ue,{className:"w-5 h-5"}),color:"text-orange-500",bgColor:"rgba(249, 115, 22, 0.2)",onAction:()=>c(i)}},children:t.jsx(X,{className:R("p-4 hover:shadow-md transition-shadow border-0 rounded-none sm:rounded-xl sm:border"),onClick:()=>c(i),children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:R("p-2 rounded-lg flex-shrink-0 transition-colors",P?"bg-success/10":"bg-primary/10"),children:P?t.jsx(re,{className:"w-5 h-5 text-success"}):t.jsx(ue,{className:"w-5 h-5 text-primary"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h4",{className:"font-medium text-foreground truncate",title:i.name,children:i.name}),t.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-muted-foreground",children:[t.jsx("span",{className:"font-mono bg-muted px-1.5 py-0.5 rounded",children:i.ean}),i.cost>0&&t.jsxs("span",{className:"flex items-center text-muted-foreground",children:[t.jsx(dt,{className:"w-3 h-3 mr-0.5"}),i.cost.toFixed(2)]})]}),t.jsxs("div",{className:"flex items-center gap-4 mt-3",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Sistema"}),t.jsx("span",{className:"text-sm font-medium",children:i.systemQuantity})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Físico"}),t.jsx("span",{className:R("text-sm font-bold",N?"text-warning":"text-success"),children:i.countedQuantity})]}),N&&t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Diferencia"}),t.jsx(at,{variant:y>0?"default":"destructive",className:"h-5 px-1.5 text-[10px]",children:y>0?`+${y}`:y})]})]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(L,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:k=>{k.stopPropagation(),c(i)},children:t.jsx(he,{className:"w-4 h-4"})}),i.status==="pending"&&t.jsx(L,{size:"icon",variant:D?"default":"secondary",className:R("h-10 w-10 rounded-full shadow-sm flex-shrink-0 transition-all ml-1",D?"bg-success hover:bg-success/90 text-white":"hover:bg-warning/20 text-warning"),onClick:k=>{k.stopPropagation(),r(i.id)},children:t.jsx(re,{className:"w-5 h-5"})}),i.status==="controlled"&&o&&t.jsx(L,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive hover:bg-destructive/10",onClick:k=>{k.stopPropagation(),o(i.id)},title:"Volver a pendientes",children:t.jsx(ae,{className:"w-4 h-4"})})]})]})})})},i.id)})})}),t.jsx(ke,{open:p!==null,onOpenChange:i=>!i&&m(),children:t.jsxs(Se,{className:"sm:max-w-md",children:[t.jsx(Ee,{children:t.jsx(_e,{children:"Editar Cantidad"})}),t.jsxs("div",{className:"space-y-4 py-4",children:[t.jsxs("div",{className:"flex gap-2 items-end",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Cantidad Física"}),t.jsx(te,{type:"number",min:"0",value:d,onChange:i=>w(i.target.value),onKeyDown:i=>{i.key==="Enter"&&a()},placeholder:"Ingresa la cantidad",autoFocus:!0})]}),t.jsx(L,{variant:g?"secondary":"outline",size:"icon",onClick:()=>_(!g),title:"Calculadora",children:t.jsx(pt,{className:"w-4 h-4"})})]}),t.jsx(fe,{children:g&&t.jsx(xe.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:t.jsx(wt,{onResult:b,onClose:()=>_(!1)})})})]}),t.jsxs(Pe,{children:[t.jsx(L,{variant:"outline",onClick:m,children:"Cancelar"}),t.jsx(L,{onClick:a,children:"Guardar"})]})]})})]})}),bt=Xe("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),De=S.forwardRef(({className:e,variant:n,...s},r)=>t.jsx("div",{ref:r,role:"alert",className:R(bt({variant:n}),e),...s}));De.displayName="Alert";const Ae=S.forwardRef(({className:e,...n},s)=>t.jsx("h5",{ref:s,className:R("mb-1 font-medium leading-none tracking-tight",e),...n}));Ae.displayName="AlertTitle";const Le=S.forwardRef(({className:e,...n},s)=>t.jsx("div",{ref:s,className:R("text-sm [&_p]:leading-relaxed",e),...n}));Le.displayName="AlertDescription";let le={},Ie;function ie(e={}){le={animate:!0,allowClose:!0,overlayClickBehavior:"close",overlayOpacity:.7,smoothScroll:!1,disableActiveInteraction:!1,showProgress:!1,stagePadding:10,stageRadius:5,popoverOffset:10,showButtons:["next","previous","close"],disableButtons:[],overlayColor:"#000",...e}}function u(e){return e?le[e]:le}function Ct(e){Ie=e}function T(){return Ie}let ne={};function Z(e,n){ne[e]=n}function O(e){var n;(n=ne[e])==null||n.call(ne)}function jt(){ne={}}function ee(e,n,s,r){return(e/=r/2)<1?s/2*e*e+n:-s/2*(--e*(e-2)-1)+n}function $e(e){const n='a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])';return e.flatMap(s=>{const r=s.matches(n),o=Array.from(s.querySelectorAll(n));return[...r?[s]:[],...o]}).filter(s=>getComputedStyle(s).pointerEvents!=="none"&&St(s))}function Be(e){if(!e||kt(e))return;const n=u("smoothScroll"),s=e.offsetHeight>window.innerHeight;e.scrollIntoView({behavior:!n||Nt(e)?"auto":"smooth",inline:"center",block:s?"start":"center"})}function Nt(e){if(!e||!e.parentElement)return;const n=e.parentElement;return n.scrollHeight>n.clientHeight}function kt(e){const n=e.getBoundingClientRect();return n.top>=0&&n.left>=0&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&n.right<=(window.innerWidth||document.documentElement.clientWidth)}function St(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}let oe={};function A(e,n){oe[e]=n}function h(e){return e?oe[e]:oe}function we(){oe={}}function Et(e,n,s,r){let o=h("__activeStagePosition");const l=o||s.getBoundingClientRect(),p=r.getBoundingClientRect(),x=ee(e,l.x,p.x-l.x,n),d=ee(e,l.y,p.y-l.y,n),w=ee(e,l.width,p.width-l.width,n),g=ee(e,l.height,p.height-l.height,n);o={x,y:d,width:w,height:g},Me(o),A("__activeStagePosition",o)}function Te(e){if(!e)return;const n=e.getBoundingClientRect(),s={x:n.x,y:n.y,width:n.width,height:n.height};A("__activeStagePosition",s),Me(s)}function _t(){const e=h("__activeStagePosition"),n=h("__overlaySvg");if(!e)return;if(!n){console.warn("No stage svg found.");return}const s=window.innerWidth,r=window.innerHeight;n.setAttribute("viewBox",`0 0 ${s} ${r}`)}function Pt(e){const n=Dt(e);document.body.appendChild(n),Re(n,s=>{s.target.tagName==="path"&&O("overlayClick")}),A("__overlaySvg",n)}function Me(e){const n=h("__overlaySvg");if(!n){Pt(e);return}const s=n.firstElementChild;if((s==null?void 0:s.tagName)!=="path")throw new Error("no path element found in stage svg");s.setAttribute("d",He(e))}function Dt(e){const n=window.innerWidth,s=window.innerHeight,r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("driver-overlay","driver-overlay-animated"),r.setAttribute("viewBox",`0 0 ${n} ${s}`),r.setAttribute("xmlSpace","preserve"),r.setAttribute("xmlnsXlink","http://www.w3.org/1999/xlink"),r.setAttribute("version","1.1"),r.setAttribute("preserveAspectRatio","xMinYMin slice"),r.style.fillRule="evenodd",r.style.clipRule="evenodd",r.style.strokeLinejoin="round",r.style.strokeMiterlimit="2",r.style.zIndex="10000",r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.width="100%",r.style.height="100%";const o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("d",He(e)),o.style.fill=u("overlayColor")||"rgb(0,0,0)",o.style.opacity=`${u("overlayOpacity")}`,o.style.pointerEvents="auto",o.style.cursor="auto",r.appendChild(o),r}function He(e){const n=window.innerWidth,s=window.innerHeight,r=u("stagePadding")||0,o=u("stageRadius")||0,l=e.width+r*2,p=e.height+r*2,x=Math.min(o,l/2,p/2),d=Math.floor(Math.max(x,0)),w=e.x-r+d,g=e.y-r,_=l-d*2,c=p-d*2;return`M${n},0L0,0L0,${s}L${n},${s}L${n},0Z
    M${w},${g} h${_} a${d},${d} 0 0 1 ${d},${d} v${c} a${d},${d} 0 0 1 -${d},${d} h-${_} a${d},${d} 0 0 1 -${d},-${d} v-${c} a${d},${d} 0 0 1 ${d},-${d} z`}function At(){const e=h("__overlaySvg");e&&e.remove()}function Lt(){const e=document.getElementById("driver-dummy-element");if(e)return e;let n=document.createElement("div");return n.id="driver-dummy-element",n.style.width="0",n.style.height="0",n.style.pointerEvents="none",n.style.opacity="0",n.style.position="fixed",n.style.top="50%",n.style.left="50%",document.body.appendChild(n),n}function be(e){const{element:n}=e;let s=typeof n=="function"?n():typeof n=="string"?document.querySelector(n):n;s||(s=Lt()),$t(s,e)}function It(){const e=h("__activeElement"),n=h("__activeStep");e&&(Te(e),_t(),Qe(e,n))}function $t(e,n){var s;const r=Date.now(),o=h("__activeStep"),l=h("__activeElement")||e,p=!l||l===e,x=e.id==="driver-dummy-element",d=l.id==="driver-dummy-element",w=u("animate"),g=n.onHighlightStarted||u("onHighlightStarted"),_=(n==null?void 0:n.onHighlighted)||u("onHighlighted"),c=(o==null?void 0:o.onDeselected)||u("onDeselected"),a=u(),m=h();!p&&c&&c(d?void 0:l,o,{config:a,state:m,driver:T()}),g&&g(x?void 0:e,n,{config:a,state:m,driver:T()});const b=!p&&w;let i=!1;zt(),A("previousStep",o),A("previousElement",l),A("activeStep",n),A("activeElement",e);const y=()=>{if(h("__transitionCallback")!==y)return;const N=Date.now()-r,P=400-N<=400/2;n.popover&&P&&!i&&b&&(Ce(e,n),i=!0),u("animate")&&N<400?Et(N,400,l,e):(Te(e),_&&_(x?void 0:e,n,{config:u(),state:h(),driver:T()}),A("__transitionCallback",void 0),A("__previousStep",o),A("__previousElement",l),A("__activeStep",n),A("__activeElement",e)),window.requestAnimationFrame(y)};A("__transitionCallback",y),window.requestAnimationFrame(y),Be(e),!b&&n.popover&&Ce(e,n),l.classList.remove("driver-active-element","driver-no-interaction"),l.removeAttribute("aria-haspopup"),l.removeAttribute("aria-expanded"),l.removeAttribute("aria-controls"),((s=n.disableActiveInteraction)!=null?s:u("disableActiveInteraction"))&&e.classList.add("driver-no-interaction"),e.classList.add("driver-active-element"),e.setAttribute("aria-haspopup","dialog"),e.setAttribute("aria-expanded","true"),e.setAttribute("aria-controls","driver-popover-content")}function Bt(){var e;(e=document.getElementById("driver-dummy-element"))==null||e.remove(),document.querySelectorAll(".driver-active-element").forEach(n=>{n.classList.remove("driver-active-element","driver-no-interaction"),n.removeAttribute("aria-haspopup"),n.removeAttribute("aria-expanded"),n.removeAttribute("aria-controls")})}function K(){const e=h("__resizeTimeout");e&&window.cancelAnimationFrame(e),A("__resizeTimeout",window.requestAnimationFrame(It))}function Tt(e){var n;if(!h("isInitialized")||!(e.key==="Tab"||e.keyCode===9))return;const s=h("__activeElement"),r=(n=h("popover"))==null?void 0:n.wrapper,o=$e([...r?[r]:[],...s?[s]:[]]),l=o[0],p=o[o.length-1];if(e.preventDefault(),e.shiftKey){const x=o[o.indexOf(document.activeElement)-1]||p;x==null||x.focus()}else{const x=o[o.indexOf(document.activeElement)+1]||l;x==null||x.focus()}}function ze(e){var n;((n=u("allowKeyboardControl"))==null||n)&&(e.key==="Escape"?O("escapePress"):e.key==="ArrowRight"?O("arrowRightPress"):e.key==="ArrowLeft"&&O("arrowLeftPress"))}function Re(e,n,s){const r=(o,l)=>{const p=o.target;e.contains(p)&&((!s||s(p))&&(o.preventDefault(),o.stopPropagation(),o.stopImmediatePropagation()),l==null||l(o))};document.addEventListener("pointerdown",r,!0),document.addEventListener("mousedown",r,!0),document.addEventListener("pointerup",r,!0),document.addEventListener("mouseup",r,!0),document.addEventListener("click",o=>{r(o,n)},!0)}function Mt(){window.addEventListener("keyup",ze,!1),window.addEventListener("keydown",Tt,!1),window.addEventListener("resize",K),window.addEventListener("scroll",K)}function Ht(){window.removeEventListener("keyup",ze),window.removeEventListener("resize",K),window.removeEventListener("scroll",K)}function zt(){const e=h("popover");e&&(e.wrapper.style.display="none")}function Ce(e,n){var s,r;let o=h("popover");o&&document.body.removeChild(o.wrapper),o=Ft(),document.body.appendChild(o.wrapper);const{title:l,description:p,showButtons:x,disableButtons:d,showProgress:w,nextBtnText:g=u("nextBtnText")||"Next &rarr;",prevBtnText:_=u("prevBtnText")||"&larr; Previous",progressText:c=u("progressText")||"{current} of {total}"}=n.popover||{};o.nextButton.innerHTML=g,o.previousButton.innerHTML=_,o.progress.innerHTML=c,l?(o.title.innerHTML=l,o.title.style.display="block"):o.title.style.display="none",p?(o.description.innerHTML=p,o.description.style.display="block"):o.description.style.display="none";const a=x||u("showButtons"),m=w||u("showProgress")||!1,b=(a==null?void 0:a.includes("next"))||(a==null?void 0:a.includes("previous"))||m;o.closeButton.style.display=a.includes("close")?"block":"none",b?(o.footer.style.display="flex",o.progress.style.display=m?"block":"none",o.nextButton.style.display=a.includes("next")?"block":"none",o.previousButton.style.display=a.includes("previous")?"block":"none"):o.footer.style.display="none";const i=d||u("disableButtons")||[];i!=null&&i.includes("next")&&(o.nextButton.disabled=!0,o.nextButton.classList.add("driver-popover-btn-disabled")),i!=null&&i.includes("previous")&&(o.previousButton.disabled=!0,o.previousButton.classList.add("driver-popover-btn-disabled")),i!=null&&i.includes("close")&&(o.closeButton.disabled=!0,o.closeButton.classList.add("driver-popover-btn-disabled"));const y=o.wrapper;y.style.display="block",y.style.left="",y.style.top="",y.style.bottom="",y.style.right="",y.id="driver-popover-content",y.setAttribute("role","dialog"),y.setAttribute("aria-labelledby","driver-popover-title"),y.setAttribute("aria-describedby","driver-popover-description");const N=o.arrow;N.className="driver-popover-arrow";const P=((s=n.popover)==null?void 0:s.popoverClass)||u("popoverClass")||"";y.className=`driver-popover ${P}`.trim(),Re(o.wrapper,M=>{var W,q,F;const Q=M.target,V=((W=n.popover)==null?void 0:W.onNextClick)||u("onNextClick"),z=((q=n.popover)==null?void 0:q.onPrevClick)||u("onPrevClick"),U=((F=n.popover)==null?void 0:F.onCloseClick)||u("onCloseClick");if(Q.closest(".driver-popover-next-btn"))return V?V(e,n,{config:u(),state:h(),driver:T()}):O("nextClick");if(Q.closest(".driver-popover-prev-btn"))return z?z(e,n,{config:u(),state:h(),driver:T()}):O("prevClick");if(Q.closest(".driver-popover-close-btn"))return U?U(e,n,{config:u(),state:h(),driver:T()}):O("closeClick")},M=>!(o!=null&&o.description.contains(M))&&!(o!=null&&o.title.contains(M))&&typeof M.className=="string"&&M.className.includes("driver-popover")),A("popover",o);const D=((r=n.popover)==null?void 0:r.onPopoverRender)||u("onPopoverRender");D&&D(o,{config:u(),state:h(),driver:T()}),Qe(e,n),Be(y);const k=e.classList.contains("driver-dummy-element"),E=$e([y,...k?[]:[e]]);E.length>0&&E[0].focus()}function Fe(){const e=h("popover");if(!(e!=null&&e.wrapper))return;const n=e.wrapper.getBoundingClientRect(),s=u("stagePadding")||0,r=u("popoverOffset")||0;return{width:n.width+s+r,height:n.height+s+r,realWidth:n.width,realHeight:n.height}}function je(e,n){const{elementDimensions:s,popoverDimensions:r,popoverPadding:o,popoverArrowDimensions:l}=n;return e==="start"?Math.max(Math.min(s.top-o,window.innerHeight-r.realHeight-l.width),l.width):e==="end"?Math.max(Math.min(s.top-(r==null?void 0:r.realHeight)+s.height+o,window.innerHeight-(r==null?void 0:r.realHeight)-l.width),l.width):e==="center"?Math.max(Math.min(s.top+s.height/2-(r==null?void 0:r.realHeight)/2,window.innerHeight-(r==null?void 0:r.realHeight)-l.width),l.width):0}function Ne(e,n){const{elementDimensions:s,popoverDimensions:r,popoverPadding:o,popoverArrowDimensions:l}=n;return e==="start"?Math.max(Math.min(s.left-o,window.innerWidth-r.realWidth-l.width),l.width):e==="end"?Math.max(Math.min(s.left-(r==null?void 0:r.realWidth)+s.width+o,window.innerWidth-(r==null?void 0:r.realWidth)-l.width),l.width):e==="center"?Math.max(Math.min(s.left+s.width/2-(r==null?void 0:r.realWidth)/2,window.innerWidth-(r==null?void 0:r.realWidth)-l.width),l.width):0}function Qe(e,n){const s=h("popover");if(!s)return;const{align:r="start",side:o="left"}=(n==null?void 0:n.popover)||{},l=r,p=e.id==="driver-dummy-element"?"over":o,x=u("stagePadding")||0,d=Fe(),w=s.arrow.getBoundingClientRect(),g=e.getBoundingClientRect(),_=g.top-d.height;let c=_>=0;const a=window.innerHeight-(g.bottom+d.height);let m=a>=0;const b=g.left-d.width;let i=b>=0;const y=window.innerWidth-(g.right+d.width);let N=y>=0;const P=!c&&!m&&!i&&!N;let D=p;if(p==="top"&&c?N=i=m=!1:p==="bottom"&&m?N=i=c=!1:p==="left"&&i?N=c=m=!1:p==="right"&&N&&(i=c=m=!1),p==="over"){const k=window.innerWidth/2-d.realWidth/2,E=window.innerHeight/2-d.realHeight/2;s.wrapper.style.left=`${k}px`,s.wrapper.style.right="auto",s.wrapper.style.top=`${E}px`,s.wrapper.style.bottom="auto"}else if(P){const k=window.innerWidth/2-(d==null?void 0:d.realWidth)/2,E=10;s.wrapper.style.left=`${k}px`,s.wrapper.style.right="auto",s.wrapper.style.bottom=`${E}px`,s.wrapper.style.top="auto"}else if(i){const k=Math.min(b,window.innerWidth-(d==null?void 0:d.realWidth)-w.width),E=je(l,{elementDimensions:g,popoverDimensions:d,popoverPadding:x,popoverArrowDimensions:w});s.wrapper.style.left=`${k}px`,s.wrapper.style.top=`${E}px`,s.wrapper.style.bottom="auto",s.wrapper.style.right="auto",D="left"}else if(N){const k=Math.min(y,window.innerWidth-(d==null?void 0:d.realWidth)-w.width),E=je(l,{elementDimensions:g,popoverDimensions:d,popoverPadding:x,popoverArrowDimensions:w});s.wrapper.style.right=`${k}px`,s.wrapper.style.top=`${E}px`,s.wrapper.style.bottom="auto",s.wrapper.style.left="auto",D="right"}else if(c){const k=Math.min(_,window.innerHeight-d.realHeight-w.width);let E=Ne(l,{elementDimensions:g,popoverDimensions:d,popoverPadding:x,popoverArrowDimensions:w});s.wrapper.style.top=`${k}px`,s.wrapper.style.left=`${E}px`,s.wrapper.style.bottom="auto",s.wrapper.style.right="auto",D="top"}else if(m){const k=Math.min(a,window.innerHeight-(d==null?void 0:d.realHeight)-w.width);let E=Ne(l,{elementDimensions:g,popoverDimensions:d,popoverPadding:x,popoverArrowDimensions:w});s.wrapper.style.left=`${E}px`,s.wrapper.style.bottom=`${k}px`,s.wrapper.style.top="auto",s.wrapper.style.right="auto",D="bottom"}P?s.arrow.classList.add("driver-popover-arrow-none"):Rt(l,D,e)}function Rt(e,n,s){const r=h("popover");if(!r)return;const o=s.getBoundingClientRect(),l=Fe(),p=r.arrow,x=l.width,d=window.innerWidth,w=o.width,g=o.left,_=l.height,c=window.innerHeight,a=o.top,m=o.height;p.className="driver-popover-arrow";let b=n,i=e;if(n==="top"?(g+w<=0?(b="right",i="end"):g+w-x<=0&&(b="top",i="start"),g>=d?(b="left",i="end"):g+x>=d&&(b="top",i="end")):n==="bottom"?(g+w<=0?(b="right",i="start"):g+w-x<=0&&(b="bottom",i="start"),g>=d?(b="left",i="start"):g+x>=d&&(b="bottom",i="end")):n==="left"?(a+m<=0?(b="bottom",i="end"):a+m-_<=0&&(b="left",i="start"),a>=c?(b="top",i="end"):a+_>=c&&(b="left",i="end")):n==="right"&&(a+m<=0?(b="bottom",i="start"):a+m-_<=0&&(b="right",i="start"),a>=c?(b="top",i="start"):a+_>=c&&(b="right",i="end")),!b)p.classList.add("driver-popover-arrow-none");else{p.classList.add(`driver-popover-arrow-side-${b}`),p.classList.add(`driver-popover-arrow-align-${i}`);const y=s.getBoundingClientRect(),N=p.getBoundingClientRect(),P=u("stagePadding")||0,D=y.left-P<window.innerWidth&&y.right+P>0&&y.top-P<window.innerHeight&&y.bottom+P>0;n==="bottom"&&D&&(N.x>y.x&&N.x+N.width<y.x+y.width?r.wrapper.style.transform="translateY(0)":(p.classList.remove(`driver-popover-arrow-align-${i}`),p.classList.add("driver-popover-arrow-none"),r.wrapper.style.transform=`translateY(-${P/2}px)`))}}function Ft(){const e=document.createElement("div");e.classList.add("driver-popover");const n=document.createElement("div");n.classList.add("driver-popover-arrow");const s=document.createElement("header");s.id="driver-popover-title",s.classList.add("driver-popover-title"),s.style.display="none",s.innerText="Popover Title";const r=document.createElement("div");r.id="driver-popover-description",r.classList.add("driver-popover-description"),r.style.display="none",r.innerText="Popover description is here";const o=document.createElement("button");o.type="button",o.classList.add("driver-popover-close-btn"),o.setAttribute("aria-label","Close"),o.innerHTML="&times;";const l=document.createElement("footer");l.classList.add("driver-popover-footer");const p=document.createElement("span");p.classList.add("driver-popover-progress-text"),p.innerText="";const x=document.createElement("span");x.classList.add("driver-popover-navigation-btns");const d=document.createElement("button");d.type="button",d.classList.add("driver-popover-prev-btn"),d.innerHTML="&larr; Previous";const w=document.createElement("button");return w.type="button",w.classList.add("driver-popover-next-btn"),w.innerHTML="Next &rarr;",x.appendChild(d),x.appendChild(w),l.appendChild(p),l.appendChild(x),e.appendChild(o),e.appendChild(n),e.appendChild(s),e.appendChild(r),e.appendChild(l),{wrapper:e,arrow:n,title:s,description:r,footer:l,previousButton:d,nextButton:w,closeButton:o,footerButtons:x,progress:p}}function Qt(){var e;const n=h("popover");n&&((e=n.wrapper.parentElement)==null||e.removeChild(n.wrapper))}function Ot(e={}){ie(e);function n(){u("allowClose")&&g()}function s(){const c=u("overlayClickBehavior");if(u("allowClose")&&c==="close"){g();return}if(typeof c=="function"){const a=h("__activeStep"),m=h("__activeElement");c(m,a,{config:u(),state:h(),driver:T()});return}c==="nextStep"&&r()}function r(){const c=h("activeIndex"),a=u("steps")||[];if(typeof c>"u")return;const m=c+1;a[m]?w(m):g()}function o(){const c=h("activeIndex"),a=u("steps")||[];if(typeof c>"u")return;const m=c-1;a[m]?w(m):g()}function l(c){(u("steps")||[])[c]?w(c):g()}function p(){var c;if(h("__transitionCallback"))return;const a=h("activeIndex"),m=h("__activeStep"),b=h("__activeElement");if(typeof a>"u"||typeof m>"u"||typeof h("activeIndex")>"u")return;const i=((c=m.popover)==null?void 0:c.onPrevClick)||u("onPrevClick");if(i)return i(b,m,{config:u(),state:h(),driver:T()});o()}function x(){var c;if(h("__transitionCallback"))return;const a=h("activeIndex"),m=h("__activeStep"),b=h("__activeElement");if(typeof a>"u"||typeof m>"u")return;const i=((c=m.popover)==null?void 0:c.onNextClick)||u("onNextClick");if(i)return i(b,m,{config:u(),state:h(),driver:T()});r()}function d(){h("isInitialized")||(A("isInitialized",!0),document.body.classList.add("driver-active",u("animate")?"driver-fade":"driver-simple"),Mt(),Z("overlayClick",s),Z("escapePress",n),Z("arrowLeftPress",p),Z("arrowRightPress",x))}function w(c=0){var a,m,b,i,y,N,P,D;const k=u("steps");if(!k){console.error("No steps to drive through"),g();return}if(!k[c]){g();return}A("__activeOnDestroyed",document.activeElement),A("activeIndex",c);const E=k[c],M=k[c+1],W=k[c-1],q=((a=E.popover)==null?void 0:a.doneBtnText)||u("doneBtnText")||"Done",F=u("allowClose"),Q=typeof((m=E.popover)==null?void 0:m.showProgress)<"u"?(b=E.popover)==null?void 0:b.showProgress:u("showProgress"),V=(((i=E.popover)==null?void 0:i.progressText)||u("progressText")||"{{current}} of {{total}}").replace("{{current}}",`${c+1}`).replace("{{total}}",`${k.length}`),z=((y=E.popover)==null?void 0:y.showButtons)||u("showButtons"),U=["next","previous",...F?["close"]:[]].filter(j=>!(z!=null&&z.length)||z.includes(j)),v=((N=E.popover)==null?void 0:N.onNextClick)||u("onNextClick"),f=((P=E.popover)==null?void 0:P.onPrevClick)||u("onPrevClick"),C=((D=E.popover)==null?void 0:D.onCloseClick)||u("onCloseClick");be({...E,popover:{showButtons:U,nextBtnText:M?void 0:q,disableButtons:[...W?[]:["previous"]],showProgress:Q,progressText:V,onNextClick:v||(()=>{M?w(c+1):g()}),onPrevClick:f||(()=>{w(c-1)}),onCloseClick:C||(()=>{g()}),...(E==null?void 0:E.popover)||{}}})}function g(c=!0){const a=h("__activeElement"),m=h("__activeStep"),b=h("__activeOnDestroyed"),i=u("onDestroyStarted");if(c&&i){const P=!a||(a==null?void 0:a.id)==="driver-dummy-element";i(P?void 0:a,m,{config:u(),state:h(),driver:T()});return}const y=(m==null?void 0:m.onDeselected)||u("onDeselected"),N=u("onDestroyed");if(document.body.classList.remove("driver-active","driver-fade","driver-simple"),Ht(),Qt(),Bt(),At(),jt(),we(),a&&m){const P=a.id==="driver-dummy-element";y&&y(P?void 0:a,m,{config:u(),state:h(),driver:T()}),N&&N(P?void 0:a,m,{config:u(),state:h(),driver:T()})}b&&b.focus()}const _={isActive:()=>h("isInitialized")||!1,refresh:K,drive:(c=0)=>{d(),w(c)},setConfig:ie,setSteps:c=>{we(),ie({...u(),steps:c})},getConfig:u,getState:h,getActiveIndex:()=>h("activeIndex"),isFirstStep:()=>h("activeIndex")===0,isLastStep:()=>{const c=u("steps")||[],a=h("activeIndex");return a!==void 0&&a===c.length-1},getActiveStep:()=>h("activeStep"),getActiveElement:()=>h("activeElement"),getPreviousElement:()=>h("previousElement"),getPreviousStep:()=>h("previousStep"),moveNext:r,movePrevious:o,moveTo:l,hasNextStep:()=>{const c=u("steps")||[],a=h("activeIndex");return a!==void 0&&!!c[a+1]},hasPreviousStep:()=>{const c=u("steps")||[],a=h("activeIndex");return a!==void 0&&!!c[a-1]},highlight:c=>{d(),be({...c,popover:c.popover?{showButtons:[],showProgress:!1,progressText:"",...c.popover}:void 0})},destroy:()=>{g(!1)}};return Ct(_),_}function Wt(){const e=()=>{Ot({showProgress:!0,steps:[{element:"#diff-mode",popover:{title:"Solo Diferencias",description:"Activa este interruptor para ver solo los productos que tienen diferencias entre el stock físico y el del sistema.",side:"bottom",align:"start"}},{element:'[role="tablist"]',popover:{title:"Pestañas de Estado",description:'Navega entre "Pendientes" y "Controlados" para organizar tu trabajo.',side:"bottom",align:"start"}},{element:".bg-card.relative",popover:{title:"Acciones Rápidas",description:"Desliza a la derecha para Confirmar/Editar o a la izquierda para reportar Diferencia/Revertir.",side:"top",align:"start"}},{element:"button:has(.lucide-save)",popover:{title:"Finalizar Inventario",description:"Cuando termines, guarda el estado del inventario aquí.",side:"left",align:"start"}}]}).drive()};return S.useEffect(()=>{localStorage.getItem("has_seen_inventory_tour")||setTimeout(()=>{e(),localStorage.setItem("has_seen_inventory_tour","true")},1e3)},[]),t.jsx(L,{variant:"ghost",size:"icon",onClick:e,title:"Ver Tutorial",children:t.jsx(xt,{className:"w-5 h-5"})})}function hn(){const{id:e}=et(),n=tt(),[s,r]=S.useState(!1),[o,l]=S.useState([]),[p,x]=S.useState(""),[d,w]=S.useState(""),[g,_]=S.useState(!1),[c,a]=S.useState(!1),[m,b]=S.useState("");S.useEffect(()=>{e&&x(decodeURIComponent(e))},[e]),S.useEffect(()=>{if(p){const v=localStorage.getItem(`cyclic_inventory_${p}`);if(v)try{const f=JSON.parse(v);if(Array.isArray(f)){const C=f.filter(j=>j&&typeof j=="object"&&typeof j.id=="string"&&typeof j.name=="string"&&typeof j.systemQuantity=="number"&&typeof j.countedQuantity=="number");C.length!==f.length&&console.warn(`Filtered out ${f.length-C.length} invalid items.`),l(C)}else console.warn("Invalid inventory data format in localStorage, resetting."),l([])}catch(f){console.error("Failed to load saved inventory",f),l([])}}},[p]),S.useEffect(()=>{p&&o.length>0&&localStorage.setItem(`cyclic_inventory_${p}`,JSON.stringify(o))},[o,p]);const i=S.useMemo(()=>o.filter(v=>{if(d){const f=d.toLowerCase();if(!v.name.toLowerCase().includes(f)&&!v.ean.includes(f))return!1}return g?v.countedQuantity!==v.systemQuantity:!0}),[o,d,g]),y=S.useMemo(()=>i.filter(v=>v.status==="pending"),[i]),N=S.useMemo(()=>i.filter(v=>v.status==="controlled"),[i]),P=async v=>{var j;const f=(j=v.target.files)==null?void 0:j[0];if(!f)return;r(!0);const C=new FileReader;C.onload=I=>{var $;try{const H=($=I.target)==null?void 0:$.result,de=st(H,{type:"binary"}),Oe=de.SheetNames[0],We=de.Sheets[Oe],pe=G.sheet_to_json(We,{header:1}),qe=[];let qt=!1,Vt="";for(let se=1;se<pe.length;se++){const Y=pe[se];if(!Y||Y.length===0)continue;const Ut=Y[14];Y[3]&&B.success(`Se cargaron ${qe.length} productos correctamente.`)}}catch(H){console.error("Error reading file:",H),B.error("Error al procesar el archivo Excel.")}finally{r(!1),v.target.value=""}},C.readAsBinaryString(f)},D=S.useCallback((v,f)=>{l(C=>C.map(j=>j.id===v?(f-j.systemQuantity!==0&&navigator.vibrate?navigator.vibrate([50,50,50]):navigator.vibrate&&navigator.vibrate(50),{...j,countedQuantity:f,status:"controlled"}):j))},[]),k=S.useCallback(v=>{navigator.vibrate&&navigator.vibrate(50),l(f=>f.map(C=>C.id===v?{...C,status:"controlled",countedQuantity:C.systemQuantity}:C)),B.success("Producto controlado")},[]),E=S.useCallback(v=>{l(f=>f.map(C=>C.id===v?{...C,status:"pending"}:C)),B.info("Producto devuelto a pendientes")},[]),M=()=>{if(!m.trim()){B.error("Por favor ingresa el ID del ajuste de PLEX");return}const v={status:"controlado",lastUpdated:Date.now(),plexId:m,items:o};localStorage.setItem(`cyclic_inventory_status_${p}`,JSON.stringify(v)),Ze(async()=>{const{OfflineQueue:f}=await import("./index-Cx5CSyws.js").then(C=>C.ad);return{OfflineQueue:f}},__vite__mapDeps([0,1,2,3,4,5,6])).then(({OfflineQueue:f})=>{f.enqueue("SAVE_INVENTORY",{labName:p,plexId:m,items:o}),navigator.onLine?B.success(`Inventario guardado con ID PLEX: ${m}`):B.info("Guardado en cola. Se sincronizará cuando recuperes la conexión.")}),a(!1),b(""),n("/cyclic-inventory")},W=()=>{const v=o.map(j=>({EAN:j.ean,Producto:j.name,Laboratorio:p,"Cantidad Sistema":j.systemQuantity,"Cantidad Física":j.countedQuantity,Diferencia:j.countedQuantity-j.systemQuantity,Costo:j.cost,Estado:j.status==="controlled"?"CONTROLADO":"PENDIENTE"})),f=G.json_to_sheet(v),C=G.book_new();G.book_append_sheet(C,f,"Inventario"),rt(C,`Inventario_${p}.xlsx`),B.success("Excel generado")},[q,F]=S.useState(!1),Q=S.useCallback(v=>{const f=o.find(C=>C.ean===v);f?(D(f.id,f.countedQuantity+1),B.success(`Producto encontrado: ${f.name}`)):B.error(`Producto no encontrado: ${v}`)},[o,D]),V=S.useCallback(v=>{let f=0,C=0;const j=new Map;o.forEach(I=>j.set(I.id,I.countedQuantity)),v.forEach(I=>{const $=o.find(H=>H.ean===I);if($){const H=j.get($.id)||0;j.set($.id,H+1),f++}else C++}),f>0&&(l(I=>I.map($=>{if(j.has($.id)){const H=j.get($.id);if(H!==$.countedQuantity)return{...$,countedQuantity:H,status:"controlled"}}return $})),B.success(`Procesados ${f} items correctamente.`)),C>0&&B.warning(`${C} códigos no encontrados.`)},[o]),z=()=>{const v=new it;v.setFontSize(16),v.text(`Inventario Cíclico: ${p}`,10,10),v.setFontSize(10),v.text(`Fecha: ${new Date().toLocaleDateString()}`,10,18);let f=30;const C=10,j=v.internal.pageSize.height;v.setFont("helvetica","bold"),v.text("Producto",10,f),v.text("Sistema",100,f),v.text("Físico",130,f),v.text("Dif",160,f),v.text("Estado",180,f),f+=C,v.setFont("helvetica","normal"),o.forEach(I=>{f>j-20&&(v.addPage(),f=20);const $=I.countedQuantity-I.systemQuantity;v.text(I.name.substring(0,40),10,f),v.text(I.systemQuantity.toString(),100,f),v.text(I.countedQuantity.toString(),130,f),v.setTextColor($===0?0:255,0,0),v.text($.toString(),160,f),v.setTextColor(0),v.text(I.status==="controlled"?"OK":"Pend",180,f),f+=C}),v.save(`Inventario_${p}_${new Date().toISOString().split("T")[0]}.pdf`),B.success("Reporte PDF generado")},U=()=>{confirm("¿Estás seguro de que quieres reiniciar los datos de este laboratorio? Se perderán los cambios no guardados.")&&(localStorage.removeItem(`cyclic_inventory_${p}`),localStorage.removeItem(`cyclic_inventory_status_${p}`),l([]),B.success("Datos reiniciados correctamente."),n("/cyclic-inventory"))};return t.jsxs("div",{className:"p-4 md:p-6 space-y-6 max-w-7xl mx-auto",children:[t.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(L,{variant:"ghost",size:"icon",onClick:()=>n("/cyclic-inventory"),children:t.jsx(ht,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:p}),t.jsx("p",{className:"text-muted-foreground text-sm",children:"Control de Inventario Cíclico"})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(Wt,{}),o.length>0&&t.jsxs(t.Fragment,{children:[t.jsxs(L,{variant:"outline",size:"sm",onClick:()=>F(!0),children:[t.jsx(yt,{className:"w-4 h-4 mr-2"}),"Escanear"]}),t.jsxs(L,{variant:"outline",size:"sm",onClick:W,children:[t.jsx(ut,{className:"w-4 h-4 mr-2"}),"Excel"]}),t.jsxs(L,{variant:"outline",size:"sm",onClick:z,children:[t.jsx(Ke,{className:"w-4 h-4 mr-2"}),"PDF"]}),t.jsxs(L,{variant:"default",size:"sm",onClick:()=>a(!0),children:[t.jsx(vt,{className:"w-4 h-4 mr-2"}),"Finalizar"]})]})]})]}),o.length===0?t.jsxs(X,{className:"p-12 border-dashed border-2 flex flex-col items-center justify-center text-center space-y-4 bg-muted/20",children:[t.jsx("div",{className:"p-4 bg-primary/10 rounded-full",children:t.jsx(Ye,{className:"w-8 h-8 text-primary"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Cargar Archivo de Inventario"}),t.jsxs("p",{className:"text-muted-foreground max-w-md mx-auto mt-2",children:["Sube el archivo Excel (.xlsx) descargado del sistema para comenzar el control de ",p,"."]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(L,{disabled:s,children:s?"Procesando...":"Seleccionar Archivo"}),t.jsx(te,{type:"file",accept:".xlsx, .xls",className:"absolute inset-0 opacity-0 cursor-pointer",onChange:P,disabled:s})]}),t.jsx("p",{className:"text-xs text-muted-foreground mt-4",children:"Columnas requeridas: C (EAN), D (Producto), E (Cantidad), O (Laboratorio)"})]}):t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-3 grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs(X,{className:"p-4 flex flex-col items-center justify-center bg-primary/5 border-primary/20",children:[t.jsx("span",{className:"text-muted-foreground text-xs uppercase font-bold",children:"Total Items"}),t.jsx("span",{className:"text-2xl font-bold",children:t.jsx(J,{value:o.length})})]}),t.jsxs(X,{className:"p-4 flex flex-col items-center justify-center bg-warning/5 border-warning/20",children:[t.jsx("span",{className:"text-muted-foreground text-xs uppercase font-bold",children:"Pendientes"}),t.jsx("span",{className:"text-2xl font-bold text-warning",children:t.jsx(J,{value:o.filter(v=>v.status==="pending").length})})]}),t.jsxs(X,{className:"p-4 flex flex-col items-center justify-center bg-success/5 border-success/20",children:[t.jsx("span",{className:"text-muted-foreground text-xs uppercase font-bold",children:"Controlados"}),t.jsx("span",{className:"text-2xl font-bold text-success",children:t.jsx(J,{value:o.filter(v=>v.status==="controlled").length})})]}),t.jsxs(X,{className:"p-4 flex flex-col items-center justify-center",children:[t.jsx("span",{className:"text-muted-foreground text-xs uppercase font-bold",children:"Avance"}),t.jsxs("span",{className:"text-2xl font-bold",children:[t.jsx(J,{value:Math.round(o.filter(v=>v.status==="controlled").length/o.length*100)}),"%"]})]})]}),t.jsxs("div",{className:"lg:col-span-3",children:[t.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(ft,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),t.jsx(te,{placeholder:"Buscar por nombre o EAN...",value:d,onChange:v=>w(v.target.value),className:"pl-9"})]}),t.jsxs("div",{className:"flex items-center space-x-2 bg-card p-2 rounded-lg border",children:[t.jsx(mt,{id:"diff-mode",checked:g,onCheckedChange:_}),t.jsx(ge,{htmlFor:"diff-mode",className:"cursor-pointer",children:"Solo Diferencias"})]}),t.jsxs(L,{variant:"destructive",size:"sm",onClick:U,className:"ml-2",children:[t.jsx(ae,{className:"w-4 h-4 mr-2"}),"Reiniciar Datos"]})]}),t.jsxs(nt,{defaultValue:"pending",className:"w-full",children:[t.jsxs(ot,{className:"grid w-full grid-cols-2 mb-4",children:[t.jsxs(ve,{value:"pending",className:"relative",children:["Pendientes",y.length>0&&t.jsx("span",{className:"ml-2 bg-warning text-warning-foreground text-[10px] px-1.5 py-0.5 rounded-full",children:y.length})]}),t.jsxs(ve,{value:"controlled",children:["Controlados",N.length>0&&t.jsx("span",{className:"ml-2 bg-success text-success-foreground text-[10px] px-1.5 py-0.5 rounded-full",children:N.length})]})]}),t.jsxs(me,{value:"pending",className:"space-y-4",children:[t.jsxs(De,{className:"bg-muted/50 border-none mb-4",children:[t.jsx(Ge,{className:"h-4 w-4"}),t.jsx(Ae,{children:"Instrucciones"}),t.jsx(Le,{children:"Desliza a la derecha para confirmar (verde) o a la izquierda para reportar diferencia (naranja)."})]}),t.jsx(ye,{items:y,onUpdateQuantity:D,onCheck:k})]}),t.jsx(me,{value:"controlled",className:"space-y-4",children:t.jsx(ye,{items:N,onUpdateQuantity:D,onCheck:k,onRevert:E,readOnly:!1})})]})]})]}),t.jsx(ke,{open:c,onOpenChange:a,children:t.jsxs(Se,{children:[t.jsxs(Ee,{children:[t.jsx(_e,{children:"Finalizar Inventario"}),t.jsx(Je,{children:"Ingresa el ID del ajuste generado en PLEX para guardar el estado de este inventario."})]}),t.jsxs("div",{className:"py-4",children:[t.jsx(ge,{htmlFor:"plexId",className:"mb-2 block",children:"ID Ajuste PLEX"}),t.jsx(te,{id:"plexId",value:m,onChange:v=>b(v.target.value),placeholder:"Ej: 123456"})]}),t.jsxs(Pe,{children:[t.jsx(L,{variant:"outline",onClick:()=>a(!1),children:"Cancelar"}),t.jsx(L,{onClick:M,children:"Guardar y Finalizar"})]})]})}),t.jsx(ct,{open:q,onOpenChange:F,onScan:Q,onBatchScan:V})]})}export{hn as default};
