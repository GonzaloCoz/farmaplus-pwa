var Jn=Object.defineProperty;var Qn=(t,s,n)=>s in t?Jn(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var Es=(t,s,n)=>Qn(t,typeof s!="symbol"?s+"":s,n);import{j as e}from"./ui-vendor-DpWgbapL.js";import{r as i,c as J,a as rt,u as er}from"./react-vendor-ylmX0jv_.js";import{c as $,C as Pt,a as pt,T as rs,u as ve,g as tr,B as A,b as O,X as Js,P as sr,D as Qs,d as en,e as tn,f as sn,h as nr,S as nn,i as se,j as B,k as _,l as H,m as rr,n as G,o as ar,p as or,q as rn,r as ir,s as lr,t as cr,v as nt,w as Ot,x as Lt,y as an,z as te,A as as,E as os,F as on,G as ln,H as lt,I as dr,J as ur,U as cn,W as mr,R as dn,K as hr,L as fr,M as xr,N as pr,O as gr,Q as vr}from"./index-nj5uYoc8.js";import{D as ct,c as Se}from"./cyclicInventoryService-C6Ll1BA1.js";import{T as Le}from"./trending-up-VhUTPing.js";import{U as un,P as Is,h as dt}from"./permissions-D9KtUNZK.js";import{C as qe}from"./clock-ChlnXsZ5.js";import{H as br}from"./history-DQvyuzGR.js";import{T as mn}from"./target-C2m_HDZr.js";import{W as hn}from"./wifi-Dh1ERag9.js";import{C as ut}from"./calendar-CqAyxpNB.js";import{auditService as yr}from"./auditService-DhQMFpMO.js";import{A as jr}from"./AnimatedCard-BTmgtiOM.js";import{D as wr,a as Nr,b as Cr,c as Sr,T as is,A as As}from"./dropdown-menu-CnGp-N5L.js";import{I as ie}from"./input-DwEKUKzf.js";import{S as Dr,A as Gt}from"./AnimatedProgressBar-DToPHBr4.js";import{P as Oe}from"./plus-CJ6Vo5rc.js";import{s as kr,e as Er,a as Ir,b as Ar,d as Mr,f as Ms,i as Rr,g as Tr,p as zr,h as Pr,j as Or,k as Lr}from"./utils-B3_ieZWp.js";import{C as Br}from"./chevron-left-CT5fWJ55.js";import{e as Nt}from"./es-DzSx4Un2.js";import{S as kt,a as Et,b as It,c as At,d as He,u as Ur}from"./useUserBranches-DGBCEysq.js";import{A as Bt,m as L}from"./animation-D5s1b1Vs.js";import{M as $r}from"./map-pin-M2BOHUnQ.js";import{T as Wr}from"./trash-2-QgeEM5Fq.js";import{S as Fr}from"./save-D4Ilx3qL.js";import{R as Vr}from"./rotate-ccw-Bzj3W3iA.js";import{g as _r}from"./expirationDB-_e3X6uli.js";import{A as Hr}from"./arrow-right-DeeW5poA.js";import{M as Gr,P as fn}from"./progress-C5Q8sFEo.js";import{C as xn}from"./CounterAnimation-Cxw_j9vI.js";import{L as Te}from"./label-DK45WQiY.js";import{L as qr}from"./loader-circle-DQFn4GZN.js";import{T as Yr,a as Xr,b as qt,c as Ne,d as Kr,e as F}from"./table-9MhbLg42.js";import{R as pn,L as Zr,C as Jr,X as Qr,Y as ea,T as gn,a as ta,b as Rs,P as sa,c as na,d as ra}from"./chart-vendor-D3hk2TXZ.js";import{E as aa}from"./eye-Dks3rOSu.js";import"./excel-uoQkVabA.js";import"./circle-DNmM3q1k.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=$("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=$("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=$("BrainCircuit",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M9 13a4.5 4.5 0 0 0 3-4",key:"10igwf"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M12 13h4",key:"1ku699"}],["path",{d:"M12 18h6a2 2 0 0 1 2 2v1",key:"105ag5"}],["path",{d:"M12 8h8",key:"1lhi5i"}],["path",{d:"M16 8V5a2 2 0 0 1 2-2",key:"u6izg6"}],["circle",{cx:"16",cy:"13",r:".5",key:"ry7gng"}],["circle",{cx:"18",cy:"3",r:".5",key:"1aiba7"}],["circle",{cx:"20",cy:"21",r:".5",key:"yhc1fs"}],["circle",{cx:"20",cy:"8",r:".5",key:"1e43v0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=$("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=$("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vn=$("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=$("ChartLine",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=$("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=$("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bn=$("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=$("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=$("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=$("MessageSquarePlus",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M12 7v6",key:"lw1j43"}],["path",{d:"M9 10h6",key:"9gxzsh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=$("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=$("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=$("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=$("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=$("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=$("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=$("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=$("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=$("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=$("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);function Na(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return i.useMemo(()=>r=>{s.forEach(a=>a(r))},s)}const Ut=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Ye(t){const s=Object.prototype.toString.call(t);return s==="[object Window]"||s==="[object global]"}function ds(t){return"nodeType"in t}function ne(t){var s,n;return t?Ye(t)?t:ds(t)&&(s=(n=t.ownerDocument)==null?void 0:n.defaultView)!=null?s:window:window}function us(t){const{Document:s}=ne(t);return t instanceof s}function gt(t){return Ye(t)?!1:t instanceof ne(t).HTMLElement}function yn(t){return t instanceof ne(t).SVGElement}function Xe(t){return t?Ye(t)?t.document:ds(t)?us(t)?t:gt(t)||yn(t)?t.ownerDocument:document:document:document}const ge=Ut?i.useLayoutEffect:i.useEffect;function ms(t){const s=i.useRef(t);return ge(()=>{s.current=t}),i.useCallback(function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return s.current==null?void 0:s.current(...r)},[])}function Ca(){const t=i.useRef(null),s=i.useCallback((r,a)=>{t.current=setInterval(r,a)},[]),n=i.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[s,n]}function mt(t,s){s===void 0&&(s=[t]);const n=i.useRef(t);return ge(()=>{n.current!==t&&(n.current=t)},s),n}function vt(t,s){const n=i.useRef();return i.useMemo(()=>{const r=t(n.current);return n.current=r,r},[...s])}function Mt(t){const s=ms(t),n=i.useRef(null),r=i.useCallback(a=>{a!==n.current&&(s==null||s(a,n.current)),n.current=a},[]);return[n,r]}function Qt(t){const s=i.useRef();return i.useEffect(()=>{s.current=t},[t]),s.current}let Yt={};function bt(t,s){return i.useMemo(()=>{if(s)return s;const n=Yt[t]==null?0:Yt[t]+1;return Yt[t]=n,t+"-"+n},[t,s])}function jn(t){return function(s){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return r.reduce((o,l)=>{const c=Object.entries(l);for(const[u,m]of c){const f=o[u];f!=null&&(o[u]=f+t*m)}return o},{...s})}}const Ge=jn(1),ht=jn(-1);function Sa(t){return"clientX"in t&&"clientY"in t}function hs(t){if(!t)return!1;const{KeyboardEvent:s}=ne(t.target);return s&&t instanceof s}function Da(t){if(!t)return!1;const{TouchEvent:s}=ne(t.target);return s&&t instanceof s}function es(t){if(Da(t)){if(t.touches&&t.touches.length){const{clientX:s,clientY:n}=t.touches[0];return{x:s,y:n}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:s,clientY:n}=t.changedTouches[0];return{x:s,y:n}}}return Sa(t)?{x:t.clientX,y:t.clientY}:null}const ft=Object.freeze({Translate:{toString(t){if(!t)return;const{x:s,y:n}=t;return"translate3d("+(s?Math.round(s):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:s,scaleY:n}=t;return"scaleX("+s+") scaleY("+n+")"}},Transform:{toString(t){if(t)return[ft.Translate.toString(t),ft.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:s,duration:n,easing:r}=t;return s+" "+n+"ms "+r}}}),Ps="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function ka(t){return t.matches(Ps)?t:t.querySelector(Ps)}const Ea={display:"none"};function Ia(t){let{id:s,value:n}=t;return J.createElement("div",{id:s,style:Ea},n)}function Aa(t){let{id:s,announcement:n,ariaLiveType:r="assertive"}=t;const a={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return J.createElement("div",{id:s,style:a,role:"status","aria-live":r,"aria-atomic":!0},n)}function Ma(){const[t,s]=i.useState("");return{announce:i.useCallback(r=>{r!=null&&s(r)},[]),announcement:t}}const wn=i.createContext(null);function Ra(t){const s=i.useContext(wn);i.useEffect(()=>{if(!s)throw new Error("useDndMonitor must be used within a children of <DndContext>");return s(t)},[t,s])}function Ta(){const[t]=i.useState(()=>new Set),s=i.useCallback(r=>(t.add(r),()=>t.delete(r)),[t]);return[i.useCallback(r=>{let{type:a,event:o}=r;t.forEach(l=>{var c;return(c=l[a])==null?void 0:c.call(l,o)})},[t]),s]}const za={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Pa={onDragStart(t){let{active:s}=t;return"Picked up draggable item "+s.id+"."},onDragOver(t){let{active:s,over:n}=t;return n?"Draggable item "+s.id+" was moved over droppable area "+n.id+".":"Draggable item "+s.id+" is no longer over a droppable area."},onDragEnd(t){let{active:s,over:n}=t;return n?"Draggable item "+s.id+" was dropped over droppable area "+n.id:"Draggable item "+s.id+" was dropped."},onDragCancel(t){let{active:s}=t;return"Dragging was cancelled. Draggable item "+s.id+" was dropped."}};function Oa(t){let{announcements:s=Pa,container:n,hiddenTextDescribedById:r,screenReaderInstructions:a=za}=t;const{announce:o,announcement:l}=Ma(),c=bt("DndLiveRegion"),[u,m]=i.useState(!1);if(i.useEffect(()=>{m(!0)},[]),Ra(i.useMemo(()=>({onDragStart(d){let{active:p}=d;o(s.onDragStart({active:p}))},onDragMove(d){let{active:p,over:h}=d;s.onDragMove&&o(s.onDragMove({active:p,over:h}))},onDragOver(d){let{active:p,over:h}=d;o(s.onDragOver({active:p,over:h}))},onDragEnd(d){let{active:p,over:h}=d;o(s.onDragEnd({active:p,over:h}))},onDragCancel(d){let{active:p,over:h}=d;o(s.onDragCancel({active:p,over:h}))}}),[o,s])),!u)return null;const f=J.createElement(J.Fragment,null,J.createElement(Ia,{id:r,value:a.draggable}),J.createElement(Aa,{id:c,announcement:l}));return n?rt.createPortal(f,n):f}var V;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(V||(V={}));function Rt(){}function Os(t,s){return i.useMemo(()=>({sensor:t,options:s??{}}),[t,s])}function La(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return i.useMemo(()=>[...s].filter(r=>r!=null),[...s])}const me=Object.freeze({x:0,y:0});function Nn(t,s){return Math.sqrt(Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2))}function Cn(t,s){let{data:{value:n}}=t,{data:{value:r}}=s;return n-r}function Ba(t,s){let{data:{value:n}}=t,{data:{value:r}}=s;return r-n}function Ls(t){let{left:s,top:n,height:r,width:a}=t;return[{x:s,y:n},{x:s+a,y:n},{x:s,y:n+r},{x:s+a,y:n+r}]}function Sn(t,s){if(!t||t.length===0)return null;const[n]=t;return n[s]}function Bs(t,s,n){return s===void 0&&(s=t.left),n===void 0&&(n=t.top),{x:s+t.width*.5,y:n+t.height*.5}}const Ua=t=>{let{collisionRect:s,droppableRects:n,droppableContainers:r}=t;const a=Bs(s,s.left,s.top),o=[];for(const l of r){const{id:c}=l,u=n.get(c);if(u){const m=Nn(Bs(u),a);o.push({id:c,data:{droppableContainer:l,value:m}})}}return o.sort(Cn)},$a=t=>{let{collisionRect:s,droppableRects:n,droppableContainers:r}=t;const a=Ls(s),o=[];for(const l of r){const{id:c}=l,u=n.get(c);if(u){const m=Ls(u),f=a.reduce((p,h,v)=>p+Nn(m[v],h),0),d=Number((f/4).toFixed(4));o.push({id:c,data:{droppableContainer:l,value:d}})}}return o.sort(Cn)};function Wa(t,s){const n=Math.max(s.top,t.top),r=Math.max(s.left,t.left),a=Math.min(s.left+s.width,t.left+t.width),o=Math.min(s.top+s.height,t.top+t.height),l=a-r,c=o-n;if(r<a&&n<o){const u=s.width*s.height,m=t.width*t.height,f=l*c,d=f/(u+m-f);return Number(d.toFixed(4))}return 0}const Fa=t=>{let{collisionRect:s,droppableRects:n,droppableContainers:r}=t;const a=[];for(const o of r){const{id:l}=o,c=n.get(l);if(c){const u=Wa(c,s);u>0&&a.push({id:l,data:{droppableContainer:o,value:u}})}}return a.sort(Ba)};function Va(t,s,n){return{...t,scaleX:s&&n?s.width/n.width:1,scaleY:s&&n?s.height/n.height:1}}function Dn(t,s){return t&&s?{x:t.left-s.left,y:t.top-s.top}:me}function _a(t){return function(n){for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return a.reduce((l,c)=>({...l,top:l.top+t*c.y,bottom:l.bottom+t*c.y,left:l.left+t*c.x,right:l.right+t*c.x}),{...n})}}const Ha=_a(1);function Ga(t){if(t.startsWith("matrix3d(")){const s=t.slice(9,-1).split(/, /);return{x:+s[12],y:+s[13],scaleX:+s[0],scaleY:+s[5]}}else if(t.startsWith("matrix(")){const s=t.slice(7,-1).split(/, /);return{x:+s[4],y:+s[5],scaleX:+s[0],scaleY:+s[3]}}return null}function qa(t,s,n){const r=Ga(s);if(!r)return t;const{scaleX:a,scaleY:o,x:l,y:c}=r,u=t.left-l-(1-a)*parseFloat(n),m=t.top-c-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),f=a?t.width/a:t.width,d=o?t.height/o:t.height;return{width:f,height:d,top:m,right:u+f,bottom:m+d,left:u}}const Ya={ignoreTransform:!1};function Ke(t,s){s===void 0&&(s=Ya);let n=t.getBoundingClientRect();if(s.ignoreTransform){const{transform:m,transformOrigin:f}=ne(t).getComputedStyle(t);m&&(n=qa(n,m,f))}const{top:r,left:a,width:o,height:l,bottom:c,right:u}=n;return{top:r,left:a,width:o,height:l,bottom:c,right:u}}function Us(t){return Ke(t,{ignoreTransform:!0})}function Xa(t){const s=t.innerWidth,n=t.innerHeight;return{top:0,left:0,right:s,bottom:n,width:s,height:n}}function Ka(t,s){return s===void 0&&(s=ne(t).getComputedStyle(t)),s.position==="fixed"}function Za(t,s){s===void 0&&(s=ne(t).getComputedStyle(t));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(a=>{const o=s[a];return typeof o=="string"?n.test(o):!1})}function $t(t,s){const n=[];function r(a){if(s!=null&&n.length>=s||!a)return n;if(us(a)&&a.scrollingElement!=null&&!n.includes(a.scrollingElement))return n.push(a.scrollingElement),n;if(!gt(a)||yn(a)||n.includes(a))return n;const o=ne(t).getComputedStyle(a);return a!==t&&Za(a,o)&&n.push(a),Ka(a,o)?n:r(a.parentNode)}return t?r(t):n}function kn(t){const[s]=$t(t,1);return s??null}function Xt(t){return!Ut||!t?null:Ye(t)?t:ds(t)?us(t)||t===Xe(t).scrollingElement?window:gt(t)?t:null:null}function En(t){return Ye(t)?t.scrollX:t.scrollLeft}function In(t){return Ye(t)?t.scrollY:t.scrollTop}function ts(t){return{x:En(t),y:In(t)}}var Y;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(Y||(Y={}));function An(t){return!Ut||!t?!1:t===document.scrollingElement}function Mn(t){const s={x:0,y:0},n=An(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},r={x:t.scrollWidth-n.width,y:t.scrollHeight-n.height},a=t.scrollTop<=s.y,o=t.scrollLeft<=s.x,l=t.scrollTop>=r.y,c=t.scrollLeft>=r.x;return{isTop:a,isLeft:o,isBottom:l,isRight:c,maxScroll:r,minScroll:s}}const Ja={x:.2,y:.2};function Qa(t,s,n,r,a){let{top:o,left:l,right:c,bottom:u}=n;r===void 0&&(r=10),a===void 0&&(a=Ja);const{isTop:m,isBottom:f,isLeft:d,isRight:p}=Mn(t),h={x:0,y:0},v={x:0,y:0},x={height:s.height*a.y,width:s.width*a.x};return!m&&o<=s.top+x.height?(h.y=Y.Backward,v.y=r*Math.abs((s.top+x.height-o)/x.height)):!f&&u>=s.bottom-x.height&&(h.y=Y.Forward,v.y=r*Math.abs((s.bottom-x.height-u)/x.height)),!p&&c>=s.right-x.width?(h.x=Y.Forward,v.x=r*Math.abs((s.right-x.width-c)/x.width)):!d&&l<=s.left+x.width&&(h.x=Y.Backward,v.x=r*Math.abs((s.left+x.width-l)/x.width)),{direction:h,speed:v}}function eo(t){if(t===document.scrollingElement){const{innerWidth:o,innerHeight:l}=window;return{top:0,left:0,right:o,bottom:l,width:o,height:l}}const{top:s,left:n,right:r,bottom:a}=t.getBoundingClientRect();return{top:s,left:n,right:r,bottom:a,width:t.clientWidth,height:t.clientHeight}}function Rn(t){return t.reduce((s,n)=>Ge(s,ts(n)),me)}function to(t){return t.reduce((s,n)=>s+En(n),0)}function so(t){return t.reduce((s,n)=>s+In(n),0)}function no(t,s){if(s===void 0&&(s=Ke),!t)return;const{top:n,left:r,bottom:a,right:o}=s(t);kn(t)&&(a<=0||o<=0||n>=window.innerHeight||r>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const ro=[["x",["left","right"],to],["y",["top","bottom"],so]];class fs{constructor(s,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=$t(n),a=Rn(r);this.rect={...s},this.width=s.width,this.height=s.height;for(const[o,l,c]of ro)for(const u of l)Object.defineProperty(this,u,{get:()=>{const m=c(r),f=a[o]-m;return this.rect[u]+f},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class at{constructor(s){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=s}add(s,n,r){var a;(a=this.target)==null||a.addEventListener(s,n,r),this.listeners.push([s,n,r])}}function ao(t){const{EventTarget:s}=ne(t);return t instanceof s?t:Xe(t)}function Kt(t,s){const n=Math.abs(t.x),r=Math.abs(t.y);return typeof s=="number"?Math.sqrt(n**2+r**2)>s:"x"in s&&"y"in s?n>s.x&&r>s.y:"x"in s?n>s.x:"y"in s?r>s.y:!1}var de;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(de||(de={}));function $s(t){t.preventDefault()}function oo(t){t.stopPropagation()}var M;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(M||(M={}));const Tn={start:[M.Space,M.Enter],cancel:[M.Esc],end:[M.Space,M.Enter,M.Tab]},io=(t,s)=>{let{currentCoordinates:n}=s;switch(t.code){case M.Right:return{...n,x:n.x+25};case M.Left:return{...n,x:n.x-25};case M.Down:return{...n,y:n.y+25};case M.Up:return{...n,y:n.y-25}}};class xs{constructor(s){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=s;const{event:{target:n}}=s;this.props=s,this.listeners=new at(Xe(n)),this.windowListeners=new at(ne(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(de.Resize,this.handleCancel),this.windowListeners.add(de.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(de.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:s,onStart:n}=this.props,r=s.node.current;r&&no(r),n(me)}handleKeyDown(s){if(hs(s)){const{active:n,context:r,options:a}=this.props,{keyboardCodes:o=Tn,coordinateGetter:l=io,scrollBehavior:c="smooth"}=a,{code:u}=s;if(o.end.includes(u)){this.handleEnd(s);return}if(o.cancel.includes(u)){this.handleCancel(s);return}const{collisionRect:m}=r.current,f=m?{x:m.left,y:m.top}:me;this.referenceCoordinates||(this.referenceCoordinates=f);const d=l(s,{active:n,context:r.current,currentCoordinates:f});if(d){const p=ht(d,f),h={x:0,y:0},{scrollableAncestors:v}=r.current;for(const x of v){const N=s.code,{isTop:b,isRight:g,isLeft:y,isBottom:w,maxScroll:C,minScroll:j}=Mn(x),S=eo(x),k={x:Math.min(N===M.Right?S.right-S.width/2:S.right,Math.max(N===M.Right?S.left:S.left+S.width/2,d.x)),y:Math.min(N===M.Down?S.bottom-S.height/2:S.bottom,Math.max(N===M.Down?S.top:S.top+S.height/2,d.y))},E=N===M.Right&&!g||N===M.Left&&!y,R=N===M.Down&&!w||N===M.Up&&!b;if(E&&k.x!==d.x){const I=x.scrollLeft+p.x,U=N===M.Right&&I<=C.x||N===M.Left&&I>=j.x;if(U&&!p.y){x.scrollTo({left:I,behavior:c});return}U?h.x=x.scrollLeft-I:h.x=N===M.Right?x.scrollLeft-C.x:x.scrollLeft-j.x,h.x&&x.scrollBy({left:-h.x,behavior:c});break}else if(R&&k.y!==d.y){const I=x.scrollTop+p.y,U=N===M.Down&&I<=C.y||N===M.Up&&I>=j.y;if(U&&!p.x){x.scrollTo({top:I,behavior:c});return}U?h.y=x.scrollTop-I:h.y=N===M.Down?x.scrollTop-C.y:x.scrollTop-j.y,h.y&&x.scrollBy({top:-h.y,behavior:c});break}}this.handleMove(s,Ge(ht(d,this.referenceCoordinates),h))}}}handleMove(s,n){const{onMove:r}=this.props;s.preventDefault(),r(n)}handleEnd(s){const{onEnd:n}=this.props;s.preventDefault(),this.detach(),n()}handleCancel(s){const{onCancel:n}=this.props;s.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}xs.activators=[{eventName:"onKeyDown",handler:(t,s,n)=>{let{keyboardCodes:r=Tn,onActivation:a}=s,{active:o}=n;const{code:l}=t.nativeEvent;if(r.start.includes(l)){const c=o.activatorNode.current;return c&&t.target!==c?!1:(t.preventDefault(),a==null||a({event:t.nativeEvent}),!0)}return!1}}];function Ws(t){return!!(t&&"distance"in t)}function Fs(t){return!!(t&&"delay"in t)}class ps{constructor(s,n,r){var a;r===void 0&&(r=ao(s.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=s,this.events=n;const{event:o}=s,{target:l}=o;this.props=s,this.events=n,this.document=Xe(l),this.documentListeners=new at(this.document),this.listeners=new at(r),this.windowListeners=new at(ne(l)),this.initialCoordinates=(a=es(o))!=null?a:me,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:s,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(s.move.name,this.handleMove,{passive:!1}),this.listeners.add(s.end.name,this.handleEnd),s.cancel&&this.listeners.add(s.cancel.name,this.handleCancel),this.windowListeners.add(de.Resize,this.handleCancel),this.windowListeners.add(de.DragStart,$s),this.windowListeners.add(de.VisibilityChange,this.handleCancel),this.windowListeners.add(de.ContextMenu,$s),this.documentListeners.add(de.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Fs(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Ws(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(s,n){const{active:r,onPending:a}=this.props;a(r,s,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:s}=this,{onStart:n}=this.props;s&&(this.activated=!0,this.documentListeners.add(de.Click,oo,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(de.SelectionChange,this.removeTextSelection),n(s))}handleMove(s){var n;const{activated:r,initialCoordinates:a,props:o}=this,{onMove:l,options:{activationConstraint:c}}=o;if(!a)return;const u=(n=es(s))!=null?n:me,m=ht(a,u);if(!r&&c){if(Ws(c)){if(c.tolerance!=null&&Kt(m,c.tolerance))return this.handleCancel();if(Kt(m,c.distance))return this.handleStart()}if(Fs(c)&&Kt(m,c.tolerance))return this.handleCancel();this.handlePending(c,m);return}s.cancelable&&s.preventDefault(),l(u)}handleEnd(){const{onAbort:s,onEnd:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleCancel(){const{onAbort:s,onCancel:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleKeydown(s){s.code===M.Esc&&this.handleCancel()}removeTextSelection(){var s;(s=this.document.getSelection())==null||s.removeAllRanges()}}const lo={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class gs extends ps{constructor(s){const{event:n}=s,r=Xe(n.target);super(s,lo,r)}}gs.activators=[{eventName:"onPointerDown",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:r}=s;return!n.isPrimary||n.button!==0?!1:(r==null||r({event:n}),!0)}}];const co={move:{name:"mousemove"},end:{name:"mouseup"}};var ss;(function(t){t[t.RightClick=2]="RightClick"})(ss||(ss={}));class uo extends ps{constructor(s){super(s,co,Xe(s.event.target))}}uo.activators=[{eventName:"onMouseDown",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:r}=s;return n.button===ss.RightClick?!1:(r==null||r({event:n}),!0)}}];const Zt={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class mo extends ps{constructor(s){super(s,Zt)}static setup(){return window.addEventListener(Zt.move.name,s,{capture:!1,passive:!1}),function(){window.removeEventListener(Zt.move.name,s)};function s(){}}}mo.activators=[{eventName:"onTouchStart",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:r}=s;const{touches:a}=n;return a.length>1?!1:(r==null||r({event:n}),!0)}}];var ot;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(ot||(ot={}));var Tt;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(Tt||(Tt={}));function ho(t){let{acceleration:s,activator:n=ot.Pointer,canScroll:r,draggingRect:a,enabled:o,interval:l=5,order:c=Tt.TreeOrder,pointerCoordinates:u,scrollableAncestors:m,scrollableAncestorRects:f,delta:d,threshold:p}=t;const h=xo({delta:d,disabled:!o}),[v,x]=Ca(),N=i.useRef({x:0,y:0}),b=i.useRef({x:0,y:0}),g=i.useMemo(()=>{switch(n){case ot.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case ot.DraggableRect:return a}},[n,a,u]),y=i.useRef(null),w=i.useCallback(()=>{const j=y.current;if(!j)return;const S=N.current.x*b.current.x,k=N.current.y*b.current.y;j.scrollBy(S,k)},[]),C=i.useMemo(()=>c===Tt.TreeOrder?[...m].reverse():m,[c,m]);i.useEffect(()=>{if(!o||!m.length||!g){x();return}for(const j of C){if((r==null?void 0:r(j))===!1)continue;const S=m.indexOf(j),k=f[S];if(!k)continue;const{direction:E,speed:R}=Qa(j,k,g,s,p);for(const I of["x","y"])h[I][E[I]]||(R[I]=0,E[I]=0);if(R.x>0||R.y>0){x(),y.current=j,v(w,l),N.current=R,b.current=E;return}}N.current={x:0,y:0},b.current={x:0,y:0},x()},[s,w,r,x,o,l,JSON.stringify(g),JSON.stringify(h),v,m,C,f,JSON.stringify(p)])}const fo={x:{[Y.Backward]:!1,[Y.Forward]:!1},y:{[Y.Backward]:!1,[Y.Forward]:!1}};function xo(t){let{delta:s,disabled:n}=t;const r=Qt(s);return vt(a=>{if(n||!r||!a)return fo;const o={x:Math.sign(s.x-r.x),y:Math.sign(s.y-r.y)};return{x:{[Y.Backward]:a.x[Y.Backward]||o.x===-1,[Y.Forward]:a.x[Y.Forward]||o.x===1},y:{[Y.Backward]:a.y[Y.Backward]||o.y===-1,[Y.Forward]:a.y[Y.Forward]||o.y===1}}},[n,s,r])}function po(t,s){const n=s!=null?t.get(s):void 0,r=n?n.node.current:null;return vt(a=>{var o;return s==null?null:(o=r??a)!=null?o:null},[r,s])}function go(t,s){return i.useMemo(()=>t.reduce((n,r)=>{const{sensor:a}=r,o=a.activators.map(l=>({eventName:l.eventName,handler:s(l.handler,r)}));return[...n,...o]},[]),[t,s])}var xt;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(xt||(xt={}));var ns;(function(t){t.Optimized="optimized"})(ns||(ns={}));const Vs=new Map;function vo(t,s){let{dragging:n,dependencies:r,config:a}=s;const[o,l]=i.useState(null),{frequency:c,measure:u,strategy:m}=a,f=i.useRef(t),d=N(),p=mt(d),h=i.useCallback(function(b){b===void 0&&(b=[]),!p.current&&l(g=>g===null?b:g.concat(b.filter(y=>!g.includes(y))))},[p]),v=i.useRef(null),x=vt(b=>{if(d&&!n)return Vs;if(!b||b===Vs||f.current!==t||o!=null){const g=new Map;for(let y of t){if(!y)continue;if(o&&o.length>0&&!o.includes(y.id)&&y.rect.current){g.set(y.id,y.rect.current);continue}const w=y.node.current,C=w?new fs(u(w),w):null;y.rect.current=C,C&&g.set(y.id,C)}return g}return b},[t,o,n,d,u]);return i.useEffect(()=>{f.current=t},[t]),i.useEffect(()=>{d||h()},[n,d]),i.useEffect(()=>{o&&o.length>0&&l(null)},[JSON.stringify(o)]),i.useEffect(()=>{d||typeof c!="number"||v.current!==null||(v.current=setTimeout(()=>{h(),v.current=null},c))},[c,d,h,...r]),{droppableRects:x,measureDroppableContainers:h,measuringScheduled:o!=null};function N(){switch(m){case xt.Always:return!1;case xt.BeforeDragging:return n;default:return!n}}}function zn(t,s){return vt(n=>t?n||(typeof s=="function"?s(t):t):null,[s,t])}function bo(t,s){return zn(t,s)}function yo(t){let{callback:s,disabled:n}=t;const r=ms(s),a=i.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(r)},[r,n]);return i.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function Wt(t){let{callback:s,disabled:n}=t;const r=ms(s),a=i.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(r)},[n]);return i.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function jo(t){return new fs(Ke(t),t)}function _s(t,s,n){s===void 0&&(s=jo);const[r,a]=i.useState(null);function o(){a(u=>{if(!t)return null;if(t.isConnected===!1){var m;return(m=u??n)!=null?m:null}const f=s(t);return JSON.stringify(u)===JSON.stringify(f)?u:f})}const l=yo({callback(u){if(t)for(const m of u){const{type:f,target:d}=m;if(f==="childList"&&d instanceof HTMLElement&&d.contains(t)){o();break}}}}),c=Wt({callback:o});return ge(()=>{o(),t?(c==null||c.observe(t),l==null||l.observe(document.body,{childList:!0,subtree:!0})):(c==null||c.disconnect(),l==null||l.disconnect())},[t]),r}function wo(t){const s=zn(t);return Dn(t,s)}const Hs=[];function No(t){const s=i.useRef(t),n=vt(r=>t?r&&r!==Hs&&t&&s.current&&t.parentNode===s.current.parentNode?r:$t(t):Hs,[t]);return i.useEffect(()=>{s.current=t},[t]),n}function Co(t){const[s,n]=i.useState(null),r=i.useRef(t),a=i.useCallback(o=>{const l=Xt(o.target);l&&n(c=>c?(c.set(l,ts(l)),new Map(c)):null)},[]);return i.useEffect(()=>{const o=r.current;if(t!==o){l(o);const c=t.map(u=>{const m=Xt(u);return m?(m.addEventListener("scroll",a,{passive:!0}),[m,ts(m)]):null}).filter(u=>u!=null);n(c.length?new Map(c):null),r.current=t}return()=>{l(t),l(o)};function l(c){c.forEach(u=>{const m=Xt(u);m==null||m.removeEventListener("scroll",a)})}},[a,t]),i.useMemo(()=>t.length?s?Array.from(s.values()).reduce((o,l)=>Ge(o,l),me):Rn(t):me,[t,s])}function Gs(t,s){s===void 0&&(s=[]);const n=i.useRef(null);return i.useEffect(()=>{n.current=null},s),i.useEffect(()=>{const r=t!==me;r&&!n.current&&(n.current=t),!r&&n.current&&(n.current=null)},[t]),n.current?ht(t,n.current):me}function So(t){i.useEffect(()=>{if(!Ut)return;const s=t.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of s)n==null||n()}},t.map(s=>{let{sensor:n}=s;return n}))}function Do(t,s){return i.useMemo(()=>t.reduce((n,r)=>{let{eventName:a,handler:o}=r;return n[a]=l=>{o(l,s)},n},{}),[t,s])}function Pn(t){return i.useMemo(()=>t?Xa(t):null,[t])}const qs=[];function ko(t,s){s===void 0&&(s=Ke);const[n]=t,r=Pn(n?ne(n):null),[a,o]=i.useState(qs);function l(){o(()=>t.length?t.map(u=>An(u)?r:new fs(s(u),u)):qs)}const c=Wt({callback:l});return ge(()=>{c==null||c.disconnect(),l(),t.forEach(u=>c==null?void 0:c.observe(u))},[t]),a}function Eo(t){if(!t)return null;if(t.children.length>1)return t;const s=t.children[0];return gt(s)?s:t}function Io(t){let{measure:s}=t;const[n,r]=i.useState(null),a=i.useCallback(m=>{for(const{target:f}of m)if(gt(f)){r(d=>{const p=s(f);return d?{...d,width:p.width,height:p.height}:p});break}},[s]),o=Wt({callback:a}),l=i.useCallback(m=>{const f=Eo(m);o==null||o.disconnect(),f&&(o==null||o.observe(f)),r(f?s(f):null)},[s,o]),[c,u]=Mt(l);return i.useMemo(()=>({nodeRef:c,rect:n,setRef:u}),[n,c,u])}const Ao=[{sensor:gs,options:{}},{sensor:xs,options:{}}],Mo={current:{}},Dt={draggable:{measure:Us},droppable:{measure:Us,strategy:xt.WhileDragging,frequency:ns.Optimized},dragOverlay:{measure:Ke}};class it extends Map{get(s){var n;return s!=null&&(n=super.get(s))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(s=>{let{disabled:n}=s;return!n})}getNodeFor(s){var n,r;return(n=(r=this.get(s))==null?void 0:r.node.current)!=null?n:void 0}}const Ro={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new it,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Rt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Dt,measureDroppableContainers:Rt,windowRect:null,measuringScheduled:!1},To={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Rt,draggableNodes:new Map,over:null,measureDroppableContainers:Rt},Ft=i.createContext(To),On=i.createContext(Ro);function zo(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new it}}}function Po(t,s){switch(s.type){case V.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:s.initialCoordinates,active:s.active}};case V.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:s.coordinates.x-t.draggable.initialCoordinates.x,y:s.coordinates.y-t.draggable.initialCoordinates.y}}};case V.DragEnd:case V.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case V.RegisterDroppable:{const{element:n}=s,{id:r}=n,a=new it(t.droppable.containers);return a.set(r,n),{...t,droppable:{...t.droppable,containers:a}}}case V.SetDroppableDisabled:{const{id:n,key:r,disabled:a}=s,o=t.droppable.containers.get(n);if(!o||r!==o.key)return t;const l=new it(t.droppable.containers);return l.set(n,{...o,disabled:a}),{...t,droppable:{...t.droppable,containers:l}}}case V.UnregisterDroppable:{const{id:n,key:r}=s,a=t.droppable.containers.get(n);if(!a||r!==a.key)return t;const o=new it(t.droppable.containers);return o.delete(n),{...t,droppable:{...t.droppable,containers:o}}}default:return t}}function Oo(t){let{disabled:s}=t;const{active:n,activatorEvent:r,draggableNodes:a}=i.useContext(Ft),o=Qt(r),l=Qt(n==null?void 0:n.id);return i.useEffect(()=>{if(!s&&!r&&o&&l!=null){if(!hs(o)||document.activeElement===o.target)return;const c=a.get(l);if(!c)return;const{activatorNode:u,node:m}=c;if(!u.current&&!m.current)return;requestAnimationFrame(()=>{for(const f of[u.current,m.current]){if(!f)continue;const d=ka(f);if(d){d.focus();break}}})}},[r,s,a,l,o]),null}function Lo(t,s){let{transform:n,...r}=s;return t!=null&&t.length?t.reduce((a,o)=>o({transform:a,...r}),n):n}function Bo(t){return i.useMemo(()=>({draggable:{...Dt.draggable,...t==null?void 0:t.draggable},droppable:{...Dt.droppable,...t==null?void 0:t.droppable},dragOverlay:{...Dt.dragOverlay,...t==null?void 0:t.dragOverlay}}),[t==null?void 0:t.draggable,t==null?void 0:t.droppable,t==null?void 0:t.dragOverlay])}function Uo(t){let{activeNode:s,measure:n,initialRect:r,config:a=!0}=t;const o=i.useRef(!1),{x:l,y:c}=typeof a=="boolean"?{x:a,y:a}:a;ge(()=>{if(!l&&!c||!s){o.current=!1;return}if(o.current||!r)return;const m=s==null?void 0:s.node.current;if(!m||m.isConnected===!1)return;const f=n(m),d=Dn(f,r);if(l||(d.x=0),c||(d.y=0),o.current=!0,Math.abs(d.x)>0||Math.abs(d.y)>0){const p=kn(m);p&&p.scrollBy({top:d.y,left:d.x})}},[s,l,c,r,n])}const Ln=i.createContext({...me,scaleX:1,scaleY:1});var Re;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(Re||(Re={}));const $o=i.memo(function(s){var n,r,a,o;let{id:l,accessibility:c,autoScroll:u=!0,children:m,sensors:f=Ao,collisionDetection:d=Fa,measuring:p,modifiers:h,...v}=s;const x=i.useReducer(Po,void 0,zo),[N,b]=x,[g,y]=Ta(),[w,C]=i.useState(Re.Uninitialized),j=w===Re.Initialized,{draggable:{active:S,nodes:k,translate:E},droppable:{containers:R}}=N,I=S!=null?k.get(S):null,U=i.useRef({initial:null,translated:null}),P=i.useMemo(()=>{var Q;return S!=null?{id:S,data:(Q=I==null?void 0:I.data)!=null?Q:Mo,rect:U}:null},[S,I]),D=i.useRef(null),[X,he]=i.useState(null),[q,Be]=i.useState(null),ue=mt(v,Object.values(v)),T=bt("DndDescribedBy",l),K=i.useMemo(()=>R.getEnabled(),[R]),W=Bo(p),{droppableRects:be,measureDroppableContainers:Pe,measuringScheduled:Ze}=vo(K,{dragging:j,dependencies:[E.x,E.y],config:W.droppable}),le=po(k,S),yt=i.useMemo(()=>q?es(q):null,[q]),De=Zn(),ye=bo(le,W.draggable.measure);Uo({activeNode:S!=null?k.get(S):null,config:De.layoutShiftCompensation,initialRect:ye,measure:W.draggable.measure});const z=_s(le,W.draggable.measure,ye),Je=_s(le?le.parentElement:null),fe=i.useRef({activatorEvent:null,active:null,activeNode:le,collisionRect:null,collisions:null,droppableRects:be,draggableNodes:k,draggingNode:null,draggingNodeRect:null,droppableContainers:R,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Ue=R.getNodeFor((n=fe.current.over)==null?void 0:n.id),je=Io({measure:W.dragOverlay.measure}),$e=(r=je.nodeRef.current)!=null?r:le,We=j?(a=je.rect)!=null?a:z:null,ys=!!(je.nodeRef.current&&je.rect),js=wo(ys?null:z),Vt=Pn($e?ne($e):null),ke=No(j?Ue??le:null),jt=ko(ke),wt=Lo(h,{transform:{x:E.x-js.x,y:E.y-js.y,scaleX:1,scaleY:1},activatorEvent:q,active:P,activeNodeRect:z,containerNodeRect:Je,draggingNodeRect:We,over:fe.current.over,overlayNodeRect:je.rect,scrollableAncestors:ke,scrollableAncestorRects:jt,windowRect:Vt}),ws=yt?Ge(yt,E):null,Ns=Co(ke),_n=Gs(Ns),Hn=Gs(Ns,[z]),Fe=Ge(wt,_n),Ve=We?Ha(We,wt):null,Qe=P&&Ve?d({active:P,collisionRect:Ve,droppableRects:be,droppableContainers:K,pointerCoordinates:ws}):null,Cs=Sn(Qe,"id"),[Ee,Ss]=i.useState(null),Gn=ys?wt:Ge(wt,Hn),qn=Va(Gn,(o=Ee==null?void 0:Ee.rect)!=null?o:null,z),_t=i.useRef(null),Ds=i.useCallback((Q,re)=>{let{sensor:ae,options:Ie}=re;if(D.current==null)return;const ce=k.get(D.current);if(!ce)return;const oe=Q.nativeEvent,xe=new ae({active:D.current,activeNode:ce,event:oe,options:Ie,context:fe,onAbort(Z){if(!k.get(Z))return;const{onDragAbort:pe}=ue.current,we={id:Z};pe==null||pe(we),g({type:"onDragAbort",event:we})},onPending(Z,Ae,pe,we){if(!k.get(Z))return;const{onDragPending:tt}=ue.current,Me={id:Z,constraint:Ae,initialCoordinates:pe,offset:we};tt==null||tt(Me),g({type:"onDragPending",event:Me})},onStart(Z){const Ae=D.current;if(Ae==null)return;const pe=k.get(Ae);if(!pe)return;const{onDragStart:we}=ue.current,et={activatorEvent:oe,active:{id:Ae,data:pe.data,rect:U}};rt.unstable_batchedUpdates(()=>{we==null||we(et),C(Re.Initializing),b({type:V.DragStart,initialCoordinates:Z,active:Ae}),g({type:"onDragStart",event:et}),he(_t.current),Be(oe)})},onMove(Z){b({type:V.DragMove,coordinates:Z})},onEnd:_e(V.DragEnd),onCancel:_e(V.DragCancel)});_t.current=xe;function _e(Z){return async function(){const{active:pe,collisions:we,over:et,scrollAdjustedTranslate:tt}=fe.current;let Me=null;if(pe&&tt){const{cancelDrop:st}=ue.current;Me={activatorEvent:oe,active:pe,collisions:we,delta:tt,over:et},Z===V.DragEnd&&typeof st=="function"&&await Promise.resolve(st(Me))&&(Z=V.DragCancel)}D.current=null,rt.unstable_batchedUpdates(()=>{b({type:Z}),C(Re.Uninitialized),Ss(null),he(null),Be(null),_t.current=null;const st=Z===V.DragEnd?"onDragEnd":"onDragCancel";if(Me){const Ht=ue.current[st];Ht==null||Ht(Me),g({type:st,event:Me})}})}}},[k]),Yn=i.useCallback((Q,re)=>(ae,Ie)=>{const ce=ae.nativeEvent,oe=k.get(Ie);if(D.current!==null||!oe||ce.dndKit||ce.defaultPrevented)return;const xe={active:oe};Q(ae,re.options,xe)===!0&&(ce.dndKit={capturedBy:re.sensor},D.current=Ie,Ds(ae,re))},[k,Ds]),ks=go(f,Yn);So(f),ge(()=>{z&&w===Re.Initializing&&C(Re.Initialized)},[z,w]),i.useEffect(()=>{const{onDragMove:Q}=ue.current,{active:re,activatorEvent:ae,collisions:Ie,over:ce}=fe.current;if(!re||!ae)return;const oe={active:re,activatorEvent:ae,collisions:Ie,delta:{x:Fe.x,y:Fe.y},over:ce};rt.unstable_batchedUpdates(()=>{Q==null||Q(oe),g({type:"onDragMove",event:oe})})},[Fe.x,Fe.y]),i.useEffect(()=>{const{active:Q,activatorEvent:re,collisions:ae,droppableContainers:Ie,scrollAdjustedTranslate:ce}=fe.current;if(!Q||D.current==null||!re||!ce)return;const{onDragOver:oe}=ue.current,xe=Ie.get(Cs),_e=xe&&xe.rect.current?{id:xe.id,rect:xe.rect.current,data:xe.data,disabled:xe.disabled}:null,Z={active:Q,activatorEvent:re,collisions:ae,delta:{x:ce.x,y:ce.y},over:_e};rt.unstable_batchedUpdates(()=>{Ss(_e),oe==null||oe(Z),g({type:"onDragOver",event:Z})})},[Cs]),ge(()=>{fe.current={activatorEvent:q,active:P,activeNode:le,collisionRect:Ve,collisions:Qe,droppableRects:be,draggableNodes:k,draggingNode:$e,draggingNodeRect:We,droppableContainers:R,over:Ee,scrollableAncestors:ke,scrollAdjustedTranslate:Fe},U.current={initial:We,translated:Ve}},[P,le,Qe,Ve,k,$e,We,be,R,Ee,ke,Fe]),ho({...De,delta:E,draggingRect:Ve,pointerCoordinates:ws,scrollableAncestors:ke,scrollableAncestorRects:jt});const Xn=i.useMemo(()=>({active:P,activeNode:le,activeNodeRect:z,activatorEvent:q,collisions:Qe,containerNodeRect:Je,dragOverlay:je,draggableNodes:k,droppableContainers:R,droppableRects:be,over:Ee,measureDroppableContainers:Pe,scrollableAncestors:ke,scrollableAncestorRects:jt,measuringConfiguration:W,measuringScheduled:Ze,windowRect:Vt}),[P,le,z,q,Qe,Je,je,k,R,be,Ee,Pe,ke,jt,W,Ze,Vt]),Kn=i.useMemo(()=>({activatorEvent:q,activators:ks,active:P,activeNodeRect:z,ariaDescribedById:{draggable:T},dispatch:b,draggableNodes:k,over:Ee,measureDroppableContainers:Pe}),[q,ks,P,z,b,T,k,Ee,Pe]);return J.createElement(wn.Provider,{value:y},J.createElement(Ft.Provider,{value:Kn},J.createElement(On.Provider,{value:Xn},J.createElement(Ln.Provider,{value:qn},m)),J.createElement(Oo,{disabled:(c==null?void 0:c.restoreFocus)===!1})),J.createElement(Oa,{...c,hiddenTextDescribedById:T}));function Zn(){const Q=(X==null?void 0:X.autoScrollEnabled)===!1,re=typeof u=="object"?u.enabled===!1:u===!1,ae=j&&!Q&&!re;return typeof u=="object"?{...u,enabled:ae}:{enabled:ae}}}),Wo=i.createContext(null),Ys="button",Fo="Draggable";function Vo(t){let{id:s,data:n,disabled:r=!1,attributes:a}=t;const o=bt(Fo),{activators:l,activatorEvent:c,active:u,activeNodeRect:m,ariaDescribedById:f,draggableNodes:d,over:p}=i.useContext(Ft),{role:h=Ys,roleDescription:v="draggable",tabIndex:x=0}=a??{},N=(u==null?void 0:u.id)===s,b=i.useContext(N?Ln:Wo),[g,y]=Mt(),[w,C]=Mt(),j=Do(l,s),S=mt(n);ge(()=>(d.set(s,{id:s,key:o,node:g,activatorNode:w,data:S}),()=>{const E=d.get(s);E&&E.key===o&&d.delete(s)}),[d,s]);const k=i.useMemo(()=>({role:h,tabIndex:x,"aria-disabled":r,"aria-pressed":N&&h===Ys?!0:void 0,"aria-roledescription":v,"aria-describedby":f.draggable}),[r,h,x,N,v,f.draggable]);return{active:u,activatorEvent:c,activeNodeRect:m,attributes:k,isDragging:N,listeners:r?void 0:j,node:g,over:p,setNodeRef:y,setActivatorNodeRef:C,transform:b}}function _o(){return i.useContext(On)}const Ho="Droppable",Go={timeout:25};function qo(t){let{data:s,disabled:n=!1,id:r,resizeObserverConfig:a}=t;const o=bt(Ho),{active:l,dispatch:c,over:u,measureDroppableContainers:m}=i.useContext(Ft),f=i.useRef({disabled:n}),d=i.useRef(!1),p=i.useRef(null),h=i.useRef(null),{disabled:v,updateMeasurementsFor:x,timeout:N}={...Go,...a},b=mt(x??r),g=i.useCallback(()=>{if(!d.current){d.current=!0;return}h.current!=null&&clearTimeout(h.current),h.current=setTimeout(()=>{m(Array.isArray(b.current)?b.current:[b.current]),h.current=null},N)},[N]),y=Wt({callback:g,disabled:v||!l}),w=i.useCallback((k,E)=>{y&&(E&&(y.unobserve(E),d.current=!1),k&&y.observe(k))},[y]),[C,j]=Mt(w),S=mt(s);return i.useEffect(()=>{!y||!C.current||(y.disconnect(),d.current=!1,y.observe(C.current))},[C,y]),i.useEffect(()=>(c({type:V.RegisterDroppable,element:{id:r,key:o,disabled:n,node:C,rect:p,data:S}}),()=>c({type:V.UnregisterDroppable,key:o,id:r})),[r]),i.useEffect(()=>{n!==f.current.disabled&&(c({type:V.SetDroppableDisabled,id:r,key:o,disabled:n}),f.current.disabled=n)},[r,o,n,c]),{active:l,rect:p,isOver:(u==null?void 0:u.id)===r,node:C,over:u,setNodeRef:j}}function vs(t,s,n){const r=t.slice();return r.splice(n<0?r.length+n:n,0,r.splice(s,1)[0]),r}function Yo(t,s){return t.reduce((n,r,a)=>{const o=s.get(r);return o&&(n[a]=o),n},Array(t.length))}function Ct(t){return t!==null&&t>=0}function Xo(t,s){if(t===s)return!0;if(t.length!==s.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==s[n])return!1;return!0}function Ko(t){return typeof t=="boolean"?{draggable:t,droppable:t}:t}const bs=t=>{let{rects:s,activeIndex:n,overIndex:r,index:a}=t;const o=vs(s,r,n),l=s[a],c=o[a];return!c||!l?null:{x:c.left-l.left,y:c.top-l.top,scaleX:c.width/l.width,scaleY:c.height/l.height}},Bn="Sortable",Un=J.createContext({activeIndex:-1,containerId:Bn,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:bs,disabled:{draggable:!1,droppable:!1}});function Zo(t){let{children:s,id:n,items:r,strategy:a=bs,disabled:o=!1}=t;const{active:l,dragOverlay:c,droppableRects:u,over:m,measureDroppableContainers:f}=_o(),d=bt(Bn,n),p=c.rect!==null,h=i.useMemo(()=>r.map(j=>typeof j=="object"&&"id"in j?j.id:j),[r]),v=l!=null,x=l?h.indexOf(l.id):-1,N=m?h.indexOf(m.id):-1,b=i.useRef(h),g=!Xo(h,b.current),y=N!==-1&&x===-1||g,w=Ko(o);ge(()=>{g&&v&&f(h)},[g,h,v,f]),i.useEffect(()=>{b.current=h},[h]);const C=i.useMemo(()=>({activeIndex:x,containerId:d,disabled:w,disableTransforms:y,items:h,overIndex:N,useDragOverlay:p,sortedRects:Yo(h,u),strategy:a}),[x,d,w.draggable,w.droppable,y,h,N,u,p,a]);return J.createElement(Un.Provider,{value:C},s)}const Jo=t=>{let{id:s,items:n,activeIndex:r,overIndex:a}=t;return vs(n,r,a).indexOf(s)},Qo=t=>{let{containerId:s,isSorting:n,wasDragging:r,index:a,items:o,newIndex:l,previousItems:c,previousContainerId:u,transition:m}=t;return!m||!r||c!==o&&a===l?!1:n?!0:l!==a&&s===u},ei={duration:200,easing:"ease"},$n="transform",ti=ft.Transition.toString({property:$n,duration:0,easing:"linear"}),si={roleDescription:"sortable"};function ni(t){let{disabled:s,index:n,node:r,rect:a}=t;const[o,l]=i.useState(null),c=i.useRef(n);return ge(()=>{if(!s&&n!==c.current&&r.current){const u=a.current;if(u){const m=Ke(r.current,{ignoreTransform:!0}),f={x:u.left-m.left,y:u.top-m.top,scaleX:u.width/m.width,scaleY:u.height/m.height};(f.x||f.y)&&l(f)}}n!==c.current&&(c.current=n)},[s,n,r,a]),i.useEffect(()=>{o&&l(null)},[o]),o}function ri(t){let{animateLayoutChanges:s=Qo,attributes:n,disabled:r,data:a,getNewIndex:o=Jo,id:l,strategy:c,resizeObserverConfig:u,transition:m=ei}=t;const{items:f,containerId:d,activeIndex:p,disabled:h,disableTransforms:v,sortedRects:x,overIndex:N,useDragOverlay:b,strategy:g}=i.useContext(Un),y=ai(r,h),w=f.indexOf(l),C=i.useMemo(()=>({sortable:{containerId:d,index:w,items:f},...a}),[d,a,w,f]),j=i.useMemo(()=>f.slice(f.indexOf(l)),[f,l]),{rect:S,node:k,isOver:E,setNodeRef:R}=qo({id:l,data:C,disabled:y.droppable,resizeObserverConfig:{updateMeasurementsFor:j,...u}}),{active:I,activatorEvent:U,activeNodeRect:P,attributes:D,setNodeRef:X,listeners:he,isDragging:q,over:Be,setActivatorNodeRef:ue,transform:T}=Vo({id:l,data:C,attributes:{...si,...n},disabled:y.draggable}),K=Na(R,X),W=!!I,be=W&&!v&&Ct(p)&&Ct(N),Pe=!b&&q,Ze=Pe&&be?T:null,yt=be?Ze??(c??g)({rects:x,activeNodeRect:P,activeIndex:p,overIndex:N,index:w}):null,De=Ct(p)&&Ct(N)?o({id:l,items:f,activeIndex:p,overIndex:N}):w,ye=I==null?void 0:I.id,z=i.useRef({activeId:ye,items:f,newIndex:De,containerId:d}),Je=f!==z.current.items,fe=s({active:I,containerId:d,isDragging:q,isSorting:W,id:l,index:w,items:f,newIndex:z.current.newIndex,previousItems:z.current.items,previousContainerId:z.current.containerId,transition:m,wasDragging:z.current.activeId!=null}),Ue=ni({disabled:!fe,index:w,node:k,rect:S});return i.useEffect(()=>{W&&z.current.newIndex!==De&&(z.current.newIndex=De),d!==z.current.containerId&&(z.current.containerId=d),f!==z.current.items&&(z.current.items=f)},[W,De,d,f]),i.useEffect(()=>{if(ye===z.current.activeId)return;if(ye!=null&&z.current.activeId==null){z.current.activeId=ye;return}const $e=setTimeout(()=>{z.current.activeId=ye},50);return()=>clearTimeout($e)},[ye]),{active:I,activeIndex:p,attributes:D,data:C,rect:S,index:w,newIndex:De,items:f,isOver:E,isSorting:W,isDragging:q,listeners:he,node:k,overIndex:N,over:Be,setNodeRef:K,setActivatorNodeRef:ue,setDroppableNodeRef:R,setDraggableNodeRef:X,transform:Ue??yt,transition:je()};function je(){if(Ue||Je&&z.current.newIndex===w)return ti;if(!(Pe&&!hs(U)||!m)&&(W||fe))return ft.Transition.toString({...m,property:$n})}}function ai(t,s){var n,r;return typeof t=="boolean"?{draggable:t,droppable:!1}:{draggable:(n=t==null?void 0:t.draggable)!=null?n:s.draggable,droppable:(r=t==null?void 0:t.droppable)!=null?r:s.droppable}}function zt(t){if(!t)return!1;const s=t.data.current;return!!(s&&"sortable"in s&&typeof s.sortable=="object"&&"containerId"in s.sortable&&"items"in s.sortable&&"index"in s.sortable)}const oi=[M.Down,M.Right,M.Up,M.Left],ii=(t,s)=>{let{context:{active:n,collisionRect:r,droppableRects:a,droppableContainers:o,over:l,scrollableAncestors:c}}=s;if(oi.includes(t.code)){if(t.preventDefault(),!n||!r)return;const u=[];o.getEnabled().forEach(d=>{if(!d||d!=null&&d.disabled)return;const p=a.get(d.id);if(p)switch(t.code){case M.Down:r.top<p.top&&u.push(d);break;case M.Up:r.top>p.top&&u.push(d);break;case M.Left:r.left>p.left&&u.push(d);break;case M.Right:r.left<p.left&&u.push(d);break}});const m=$a({active:n,collisionRect:r,droppableRects:a,droppableContainers:u,pointerCoordinates:null});let f=Sn(m,"id");if(f===(l==null?void 0:l.id)&&m.length>1&&(f=m[1].id),f!=null){const d=o.get(n.id),p=o.get(f),h=p?a.get(p.id):null,v=p==null?void 0:p.node.current;if(v&&h&&d&&p){const N=$t(v).some((j,S)=>c[S]!==j),b=Wn(d,p),g=li(d,p),y=N||!b?{x:0,y:0}:{x:g?r.width-h.width:0,y:g?r.height-h.height:0},w={x:h.left,y:h.top};return y.x&&y.y?w:ht(w,y)}}}};function Wn(t,s){return!zt(t)||!zt(s)?!1:t.data.current.sortable.containerId===s.data.current.sortable.containerId}function li(t,s){return!zt(t)||!zt(s)||!Wn(t,s)?!1:t.data.current.sortable.index<s.data.current.sortable.index}const St=[{id:"smart-analyst",type:"smart-analyst",title:"Analista Inteligente",description:"Anlisis automtico de inventario",icon:la,visible:!0,order:0,size:"small",span:2,row:"top"},{id:"metrics-carousel",type:"metrics-carousel",title:"Mtricas Financieras",description:"Diferencia neta, negativos y positivos",icon:ct,visible:!0,order:1,size:"small",span:1,row:"top",mandatory:!0},{id:"active-products",type:"active-products",title:"Productos Activos",description:"Total de productos en inventarios",icon:ls,visible:!0,order:2,size:"small",span:1,row:"top"},{id:"inventory-summary",type:"inventory-summary",title:"Resumen de Inventario",description:"Progreso de productos en stock",icon:Pt,visible:!1,order:10,size:"large",span:1,row:"middle"},{id:"inventory-alerts",type:"inventory-alerts",title:"Alertas de Inventario",description:"Notificaciones importantes",icon:pt,visible:!0,order:6,size:"large",span:1,row:"middle"},{id:"upcoming-inventories",type:"upcoming-inventories",title:"Prximos Inventarios",description:"Inventarios programados",icon:vn,visible:!0,order:5,size:"large",span:1,row:"middle"},{id:"branches-table",type:"branches-table",title:"Tabla de Sucursales",description:"Listado completo de sucursales",icon:ca,visible:!0,order:7,size:"full",span:1,row:"bottom"},{id:"inventory-progress",type:"inventory-progress",title:"Progreso de Inventarios",description:"Porcentaje de inventarios completados",icon:Le,visible:!1,order:6,size:"small",span:1,row:"top"},{id:"critical-products",type:"critical-products",title:"Productos Crticos",description:"Productos con stock bajo o agotados",icon:rs,visible:!1,order:7,size:"small",span:1,row:"top"},{id:"total-stock-value",type:"total-stock-value",title:"Valor Total de Stock",description:"Valor monetario total del inventario",icon:ct,visible:!1,order:8,size:"small",span:1,row:"top"},{id:"active-users",type:"active-users",title:"Usuarios Activos",description:"Usuarios trabajando en tiempo real",icon:un,visible:!1,order:9,size:"small",span:1,row:"top"},{id:"pending-inventories",type:"pending-inventories",title:"Inventarios Pendientes",description:"Inventarios sin completar",icon:qe,visible:!1,order:10,size:"small",span:1,row:"top"},{id:"trends-chart",type:"trends-chart",title:"Grfico de Tendencias",description:"Evolucin de diferencias en el tiempo",icon:da,visible:!0,order:11,size:"large",span:1,row:"middle"},{id:"top-products",type:"top-products",title:"Top Productos con Diferencias",description:"Productos con mayores discrepancias",icon:wa,visible:!1,order:12,size:"large",span:1,row:"middle"},{id:"activity-timeline",type:"activity-timeline",title:"Actividad Reciente",description:"Timeline de ltimas acciones",icon:br,visible:!1,order:13,size:"large",span:1,row:"middle"},{id:"category-distribution",type:"category-distribution",title:"Distribucin por Categora",description:"Porcentaje de productos por categora",icon:Ts,visible:!1,order:14,size:"large",span:1,row:"middle"},{id:"monthly-goals",type:"monthly-goals",title:"Objetivos del Mes",description:"Progreso hacia metas mensuales",icon:mn,visible:!1,order:15,size:"large",span:1,row:"middle"},{id:"sync-status",type:"sync-status",title:"Estado de Sincronizacin",description:"Conexin y datos pendientes",icon:hn,visible:!1,order:16,size:"large",span:1,row:"middle"},{id:"quick-actions",type:"quick-actions",title:"Acciones Rpidas",description:"Tareas frecuentes",icon:cs,visible:!1,order:17,size:"large",span:1,row:"middle"},{id:"countdown",type:"countdown",title:"Contador de Das",description:"Das restantes para finalizar conteo cclico",icon:ut,visible:!0,order:3,size:"small",span:1,row:"top"},{id:"category-progress",type:"category-progress",title:"Progreso por Rubros",description:"Avance de inventario por categora",icon:Ts,visible:!0,order:4,size:"large",span:1,row:"middle"}];function ci(t){const s=`dashboard - layout - v5 - ${t||"default"} `,[n,r]=i.useState(()=>{try{const v=localStorage.getItem(s);if(v){const x=JSON.parse(v);return St.map(b=>{const g=x.widgets.find(y=>y.id===b.id);return g?{...b,visible:g.visible,order:g.order,...b.mandatory?{visible:!0}:{}}:b}).sort((b,g)=>b.order-g.order)}}catch(v){console.error("Error loading dashboard layout:",v)}return St}),[a,o]=i.useState(!1);i.useEffect(()=>{const x={widgets:n.map(({id:N,visible:b,order:g})=>({id:N,visible:b,order:g})),lastUpdated:Date.now()};localStorage.setItem(s,JSON.stringify(x))},[n,s]);const l=(v,x)=>{r(N=>{const b=N.findIndex(w=>w.id===v),g=N.findIndex(w=>w.id===x);return vs(N,b,g).map((w,C)=>({...w,order:C}))})},c=v=>{r(x=>x.map(N=>N.id===v&&!N.mandatory?{...N,visible:!N.visible}:N))},u=()=>{r(St),o(!1)},m=(v,x)=>{r(N=>N.map(b=>b.id===v?{...b,size:x}:b))},f=(v,x)=>{r(N=>N.map(b=>b.id===v?{...b,span:x}:b))},d=v=>{r(x=>x.map(N=>({...N,visible:N.mandatory||v.includes(N.id)})))};i.useEffect(()=>{n.every(x=>x.title&&x.icon)||(console.warn("Detected corrupted widget state, resetting to defaults"),r(St))},[n]);const p=n.filter(v=>v.visible).sort((v,x)=>v.order-x.order),h=n.filter(v=>!v.visible).sort((v,x)=>(v.title||"").localeCompare(x.title||""));return{widgets:n,visibleWidgets:p,hiddenWidgets:h,isEditMode:a,setIsEditMode:o,reorderWidgets:l,toggleWidgetVisibility:c,updateWidgetSize:m,updateWidgetSpan:f,applyPreset:d,resetLayout:u}}const di=()=>{const{user:t}=ve(),[s,n]=i.useState({totalStock:0,activeProducts:0,negativeStock:0,positiveStock:0,negativeUnits:0,positiveUnits:0,totalSystemUnits:0}),[r,a]=i.useState(0),[o,l]=i.useState(!0),[c,u]=i.useState(0),[m,f]=i.useState(null);i.useEffect(()=>{(async()=>{if(t!=null&&t.branchName)try{const h=await Se.getBranchConfig(t.branchName);u(h.days),f(h.startDate)}catch(h){console.error("Error loading branch config:",h)}})()},[t]),i.useEffect(()=>{(async()=>{l(!0);let h=0;try{h=await tr()}catch(v){console.error("Error fetching product count:",v)}if(!(t!=null&&t.branchSheet)){n({totalStock:0,activeProducts:h,negativeStock:0,positiveStock:0,negativeUnits:0,positiveUnits:0,totalSystemUnits:0}),l(!1);return}try{const v=await Se.getAllCyclicInventories(t.branchSheet),x=v.reduce((b,g)=>({negativeStock:b.negativeStock+g.negativeValue,positiveStock:b.positiveStock+g.positiveValue,totalStock:b.totalStock+g.differenceValue,negativeUnits:b.negativeUnits+g.negativeUnits,positiveUnits:b.positiveUnits+g.positiveUnits,totalSystemUnits:b.totalSystemUnits+g.totalSystemUnits,controlledCount:b.controlledCount+(g.status==="controlado"?1:0)}),{negativeStock:0,positiveStock:0,totalStock:0,negativeUnits:0,positiveUnits:0,totalSystemUnits:0,controlledCount:0}),N=v.length>0?Math.round(x.controlledCount/v.length*100):0;a(N),n({totalStock:x.totalStock,activeProducts:h,negativeStock:x.negativeStock,positiveStock:x.positiveStock,negativeUnits:x.negativeUnits,positiveUnits:x.positiveUnits,totalSystemUnits:x.totalSystemUnits})}catch(v){console.error("Error loading metrics:",v)}finally{l(!1)}})()},[t]);const d=i.useCallback(async(p,h,v)=>{try{return await Se.saveBranchConfig(p,h,v),await yr.logAction({action:"CONFIG_UPDATE",entityType:"BRANCH_CONFIG",branchId:p,userId:t==null?void 0:t.id,details:{days:h,startDate:v}}),(t==null?void 0:t.branchName)===p&&(u(h),v&&f(v)),!0}catch(x){throw console.error("Error saving config:",x),x}},[t]);return i.useMemo(()=>({metrics:s,globalProgress:r,assignedDays:c,cycleStartDate:m,updateConfig:d,isLoading:o}),[s,r,c,m,o]),i.useMemo(()=>({metrics:s,globalProgress:r,assignedDays:c,cycleStartDate:m,updateConfig:d,isLoading:o}),[s,r,c,m,d,o])},ui={small:"h-[200px]",medium:"h-[300px]",large:"h-[400px]",full:"h-auto"},mi={small:"col-span-1",medium:"col-span-1",large:"col-span-1",full:"col-span-full"},Xs={small:{label:"Pequeo",icon:xa,description:"1/4 ancho (3 cols)"},medium:{label:"Mediano",icon:ya,description:"1/2 ancho (6 cols)"},large:{label:"Grande",icon:zs,description:"1/3 ancho (4 cols)"},full:{label:"Ancho completo",icon:zs,description:"Ancho completo (12 cols)"}};function hi({currentSize:t,onChange:s,availableSizes:n=["small","medium","large"]}){const r=Xs[t].icon;return e.jsxs(wr,{children:[e.jsx(Nr,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-6 w-6",title:"Cambiar tamao",children:e.jsx(r,{className:"h-4 w-4"})})}),e.jsx(Cr,{align:"end",children:n.map(a=>{const o=Xs[a],l=o.icon;return e.jsxs(Sr,{onClick:()=>s(a),className:O("flex items-center gap-2",t===a&&"bg-accent"),children:[e.jsx(l,{className:"h-4 w-4"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium",children:o.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:o.description})]})]},a)})})]})}const fi=i.memo(({widget:t,isEditMode:s,onRemove:n,onSizeChange:r,children:a})=>{const{attributes:o,listeners:l,setNodeRef:c,transform:u,transition:m,isDragging:f}=ri({id:t.id,disabled:!s}),d={transform:ft.Transform.toString(u),transition:m};return e.jsx("div",{ref:c,style:d,className:O(mi[t.size],f&&"opacity-50 z-50",s&&"cursor-move",ui[t.size]),children:e.jsx(jr,{hoverEffect:s?"none":"lift",className:"h-full",children:e.jsxs("div",{className:O("relative h-full transition-all rounded-lg",s&&"ring-2 ring-primary/20 hover:ring-primary/40"),children:[s&&e.jsxs("div",{className:"absolute top-2 right-2 z-10 flex gap-1",children:[r&&e.jsx(hi,{currentSize:t.size,onChange:r}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-6 w-6 cursor-grab active:cursor-grabbing",...o,...l,children:e.jsx(ma,{className:"h-4 w-4"})}),!t.mandatory&&n&&e.jsx(A,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-destructive hover:text-destructive-foreground",onClick:n,children:e.jsx(Js,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"h-full",children:a})]})})})}),Ks={metrics:{id:"metrics",name:"Mtricas",icon:ct,description:"Indicadores financieros y de rendimiento"},inventory:{id:"inventory",name:"Inventario",icon:sr,description:"Gestin y control de inventarios"},analytics:{id:"analytics",name:"Anlisis",icon:Pt,description:"Grficos y reportes analticos"},actions:{id:"actions",name:"Acciones",icon:cs,description:"Acciones rpidas y utilidades"},alerts:{id:"alerts",name:"Alertas",icon:pt,description:"Notificaciones y recordatorios"},activity:{id:"activity",name:"Actividad",icon:ls,description:"Seguimiento de actividad y usuarios"}},Jt={"metrics-carousel":"metrics","active-products":"inventory","inventory-summary":"inventory","inventory-alerts":"alerts","upcoming-inventories":"inventory","branches-table":"activity","inventory-progress":"inventory","critical-products":"alerts","total-stock-value":"metrics","active-users":"activity","pending-inventories":"inventory","trends-chart":"analytics","top-products":"analytics","activity-timeline":"activity","category-distribution":"analytics","monthly-goals":"metrics","sync-status":"actions","quick-actions":"actions",countdown:"alerts","category-progress":"analytics",calendar:"actions"},xi=new Set(["metrics-carousel","active-products","inventory-alerts","trends-chart","quick-actions"]);function pi({open:t,onOpenChange:s,hiddenWidgets:n,onAddWidget:r}){const[a,o]=i.useState(""),[l,c]=i.useState(null),u=i.useMemo(()=>{let d=n;return a&&(d=d.filter(p=>p.title.toLowerCase().includes(a.toLowerCase())||p.description.toLowerCase().includes(a.toLowerCase()))),l&&(d=d.filter(p=>Jt[p.type]===l)),d},[n,a,l]),m=i.useMemo(()=>{const d={};return u.forEach(p=>{const h=Jt[p.type]||"other";d[h]||(d[h]=[]),d[h].push(p)}),d},[u]),f=d=>{r(d),n.length===1&&s(!1)};return e.jsx(Qs,{open:t,onOpenChange:s,children:e.jsxs(en,{className:"max-h-[90vh]",children:[e.jsxs(tn,{children:[e.jsx(sn,{children:"Galera de Widgets"}),e.jsx(nr,{children:"Explora y agrega widgets para personalizar tu dashboard"})]}),e.jsxs("div",{className:"px-4 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(nn,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ie,{placeholder:"Buscar widgets...",value:a,onChange:d=>o(d.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[e.jsx(A,{variant:l===null?"default":"outline",size:"sm",onClick:()=>c(null),children:"Todos"}),Object.values(Ks).map(d=>{const p=d.icon,h=n.filter(v=>Jt[v.type]===d.id).length;return h===0?null:e.jsxs(A,{variant:l===d.id?"default":"outline",size:"sm",onClick:()=>c(d.id),className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4"}),d.name,e.jsx(se,{variant:"secondary",className:"ml-1",children:h})]},d.id)})]})]}),e.jsx("div",{className:"px-4 pb-4 max-h-[50vh] overflow-y-auto",children:u.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-lg font-medium",children:n.length===0?"Todos los widgets estn visibles":"No se encontraron widgets"}),a&&e.jsx("p",{className:"text-sm mt-2",children:"Intenta con otra bsqueda o categora"})]}):e.jsx("div",{className:"space-y-6",children:Object.entries(m).map(([d,p])=>{const h=Ks[d];if(!h||p.length===0)return null;const v=h.icon;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sticky top-0 bg-background py-2 z-10",children:[e.jsx(v,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"font-semibold",children:h.name}),e.jsx(se,{variant:"outline",children:p.length})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:p.map(x=>{const N=x.icon,b=xi.has(x.id);return e.jsxs(B,{className:O("hover:border-primary transition-all hover:shadow-md",b&&"border-primary/50"),children:[e.jsx(_,{className:"pb-3",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(N,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"text-sm truncate",children:x.title}),b&&e.jsx(Dr,{className:"h-3 w-3 fill-yellow-400 text-yellow-400 flex-shrink-0"})]}),e.jsx(rr,{className:"text-xs mt-1 line-clamp-2",children:x.description})]})]})})}),e.jsx(G,{className:"pt-0",children:e.jsxs(A,{size:"sm",className:"w-full",onClick:()=>f(x.id),children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Agregar"]})})]},x.id)})})]},d)})})}),e.jsx(ar,{children:e.jsx(or,{asChild:!0,children:e.jsx(A,{variant:"outline",children:"Cerrar"})})})]})})}function Fn({events:t=[],selected:s,onSelect:n,className:r}){const[a,o]=J.useState(s||new Date);J.useEffect(()=>{s&&o(s)},[s]);const l=kr(a),c=Er(l),u=Ir(l,{locale:Nt,weekStartsOn:1}),m=Ar(c,{locale:Nt,weekStartsOn:1}),f=[];let d=u;for(;d<=m;){const b=[];for(let g=0;g<7;g++)b.push(d),d=Mr(d,1);f.push(b)}const p=J.useMemo(()=>{const b=new Map;return t.forEach(g=>{const y=g.date;b.has(y)||b.set(y,[]),b.get(y).push(g)}),b},[t]),h=new Date,v=()=>o(b=>Or(b,1)),x=()=>o(b=>Lr(b,1)),N="h-10 w-10";return e.jsxs("div",{className:`w-full ${r||""}`,children:[e.jsxs("div",{className:"flex items-center justify-between px-2 pb-2",children:[e.jsx("button",{onClick:v,className:"p-1 rounded hover:bg-muted/50",children:e.jsx(Br,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx("div",{className:"text-sm font-semibold",children:Ms(l,"LLLL yyyy",{locale:Nt})}),e.jsx("button",{onClick:x,className:"p-1 rounded hover:bg-muted/50",children:e.jsx(rn,{className:"h-5 w-5 text-muted-foreground"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 px-1 text-xs text-muted-foreground mb-1",children:["LU","MA","MI","JU","VI","SA","DO"].map((b,g)=>e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"h-10 w-10 flex items-center justify-center font-medium uppercase",children:b})},g))}),e.jsx("div",{className:"space-y-1",children:f.map((b,g)=>e.jsx("div",{className:"grid grid-cols-7 gap-1",children:b.map(y=>{const w=y.toISOString().slice(0,10),C=Rr(y,l),j=p.get(w)||[],S=j.length>0,k=s?Tr(y,s):!1,E=j.some(U=>{const P=zr(U.date),D=Pr(P,h);return D>=2&&D<=5}),R=k?"bg-primary text-primary-foreground":E?"hover:bg-primary/10 ring-2 ring-accent":"hover:bg-primary/10",I=e.jsx("button",{onClick:()=>n&&n(y),className:`flex items-center justify-center ${N} rounded-full transition-colors focus:outline-none ${C?"text-foreground":"text-muted-foreground"} ${R}`,children:e.jsxs("div",{className:"relative flex items-center justify-center w-full h-full",children:[e.jsx("span",{className:"text-sm font-medium",children:Ms(y,"d",{locale:Nt})}),S&&e.jsx("span",{className:"absolute bottom-1.5 h-1.5 w-1.5 rounded-full bg-blue-500"})]})},w);if(S){const U=e.jsxs("div",{className:"space-y-1",children:[j.slice(0,5).map(P=>e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"font-medium",children:P.title}),e.jsxs("div",{className:"text-muted-foreground",children:[P.branch,"  ",P.sector]})]},P.id)),j.length>5&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["+",j.length-5," ms"]})]});return e.jsxs(ir,{children:[e.jsx(lr,{asChild:!0,children:I}),e.jsx(cr,{side:"top",children:U})]},w)}return I})},g))})]})}function gi(t){const[s,n]=i.useState(!1);return i.useEffect(()=>{function r(o){n(o.matches)}const a=matchMedia(t);return a.addEventListener("change",r),n(a.matches),()=>a.removeEventListener("change",r)},[t]),s}const ze={async getEvents(t,s=!1){let n=nt.from("inventory_events").select("*").order("date",{ascending:!0});!s&&t&&(n=n.eq("branch_name",t));const{data:r,error:a}=await n;return a?(console.error("Error fetching events:",a),[]):r||[]},async addEvent(t){const{data:s,error:n}=await nt.rpc("manage_inventory_event",{p_action:"CREATE",p_title:t.title,p_branch:t.branch_name,p_sector:t.sector,p_date:t.date});return n?(console.error("Error adding event via RPC:",n),null):s},async deleteEvent(t){const{error:s}=await nt.rpc("manage_inventory_event",{p_action:"DELETE",p_id:t});return s?(console.error("Error deleting event via RPC:",s),!1):!0},async updateEvent(t){const{error:s}=await nt.rpc("manage_inventory_event",{p_action:"UPDATE",p_id:t.id,p_title:t.title,p_branch:t.branch_name,p_sector:t.sector,p_date:t.date});if(s){console.error("Error updating event via RPC:",s);const{error:n}=await nt.from("inventory_events").update({title:t.title,branch_name:t.branch_name,sector:t.sector,date:t.date}).eq("id",t.id);return n?(console.error("Error updating event via Table:",n),!1):!0}return!0}},vi=["Farmacia","Perfumeria","General"];function bi({open:t,onOpenChange:s,initialDate:n}){const r=gi("(min-width: 768px)"),{user:a}=ve(),o=(a==null?void 0:a.role)==="admin",[l,c]=i.useState(n||new Date),[u,m]=i.useState([]),[f,d]=i.useState("list"),[p,h]=i.useState(null),[v,x]=i.useState(""),[N,b]=i.useState(""),[g,y]=i.useState(""),[w,C]=i.useState("");i.useEffect(()=>{t&&(j(),n&&c(n))},[t,n,a==null?void 0:a.branchName]);const j=async()=>{try{const D=await ze.getEvents(a==null?void 0:a.branchName,o);m(D)}catch(D){console.error("Error loading events",D)}},S=async()=>{if(!v||!N||!g||!w){te.error("Error","Completa todos los campos");return}try{if(f==="add"){const D=await ze.addEvent({title:v,branch_name:N,sector:g,date:w});D&&(te.success("Creado","Evento agregado exitosamente"),m(X=>[...X,D]),I())}else f==="edit"&&p&&await ze.updateEvent({id:p,title:v,branch_name:N,sector:g,date:w})&&(te.success("Actualizado","Evento modificado exitosamente"),await j(),I())}catch{te.error("Error","Ocurri un error al guardar")}},k=async D=>{if(confirm("Ests seguro de eliminar este evento?"))try{await ze.deleteEvent(D)&&(te.success("Eliminado","Evento eliminado"),m(he=>he.filter(q=>q.id!==D)),f==="edit"&&I())}catch{te.error("Error","No se pudo eliminar el evento")}},E=()=>{x(""),b(""),y(""),C(l.toISOString().slice(0,10)),d("add")},R=D=>{h(D.id),x(D.title),b(D.branch_name),y(D.sector),C(D.date),d("edit")},I=()=>{d("list"),h(null),x(""),b(""),y("")},U=D=>{const X=D.toISOString().slice(0,10);return u.filter(he=>he.date===X)},P=()=>e.jsxs("div",{className:`flex ${r?"flex-row":"flex-col"} h-full bg-background`,children:[e.jsx("div",{className:r?"w-[380px] border-r border-border/40 p-6 flex flex-col bg-card/50":"w-full p-4",children:e.jsx("div",{className:"flex-1 flex flex-col justify-center",children:e.jsx(Fn,{events:u.map(D=>({...D,branch:D.branch_name})),selected:l,onSelect:D=>{D&&(c(D),f==="add"&&C(D.toISOString().slice(0,10)),f==="edit"&&I())},className:O("rounded-2xl border border-border/50 shadow-sm p-4 bg-card w-full mx-auto","transition-all duration-300 hover:shadow-md hover:border-border/80")})})}),e.jsx("div",{className:O(r?"flex-1 p-8":"w-full p-4","flex flex-col relative bg-gradient-to-br from-background to-muted/20"),children:e.jsx(Bt,{mode:"wait",children:f==="list"?e.jsxs(L.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx(L.h2,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-3xl font-bold capitalize tracking-tight text-foreground",children:l.toLocaleDateString("es-AR",{weekday:"long",day:"numeric",month:"long"})},l.toISOString()),e.jsxs("p",{className:"text-muted-foreground mt-1 text-sm font-medium",children:[U(l).length," ",U(l).length===1?"Evento programado":"Eventos programados"]})]}),o&&e.jsxs(A,{onClick:E,className:"rounded-full shadow-lg hover:shadow-xl transition-all hover:scale-105 active:scale-95 bg-primary text-primary-foreground px-6 py-2 h-auto text-sm font-medium",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Nuevo Evento"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto -mr-4 pr-4 custom-scrollbar",children:U(l).length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[300px] text-muted-foreground/40 border-2 border-dashed border-border/40 rounded-3xl bg-muted/5",children:[e.jsx(ut,{className:"w-16 h-16 mb-4 opacity-10"}),e.jsx("p",{className:"text-lg font-medium",children:"Sin agenda para hoy"}),e.jsx("p",{className:"text-sm",children:"Disfruta de tu da libre"})]}):e.jsx("div",{className:"space-y-4",children:U(l).map((D,X)=>e.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:X*.1},className:"group relative overflow-hidden bg-card border border-border/50 rounded-2xl p-5 shadow-sm hover:shadow-lg hover:border-primary/20 transition-all duration-300",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-primary/20 group-hover:bg-primary transition-colors"}),e.jsxs("div",{className:"flex justify-between items-start pl-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-semibold text-foreground mb-2 group-hover:text-primary transition-colors",children:D.title}),e.jsxs("div",{className:"flex flex-col gap-1.5 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($r,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:D.branch_name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:D.sector})]})]})]}),o&&e.jsx(A,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity hover:bg-muted text-muted-foreground hover:text-foreground rounded-full",onClick:()=>R(D),children:e.jsx(Is,{className:"w-4 h-4"})})]})]},D.id))})})]},"list"):e.jsx(L.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"flex flex-col h-full justify-center max-w-md mx-auto w-full",children:e.jsxs("div",{className:"bg-card border border-border/60 rounded-3xl shadow-xl p-6 sm:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-primary",children:f==="add"?e.jsx(Oe,{className:"w-5 h-5"}):e.jsx(Is,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:f==="add"?"Programar Inventario":"Editar Detalles"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Complete la informacin requerida"})]})]}),e.jsx(A,{variant:"ghost",size:"icon",className:"rounded-full hover:bg-muted",onClick:I,children:e.jsx(Js,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium ml-1 text-muted-foreground",children:"Ttulo del Evento"}),e.jsx(ie,{placeholder:"Ej: Auditora Anual",value:v,onChange:D=>x(D.target.value),className:"bg-muted/30 border-border/50 focus:bg-background h-11 rounded-xl"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium ml-1 text-muted-foreground",children:"Sucursal"}),e.jsxs(kt,{value:N,onValueChange:b,children:[e.jsx(Et,{className:"bg-muted/30 border-border/50 focus:bg-background h-11 rounded-xl",children:e.jsx(It,{placeholder:"Seleccionar"})}),e.jsx(At,{children:an.map(D=>e.jsx(He,{value:D,children:D},D))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium ml-1 text-muted-foreground",children:"Sector"}),e.jsxs(kt,{value:g,onValueChange:y,children:[e.jsx(Et,{className:"bg-muted/30 border-border/50 focus:bg-background h-11 rounded-xl",children:e.jsx(It,{placeholder:"Seleccionar"})}),e.jsx(At,{children:vi.map(D=>e.jsx(He,{value:D,children:D},D))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium ml-1 text-muted-foreground",children:"Fecha Asignada"}),e.jsx(ie,{type:"date",value:w,onChange:D=>C(D.target.value),className:"bg-muted/30 border-border/50 focus:bg-background h-11 rounded-xl"})]}),e.jsxs("div",{className:"flex gap-3 mt-8 pt-2",children:[f==="edit"&&p&&e.jsx(A,{variant:"ghost",className:"text-destructive hover:bg-destructive/10 hover:text-destructive h-11 px-4 rounded-xl",onClick:()=>k(p),children:e.jsx(Wr,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 flex gap-3 justify-end",children:[e.jsx(A,{variant:"outline",className:"h-11 rounded-xl px-6 border-border/60 hover:bg-muted",onClick:I,children:"Cancelar"}),e.jsxs(A,{className:"h-11 rounded-xl px-8 shadow-lg hover:shadow-primary/20 hover:scale-[1.02] transition-all",onClick:S,children:[e.jsx(Fr,{className:"w-4 h-4 mr-2"}),"Guardar"]})]})]})]})]})},"form")})})]});return r?e.jsx(Ot,{open:t,onOpenChange:s,children:e.jsx(Lt,{className:"max-w-[1000px] w-[95vw] h-[80vh] p-0 gap-0 overflow-hidden border-none shadow-2xl rounded-3xl bg-background text-foreground ring-1 ring-border/20",children:P()})}):e.jsx(Qs,{open:t,onOpenChange:s,children:e.jsxs(en,{className:"h-[95vh] rounded-t-3xl",children:[e.jsx(tn,{className:"text-left border-b pb-4 px-6",children:e.jsx(sn,{children:"Calendario"})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:P()})]})})}const Vn=[{id:"executive",name:"Ejecutivo",description:"Vista enfocada en mtricas financieras y tendencias",icon:Le,widgetIds:["metrics-carousel","total-stock-value","trends-chart","category-distribution","monthly-goals","branches-table"]},{id:"operational",name:"Operativo",description:"Vista para operaciones diarias e inventarios",icon:cs,widgetIds:["metrics-carousel","active-products","countdown","inventory-alerts","upcoming-inventories","pending-inventories","quick-actions","category-progress"]},{id:"analytical",name:"Analtico",description:"Vista con grficos y anlisis detallados",icon:Pt,widgetIds:["metrics-carousel","trends-chart","category-distribution","top-products","category-progress","inventory-progress","critical-products"]},{id:"complete",name:"Completo",description:"Todos los widgets disponibles",icon:bn,widgetIds:["metrics-carousel","active-products","countdown","inventory-summary","inventory-alerts","upcoming-inventories","branches-table","inventory-progress","critical-products","total-stock-value","active-users","pending-inventories","trends-chart","top-products","activity-timeline","category-distribution","monthly-goals","sync-status","quick-actions","category-progress"]}];function yi({open:t,onOpenChange:s,onApplyPreset:n}){const r=a=>{n(a),s(!1)};return e.jsx(Ot,{open:t,onOpenChange:s,children:e.jsxs(Lt,{className:"max-w-3xl",children:[e.jsxs(as,{children:[e.jsx(os,{children:"Layouts Predefinidos"}),e.jsx(on,{children:"Selecciona un layout predefinido para configurar tu dashboard rpidamente"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 py-4",children:Vn.map(a=>{const o=a.icon;return e.jsxs(B,{className:O("p-4 cursor-pointer transition-all hover:border-primary hover:shadow-md","flex flex-col gap-3"),onClick:()=>r(a.id),children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(o,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-base",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(ln,{className:"h-3 w-3"}),e.jsxs("span",{children:[a.widgetIds.length," widgets incluidos"]})]}),e.jsx(A,{variant:"outline",size:"sm",className:"w-full mt-2",onClick:l=>{l.stopPropagation(),r(a.id)},children:"Aplicar Layout"})]},a.id)})}),e.jsx("div",{className:"flex justify-end gap-2 pt-2 border-t",children:e.jsx(A,{variant:"outline",onClick:()=>s(!1),children:"Cancelar"})})]})})}const ji={hidden:{opacity:0,y:20},show:{opacity:1,y:0}};function wi({isEditMode:t,setIsEditMode:s,onOpenPresets:n,onOpenGallery:r,onResetLayout:a,hasHiddenWidgets:o}){const{user:l}=ve(),c=()=>{const u=new Date().getHours();return u>=6&&u<12?"Buenos das":u>=12&&u<20?"Buenas tardes":"Buenas noches"};return e.jsxs(L.div,{variants:ji,className:"space-y-1",children:[e.jsx("div",{className:"text-muted-foreground text-xs font-normal",children:new Date().toLocaleDateString("es-AR",{weekday:"long",month:"short",day:"2-digit",year:"numeric"})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-2xl font-medium tracking-tight text-foreground",children:[c(),", ",(l==null?void 0:l.role)==="admin"||(l==null?void 0:l.role)==="mod"?l==null?void 0:l.name.split(" ")[0]:(l==null?void 0:l.branchName)||"Sucursal"," ",e.jsx("span",{className:"wave",children:""})]}),e.jsxs("div",{className:"flex gap-2",children:[t&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:n,children:[e.jsx(bn,{className:"h-4 w-4 mr-2"}),"Presets"]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:r,disabled:!o,children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Agregar Widget"]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:a,children:[e.jsx(Vr,{className:"h-4 w-4 mr-2"}),"Resetear"]})]}),dt(l,"EDIT_DASHBOARD_LAYOUT")&&e.jsx(L.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(A,{variant:t?"default":"outline",size:"sm",onClick:()=>s(!t),className:O("relative overflow-hidden transition-all duration-300",t&&"bg-green-600 hover:bg-green-700"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bt,{mode:"wait",children:t?e.jsx(L.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},children:e.jsx(ln,{className:"h-4 w-4"})},"check"):e.jsx(L.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},children:e.jsx(ga,{className:"h-4 w-4"})},"edit")}),e.jsx("span",{children:t?"Guardar":"Editar Dashboard"})]})})})]})]})]})}function Ni(){const{user:t}=ve(),[s,n]=i.useState([]),[r,a]=i.useState(!0),[o,l]=i.useState(0),c=er();i.useEffect(()=>{u();const p=setInterval(u,5e3);return()=>clearInterval(p)},[t==null?void 0:t.branchName]),i.useEffect(()=>{if(s.length<=1)return;const p=setInterval(()=>{l(h=>(h+1)%s.length)},4e3);return()=>clearInterval(p)},[s.length]);const u=async()=>{try{const p=await _r(t==null?void 0:t.branchName),h=new Date,v=h.getMonth()+1,x=h.getFullYear(),N=x*100+v,b=[],g=new Map;p.forEach(y=>{const w=g.get(y.ean);(!w||y.timestamp>w.timestamp)&&g.set(y.ean,y)}),g.forEach(y=>{y.batches.forEach(w=>{if(w.quantity<=0||w.status&&w.status!=="active")return;const C=w.reminderMonths;if(!C)return;const j=w.expirationDate.split("/");if(j.length<2)return;let S=parseInt(j[0]),k=parseInt(j[1]);k<100&&(k+=2e3);const E=k*100+S,R=k*12+S,I=x*12+v;if(R-I<=C){const D=new Date(k,S-1,1).getTime()-h.getTime(),X=Math.ceil(D/(1e3*60*60*24));b.push({productName:y.productName,batchNumber:w.batchNumber,expirationDate:w.expirationDate,reminderMonths:C,daysUntilExpiry:X})}})}),b.sort((y,w)=>y.daysUntilExpiry-w.daysUntilExpiry),n(y=>JSON.stringify(y)===JSON.stringify(b)?y:b)}catch(p){console.error("Smart Analyst Error:",p)}finally{a(!1)}};if(r)return null;const m=s.length,f=m===0,d=s[o];return e.jsx(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"h-full",children:e.jsxs(B,{className:"flex flex-col h-full bg-card border-border/50 shadow-sm relative overflow-hidden group hover:shadow-md transition-all cursor-pointer",onClick:()=>c("/smart-analyst"),role:"button",tabIndex:0,children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-primary/20 to-transparent opacity-50"}),e.jsx(_,{className:"pb-2 pt-4 px-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(H,{className:"text-sm font-medium text-muted-foreground",children:"Control de Vencimientos"}),f?e.jsx(lt,{className:"w-4 h-4 text-emerald-500"}):e.jsx(ia,{className:"w-4 h-4 text-primary"})]})}),e.jsxs(G,{className:"flex-1 flex flex-col px-4 pb-4 pt-0 min-h-0",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-2",children:[e.jsx("span",{className:`text-3xl font-bold ${f?"text-emerald-600 dark:text-emerald-400":"text-foreground"}`,children:f?"Todo en Orden":`${m}`}),!f&&e.jsx("span",{className:"text-sm text-muted-foreground",children:"Alertas"})]}),f&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-3",children:"No detectamos productos prximos a vencer segn tus recordatorios configurados."}),!f&&d&&e.jsx("div",{className:"flex-1 relative min-h-0 mb-2",children:e.jsx(Bt,{mode:"wait",children:e.jsxs(L.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.2},className:"absolute inset-0 flex flex-col justify-center border-l-2 border-primary/50 pl-3 py-1",children:[e.jsx("p",{className:"font-medium text-sm truncate text-foreground leading-tight mb-1",title:d.productName,children:d.productName}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground/80",children:[e.jsxs("span",{className:"font-mono bg-muted/50 px-1 rounded text-[10px]",children:["Lote: ",d.batchNumber]}),e.jsx("span",{children:""}),e.jsxs("span",{className:d.daysUntilExpiry<=30?"text-red-500 font-medium":"text-amber-500",children:["Vence: ",d.expirationDate]})]})]},`${d.productName}-${d.batchNumber}`)})}),!f&&s.length>1&&e.jsx("div",{className:"flex gap-1 mb-2",children:s.slice(0,5).map((p,h)=>e.jsx("div",{className:`h-1 rounded-full transition-all duration-300 ${h===o%5?"w-4 bg-primary":"w-1.5 bg-primary/20"}`},h))}),!f&&e.jsxs(A,{className:"w-full h-8 text-xs mt-auto",size:"sm",variant:"outline",onClick:()=>c("/smart-analyst"),children:["Ver Detalles ",e.jsx(Hr,{className:"w-3 h-3 ml-2"})]})]})]})})}function Ci({metrics:t}){const s=(o,l)=>{if(l===0)return{value:0,isPositive:!0};const c=o/l*100;return{value:Math.abs(Number(c.toFixed(1))),isPositive:c>=0}},n=s(t.negativeUnits+t.positiveUnits,t.totalSystemUnits),r=s(t.negativeUnits,t.totalSystemUnits),a=s(t.positiveUnits,t.totalSystemUnits);return e.jsx(Gr,{items:[{id:"net",label:"Diferencia Neta",value:t.totalStock,color:t.totalStock<0?"text-destructive":t.totalStock>0?"text-success":"text-foreground",icon:ct,prefix:"$",trend:n},{id:"negative",label:"Negativo Total",value:t.negativeStock,color:"text-destructive",icon:is,prefix:"$",trend:r},{id:"positive",label:"Positivo Total",value:t.positiveStock,color:"text-success",icon:Le,prefix:"$",trend:a}]})}function Si({activeProducts:t}){return e.jsxs(B,{className:"h-full flex flex-col justify-between",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(H,{className:"text-sm font-medium",children:"Productos Activos"}),e.jsx(ls,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(G,{children:[(()=>{const s=new Intl.NumberFormat("es-AR").format(t);let n="text-3xl";return s.length>8?n="text-xl":s.length>6&&(n="text-2xl"),e.jsx("div",{className:`${n} font-bold`,children:e.jsx(xn,{value:t})})})(),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total en base de datos"})]})]})}function Di(){return e.jsxs(B,{className:"p-6 h-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-sm font-medium text-muted-foreground",children:"Resumen de Inventario"}),e.jsx("button",{className:"text-sm text-muted-foreground hover:text-foreground",children:"Ver detalles"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Productos en Stock"}),e.jsx("span",{className:"text-sm font-medium",children:"85%"})]}),e.jsx(Gt,{value:85})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Productos con Bajo Stock"}),e.jsx("span",{className:"text-sm font-medium text-warning",children:"12%"})]}),e.jsx(Gt,{value:12,variant:"warning"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Productos Agotados"}),e.jsx("span",{className:"text-sm font-medium text-destructive",children:"3%"})]}),e.jsx(Gt,{value:3,variant:"destructive"})]})]})]})}const ki=[{label:"Diferencia de Stock",icon:rs,message:"Hola, he detectado una diferencia de stock importante en...",color:"bg-orange-500/10 text-orange-600 hover:bg-orange-500/20 border-orange-200"},{label:"Confirmar Cierre",icon:ua,message:"El cierre del inventario cclico ha sido completado y verificado.",color:"bg-green-500/10 text-green-600 hover:bg-green-500/20 border-green-200"},{label:"Solicitud Urgente",icon:ha,message:"Necesito autorizacin urgente para...",color:"bg-blue-500/10 text-blue-600 hover:bg-blue-500/20 border-blue-200"}],ee={dark:"#08102E",blue:"#045598",light:"#a5b1e1ff"},Ei=()=>e.jsxs("div",{className:"relative w-32 h-32 flex items-center justify-center",children:[e.jsx(L.div,{className:"absolute inset-0 rounded-full blur-xl opacity-50",style:{background:`radial-gradient(circle at center, ${ee.light}, ${ee.blue})`},animate:{scale:[.8,1,.9,.8],opacity:[.4,.6,.5,.4]},transition:{duration:5,repeat:1/0,ease:"easeInOut",times:[0,.4,.8,1]}}),e.jsx(L.div,{className:"absolute w-28 h-28 rounded-full blur-lg mix-blend-screen",style:{background:`conic-gradient(from 0deg, ${ee.dark}, ${ee.blue}, ${ee.light}, ${ee.dark})`},animate:{rotate:360,scale:[.9,1.1,1,.9]},transition:{rotate:{duration:7,repeat:1/0,ease:"linear"},scale:{duration:6,repeat:1/0,ease:"easeInOut"}}}),e.jsx(L.div,{className:"absolute w-24 h-24 rounded-full blur-md mix-blend-overlay",style:{background:`conic-gradient(from 180deg, ${ee.light}, ${ee.blue}, ${ee.dark}, ${ee.light})`},animate:{rotate:-360,scale:[1.1,.9,.95,1.1]},transition:{rotate:{duration:9,repeat:1/0,ease:"linear"},scale:{duration:8,repeat:1/0,ease:"easeInOut"}}}),e.jsxs(L.div,{className:"absolute w-20 h-20 rounded-full backdrop-blur-md z-10 flex items-center justify-center overflow-hidden",style:{background:"linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.05) 100%)",border:"1px solid rgba(255,255,255,0.3)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.37), inset 0 0 0 1px rgba(255,255,255,0.1)"},animate:{boxShadow:[`0 0 20px ${ee.blue}40, inset 0 0 10px rgba(255,255,255,0.1)`,`0 0 35px ${ee.light}50, inset 0 0 20px rgba(255,255,255,0.2)`,`0 0 20px ${ee.blue}40, inset 0 0 10px rgba(255,255,255,0.1)`]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1/2 bg-gradient-to-b from-white/20 to-transparent opacity-50 pointer-events-none"}),e.jsx(fa,{className:"w-10 h-10 text-white drop-shadow-md relative z-10",strokeWidth:2})]})]});function Ii(){var f;const{user:t}=ve(),[s,n]=i.useState(""),r=i.useRef(null),[a,o]=i.useState(!1),l=d=>{const v=`https://teams.microsoft.com/l/chat/0/0?users=GHCoz@farmaplus.com.ar&message=${encodeURIComponent(d)}`;window.open(v,"_blank"),n("")},c=()=>{s.trim()&&l(s)},u=d=>{l(d)},m=d=>{d.key==="Enter"&&c()};return e.jsxs(B,{className:"h-full flex flex-col border-border/50 bg-gradient-to-br from-card/50 to-muted/20 backdrop-blur-sm overflow-hidden relative group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-full h-full opacity-5 pointer-events-none",style:{background:`radial-gradient(circle at top right, ${ee.light}, transparent 70%)`}}),e.jsx(_,{className:"pb-2 flex flex-row items-center justify-between space-y-0 relative z-10",children:e.jsx(H,{className:"text-lg font-medium tracking-tight",children:"Chat Teams"})}),e.jsxs(G,{className:"flex-1 flex flex-col gap-4 relative z-10 p-4",children:[e.jsxs("div",{className:"flex-1 flex flex-col justify-center items-center text-center -mt-4",children:[e.jsx(Ei,{}),e.jsxs(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5},className:"space-y-1 relative z-20 mt-2",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Hola ",((f=t==null?void 0:t.name)==null?void 0:f.split(" ")[0])||"Gonzalo"]}),e.jsx("p",{className:"text-muted-foreground text-xs max-w-[200px] mx-auto",children:"En qu puedo ayudarte hoy?"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center mb-1",children:ki.map((d,p)=>e.jsxs(L.button,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.8+p*.1},onClick:()=>u(d.message),className:O("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-[10px] font-medium border transition-all duration-200 hover:scale-105 active:scale-95 shadow-sm bg-background/50 backdrop-blur-sm",d.color),children:[e.jsx(d.icon,{className:"h-3 w-3"}),d.label]},d.label))}),e.jsx("div",{className:"relative mt-auto",children:e.jsxs("div",{className:"relative flex items-center bg-background/80 backdrop-blur border rounded-full shadow-sm focus-within:ring-2 transition-all group-hover:shadow-md",style:{borderColor:`${ee.light}30`},children:[e.jsx(A,{variant:"ghost",size:"icon",className:"h-10 w-10 text-muted-foreground hover:text-primary rounded-full shrink-0 ml-1",onClick:()=>o(!a),title:"Adjuntar Reporte",children:e.jsx(pa,{className:"h-4 w-4"})}),e.jsx(ie,{ref:r,value:s,onChange:d=>n(d.target.value),onKeyDown:m,placeholder:"Escribe tu mensaje...",className:"border-none shadow-none focus-visible:ring-0 bg-transparent h-10 px-2 text-sm"}),e.jsx(A,{onClick:c,size:"icon",className:"h-9 w-9 rounded-full mr-1 transition-all shrink-0",style:{backgroundColor:s.trim()?ee.blue:void 0,opacity:s.trim()?1:.5},disabled:!s.trim(),children:e.jsx(va,{className:"h-4 w-4 text-white"})})]})})]})]})}function Ai({open:t,onOpenChange:s,onEventAdded:n}){const[r,a]=i.useState(!1),[o,l]=i.useState(""),[c,u]=i.useState(""),[m,f]=i.useState("Farmacia"),[d,p]=i.useState(new Date().toISOString().slice(0,10)),h=async v=>{if(v.preventDefault(),!c||!d){te.error("Datos incompletos","Sucursal y fecha son requeridas");return}a(!0);try{const x=await ze.addEvent({title:o||`Inventario ${c}`,branch_name:c,sector:m,date:d});x?(te.success("Evento agregado","El evento se cre correctamente"),n(x),s(!1),l(""),u(""),f("Farmacia")):te.error("Error","No se pudo crear el evento")}catch(x){console.error(x),te.error("Error inesperado","Ocurri un error al procesar la solicitud")}finally{a(!1)}};return e.jsx(Ot,{open:t,onOpenChange:s,children:e.jsxs(Lt,{className:"sm:max-w-[425px]",children:[e.jsxs(as,{children:[e.jsx(os,{children:"Programar Inventario"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Complete los datos del nuevo evento de inventario."})]}),e.jsxs("form",{onSubmit:h,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Te,{htmlFor:"branch",children:"Sucursal"}),e.jsxs(kt,{value:c,onValueChange:u,children:[e.jsx(Et,{children:e.jsx(It,{placeholder:"Seleccionar sucursal"})}),e.jsx(At,{className:"max-h-[200px]",children:an.map(v=>e.jsx(He,{value:v,children:v},v))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Te,{htmlFor:"sector",children:"Sector"}),e.jsxs(kt,{value:m,onValueChange:f,children:[e.jsx(Et,{children:e.jsx(It,{placeholder:"Seleccionar sector"})}),e.jsxs(At,{children:[e.jsx(He,{value:"Farmacia",children:"Farmacia"}),e.jsx(He,{value:"Perfumera",children:"Perfumera"}),e.jsx(He,{value:"General",children:"General"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Te,{htmlFor:"date",children:"Fecha"}),e.jsx(ie,{id:"date",type:"date",value:d,onChange:v=>p(v.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Te,{htmlFor:"title",children:"Ttulo (Opcional)"}),e.jsx(ie,{id:"title",placeholder:"Ej. Inventario Anual",value:o,onChange:v=>l(v.target.value)})]}),e.jsxs(dr,{className:"pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:()=>s(!1),children:"Cancelar"}),e.jsxs(A,{type:"submit",disabled:r,children:[r&&e.jsx(qr,{className:"mr-2 h-4 w-4 animate-spin"}),"Guardar Evento"]})]})]})]})})}function Mi({onDateClick:t}){const{user:s}=ve(),n=(s==null?void 0:s.role)==="admin",[r,a]=i.useState([]),[o,l]=i.useState(!0),[c,u]=i.useState(!1),[m]=i.useState(new Date),[f,d]=i.useState([]);i.useEffect(()=>{p()},[s==null?void 0:s.branchName]);const p=async()=>{try{const h=await ze.getEvents(s==null?void 0:s.branchName,n),v=new Date().toISOString().slice(0,10),x=h.filter(C=>C.date>=v).sort((C,j)=>C.date.localeCompare(j.date)).slice(0,3).map(C=>({id:C.id,branch:C.branch_name||C.branchId,sector:C.sector||C.description,date:C.date,formattedDate:new Date(C.date+"T12:00:00").toLocaleDateString("es-AR",{weekday:"long",day:"numeric"})}));a(x),new Date(m).setDate(m.getDate()-m.getDay()+1);const b=[],g=["D","L","M","M","J","V","S"],y=["D","L","M","M","J","V","S"],w=new Date(m);w.setDate(m.getDate()-m.getDay());for(let C=0;C<7;C++){const j=new Date(w);j.setDate(w.getDate()+C);const S=j.toISOString().slice(0,10),k=S===v,E=h.some(R=>R.date===S);b.push({day:y[C],date:j.getDate(),iso:S,hasEvent:E,isToday:k})}d(b)}catch(h){console.error("Error loading upcoming inventories:",h)}finally{l(!1)}};return e.jsxs(B,{className:"p-0 h-full flex flex-col relative overflow-hidden bg-card border-none shadow-sm",children:[e.jsxs("div",{className:"p-5 pb-2 flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-base font-semibold text-foreground",children:m.toLocaleDateString("es-AR",{month:"long",year:"numeric"})})}),e.jsx("div",{className:"flex gap-1",children:dt(s,"MANAGE_CALENDAR_EVENTS")&&e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full hover:bg-muted",onClick:()=>u(!0),children:e.jsx(Oe,{className:"h-4 w-4"})})})]}),e.jsx("div",{className:"px-5 py-2 flex justify-between items-center mb-2",children:f.map((h,v)=>e.jsxs("div",{className:"flex flex-col items-center gap-2 cursor-pointer group",onClick:()=>t==null?void 0:t(h.iso),children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground group-hover:text-primary transition-colors",children:h.day}),e.jsx("div",{className:O("h-8 w-8 rounded-full flex items-center justify-center text-sm font-semibold transition-all",h.isToday?"bg-primary text-primary-foreground shadow-md":"text-foreground group-hover:bg-muted"),children:h.date}),e.jsx("div",{className:O("h-1.5 w-1.5 rounded-full transition-colors",h.hasEvent?"bg-orange-500":"bg-transparent")})]},v))}),e.jsx("div",{className:"flex-1 bg-muted/30 p-4 space-y-3 rounded-t-3xl mt-1",children:o?e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsx("div",{className:"h-14 bg-muted animate-pulse rounded-2xl"}),e.jsx("div",{className:"h-14 bg-muted animate-pulse rounded-2xl"})]}):r.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center py-8 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"Sin eventos prximos"})}):r.map(h=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-card rounded-2xl shadow-sm cursor-pointer hover:shadow-md transition-all group",onClick:()=>t==null?void 0:t(h.date),children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-primary group-hover:bg-primary group-hover:text-primary-foreground transition-colors shrink-0",children:e.jsx(vn,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-semibold truncate text-foreground",children:h.branch}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[h.sector,"  ",h.formattedDate]})]}),e.jsx(A,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(rn,{className:"w-4 h-4 text-muted-foreground"})})]},h.id))}),e.jsx(Ai,{open:c,onOpenChange:u,onSuccess:p})]})}const Zs=8;function Ri({branches:t}){const{selectBranch:s,clearBranchSelection:n,user:r}=ve(),{availableBranches:a}=Ur(),[o,l]=i.useState(""),[c,u]=i.useState(!1),[m,f]=i.useState([]),[d,p]=i.useState(!0),[h,v]=i.useState({key:"progress",direction:"descending"});i.useEffect(()=>{(async()=>{p(!0);try{const k=(await Se.getBranchesSummary()).filter(E=>a.length===0||a.includes(E.branchName));f(k)}catch(S){console.error("Failed to load branch summaries",S)}finally{p(!1)}})()},[a]);const x=i.useMemo(()=>m.filter(j=>j.branchName.toLowerCase().includes(o.toLowerCase())),[m,o]),N=i.useMemo(()=>{let j=[...x];return h.key&&j.sort((S,k)=>{const E=S[h.key],R=k[h.key];return E<R?h.direction==="ascending"?-1:1:E>R?h.direction==="ascending"?1:-1:0}),j},[x,h]),b=j=>{let S="ascending";h.key===j&&h.direction==="ascending"&&(S="descending"),v({key:j,direction:S})},g=c?N:N.slice(0,Zs),y=j=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(j),w=j=>{(r==null?void 0:r.branchName)===j?n==null||n():s&&(s(j),window.scrollTo({top:0,behavior:"smooth"}))},C=j=>(r==null?void 0:r.branchName)===j;return e.jsx(L.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},className:"w-full",children:e.jsxs(B,{className:"p-6 overflow-hidden border-t-4 border-t-primary shadow-md",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Le,{className:"w-6 h-6 text-primary"}),"Monitor de Sucursales"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Estado en tiempo real de inventarios cclicos y cumplimiento."})]}),e.jsxs("div",{className:"relative w-full md:w-72",children:[e.jsx(nn,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ie,{placeholder:"Buscar sucursal...",value:o,onChange:j=>l(j.target.value),className:"pl-10 h-10 bg-muted/50 border-0 focus-visible:ring-1 focus-visible:ring-primary"})]})]}),e.jsx("div",{className:"rounded-xl border bg-card/50 overflow-hidden",children:e.jsxs(Yr,{children:[e.jsx(Xr,{className:"bg-muted/40 hover:bg-muted/50 transition-colors",children:e.jsxs(qt,{children:[e.jsx(Ne,{className:"w-[200px] cursor-pointer",onClick:()=>b("branchName"),children:e.jsxs("div",{className:"flex items-center font-semibold text-foreground",children:["Sucursal",e.jsx(As,{className:"ml-2 h-3 w-3 opacity-50"})]})}),e.jsx(Ne,{className:"text-center cursor-pointer hidden md:table-cell",onClick:()=>b("deploymentDate"),children:"Fecha Inicio"}),e.jsx(Ne,{className:"text-center hidden lg:table-cell",children:"Vuelta"}),e.jsx(Ne,{className:"text-center hidden lg:table-cell",children:"Obj. Mensual"}),e.jsx(Ne,{className:"text-center cursor-pointer",onClick:()=>b("progress"),children:e.jsxs("div",{className:"flex items-center justify-center font-semibold text-foreground",children:["% Avance",e.jsx(As,{className:"ml-2 h-3 w-3 opacity-50"})]})}),e.jsx(Ne,{className:"text-center hidden md:table-cell",children:"Un. Inventario"}),e.jsx(Ne,{className:"text-center cursor-pointer hidden md:table-cell",onClick:()=>b("differenceUnits"),children:"Diferencia"}),e.jsx(Ne,{className:"text-right cursor-pointer",onClick:()=>b("adjustmentsValue"),children:"$ Ajustes"}),e.jsx(Ne,{className:"text-center w-[120px]",children:"Status"})]})}),e.jsx(Kr,{children:d?Array.from({length:5}).map((j,S)=>e.jsxs(qt,{children:[e.jsx(F,{children:e.jsx("div",{className:"h-5 w-32 bg-muted rounded animate-pulse"})}),e.jsx(F,{className:"hidden md:table-cell",children:e.jsx("div",{className:"h-5 w-20 bg-muted rounded animate-pulse mx-auto"})}),e.jsx(F,{className:"hidden lg:table-cell",children:e.jsx("div",{className:"h-5 w-10 bg-muted rounded animate-pulse mx-auto"})}),e.jsx(F,{className:"hidden lg:table-cell",children:e.jsx("div",{className:"h-5 w-12 bg-muted rounded animate-pulse mx-auto"})}),e.jsx(F,{children:e.jsx("div",{className:"h-5 w-16 bg-muted rounded animate-pulse mx-auto"})}),e.jsx(F,{className:"hidden md:table-cell",children:e.jsx("div",{className:"h-5 w-16 bg-muted rounded animate-pulse mx-auto"})}),e.jsx(F,{className:"hidden md:table-cell",children:e.jsx("div",{className:"h-5 w-16 bg-muted rounded animate-pulse mx-auto"})}),e.jsx(F,{className:"text-right",children:e.jsx("div",{className:"h-5 w-24 bg-muted rounded animate-pulse ml-auto"})}),e.jsx(F,{children:e.jsx("div",{className:"h-6 w-20 bg-muted rounded-full animate-pulse mx-auto"})})]},S)):g.length>0?g.map((j,S)=>e.jsxs(L.tr,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:S*.05},onClick:()=>w(j.branchName),className:O("group cursor-pointer hover:bg-muted/50 transition-all border-b last:border-0",C(j.branchName)&&"bg-primary/5 hover:bg-primary/10 border-l-4 border-l-primary"),children:[e.jsxs(F,{className:"font-medium text-foreground relative",children:[C(j.branchName)&&e.jsx(L.div,{layoutId:"active-indicator",className:"absolute left-0 top-0 bottom-0 w-1 bg-primary"}),j.branchName]}),e.jsx(F,{className:"text-center text-muted-foreground text-sm hidden md:table-cell",children:j.deploymentDate}),e.jsxs(F,{className:"text-center text-muted-foreground text-sm hidden lg:table-cell",children:[j.cyclicRound,""]}),e.jsx(F,{className:"text-center text-muted-foreground text-sm hidden lg:table-cell",children:j.monthlyGoal}),e.jsx(F,{className:"text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("span",{className:O("font-bold text-sm",j.progress>=j.monthlyGoal?"text-green-600":"text-foreground"),children:[j.progress,"%"]}),e.jsx("div",{className:"w-16 h-1.5 bg-muted rounded-full overflow-hidden mt-1",children:e.jsx("div",{className:O("h-full rounded-full transition-all",j.progress>=100?"bg-green-500":"bg-primary"),style:{width:`${Math.min(j.progress,100)}%`}})})]})}),e.jsx(F,{className:"text-center font-mono text-sm hidden md:table-cell",children:j.inventoryUnits}),e.jsx(F,{className:"text-center font-mono text-sm hidden md:table-cell",children:e.jsxs("span",{className:j.differenceUnits===0?"text-muted-foreground":j.differenceUnits>0?"text-green-600":"text-red-600",children:[j.differenceUnits>0?"+":"",j.differenceUnits]})}),e.jsx(F,{className:"text-right font-mono text-sm",children:e.jsx("span",{className:j.adjustmentsValue===0?"text-muted-foreground":j.adjustmentsValue>0?"text-green-600":"text-red-600",children:y(j.adjustmentsValue)})}),e.jsx(F,{className:"text-center",children:j.status==="controlado"?e.jsxs(se,{variant:"outline",className:"font-normal border bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30",children:[e.jsx(ur,{className:"w-3 h-3 mr-1"})," FINALIZADA"]}):j.status==="por_controlar"?e.jsxs(se,{variant:"outline",className:"font-normal border bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30",children:[e.jsx(qe,{className:"w-3 h-3 mr-1"})," EN PROCESO"]}):e.jsxs(se,{variant:"outline",className:"font-normal border bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30",children:[e.jsx(pt,{className:"w-3 h-3 mr-1"})," PENDIENTE"]})})]},j.branchName)):e.jsx(qt,{children:e.jsx(F,{colSpan:9,className:"h-24 text-center text-muted-foreground",children:"No se encontraron sucursales con esa bsqueda."})})})]})}),N.length>Zs&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>u(!c),className:"text-muted-foreground hover:text-foreground",children:c?"Mostrar menos":`Ver todas las sucursales (${N.length})`})})]})})}function Ti({completedCount:t,totalCount:s}){const n=s>0?Math.round(t/s*100):0,r=()=>n>=80?"text-success":n>=50?"text-warning":"text-destructive";return e.jsxs(B,{className:"h-full flex flex-col justify-between",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(H,{className:"text-sm font-medium",children:"Progreso"}),e.jsx(Le,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(G,{children:[e.jsxs("div",{className:`text-xl font-bold ${r()}`,children:[n,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t," de ",s," completados"]}),e.jsx(fn,{value:n,className:"mt-2"})]})]})}function zi({criticalCount:t,outOfStockCount:s}){const n=t>0||s>0;return e.jsxs(B,{className:"h-full flex flex-col justify-between",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(H,{className:"text-sm font-medium",children:"Crticos"}),e.jsx(rs,{className:`h-4 w-4 ${n?"text-destructive":"text-muted-foreground"}`})]}),e.jsxs(G,{children:[e.jsx("div",{className:`text-xl font-bold ${n?"text-destructive":"text-foreground"}`,children:t}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Productos con stock bajo"}),s>0&&e.jsxs(se,{variant:"destructive",className:"mt-2",children:[s," agotados"]})]})]})}function Pi({totalValue:t,changePercentage:s}){const n=s!==void 0&&s>=0;return e.jsxs(B,{className:"h-full flex flex-col justify-between",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(H,{className:"text-sm font-medium text-muted-foreground",children:"Valor Total"}),e.jsx(ct,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(G,{children:[e.jsxs("div",{className:"text-xl font-bold",children:["$",e.jsx(xn,{value:t})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Valor de inventario"}),s!==void 0&&e.jsxs("div",{className:`flex items-center gap-1 mt-2 text-xs ${n?"text-success":"text-destructive"}`,children:[n?e.jsx(Le,{className:"h-3 w-3"}):e.jsx(is,{className:"h-3 w-3"}),e.jsxs("span",{children:[Math.abs(s).toFixed(1),"% vs mes anterior"]})]})]})]})}function Oi({activeCount:t,activeBranches:s}){return e.jsxs(B,{className:"h-full flex flex-col justify-between",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(H,{className:"text-sm font-medium",children:"Activos"}),e.jsxs("div",{className:"relative",children:[e.jsx(un,{className:"h-4 w-4 text-muted-foreground"}),t>0&&e.jsx("span",{className:"absolute -top-1 -right-1 h-2 w-2 bg-success rounded-full animate-pulse"})]})]}),e.jsxs(G,{children:[e.jsx("div",{className:"text-xl font-bold",children:t}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Usuarios trabajando"}),s.length>0&&e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[s.slice(0,2).map((n,r)=>e.jsx(se,{variant:"secondary",className:"text-xs",children:n},r)),s.length>2&&e.jsxs(se,{variant:"secondary",className:"text-xs",children:["+",s.length-2]})]})]})]})}function Li({pendingCount:t,urgentCount:s}){return e.jsxs(B,{className:"h-full flex flex-col justify-between",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(H,{className:"text-sm font-medium",children:"Pendientes"}),e.jsx(qe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(G,{children:[e.jsx("div",{className:`text-xl font-bold ${t>0?"text-warning":"text-foreground"}`,children:t}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Inventarios sin completar"}),s>0&&e.jsxs(se,{variant:"destructive",className:"mt-2",children:[s," urgentes"]})]})]})}function Bi({data:t=[]}){const[s,n]=i.useState("7d"),r=[{date:"01/12",negative:-1200,positive:800},{date:"02/12",negative:-950,positive:1100},{date:"03/12",negative:-1500,positive:900},{date:"04/12",negative:-800,positive:1300},{date:"05/12",negative:-1100,positive:950},{date:"06/12",negative:-900,positive:1200},{date:"07/12",negative:-1300,positive:1e3}],a=t.length>0?t:r;return e.jsxs(B,{className:"h-full",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsx(H,{className:"text-lg font-semibold",children:"Tendencias"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:s==="7d"?"default":"outline",size:"sm",onClick:()=>n("7d"),children:"7 das"}),e.jsx(A,{variant:s==="30d"?"default":"outline",size:"sm",onClick:()=>n("30d"),children:"30 das"})]})]}),e.jsx(G,{children:e.jsx(pn,{width:"100%",height:200,children:e.jsxs(Zr,{data:a,children:[e.jsx(Jr,{strokeDasharray:"3 3"}),e.jsx(Qr,{dataKey:"date",fontSize:12}),e.jsx(ea,{fontSize:12}),e.jsx(gn,{}),e.jsx(ta,{}),e.jsx(Rs,{type:"monotone",dataKey:"negative",stroke:"hsl(var(--destructive))",name:"Negativo",strokeWidth:2}),e.jsx(Rs,{type:"monotone",dataKey:"positive",stroke:"hsl(var(--success))",name:"Positivo",strokeWidth:2})]})})})]})}function Ui({products:t=[]}){const s=[{name:"Ibuprofeno 600mg",ean:"7798140250685",difference:-45,value:-2250,type:"negative"},{name:"Paracetamol 500mg",ean:"7798140250692",difference:32,value:1600,type:"positive"},{name:"Amoxicilina 500mg",ean:"7798140250708",difference:-28,value:-1680,type:"negative"},{name:"Omeprazol 20mg",ean:"7798140250715",difference:25,value:1500,type:"positive"},{name:"Losartn 50mg",ean:"7798140250722",difference:-20,value:-1200,type:"negative"}],n=t.length>0?t:s;return e.jsxs(B,{className:"h-full",children:[e.jsxs(_,{className:"pb-3",children:[e.jsx(H,{className:"text-lg font-semibold",children:"Top Diferencias"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Productos con mayores discrepancias"})]}),e.jsx(G,{children:e.jsx("div",{className:"space-y-3",children:n.map((r,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-medium",children:r.name}),e.jsx(se,{variant:r.type==="negative"?"destructive":"default",className:"text-xs",children:r.type==="negative"?"Faltante":"Sobrante"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["EAN: ",r.ean]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`flex items-center gap-1 ${r.type==="negative"?"text-destructive":"text-success"}`,children:[r.type==="negative"?e.jsx(is,{className:"h-3 w-3"}):e.jsx(Le,{className:"h-3 w-3"}),e.jsx("span",{className:"text-sm font-semibold",children:Math.abs(r.difference)})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",Math.abs(r.value)]})]}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(aa,{className:"h-4 w-4"})})]})]},a))})})]})}function $i({activities:t=[]}){const s=[{id:"1",type:"completed",title:"Inventario Farmacia completado",branch:"Belgrano IV",timestamp:"Hace 5 minutos",user:"Juan Prez"},{id:"2",type:"adjusted",title:"Ajustes realizados en Perfumera",branch:"Recoleta",timestamp:"Hace 15 minutos",user:"Mara Gonzlez"},{id:"3",type:"imported",title:"Inventario importado",branch:"Palermo II",timestamp:"Hace 1 hora",user:"Carlos Rodrguez"},{id:"4",type:"completed",title:"Pre-conteo finalizado",branch:"Microcentro",timestamp:"Hace 2 horas",user:"Ana Martnez"}],n=t.length>0?t:s,r=o=>{switch(o){case"completed":return e.jsx(lt,{className:"h-4 w-4 text-success"});case"adjusted":return e.jsx(ba,{className:"h-4 w-4 text-warning"});case"imported":return e.jsx(cn,{className:"h-4 w-4 text-primary"})}},a=o=>{switch(o){case"completed":return"Completado";case"adjusted":return"Ajustado";case"imported":return"Importado"}};return e.jsxs(B,{className:"h-full",children:[e.jsxs(_,{className:"pb-3",children:[e.jsx(H,{className:"text-lg font-semibold",children:"Actividad Reciente"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"ltimas acciones realizadas"})]}),e.jsx(G,{children:e.jsx("div",{className:"space-y-4",children:n.map((o,l)=>e.jsxs("div",{className:"relative",children:[l<n.length-1&&e.jsx("div",{className:"absolute left-2 top-8 bottom-0 w-px bg-border"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"relative z-10 mt-1 rounded-full bg-background p-1 border",children:r(o.type)}),e.jsxs("div",{className:"flex-1 pb-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:o.title}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[o.branch,"  ",o.user]})]}),e.jsx(se,{variant:"secondary",className:"text-xs",children:a(o.type)})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-muted-foreground",children:[e.jsx(qe,{className:"h-3 w-3"}),e.jsx("span",{children:o.timestamp})]})]})]})]},o.id))})})]})}const Ce=["hsl(var(--chart-1))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))"];function Wi({data:t=[]}){const s=[{name:"Farmacia",value:450,color:Ce[0]},{name:"Perfumera",value:280,color:Ce[1]},{name:"Higiene",value:180,color:Ce[2]},{name:"Bebs",value:120,color:Ce[3]},{name:"Otros",value:90,color:Ce[4]}],n=t.length>0?t:s,r=n.reduce((a,o)=>a+o.value,0);return e.jsxs(B,{className:"h-full",children:[e.jsxs(_,{className:"pb-3",children:[e.jsx(H,{className:"text-lg font-semibold",children:"Distribucin por Categora"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Productos por categora"})]}),e.jsxs(G,{children:[e.jsx(pn,{width:"100%",height:200,children:e.jsxs(sa,{children:[e.jsx(na,{data:n,cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:o})=>`${a} ${(o*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:n.map((a,o)=>e.jsx(ra,{fill:a.color||Ce[o%Ce.length]},`cell-${o}`))}),e.jsx(gn,{})]})}),e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2",children:n.map((a,o)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:a.color||Ce[o%Ce.length]}}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[a.name,": ",a.value," (",(a.value/r*100).toFixed(1),"%)"]})]},o))})]})]})}function Fi({goals:t=[]}){const s=[{title:"Inventarios Completados",current:45,target:60,badge:"75%"},{title:"Productos Controlados",current:1250,target:1500,badge:"83%"},{title:"Diferencias Resueltas",current:28,target:35,badge:"80%"}],n=t.length>0?t:s;return e.jsxs(B,{className:"h-full",children:[e.jsx(_,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(H,{className:"text-lg font-semibold",children:"Objetivos del Mes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Progreso hacia metas"})]}),e.jsx(mn,{className:"h-5 w-5 text-primary"})]})}),e.jsx(G,{children:e.jsx("div",{className:"space-y-4",children:n.map((r,a)=>{const o=Math.round(r.current/r.target*100),l=o>=100;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:r.title}),l&&e.jsx(oa,{className:"h-4 w-4 text-success"})]}),e.jsxs(se,{variant:l?"default":"secondary",children:[r.current,"/",r.target]})]}),e.jsx(fn,{value:o,className:"h-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[o,"% completado"]})]},a)})})})]})}function Vi({isOnline:t=!0,pendingCount:s=0,lastSync:n="Hace 5 minutos",onSync:r}){return e.jsxs(B,{className:"h-full",children:[e.jsx(_,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(H,{className:"text-lg font-semibold",children:"Sincronizacin"}),t?e.jsx(hn,{className:"h-5 w-5 text-success"}):e.jsx(mr,{className:"h-5 w-5 text-destructive"})]})}),e.jsxs(G,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Estado de Conexin"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t?"Conectado":"Sin conexin"})]}),e.jsx(se,{variant:t?"default":"destructive",children:t?"Online":"Offline"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Datos Pendientes"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s>0?`${s} elementos`:"Todo sincronizado"})]}),s>0?e.jsx(se,{variant:"warning",children:s}):e.jsx(lt,{className:"h-5 w-5 text-success"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(qe,{className:"h-3 w-3"}),e.jsxs("span",{children:["ltima sincronizacin: ",n]})]}),e.jsxs(A,{className:"w-full",variant:s>0?"default":"outline",onClick:r,disabled:!t,children:[e.jsx(dn,{className:"h-4 w-4 mr-2"}),s>0?"Sincronizar Ahora":"Actualizar"]})]})]})}function _i({actions:t=[]}){const s=[{title:"Nuevo Pre-Conteo",description:"Iniciar nuevo pre-conteo",icon:Oe,onClick:()=>console.log("Nuevo Pre-Conteo"),variant:"default"},{title:"Importar Inventario",description:"Cargar desde Excel",icon:cn,onClick:()=>console.log("Importar"),variant:"outline"},{title:"Ver Reportes",description:"Anlisis y estadsticas",icon:Pt,onClick:()=>console.log("Reportes"),variant:"outline"},{title:"Exportar Datos",description:"Descargar informacin",icon:hr,onClick:()=>console.log("Exportar"),variant:"outline"},{title:"Configuracin",description:"Ajustes del sistema",icon:fr,onClick:()=>console.log("Configuracin"),variant:"secondary"}],n=t.length>0?t:s;return e.jsxs(B,{className:"h-full",children:[e.jsxs(_,{className:"pb-3",children:[e.jsx(H,{className:"text-lg font-semibold",children:"Acciones Rpidas"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tareas frecuentes"})]}),e.jsx(G,{children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:n.map((r,a)=>{const o=r.icon;return e.jsxs(A,{variant:r.variant||"outline",className:"h-auto flex-col items-start p-4 gap-2",onClick:r.onClick,children:[e.jsx(o,{className:"h-5 w-5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-medium",children:r.title}),e.jsx("p",{className:"text-xs text-muted-foreground font-normal",children:r.description})]})]},a)})})})]})}function Hi({assignedDays:t=0,startDate:s,totalProgress:n=0,isEditable:r=!1,onEdit:a}){const o=i.useMemo(()=>{if(!s||t===0)return{daysRemaining:0,daysElapsed:0,timeProgress:0,status:"pending",expectedProgress:0,isDelayed:!1,segments:[0,0,0]};const m=new Date(s),d=new Date().getTime()-m.getTime(),p=Math.max(0,Math.floor(d/(1e3*60*60*24))),h=Math.max(0,t-p),v=Math.min(100,p/t*100),x=Math.round(v),N=n<x-5,b=n>x+15;let g="on-track";N?g="behind":b&&(g="ahead");const y=3,w=100/y,C=Array.from({length:y}).map((j,S)=>{const k=(S+1)*w;return n>=k?100:n<=S*w?0:(n-S*w)/w*100});return{daysRemaining:h,daysElapsed:p,timeProgress:v,status:g,expectedProgress:x,isDelayed:N,segments:C}},[s,t,n]),l=()=>t===0?"text-muted-foreground":o.status==="behind"?"text-destructive":o.status==="ahead"?"text-blue-500":"text-green-500",c=()=>t===0?"Sin configurar":o.status==="behind"?"Retrasado":o.status==="ahead"?"Adelantado":"Al da",u=()=>t===0?e.jsx(ja,{className:"h-4 w-4"}):o.status==="behind"?e.jsx(pt,{className:"h-4 w-4"}):o.status==="ahead"?e.jsx(lt,{className:"h-4 w-4"}):e.jsx(lt,{className:"h-4 w-4"});return e.jsxs(B,{className:"h-full flex flex-col overflow-hidden relative group/card border-border/50 bg-card/50 backdrop-blur-sm",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 px-5 pt-4 pb-2",children:[e.jsx(H,{className:"text-sm font-semibold tracking-tight",children:"Plazo de Inventario"}),e.jsxs("div",{className:"flex items-center gap-2",children:[r&&e.jsx("button",{onPointerDown:m=>m.stopPropagation(),onClick:m=>{m.stopPropagation(),a==null||a()},className:"relative z-50 text-muted-foreground hover:text-primary transition-colors opacity-0 group-hover/card:opacity-100 cursor-pointer",title:"Configurar plazo",children:e.jsx(ut,{className:"h-4 w-4"})}),!r&&e.jsx(ut,{className:"h-4 w-4 text-muted-foreground"})]})]}),e.jsxs(G,{className:"flex flex-col justify-between flex-1 px-5 pb-5 pt-1 gap-4",children:[e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground font-bold uppercase tracking-widest mb-0.5",children:"Asignados"}),e.jsx("span",{className:"text-3xl font-black tracking-tighter text-foreground leading-none",children:t>0?t:"--"})]}),e.jsx("div",{className:"h-10 w-px bg-border/40 mx-2"}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground font-bold uppercase tracking-widest mb-0.5",children:"Restantes"}),e.jsx("span",{className:O("text-3xl font-black tracking-tighter leading-none",o.daysRemaining<7&&t>0?"text-destructive":"text-foreground"),children:t>0?o.daysRemaining:"--"})]})]}),e.jsxs("div",{className:"bg-muted/30 rounded-xl p-3 border border-border/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"flex items-center gap-1.5",children:e.jsxs("span",{className:O("flex items-center gap-1 text-[10px] font-bold uppercase tracking-wider",l()),children:[u(),c()]})}),e.jsxs("span",{className:"text-xs font-bold",children:[n,"% ",e.jsx("span",{className:"text-[10px] font-normal text-muted-foreground ml-1",children:"real"})]})]}),e.jsxs("div",{className:"h-1.5 w-full bg-muted/50 rounded-full overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-foreground/20 z-10",style:{left:`${o.expectedProgress}%`}}),e.jsx("div",{className:O("h-full transition-all duration-700 rounded-full",o.status==="behind"?"bg-destructive":"bg-primary"),style:{width:`${n}%`}})]}),e.jsxs("div",{className:"flex justify-between mt-1 text-[9px] text-muted-foreground font-medium uppercase tracking-tighter",children:[e.jsx("span",{children:"Inicio"}),e.jsx("span",{style:{marginLeft:`${o.expectedProgress-5}%`},children:"Objetivo Hoy"}),e.jsx("span",{children:"Meta"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("span",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-wider block",children:"Avance por Periodos"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:o.segments.map((m,f)=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"h-1 w-full bg-muted/50 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-foreground/40 transition-all duration-1000",style:{width:`${m}%`}})}),e.jsxs("div",{className:"text-[9px] text-center font-bold text-muted-foreground/70",children:["M",f+1,": ",Math.round(m),"%"]})]},f))})]})]})]})}function Gi(){const{user:t}=ve(),[s,n]=i.useState([]),[r,a]=i.useState(!0),[o,l]=i.useState(null);i.useEffect(()=>{(async()=>{if(!(t!=null&&t.branchSheet)){a(!1);return}try{const m=await gr(t.branchSheet),f=await Se.getAllCyclicInventories(t.branchSheet)||[],d=new Map(f.map(g=>[g.labName,g.status])),p=await Se.getBranchConfig(t.branchSheet);let h=0;if(p.startDate){const g=new Date(p.startDate),w=Math.abs(new Date().getTime()-g.getTime());h=Math.ceil(w/864e5)}const v=async(g,y,w)=>{if(h>=y){const C=await Se.getCycleClosures(t.branchSheet,g);if(!(Object.keys(C).length>0)){console.log(`Auto-closing Period ${g} (Day ${y} reached)`);const S=Object.entries(w).map(([k,E])=>({name:k,percentage:E.total>0?Math.round(E.controlled/E.total*100):0}));return await Se.saveCycleClosure(t.branchSheet,g,S),te.success(`Cierre automtico del Periodo ${g} completado.`),!0}}return!1},x={Medicamentos:{total:0,controlled:0},Perfumera:{total:0,controlled:0},Accesorios:{total:0,controlled:0},Varios:{total:0,controlled:0}};m.forEach(g=>{let y="Varios";const w=(g.category||"").toUpperCase();w==="MEDICAMENTOS"?y="Medicamentos":w==="PERFUMERIA"?y="Perfumera":w==="ACCESORIOS"&&(y="Accesorios");const j=d.get(g.name)==="controlado";x[y].total+=1,j&&(x[y].controlled+=1)}),await v(1,30,x),await v(2,60,x);const N=await Se.getCycleClosures(t.branchSheet||"",1),b=Object.entries(x).map(([g,y])=>{const w=y.total>0?Math.round(y.controlled/y.total*100):0,C=N[g.toUpperCase()]||0;return{name:g,totalItems:y.total,controlledItems:y.controlled,percentage:w,previousPercentage:Math.min(C,w)}});n(b)}catch(m){console.error("Error loading category progress:",m)}finally{a(!1)}})()},[t]);const c=i.useMemo(()=>{if(o)return s.find(d=>d.name===o)||null;const u=s.reduce((d,p)=>d+p.totalItems,0),m=s.reduce((d,p)=>d+p.controlledItems,0);return{name:"Avance Global",percentage:u>0?Math.round(m/u*100):0,totalItems:u,controlledItems:m}},[s,o]);return r?e.jsx(B,{className:"h-full border-none shadow-none flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs(B,{className:"h-full flex flex-col border-border/50 bg-card/50 backdrop-blur-sm overflow-hidden",children:[e.jsxs(_,{className:"pb-0 pt-4 px-5 flex flex-row items-center justify-between space-y-0 text-foreground",children:[e.jsx(H,{className:"text-xl font-medium tracking-tight",children:o?`Rubro: ${o}`:"Progreso de Inventario"}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("button",{onClick:()=>l(null),className:"h-8 w-8 rounded-full bg-muted/50 flex items-center justify-center hover:bg-muted transition-colors",title:"Ver Avance Global",children:e.jsx(xr,{className:O("h-4 w-4 transition-transform",!o&&"rotate-180")})})})]}),e.jsxs(G,{className:"flex-1 p-5 pt-4 flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx(Bt,{mode:"wait",children:e.jsxs(L.span,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"text-6xl font-bold tracking-tighter",children:[c==null?void 0:c.percentage,"%"]},c==null?void 0:c.percentage)})}),e.jsx("p",{className:"text-sm text-muted-foreground font-medium mt-1",children:o?`Avance en ${o}`:"Avance total acumulado"})]}),e.jsx("div",{className:"flex-1 flex flex-col justify-end",children:e.jsx("div",{className:"flex items-end justify-between gap-3 h-48 mb-2 px-1",children:s.map(u=>{const m=o===u.name,f=u.previousPercentage>0,d=Math.max(...s.map(h=>h.totalItems)),p=d>0?Math.max(20,u.totalItems/d*100):20;return e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-2 group cursor-pointer h-full justify-end",onClick:()=>l(o===u.name?null:u.name),children:[e.jsx("span",{className:O("text-[10px] font-bold transition-colors mb-1",m?"text-primary":"text-muted-foreground/70"),children:u.totalItems}),e.jsxs(L.div,{className:O("w-full rounded-2xl overflow-hidden flex flex-col justify-end relative transition-all duration-300 bg-secondary dark:bg-muted/20",m?"ring-2 ring-primary ring-offset-2 ring-offset-background":"hover:bg-secondary/80 dark:hover:bg-muted/30"),initial:{height:0},animate:{height:`${p}%`},transition:{type:"spring",stiffness:300,damping:30},children:[e.jsxs("div",{className:"absolute -top-10 left-1/2 -translate-x-1/2 bg-foreground text-background text-[10px] font-bold px-2 py-1 rounded-md opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-20 shadow-lg pointer-events-none",children:[u.percentage,"% (",u.controlledItems,"/",u.totalItems,")"]}),e.jsx(L.div,{className:O("w-full absolute bottom-0 left-0 right-0 z-10 transition-colors duration-300",m?"bg-primary":"bg-muted-foreground/40 group-hover:bg-muted-foreground/50"),initial:{height:0},animate:{height:`${u.percentage}%`},transition:{duration:.5,delay:.1}}),f&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-20 opacity-30 pointer-events-none",style:{height:`${u.previousPercentage}%`,backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 4px, currentColor 4px, currentColor 8px)",color:m?"white":"inherit"}}),u.percentage>0&&e.jsx(L.div,{className:"absolute left-1/2 -translate-x-1/2 w-1.5 h-1.5 bg-white rounded-full z-30 shadow-sm",style:{bottom:`calc(${u.percentage}% - 3px)`}})]}),e.jsx("span",{className:O("text-[10px] font-bold uppercase tracking-wider transition-colors",m?"text-foreground":"text-muted-foreground"),children:u.name.substring(0,3)})]},u.name)})})}),e.jsxs("div",{className:"pt-2 border-t border-border/40 flex justify-between items-center h-10",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-widest leading-none",children:"Hechos"}),e.jsx("span",{className:"text-sm font-bold",children:c==null?void 0:c.controlledItems})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-widest leading-none",children:"Pendientes"}),e.jsx("span",{className:"text-sm font-bold",children:((c==null?void 0:c.totalItems)||0)-((c==null?void 0:c.controlledItems)||0)})]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-medium text-muted-foreground bg-muted/30 px-2 py-1 rounded-full border border-border/50",children:[e.jsx(pr,{className:"h-3 w-3"}),"Refresca cada 30 min"]})]})]})]})}function qi(){const{user:t}=ve(),[s,n]=i.useState(new Date),[r,a]=i.useState([]),[o,l]=i.useState(!1),[c,u]=i.useState(""),[m,f]=i.useState(""),[d,p]=i.useState(""),[h,v]=i.useState(new Date().toISOString().slice(0,10));i.useEffect(()=>{x()},[t==null?void 0:t.branchName]);const x=async()=>{try{const y=(await ze.getEvents()).map(w=>({id:w.id,title:w.title,branch:w.branch_name||w.branchId||"General",sector:w.sector||w.description||"",date:w.date.split("T")[0]}));a(y)}catch(g){console.error("Error loading events:",g)}},N=async()=>{if(!c||!m||!d||!h){te.error("Error","Por favor completa todos los campos");return}try{await ze.addEvent({title:c,branch_name:m,sector:d,date:h}),te.success("Operacin exitosa","Evento agregado"),l(!1),u(""),f(""),p(""),v(new Date().toISOString().slice(0,10)),x()}catch{te.error("Error","Error al crear evento")}},b=g=>{const y=g.toISOString().split("T")[0];return r.filter(w=>w.date===y)};return e.jsxs(B,{className:"h-full flex flex-col",children:[e.jsx(_,{className:"pb-2",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ut,{className:"w-5 h-5 text-primary"}),e.jsx(H,{children:"Calendario"})]})})}),e.jsx(G,{className:"flex-1 p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 h-full",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Fn,{selected:s,onSelect:n,events:r})}),e.jsxs("div",{className:"w-full md:w-80 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold capitalize",children:s.toLocaleDateString("es-AR",{weekday:"long",day:"numeric",month:"long"})}),e.jsx(A,{size:"sm",variant:o?"ghost":"outline",onClick:()=>l(!o),children:o?"Cancelar":e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4 mr-1"})," Evento"]})})]}),o?e.jsxs("div",{className:"p-3 bg-muted/50 border rounded-md space-y-3 mb-4 animate-in slide-in-from-top-2",children:[e.jsx(ie,{placeholder:"Ttulo",value:c,onChange:g=>u(g.target.value),className:"bg-background h-8"}),e.jsx(ie,{placeholder:"Sucursal",value:m,onChange:g=>f(g.target.value),className:"bg-background h-8"}),e.jsx(ie,{placeholder:"Sector",value:d,onChange:g=>p(g.target.value),className:"bg-background h-8"}),e.jsx(ie,{type:"date",value:h,onChange:g=>v(g.target.value),className:"bg-background h-8"}),e.jsx(A,{size:"sm",className:"w-full",onClick:N,children:"Guardar Evento"})]}):e.jsx("div",{className:"flex-1 overflow-auto space-y-2 pr-1",children:b(s).length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-20 text-muted-foreground text-sm border-2 border-dashed rounded-lg",children:"No hay eventos"}):b(s).map(g=>e.jsxs("div",{className:"p-3 bg-muted/50 hover:bg-muted border rounded-md transition-colors text-sm",children:[e.jsx("p",{className:"font-medium text-foreground",children:g.title}),e.jsxs("div",{className:"flex justify-between mt-1 text-xs text-muted-foreground",children:[e.jsx("span",{children:g.branch}),e.jsx("span",{children:g.sector})]})]},g.id))})]})]})})]})}const Yi=i.memo(({widgetType:t,user:s,metrics:n,globalProgress:r,assignedDays:a,cycleStartDate:o,onDateClick:l,onEditConfig:c})=>{switch(t){case"smart-analyst":return e.jsx(Ni,{});case"metrics-carousel":return e.jsx(Ci,{metrics:n});case"active-products":return e.jsx(Si,{activeProducts:n.activeProducts});case"inventory-summary":return e.jsx(Di,{});case"inventory-alerts":return e.jsx(Ii,{});case"upcoming-inventories":return e.jsx(Mi,{onDateClick:l});case"branches-table":return dt(s,"VIEW_BRANCH_MONITOR")?e.jsx(Ri,{branches:[{name:"Belgrano IV",address:"Av. Cabildo 2040",zonal:"Zona Norte",email:"belgrano4@farmaplus.com"},{name:"Recoleta",address:"Av. Santa Fe 1860",zonal:"Zona Centro",email:"recoleta@farmaplus.com"},{name:"Palermo II",address:"Av. Las Heras 3520",zonal:"Zona Norte",email:"palermo2@farmaplus.com"},{name:"Microcentro",address:"Florida 520",zonal:"Zona Centro",email:"microcentro@farmaplus.com"},{name:"Belgrano III",address:"Av. Cabildo 1520",zonal:"Zona Norte",email:"belgrano3@farmaplus.com"},{name:"Villa Urquiza II",address:"Av. Triunvirato 4280",zonal:"Zona Norte",email:"villaurquiza2@farmaplus.com"}]}):null;case"inventory-progress":return e.jsx(Ti,{completedCount:r,totalCount:100});case"critical-products":return e.jsx(zi,{criticalCount:15,outOfStockCount:3});case"total-stock-value":return e.jsx(Pi,{totalValue:n.totalStock,changePercentage:5.2});case"active-users":return e.jsx(Oi,{activeCount:5,activeBranches:["Belgrano IV","Recoleta","Palermo II"]});case"pending-inventories":return e.jsx(Li,{pendingCount:7,urgentCount:2});case"trends-chart":return e.jsx(Bi,{});case"top-products":return e.jsx(Ui,{});case"activity-timeline":return e.jsx($i,{});case"category-distribution":return e.jsx(Wi,{});case"monthly-goals":return e.jsx(Fi,{});case"sync-status":return e.jsx(Vi,{isOnline:navigator.onLine,pendingCount:0});case"quick-actions":return e.jsx(_i,{});case"calendar":return e.jsx(qi,{});case"countdown":return e.jsx(Hi,{assignedDays:a,startDate:o,totalProgress:r,isEditable:dt(s,"MANAGE_INVENTORY_CONFIG"),onEdit:c});case"category-progress":return e.jsx(Gi,{});default:return null}});class Xi extends i.Component{constructor(){super(...arguments);Es(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,r){console.error("Uncaught error in widget:",n,r)}render(){var n;return this.state.hasError?e.jsxs("div",{className:"h-full w-full flex flex-col items-center justify-center p-4 bg-destructive/5 text-center space-y-3 rounded-lg border border-destructive/20",children:[e.jsx(pt,{className:"w-8 h-8 text-destructive opacity-80"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-medium text-destructive",children:"Error en el widget"}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 max-w-[200px]",children:((n=this.state.error)==null?void 0:n.message)||"Algo sali mal"})]}),e.jsxs(A,{variant:"outline",size:"sm",className:"h-8 text-xs gap-2",onClick:()=>this.setState({hasError:!1}),children:[e.jsx(dn,{className:"w-3 h-3"}),"Reintentar"]})]}):this.props.children}}function Ki({open:t,onOpenChange:s,user:n,currentAssignedDays:r,currentStartDate:a,onSave:o}){const[l,c]=i.useState(""),[u,m]=i.useState(90),[f,d]=i.useState(0),[p,h]=i.useState(new Date().toISOString().split("T")[0]);i.useEffect(()=>{if(t){const x=r||90,b=[180,150,120,90].find(g=>g<=x)||90;c((n==null?void 0:n.branchName)||""),m(b),d(Math.max(0,x-b)),h(a?a.split("T")[0]:new Date().toISOString().split("T")[0])}},[t,r,a,n]);const v=async()=>{if(!(n!=null&&n.branchName))return;const x=u+f;try{await o(n.branchName,x,p),te.success("Operacin exitosa",`Plazo actualizado a ${x} das`),s(!1)}catch{te.error("Error","Error al guardar")}};return e.jsx(Ot,{open:t,onOpenChange:s,children:e.jsxs(Lt,{className:"max-w-md",children:[e.jsxs(as,{children:[e.jsx(os,{children:"Configurar Plazo de Inventario"}),e.jsx(on,{children:"Ajusta los parmetros del ciclo de inventario para esta sucursal."})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Te,{className:"text-muted-foreground",children:"Sucursal Seleccionada"}),e.jsx("div",{className:"text-lg font-semibold border p-3 rounded-md bg-muted/50",children:(n==null?void 0:n.branchName)||"Sin sucursal asignada"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Te,{children:"Das Base"}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:[90,120,150,180].map(x=>e.jsx("button",{onClick:()=>m(x),className:O("flex flex-col items-center justify-center p-3 rounded-lg border-2 transition-all",u===x?"border-primary bg-primary/10 text-primary font-bold":"border-muted hover:border-primary/50 text-muted-foreground"),children:e.jsx("span",{className:"text-xl",children:x})},x))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Te,{children:"Prroga (Das adicionales)"}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx(ie,{type:"number",placeholder:"0",className:"text-lg font-medium",value:f,onChange:x=>d(Number(x.target.value)),min:0}),e.jsxs("div",{className:"text-sm text-muted-foreground text-nowrap",children:["Total: ",e.jsx("span",{className:"font-bold text-foreground mx-1 text-lg",children:u+f})," das"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Te,{children:"Fecha de Inicio del Ciclo"}),e.jsx(ie,{type:"date",value:p,onChange:x=>h(x.target.value),className:"bg-background"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Esta fecha se usa para calcular los das restantes y el ritmo de avance."})]}),e.jsx(A,{className:"w-full mt-2",onClick:v,children:"Guardar Configuracin"})]})]})})}const Zi={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.03}}};function Ol(){const{user:t}=ve(),{metrics:s,globalProgress:n,assignedDays:r,cycleStartDate:a,updateConfig:o,isLoading:l}=di(),{visibleWidgets:c,hiddenWidgets:u,isEditMode:m,setIsEditMode:f,reorderWidgets:d,toggleWidgetVisibility:p,updateWidgetSize:h,applyPreset:v,resetLayout:x}=ci(t==null?void 0:t.branchName),[N,b]=i.useState(!1),[g,y]=i.useState(!1),[w,C]=i.useState(!1),[j,S]=i.useState(!1),[k,E]=i.useState(void 0),R=i.useCallback(T=>{const K=T?new Date(T):new Date;K.setHours(12,0,0,0),E(K),S(!0)},[]),I=La(Os(gs,{activationConstraint:{distance:8}}),Os(xs,{coordinateGetter:ii})),U=i.useCallback(T=>{const{active:K,over:W}=T;W&&K.id!==W.id&&d(K.id,W.id)},[d]),P=i.useMemo(()=>c.filter(T=>T.type==="branches-table"?dt(t,"VIEW_BRANCH_MONITOR"):!0),[c,t]),D=i.useCallback(()=>y(!0),[]),X=i.useCallback(()=>b(!0),[]),he=i.useCallback(()=>C(!0),[]),q=i.useCallback(T=>p(T),[p]),Be=i.useCallback((T,K)=>h(T,K),[h]),ue=i.useCallback(T=>{const K=Vn.find(W=>W.id===T);K&&v(K.widgetIds)},[v]);return l?e.jsx(vr,{}):e.jsxs(L.div,{className:"pt-3 pb-6 px-6 space-y-6",variants:Zi,initial:"hidden",animate:"show",children:[e.jsx(wi,{isEditMode:m,setIsEditMode:f,onOpenPresets:D,onOpenGallery:X,onResetLayout:x,hasHiddenWidgets:u.length>0}),e.jsx($o,{sensors:I,collisionDetection:Ua,onDragEnd:U,children:e.jsx(Zo,{items:P.map(T=>T.id),strategy:bs,children:e.jsx("div",{className:"grid grid-cols-12 gap-6 auto-rows-auto",children:P.map(T=>e.jsx("div",{className:O(T.size==="small"&&"col-span-12 md:col-span-6 lg:col-span-3",T.size==="large"&&"col-span-12 md:col-span-6 lg:col-span-4",T.size==="full"&&"col-span-12"),children:e.jsx(fi,{widget:T,isEditMode:m,onRemove:()=>q(T.id),onSizeChange:K=>Be(T.id,K),children:e.jsx(Xi,{children:e.jsx(Yi,{widgetType:T.type,user:t,metrics:s,globalProgress:n,assignedDays:r,cycleStartDate:a,onDateClick:R,onEditConfig:he})})})},T.id))})})}),e.jsx(yi,{open:g,onOpenChange:y,onApplyPreset:ue}),e.jsx(pi,{open:N,onOpenChange:b,hiddenWidgets:u,onAddWidget:q}),e.jsx(Ki,{open:w,onOpenChange:C,user:t,currentAssignedDays:r,currentStartDate:a,onSave:o}),e.jsx(bi,{open:j,onOpenChange:S,initialDate:k})]})}export{Ol as default};
