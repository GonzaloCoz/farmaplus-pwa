var Xn=Object.defineProperty;var Kn=(e,s,n)=>s in e?Xn(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n;var Cs=(e,s,n)=>Kn(e,typeof s!="symbol"?s+"":s,n);import{j as t}from"./ui-vendor-CDeHCoCT.js";import{r as i,c as Y,a as Qe,u as Zn}from"./react-vendor-ylmX0jv_.js";import{c as P,C as At,a as dt,T as ts,u as xe,g as Jn,B as M,b as L,X as Zs,P as Qn,D as Js,d as Qs,e as en,f as tn,h as er,S as sn,i as Q,j as z,k as W,l as F,m as tr,n as V,o as sr,p as nr,q as rr,r as ar,s as or,t as ir,v as Ft,w as Mt,x as Rt,y as Tt,z as zt,A as ae,E as nn,F as rn,G as nt,H as lr,I as cr,J as dr,U as an,W as ur,R as on,K as mr,L as hr,M as fr,N as xr,O as pr,Q as gr}from"./index-88HeHBU_.js";import{D as rt,c as Ne}from"./cyclicInventoryService-CQDQ737-.js";import{T as Te}from"./trending-up-DAk7262J.js";import{U as ln,h as at}from"./permissions-B8fFzo_0.js";import{C as ut}from"./clock-ChbqCT-J.js";import{H as vr}from"./history-CvgmQddQ.js";import{T as cn}from"./target-DLbcoXhl.js";import{W as dn}from"./wifi-CJ81zKGK.js";import{C as St}from"./calendar-CquGndSq.js";import{auditService as br}from"./auditService-DZqFkZac.js";import{A as yr}from"./AnimatedCard-DO1OEZet.js";import{D as jr,a as wr,b as Nr,c as Cr,T as ss,A as Ss}from"./dropdown-menu-CrIn5pYW.js";import{I as Z}from"./input-BBxKqSGF.js";import{S as Sr,A as Vt}from"./AnimatedProgressBar-B1rSqfSu.js";import{P as Fe}from"./plus-B5gctVKY.js";import{s as Dr,e as kr,a as Er,b as Ir,d as Ar,f as Ds,i as Mr,g as Rr,p as Tr,h as zr,j as Pr,k as Or}from"./utils-B3_ieZWp.js";import{C as Lr}from"./chevron-left-BOfAYgOd.js";import{e as yt}from"./es-DzSx4Un2.js";import{m as B,A as ns}from"./animation-b3c-J9zS.js";import{R as Br}from"./rotate-ccw-D6LrGB4I.js";import{g as Ur}from"./expirationDB-BFyqtfL7.js";import{A as $r}from"./arrow-right-DpMjf9DB.js";import{M as Wr,P as un}from"./progress-QrTCqD_g.js";import{C as mn}from"./CounterAnimation-D0rflmzZ.js";import{L as Me}from"./label-PbGot-Z7.js";import{S as ks,a as Es,b as Is,c as As,d as jt}from"./select-BRcGlYup.js";import{L as Fr}from"./loader-circle-X6qRBHih.js";import{T as Vr,a as Hr,b as Ht,c as je,d as Gr,e as U}from"./table-D5_bpSso.js";import{R as hn,L as _r,C as qr,X as Yr,Y as Xr,T as fn,a as Kr,b as Ms,P as Zr,c as Jr,d as Qr}from"./chart-vendor-D3hk2TXZ.js";import{E as ea}from"./eye-B4lXTvBl.js";import"./excel-uoQkVabA.js";import"./circle-CMyczGQm.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=P("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=P("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=P("BrainCircuit",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M9 13a4.5 4.5 0 0 0 3-4",key:"10igwf"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M12 13h4",key:"1ku699"}],["path",{d:"M12 18h6a2 2 0 0 1 2 2v1",key:"105ag5"}],["path",{d:"M12 8h8",key:"1lhi5i"}],["path",{d:"M16 8V5a2 2 0 0 1 2-2",key:"u6izg6"}],["circle",{cx:"16",cy:"13",r:".5",key:"ry7gng"}],["circle",{cx:"18",cy:"3",r:".5",key:"1aiba7"}],["circle",{cx:"20",cy:"21",r:".5",key:"yhc1fs"}],["circle",{cx:"20",cy:"8",r:".5",key:"1e43v0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=P("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=P("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xn=P("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=P("ChartLine",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=P("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=P("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pn=P("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=P("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=P("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=P("MessageSquarePlus",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M12 7v6",key:"lw1j43"}],["path",{d:"M9 10h6",key:"9gxzsh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=P("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=P("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=P("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=P("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=P("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=P("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=P("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=P("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=P("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=P("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);function va(){for(var e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];return i.useMemo(()=>r=>{s.forEach(a=>a(r))},s)}const Pt=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Ve(e){const s=Object.prototype.toString.call(e);return s==="[object Window]"||s==="[object global]"}function os(e){return"nodeType"in e}function ee(e){var s,n;return e?Ve(e)?e:os(e)&&(s=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?s:window:window}function is(e){const{Document:s}=ee(e);return e instanceof s}function mt(e){return Ve(e)?!1:e instanceof ee(e).HTMLElement}function gn(e){return e instanceof ee(e).SVGElement}function He(e){return e?Ve(e)?e.document:os(e)?is(e)?e:mt(e)||gn(e)?e.ownerDocument:document:document:document}const fe=Pt?i.useLayoutEffect:i.useEffect;function ls(e){const s=i.useRef(e);return fe(()=>{s.current=e}),i.useCallback(function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return s.current==null?void 0:s.current(...r)},[])}function ba(){const e=i.useRef(null),s=i.useCallback((r,a)=>{e.current=setInterval(r,a)},[]),n=i.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[s,n]}function ot(e,s){s===void 0&&(s=[e]);const n=i.useRef(e);return fe(()=>{n.current!==e&&(n.current=e)},s),n}function ht(e,s){const n=i.useRef();return i.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...s])}function Dt(e){const s=ls(e),n=i.useRef(null),r=i.useCallback(a=>{a!==n.current&&(s==null||s(a,n.current)),n.current=a},[]);return[n,r]}function Kt(e){const s=i.useRef();return i.useEffect(()=>{s.current=e},[e]),s.current}let Gt={};function ft(e,s){return i.useMemo(()=>{if(s)return s;const n=Gt[e]==null?0:Gt[e]+1;return Gt[e]=n,e+"-"+n},[e,s])}function vn(e){return function(s){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return r.reduce((o,l)=>{const c=Object.entries(l);for(const[u,h]of c){const m=o[u];m!=null&&(o[u]=m+e*h)}return o},{...s})}}const $e=vn(1),it=vn(-1);function ya(e){return"clientX"in e&&"clientY"in e}function cs(e){if(!e)return!1;const{KeyboardEvent:s}=ee(e.target);return s&&e instanceof s}function ja(e){if(!e)return!1;const{TouchEvent:s}=ee(e.target);return s&&e instanceof s}function Zt(e){if(ja(e)){if(e.touches&&e.touches.length){const{clientX:s,clientY:n}=e.touches[0];return{x:s,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:s,clientY:n}=e.changedTouches[0];return{x:s,y:n}}}return ya(e)?{x:e.clientX,y:e.clientY}:null}const lt=Object.freeze({Translate:{toString(e){if(!e)return;const{x:s,y:n}=e;return"translate3d("+(s?Math.round(s):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:s,scaleY:n}=e;return"scaleX("+s+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[lt.Translate.toString(e),lt.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:s,duration:n,easing:r}=e;return s+" "+n+"ms "+r}}}),zs="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function wa(e){return e.matches(zs)?e:e.querySelector(zs)}const Na={display:"none"};function Ca(e){let{id:s,value:n}=e;return Y.createElement("div",{id:s,style:Na},n)}function Sa(e){let{id:s,announcement:n,ariaLiveType:r="assertive"}=e;const a={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Y.createElement("div",{id:s,style:a,role:"status","aria-live":r,"aria-atomic":!0},n)}function Da(){const[e,s]=i.useState("");return{announce:i.useCallback(r=>{r!=null&&s(r)},[]),announcement:e}}const bn=i.createContext(null);function ka(e){const s=i.useContext(bn);i.useEffect(()=>{if(!s)throw new Error("useDndMonitor must be used within a children of <DndContext>");return s(e)},[e,s])}function Ea(){const[e]=i.useState(()=>new Set),s=i.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[i.useCallback(r=>{let{type:a,event:o}=r;e.forEach(l=>{var c;return(c=l[a])==null?void 0:c.call(l,o)})},[e]),s]}const Ia={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Aa={onDragStart(e){let{active:s}=e;return"Picked up draggable item "+s.id+"."},onDragOver(e){let{active:s,over:n}=e;return n?"Draggable item "+s.id+" was moved over droppable area "+n.id+".":"Draggable item "+s.id+" is no longer over a droppable area."},onDragEnd(e){let{active:s,over:n}=e;return n?"Draggable item "+s.id+" was dropped over droppable area "+n.id:"Draggable item "+s.id+" was dropped."},onDragCancel(e){let{active:s}=e;return"Dragging was cancelled. Draggable item "+s.id+" was dropped."}};function Ma(e){let{announcements:s=Aa,container:n,hiddenTextDescribedById:r,screenReaderInstructions:a=Ia}=e;const{announce:o,announcement:l}=Da(),c=ft("DndLiveRegion"),[u,h]=i.useState(!1);if(i.useEffect(()=>{h(!0)},[]),ka(i.useMemo(()=>({onDragStart(d){let{active:x}=d;o(s.onDragStart({active:x}))},onDragMove(d){let{active:x,over:f}=d;s.onDragMove&&o(s.onDragMove({active:x,over:f}))},onDragOver(d){let{active:x,over:f}=d;o(s.onDragOver({active:x,over:f}))},onDragEnd(d){let{active:x,over:f}=d;o(s.onDragEnd({active:x,over:f}))},onDragCancel(d){let{active:x,over:f}=d;o(s.onDragCancel({active:x,over:f}))}}),[o,s])),!u)return null;const m=Y.createElement(Y.Fragment,null,Y.createElement(Ca,{id:r,value:a.draggable}),Y.createElement(Sa,{id:c,announcement:l}));return n?Qe.createPortal(m,n):m}var $;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})($||($={}));function kt(){}function Ps(e,s){return i.useMemo(()=>({sensor:e,options:s??{}}),[e,s])}function Ra(){for(var e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];return i.useMemo(()=>[...s].filter(r=>r!=null),[...s])}const ce=Object.freeze({x:0,y:0});function yn(e,s){return Math.sqrt(Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2))}function jn(e,s){let{data:{value:n}}=e,{data:{value:r}}=s;return n-r}function Ta(e,s){let{data:{value:n}}=e,{data:{value:r}}=s;return r-n}function Os(e){let{left:s,top:n,height:r,width:a}=e;return[{x:s,y:n},{x:s+a,y:n},{x:s,y:n+r},{x:s+a,y:n+r}]}function wn(e,s){if(!e||e.length===0)return null;const[n]=e;return n[s]}function Ls(e,s,n){return s===void 0&&(s=e.left),n===void 0&&(n=e.top),{x:s+e.width*.5,y:n+e.height*.5}}const za=e=>{let{collisionRect:s,droppableRects:n,droppableContainers:r}=e;const a=Ls(s,s.left,s.top),o=[];for(const l of r){const{id:c}=l,u=n.get(c);if(u){const h=yn(Ls(u),a);o.push({id:c,data:{droppableContainer:l,value:h}})}}return o.sort(jn)},Pa=e=>{let{collisionRect:s,droppableRects:n,droppableContainers:r}=e;const a=Os(s),o=[];for(const l of r){const{id:c}=l,u=n.get(c);if(u){const h=Os(u),m=a.reduce((x,f,v)=>x+yn(h[v],f),0),d=Number((m/4).toFixed(4));o.push({id:c,data:{droppableContainer:l,value:d}})}}return o.sort(jn)};function Oa(e,s){const n=Math.max(s.top,e.top),r=Math.max(s.left,e.left),a=Math.min(s.left+s.width,e.left+e.width),o=Math.min(s.top+s.height,e.top+e.height),l=a-r,c=o-n;if(r<a&&n<o){const u=s.width*s.height,h=e.width*e.height,m=l*c,d=m/(u+h-m);return Number(d.toFixed(4))}return 0}const La=e=>{let{collisionRect:s,droppableRects:n,droppableContainers:r}=e;const a=[];for(const o of r){const{id:l}=o,c=n.get(l);if(c){const u=Oa(c,s);u>0&&a.push({id:l,data:{droppableContainer:o,value:u}})}}return a.sort(Ta)};function Ba(e,s,n){return{...e,scaleX:s&&n?s.width/n.width:1,scaleY:s&&n?s.height/n.height:1}}function Nn(e,s){return e&&s?{x:e.left-s.left,y:e.top-s.top}:ce}function Ua(e){return function(n){for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return a.reduce((l,c)=>({...l,top:l.top+e*c.y,bottom:l.bottom+e*c.y,left:l.left+e*c.x,right:l.right+e*c.x}),{...n})}}const $a=Ua(1);function Wa(e){if(e.startsWith("matrix3d(")){const s=e.slice(9,-1).split(/, /);return{x:+s[12],y:+s[13],scaleX:+s[0],scaleY:+s[5]}}else if(e.startsWith("matrix(")){const s=e.slice(7,-1).split(/, /);return{x:+s[4],y:+s[5],scaleX:+s[0],scaleY:+s[3]}}return null}function Fa(e,s,n){const r=Wa(s);if(!r)return e;const{scaleX:a,scaleY:o,x:l,y:c}=r,u=e.left-l-(1-a)*parseFloat(n),h=e.top-c-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),m=a?e.width/a:e.width,d=o?e.height/o:e.height;return{width:m,height:d,top:h,right:u+m,bottom:h+d,left:u}}const Va={ignoreTransform:!1};function Ge(e,s){s===void 0&&(s=Va);let n=e.getBoundingClientRect();if(s.ignoreTransform){const{transform:h,transformOrigin:m}=ee(e).getComputedStyle(e);h&&(n=Fa(n,h,m))}const{top:r,left:a,width:o,height:l,bottom:c,right:u}=n;return{top:r,left:a,width:o,height:l,bottom:c,right:u}}function Bs(e){return Ge(e,{ignoreTransform:!0})}function Ha(e){const s=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:s,bottom:n,width:s,height:n}}function Ga(e,s){return s===void 0&&(s=ee(e).getComputedStyle(e)),s.position==="fixed"}function _a(e,s){s===void 0&&(s=ee(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(a=>{const o=s[a];return typeof o=="string"?n.test(o):!1})}function Ot(e,s){const n=[];function r(a){if(s!=null&&n.length>=s||!a)return n;if(is(a)&&a.scrollingElement!=null&&!n.includes(a.scrollingElement))return n.push(a.scrollingElement),n;if(!mt(a)||gn(a)||n.includes(a))return n;const o=ee(e).getComputedStyle(a);return a!==e&&_a(a,o)&&n.push(a),Ga(a,o)?n:r(a.parentNode)}return e?r(e):n}function Cn(e){const[s]=Ot(e,1);return s??null}function _t(e){return!Pt||!e?null:Ve(e)?e:os(e)?is(e)||e===He(e).scrollingElement?window:mt(e)?e:null:null}function Sn(e){return Ve(e)?e.scrollX:e.scrollLeft}function Dn(e){return Ve(e)?e.scrollY:e.scrollTop}function Jt(e){return{x:Sn(e),y:Dn(e)}}var _;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(_||(_={}));function kn(e){return!Pt||!e?!1:e===document.scrollingElement}function En(e){const s={x:0,y:0},n=kn(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},a=e.scrollTop<=s.y,o=e.scrollLeft<=s.x,l=e.scrollTop>=r.y,c=e.scrollLeft>=r.x;return{isTop:a,isLeft:o,isBottom:l,isRight:c,maxScroll:r,minScroll:s}}const qa={x:.2,y:.2};function Ya(e,s,n,r,a){let{top:o,left:l,right:c,bottom:u}=n;r===void 0&&(r=10),a===void 0&&(a=qa);const{isTop:h,isBottom:m,isLeft:d,isRight:x}=En(e),f={x:0,y:0},v={x:0,y:0},p={height:s.height*a.y,width:s.width*a.x};return!h&&o<=s.top+p.height?(f.y=_.Backward,v.y=r*Math.abs((s.top+p.height-o)/p.height)):!m&&u>=s.bottom-p.height&&(f.y=_.Forward,v.y=r*Math.abs((s.bottom-p.height-u)/p.height)),!x&&c>=s.right-p.width?(f.x=_.Forward,v.x=r*Math.abs((s.right-p.width-c)/p.width)):!d&&l<=s.left+p.width&&(f.x=_.Backward,v.x=r*Math.abs((s.left+p.width-l)/p.width)),{direction:f,speed:v}}function Xa(e){if(e===document.scrollingElement){const{innerWidth:o,innerHeight:l}=window;return{top:0,left:0,right:o,bottom:l,width:o,height:l}}const{top:s,left:n,right:r,bottom:a}=e.getBoundingClientRect();return{top:s,left:n,right:r,bottom:a,width:e.clientWidth,height:e.clientHeight}}function In(e){return e.reduce((s,n)=>$e(s,Jt(n)),ce)}function Ka(e){return e.reduce((s,n)=>s+Sn(n),0)}function Za(e){return e.reduce((s,n)=>s+Dn(n),0)}function Ja(e,s){if(s===void 0&&(s=Ge),!e)return;const{top:n,left:r,bottom:a,right:o}=s(e);Cn(e)&&(a<=0||o<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Qa=[["x",["left","right"],Ka],["y",["top","bottom"],Za]];class ds{constructor(s,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=Ot(n),a=In(r);this.rect={...s},this.width=s.width,this.height=s.height;for(const[o,l,c]of Qa)for(const u of l)Object.defineProperty(this,u,{get:()=>{const h=c(r),m=a[o]-h;return this.rect[u]+m},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class et{constructor(s){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=s}add(s,n,r){var a;(a=this.target)==null||a.addEventListener(s,n,r),this.listeners.push([s,n,r])}}function eo(e){const{EventTarget:s}=ee(e);return e instanceof s?e:He(e)}function qt(e,s){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof s=="number"?Math.sqrt(n**2+r**2)>s:"x"in s&&"y"in s?n>s.x&&r>s.y:"x"in s?n>s.x:"y"in s?r>s.y:!1}var le;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(le||(le={}));function Us(e){e.preventDefault()}function to(e){e.stopPropagation()}var E;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(E||(E={}));const An={start:[E.Space,E.Enter],cancel:[E.Esc],end:[E.Space,E.Enter,E.Tab]},so=(e,s)=>{let{currentCoordinates:n}=s;switch(e.code){case E.Right:return{...n,x:n.x+25};case E.Left:return{...n,x:n.x-25};case E.Down:return{...n,y:n.y+25};case E.Up:return{...n,y:n.y-25}}};class us{constructor(s){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=s;const{event:{target:n}}=s;this.props=s,this.listeners=new et(He(n)),this.windowListeners=new et(ee(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(le.Resize,this.handleCancel),this.windowListeners.add(le.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(le.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:s,onStart:n}=this.props,r=s.node.current;r&&Ja(r),n(ce)}handleKeyDown(s){if(cs(s)){const{active:n,context:r,options:a}=this.props,{keyboardCodes:o=An,coordinateGetter:l=so,scrollBehavior:c="smooth"}=a,{code:u}=s;if(o.end.includes(u)){this.handleEnd(s);return}if(o.cancel.includes(u)){this.handleCancel(s);return}const{collisionRect:h}=r.current,m=h?{x:h.left,y:h.top}:ce;this.referenceCoordinates||(this.referenceCoordinates=m);const d=l(s,{active:n,context:r.current,currentCoordinates:m});if(d){const x=it(d,m),f={x:0,y:0},{scrollableAncestors:v}=r.current;for(const p of v){const b=s.code,{isTop:y,isRight:g,isLeft:w,isBottom:N,maxScroll:j,minScroll:S}=En(p),D=Xa(p),C={x:Math.min(b===E.Right?D.right-D.width/2:D.right,Math.max(b===E.Right?D.left:D.left+D.width/2,d.x)),y:Math.min(b===E.Down?D.bottom-D.height/2:D.bottom,Math.max(b===E.Down?D.top:D.top+D.height/2,d.y))},k=b===E.Right&&!g||b===E.Left&&!w,T=b===E.Down&&!N||b===E.Up&&!y;if(k&&C.x!==d.x){const I=p.scrollLeft+x.x,O=b===E.Right&&I<=j.x||b===E.Left&&I>=S.x;if(O&&!x.y){p.scrollTo({left:I,behavior:c});return}O?f.x=p.scrollLeft-I:f.x=b===E.Right?p.scrollLeft-j.x:p.scrollLeft-S.x,f.x&&p.scrollBy({left:-f.x,behavior:c});break}else if(T&&C.y!==d.y){const I=p.scrollTop+x.y,O=b===E.Down&&I<=j.y||b===E.Up&&I>=S.y;if(O&&!x.x){p.scrollTo({top:I,behavior:c});return}O?f.y=p.scrollTop-I:f.y=b===E.Down?p.scrollTop-j.y:p.scrollTop-S.y,f.y&&p.scrollBy({top:-f.y,behavior:c});break}}this.handleMove(s,$e(it(d,this.referenceCoordinates),f))}}}handleMove(s,n){const{onMove:r}=this.props;s.preventDefault(),r(n)}handleEnd(s){const{onEnd:n}=this.props;s.preventDefault(),this.detach(),n()}handleCancel(s){const{onCancel:n}=this.props;s.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}us.activators=[{eventName:"onKeyDown",handler:(e,s,n)=>{let{keyboardCodes:r=An,onActivation:a}=s,{active:o}=n;const{code:l}=e.nativeEvent;if(r.start.includes(l)){const c=o.activatorNode.current;return c&&e.target!==c?!1:(e.preventDefault(),a==null||a({event:e.nativeEvent}),!0)}return!1}}];function $s(e){return!!(e&&"distance"in e)}function Ws(e){return!!(e&&"delay"in e)}class ms{constructor(s,n,r){var a;r===void 0&&(r=eo(s.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=s,this.events=n;const{event:o}=s,{target:l}=o;this.props=s,this.events=n,this.document=He(l),this.documentListeners=new et(this.document),this.listeners=new et(r),this.windowListeners=new et(ee(l)),this.initialCoordinates=(a=Zt(o))!=null?a:ce,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:s,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(s.move.name,this.handleMove,{passive:!1}),this.listeners.add(s.end.name,this.handleEnd),s.cancel&&this.listeners.add(s.cancel.name,this.handleCancel),this.windowListeners.add(le.Resize,this.handleCancel),this.windowListeners.add(le.DragStart,Us),this.windowListeners.add(le.VisibilityChange,this.handleCancel),this.windowListeners.add(le.ContextMenu,Us),this.documentListeners.add(le.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Ws(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if($s(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(s,n){const{active:r,onPending:a}=this.props;a(r,s,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:s}=this,{onStart:n}=this.props;s&&(this.activated=!0,this.documentListeners.add(le.Click,to,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(le.SelectionChange,this.removeTextSelection),n(s))}handleMove(s){var n;const{activated:r,initialCoordinates:a,props:o}=this,{onMove:l,options:{activationConstraint:c}}=o;if(!a)return;const u=(n=Zt(s))!=null?n:ce,h=it(a,u);if(!r&&c){if($s(c)){if(c.tolerance!=null&&qt(h,c.tolerance))return this.handleCancel();if(qt(h,c.distance))return this.handleStart()}if(Ws(c)&&qt(h,c.tolerance))return this.handleCancel();this.handlePending(c,h);return}s.cancelable&&s.preventDefault(),l(u)}handleEnd(){const{onAbort:s,onEnd:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleCancel(){const{onAbort:s,onCancel:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleKeydown(s){s.code===E.Esc&&this.handleCancel()}removeTextSelection(){var s;(s=this.document.getSelection())==null||s.removeAllRanges()}}const no={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class hs extends ms{constructor(s){const{event:n}=s,r=He(n.target);super(s,no,r)}}hs.activators=[{eventName:"onPointerDown",handler:(e,s)=>{let{nativeEvent:n}=e,{onActivation:r}=s;return!n.isPrimary||n.button!==0?!1:(r==null||r({event:n}),!0)}}];const ro={move:{name:"mousemove"},end:{name:"mouseup"}};var Qt;(function(e){e[e.RightClick=2]="RightClick"})(Qt||(Qt={}));class ao extends ms{constructor(s){super(s,ro,He(s.event.target))}}ao.activators=[{eventName:"onMouseDown",handler:(e,s)=>{let{nativeEvent:n}=e,{onActivation:r}=s;return n.button===Qt.RightClick?!1:(r==null||r({event:n}),!0)}}];const Yt={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class oo extends ms{constructor(s){super(s,Yt)}static setup(){return window.addEventListener(Yt.move.name,s,{capture:!1,passive:!1}),function(){window.removeEventListener(Yt.move.name,s)};function s(){}}}oo.activators=[{eventName:"onTouchStart",handler:(e,s)=>{let{nativeEvent:n}=e,{onActivation:r}=s;const{touches:a}=n;return a.length>1?!1:(r==null||r({event:n}),!0)}}];var tt;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(tt||(tt={}));var Et;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(Et||(Et={}));function io(e){let{acceleration:s,activator:n=tt.Pointer,canScroll:r,draggingRect:a,enabled:o,interval:l=5,order:c=Et.TreeOrder,pointerCoordinates:u,scrollableAncestors:h,scrollableAncestorRects:m,delta:d,threshold:x}=e;const f=co({delta:d,disabled:!o}),[v,p]=ba(),b=i.useRef({x:0,y:0}),y=i.useRef({x:0,y:0}),g=i.useMemo(()=>{switch(n){case tt.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case tt.DraggableRect:return a}},[n,a,u]),w=i.useRef(null),N=i.useCallback(()=>{const S=w.current;if(!S)return;const D=b.current.x*y.current.x,C=b.current.y*y.current.y;S.scrollBy(D,C)},[]),j=i.useMemo(()=>c===Et.TreeOrder?[...h].reverse():h,[c,h]);i.useEffect(()=>{if(!o||!h.length||!g){p();return}for(const S of j){if((r==null?void 0:r(S))===!1)continue;const D=h.indexOf(S),C=m[D];if(!C)continue;const{direction:k,speed:T}=Ya(S,C,g,s,x);for(const I of["x","y"])f[I][k[I]]||(T[I]=0,k[I]=0);if(T.x>0||T.y>0){p(),w.current=S,v(N,l),b.current=T,y.current=k;return}}b.current={x:0,y:0},y.current={x:0,y:0},p()},[s,N,r,p,o,l,JSON.stringify(g),JSON.stringify(f),v,h,j,m,JSON.stringify(x)])}const lo={x:{[_.Backward]:!1,[_.Forward]:!1},y:{[_.Backward]:!1,[_.Forward]:!1}};function co(e){let{delta:s,disabled:n}=e;const r=Kt(s);return ht(a=>{if(n||!r||!a)return lo;const o={x:Math.sign(s.x-r.x),y:Math.sign(s.y-r.y)};return{x:{[_.Backward]:a.x[_.Backward]||o.x===-1,[_.Forward]:a.x[_.Forward]||o.x===1},y:{[_.Backward]:a.y[_.Backward]||o.y===-1,[_.Forward]:a.y[_.Forward]||o.y===1}}},[n,s,r])}function uo(e,s){const n=s!=null?e.get(s):void 0,r=n?n.node.current:null;return ht(a=>{var o;return s==null?null:(o=r??a)!=null?o:null},[r,s])}function mo(e,s){return i.useMemo(()=>e.reduce((n,r)=>{const{sensor:a}=r,o=a.activators.map(l=>({eventName:l.eventName,handler:s(l.handler,r)}));return[...n,...o]},[]),[e,s])}var ct;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(ct||(ct={}));var es;(function(e){e.Optimized="optimized"})(es||(es={}));const Fs=new Map;function ho(e,s){let{dragging:n,dependencies:r,config:a}=s;const[o,l]=i.useState(null),{frequency:c,measure:u,strategy:h}=a,m=i.useRef(e),d=b(),x=ot(d),f=i.useCallback(function(y){y===void 0&&(y=[]),!x.current&&l(g=>g===null?y:g.concat(y.filter(w=>!g.includes(w))))},[x]),v=i.useRef(null),p=ht(y=>{if(d&&!n)return Fs;if(!y||y===Fs||m.current!==e||o!=null){const g=new Map;for(let w of e){if(!w)continue;if(o&&o.length>0&&!o.includes(w.id)&&w.rect.current){g.set(w.id,w.rect.current);continue}const N=w.node.current,j=N?new ds(u(N),N):null;w.rect.current=j,j&&g.set(w.id,j)}return g}return y},[e,o,n,d,u]);return i.useEffect(()=>{m.current=e},[e]),i.useEffect(()=>{d||f()},[n,d]),i.useEffect(()=>{o&&o.length>0&&l(null)},[JSON.stringify(o)]),i.useEffect(()=>{d||typeof c!="number"||v.current!==null||(v.current=setTimeout(()=>{f(),v.current=null},c))},[c,d,f,...r]),{droppableRects:p,measureDroppableContainers:f,measuringScheduled:o!=null};function b(){switch(h){case ct.Always:return!1;case ct.BeforeDragging:return n;default:return!n}}}function Mn(e,s){return ht(n=>e?n||(typeof s=="function"?s(e):e):null,[s,e])}function fo(e,s){return Mn(e,s)}function xo(e){let{callback:s,disabled:n}=e;const r=ls(s),a=i.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(r)},[r,n]);return i.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function Lt(e){let{callback:s,disabled:n}=e;const r=ls(s),a=i.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(r)},[n]);return i.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function po(e){return new ds(Ge(e),e)}function Vs(e,s,n){s===void 0&&(s=po);const[r,a]=i.useState(null);function o(){a(u=>{if(!e)return null;if(e.isConnected===!1){var h;return(h=u??n)!=null?h:null}const m=s(e);return JSON.stringify(u)===JSON.stringify(m)?u:m})}const l=xo({callback(u){if(e)for(const h of u){const{type:m,target:d}=h;if(m==="childList"&&d instanceof HTMLElement&&d.contains(e)){o();break}}}}),c=Lt({callback:o});return fe(()=>{o(),e?(c==null||c.observe(e),l==null||l.observe(document.body,{childList:!0,subtree:!0})):(c==null||c.disconnect(),l==null||l.disconnect())},[e]),r}function go(e){const s=Mn(e);return Nn(e,s)}const Hs=[];function vo(e){const s=i.useRef(e),n=ht(r=>e?r&&r!==Hs&&e&&s.current&&e.parentNode===s.current.parentNode?r:Ot(e):Hs,[e]);return i.useEffect(()=>{s.current=e},[e]),n}function bo(e){const[s,n]=i.useState(null),r=i.useRef(e),a=i.useCallback(o=>{const l=_t(o.target);l&&n(c=>c?(c.set(l,Jt(l)),new Map(c)):null)},[]);return i.useEffect(()=>{const o=r.current;if(e!==o){l(o);const c=e.map(u=>{const h=_t(u);return h?(h.addEventListener("scroll",a,{passive:!0}),[h,Jt(h)]):null}).filter(u=>u!=null);n(c.length?new Map(c):null),r.current=e}return()=>{l(e),l(o)};function l(c){c.forEach(u=>{const h=_t(u);h==null||h.removeEventListener("scroll",a)})}},[a,e]),i.useMemo(()=>e.length?s?Array.from(s.values()).reduce((o,l)=>$e(o,l),ce):In(e):ce,[e,s])}function Gs(e,s){s===void 0&&(s=[]);const n=i.useRef(null);return i.useEffect(()=>{n.current=null},s),i.useEffect(()=>{const r=e!==ce;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?it(e,n.current):ce}function yo(e){i.useEffect(()=>{if(!Pt)return;const s=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of s)n==null||n()}},e.map(s=>{let{sensor:n}=s;return n}))}function jo(e,s){return i.useMemo(()=>e.reduce((n,r)=>{let{eventName:a,handler:o}=r;return n[a]=l=>{o(l,s)},n},{}),[e,s])}function Rn(e){return i.useMemo(()=>e?Ha(e):null,[e])}const _s=[];function wo(e,s){s===void 0&&(s=Ge);const[n]=e,r=Rn(n?ee(n):null),[a,o]=i.useState(_s);function l(){o(()=>e.length?e.map(u=>kn(u)?r:new ds(s(u),u)):_s)}const c=Lt({callback:l});return fe(()=>{c==null||c.disconnect(),l(),e.forEach(u=>c==null?void 0:c.observe(u))},[e]),a}function No(e){if(!e)return null;if(e.children.length>1)return e;const s=e.children[0];return mt(s)?s:e}function Co(e){let{measure:s}=e;const[n,r]=i.useState(null),a=i.useCallback(h=>{for(const{target:m}of h)if(mt(m)){r(d=>{const x=s(m);return d?{...d,width:x.width,height:x.height}:x});break}},[s]),o=Lt({callback:a}),l=i.useCallback(h=>{const m=No(h);o==null||o.disconnect(),m&&(o==null||o.observe(m)),r(m?s(m):null)},[s,o]),[c,u]=Dt(l);return i.useMemo(()=>({nodeRef:c,rect:n,setRef:u}),[n,c,u])}const So=[{sensor:hs,options:{}},{sensor:us,options:{}}],Do={current:{}},Ct={draggable:{measure:Bs},droppable:{measure:Bs,strategy:ct.WhileDragging,frequency:es.Optimized},dragOverlay:{measure:Ge}};class st extends Map{get(s){var n;return s!=null&&(n=super.get(s))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(s=>{let{disabled:n}=s;return!n})}getNodeFor(s){var n,r;return(n=(r=this.get(s))==null?void 0:r.node.current)!=null?n:void 0}}const ko={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new st,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:kt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Ct,measureDroppableContainers:kt,windowRect:null,measuringScheduled:!1},Eo={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:kt,draggableNodes:new Map,over:null,measureDroppableContainers:kt},Bt=i.createContext(Eo),Tn=i.createContext(ko);function Io(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new st}}}function Ao(e,s){switch(s.type){case $.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:s.initialCoordinates,active:s.active}};case $.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:s.coordinates.x-e.draggable.initialCoordinates.x,y:s.coordinates.y-e.draggable.initialCoordinates.y}}};case $.DragEnd:case $.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case $.RegisterDroppable:{const{element:n}=s,{id:r}=n,a=new st(e.droppable.containers);return a.set(r,n),{...e,droppable:{...e.droppable,containers:a}}}case $.SetDroppableDisabled:{const{id:n,key:r,disabled:a}=s,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const l=new st(e.droppable.containers);return l.set(n,{...o,disabled:a}),{...e,droppable:{...e.droppable,containers:l}}}case $.UnregisterDroppable:{const{id:n,key:r}=s,a=e.droppable.containers.get(n);if(!a||r!==a.key)return e;const o=new st(e.droppable.containers);return o.delete(n),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function Mo(e){let{disabled:s}=e;const{active:n,activatorEvent:r,draggableNodes:a}=i.useContext(Bt),o=Kt(r),l=Kt(n==null?void 0:n.id);return i.useEffect(()=>{if(!s&&!r&&o&&l!=null){if(!cs(o)||document.activeElement===o.target)return;const c=a.get(l);if(!c)return;const{activatorNode:u,node:h}=c;if(!u.current&&!h.current)return;requestAnimationFrame(()=>{for(const m of[u.current,h.current]){if(!m)continue;const d=wa(m);if(d){d.focus();break}}})}},[r,s,a,l,o]),null}function Ro(e,s){let{transform:n,...r}=s;return e!=null&&e.length?e.reduce((a,o)=>o({transform:a,...r}),n):n}function To(e){return i.useMemo(()=>({draggable:{...Ct.draggable,...e==null?void 0:e.draggable},droppable:{...Ct.droppable,...e==null?void 0:e.droppable},dragOverlay:{...Ct.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function zo(e){let{activeNode:s,measure:n,initialRect:r,config:a=!0}=e;const o=i.useRef(!1),{x:l,y:c}=typeof a=="boolean"?{x:a,y:a}:a;fe(()=>{if(!l&&!c||!s){o.current=!1;return}if(o.current||!r)return;const h=s==null?void 0:s.node.current;if(!h||h.isConnected===!1)return;const m=n(h),d=Nn(m,r);if(l||(d.x=0),c||(d.y=0),o.current=!0,Math.abs(d.x)>0||Math.abs(d.y)>0){const x=Cn(h);x&&x.scrollBy({top:d.y,left:d.x})}},[s,l,c,r,n])}const zn=i.createContext({...ce,scaleX:1,scaleY:1});var Ae;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Ae||(Ae={}));const Po=i.memo(function(s){var n,r,a,o;let{id:l,accessibility:c,autoScroll:u=!0,children:h,sensors:m=So,collisionDetection:d=La,measuring:x,modifiers:f,...v}=s;const p=i.useReducer(Ao,void 0,Io),[b,y]=p,[g,w]=Ea(),[N,j]=i.useState(Ae.Uninitialized),S=N===Ae.Initialized,{draggable:{active:D,nodes:C,translate:k},droppable:{containers:T}}=b,I=D!=null?C.get(D):null,O=i.useRef({initial:null,translated:null}),H=i.useMemo(()=>{var X;return D!=null?{id:D,data:(X=I==null?void 0:I.data)!=null?X:Do,rect:O}:null},[D,I]),A=i.useRef(null),[G,de]=i.useState(null),[te,xt]=i.useState(null),pe=ot(v,Object.values(v)),_e=ft("DndDescribedBy",l),pt=i.useMemo(()=>T.getEnabled(),[T]),J=To(x),{droppableRects:ge,measureDroppableContainers:Re,measuringScheduled:qe}=ho(pt,{dragging:S,dependencies:[k.x,k.y],config:J.droppable}),oe=uo(C,D),gt=i.useMemo(()=>te?Zt(te):null,[te]),Ce=Yn(),ve=fo(oe,J.draggable.measure);zo({activeNode:D!=null?C.get(D):null,config:Ce.layoutShiftCompensation,initialRect:ve,measure:J.draggable.measure});const R=Vs(oe,J.draggable.measure,ve),Ye=Vs(oe?oe.parentElement:null),ue=i.useRef({activatorEvent:null,active:null,activeNode:oe,collisionRect:null,collisions:null,droppableRects:ge,draggableNodes:C,draggingNode:null,draggingNodeRect:null,droppableContainers:T,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),ze=T.getNodeFor((n=ue.current.over)==null?void 0:n.id),be=Co({measure:J.dragOverlay.measure}),Pe=(r=be.nodeRef.current)!=null?r:oe,Oe=S?(a=be.rect)!=null?a:R:null,ps=!!(be.nodeRef.current&&be.rect),gs=go(ps?null:R),Ut=Rn(Pe?ee(Pe):null),Se=vo(S?ze??oe:null),vt=wo(Se),bt=Ro(f,{transform:{x:k.x-gs.x,y:k.y-gs.y,scaleX:1,scaleY:1},activatorEvent:te,active:H,activeNodeRect:R,containerNodeRect:Ye,draggingNodeRect:Oe,over:ue.current.over,overlayNodeRect:be.rect,scrollableAncestors:Se,scrollableAncestorRects:vt,windowRect:Ut}),vs=gt?$e(gt,k):null,bs=bo(Se),Wn=Gs(bs),Fn=Gs(bs,[R]),Le=$e(bt,Wn),Be=Oe?$a(Oe,bt):null,Xe=H&&Be?d({active:H,collisionRect:Be,droppableRects:ge,droppableContainers:pt,pointerCoordinates:vs}):null,ys=wn(Xe,"id"),[De,js]=i.useState(null),Vn=ps?bt:$e(bt,Fn),Hn=Ba(Vn,(o=De==null?void 0:De.rect)!=null?o:null,R),$t=i.useRef(null),ws=i.useCallback((X,se)=>{let{sensor:ne,options:ke}=se;if(A.current==null)return;const ie=C.get(A.current);if(!ie)return;const re=X.nativeEvent,me=new ne({active:A.current,activeNode:ie,event:re,options:ke,context:ue,onAbort(q){if(!C.get(q))return;const{onDragAbort:he}=pe.current,ye={id:q};he==null||he(ye),g({type:"onDragAbort",event:ye})},onPending(q,Ee,he,ye){if(!C.get(q))return;const{onDragPending:Ze}=pe.current,Ie={id:q,constraint:Ee,initialCoordinates:he,offset:ye};Ze==null||Ze(Ie),g({type:"onDragPending",event:Ie})},onStart(q){const Ee=A.current;if(Ee==null)return;const he=C.get(Ee);if(!he)return;const{onDragStart:ye}=pe.current,Ke={activatorEvent:re,active:{id:Ee,data:he.data,rect:O}};Qe.unstable_batchedUpdates(()=>{ye==null||ye(Ke),j(Ae.Initializing),y({type:$.DragStart,initialCoordinates:q,active:Ee}),g({type:"onDragStart",event:Ke}),de($t.current),xt(re)})},onMove(q){y({type:$.DragMove,coordinates:q})},onEnd:Ue($.DragEnd),onCancel:Ue($.DragCancel)});$t.current=me;function Ue(q){return async function(){const{active:he,collisions:ye,over:Ke,scrollAdjustedTranslate:Ze}=ue.current;let Ie=null;if(he&&Ze){const{cancelDrop:Je}=pe.current;Ie={activatorEvent:re,active:he,collisions:ye,delta:Ze,over:Ke},q===$.DragEnd&&typeof Je=="function"&&await Promise.resolve(Je(Ie))&&(q=$.DragCancel)}A.current=null,Qe.unstable_batchedUpdates(()=>{y({type:q}),j(Ae.Uninitialized),js(null),de(null),xt(null),$t.current=null;const Je=q===$.DragEnd?"onDragEnd":"onDragCancel";if(Ie){const Wt=pe.current[Je];Wt==null||Wt(Ie),g({type:Je,event:Ie})}})}}},[C]),Gn=i.useCallback((X,se)=>(ne,ke)=>{const ie=ne.nativeEvent,re=C.get(ke);if(A.current!==null||!re||ie.dndKit||ie.defaultPrevented)return;const me={active:re};X(ne,se.options,me)===!0&&(ie.dndKit={capturedBy:se.sensor},A.current=ke,ws(ne,se))},[C,ws]),Ns=mo(m,Gn);yo(m),fe(()=>{R&&N===Ae.Initializing&&j(Ae.Initialized)},[R,N]),i.useEffect(()=>{const{onDragMove:X}=pe.current,{active:se,activatorEvent:ne,collisions:ke,over:ie}=ue.current;if(!se||!ne)return;const re={active:se,activatorEvent:ne,collisions:ke,delta:{x:Le.x,y:Le.y},over:ie};Qe.unstable_batchedUpdates(()=>{X==null||X(re),g({type:"onDragMove",event:re})})},[Le.x,Le.y]),i.useEffect(()=>{const{active:X,activatorEvent:se,collisions:ne,droppableContainers:ke,scrollAdjustedTranslate:ie}=ue.current;if(!X||A.current==null||!se||!ie)return;const{onDragOver:re}=pe.current,me=ke.get(ys),Ue=me&&me.rect.current?{id:me.id,rect:me.rect.current,data:me.data,disabled:me.disabled}:null,q={active:X,activatorEvent:se,collisions:ne,delta:{x:ie.x,y:ie.y},over:Ue};Qe.unstable_batchedUpdates(()=>{js(Ue),re==null||re(q),g({type:"onDragOver",event:q})})},[ys]),fe(()=>{ue.current={activatorEvent:te,active:H,activeNode:oe,collisionRect:Be,collisions:Xe,droppableRects:ge,draggableNodes:C,draggingNode:Pe,draggingNodeRect:Oe,droppableContainers:T,over:De,scrollableAncestors:Se,scrollAdjustedTranslate:Le},O.current={initial:Oe,translated:Be}},[H,oe,Xe,Be,C,Pe,Oe,ge,T,De,Se,Le]),io({...Ce,delta:k,draggingRect:Be,pointerCoordinates:vs,scrollableAncestors:Se,scrollableAncestorRects:vt});const _n=i.useMemo(()=>({active:H,activeNode:oe,activeNodeRect:R,activatorEvent:te,collisions:Xe,containerNodeRect:Ye,dragOverlay:be,draggableNodes:C,droppableContainers:T,droppableRects:ge,over:De,measureDroppableContainers:Re,scrollableAncestors:Se,scrollableAncestorRects:vt,measuringConfiguration:J,measuringScheduled:qe,windowRect:Ut}),[H,oe,R,te,Xe,Ye,be,C,T,ge,De,Re,Se,vt,J,qe,Ut]),qn=i.useMemo(()=>({activatorEvent:te,activators:Ns,active:H,activeNodeRect:R,ariaDescribedById:{draggable:_e},dispatch:y,draggableNodes:C,over:De,measureDroppableContainers:Re}),[te,Ns,H,R,y,_e,C,De,Re]);return Y.createElement(bn.Provider,{value:w},Y.createElement(Bt.Provider,{value:qn},Y.createElement(Tn.Provider,{value:_n},Y.createElement(zn.Provider,{value:Hn},h)),Y.createElement(Mo,{disabled:(c==null?void 0:c.restoreFocus)===!1})),Y.createElement(Ma,{...c,hiddenTextDescribedById:_e}));function Yn(){const X=(G==null?void 0:G.autoScrollEnabled)===!1,se=typeof u=="object"?u.enabled===!1:u===!1,ne=S&&!X&&!se;return typeof u=="object"?{...u,enabled:ne}:{enabled:ne}}}),Oo=i.createContext(null),qs="button",Lo="Draggable";function Bo(e){let{id:s,data:n,disabled:r=!1,attributes:a}=e;const o=ft(Lo),{activators:l,activatorEvent:c,active:u,activeNodeRect:h,ariaDescribedById:m,draggableNodes:d,over:x}=i.useContext(Bt),{role:f=qs,roleDescription:v="draggable",tabIndex:p=0}=a??{},b=(u==null?void 0:u.id)===s,y=i.useContext(b?zn:Oo),[g,w]=Dt(),[N,j]=Dt(),S=jo(l,s),D=ot(n);fe(()=>(d.set(s,{id:s,key:o,node:g,activatorNode:N,data:D}),()=>{const k=d.get(s);k&&k.key===o&&d.delete(s)}),[d,s]);const C=i.useMemo(()=>({role:f,tabIndex:p,"aria-disabled":r,"aria-pressed":b&&f===qs?!0:void 0,"aria-roledescription":v,"aria-describedby":m.draggable}),[r,f,p,b,v,m.draggable]);return{active:u,activatorEvent:c,activeNodeRect:h,attributes:C,isDragging:b,listeners:r?void 0:S,node:g,over:x,setNodeRef:w,setActivatorNodeRef:j,transform:y}}function Uo(){return i.useContext(Tn)}const $o="Droppable",Wo={timeout:25};function Fo(e){let{data:s,disabled:n=!1,id:r,resizeObserverConfig:a}=e;const o=ft($o),{active:l,dispatch:c,over:u,measureDroppableContainers:h}=i.useContext(Bt),m=i.useRef({disabled:n}),d=i.useRef(!1),x=i.useRef(null),f=i.useRef(null),{disabled:v,updateMeasurementsFor:p,timeout:b}={...Wo,...a},y=ot(p??r),g=i.useCallback(()=>{if(!d.current){d.current=!0;return}f.current!=null&&clearTimeout(f.current),f.current=setTimeout(()=>{h(Array.isArray(y.current)?y.current:[y.current]),f.current=null},b)},[b]),w=Lt({callback:g,disabled:v||!l}),N=i.useCallback((C,k)=>{w&&(k&&(w.unobserve(k),d.current=!1),C&&w.observe(C))},[w]),[j,S]=Dt(N),D=ot(s);return i.useEffect(()=>{!w||!j.current||(w.disconnect(),d.current=!1,w.observe(j.current))},[j,w]),i.useEffect(()=>(c({type:$.RegisterDroppable,element:{id:r,key:o,disabled:n,node:j,rect:x,data:D}}),()=>c({type:$.UnregisterDroppable,key:o,id:r})),[r]),i.useEffect(()=>{n!==m.current.disabled&&(c({type:$.SetDroppableDisabled,id:r,key:o,disabled:n}),m.current.disabled=n)},[r,o,n,c]),{active:l,rect:x,isOver:(u==null?void 0:u.id)===r,node:j,over:u,setNodeRef:S}}function fs(e,s,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(s,1)[0]),r}function Vo(e,s){return e.reduce((n,r,a)=>{const o=s.get(r);return o&&(n[a]=o),n},Array(e.length))}function wt(e){return e!==null&&e>=0}function Ho(e,s){if(e===s)return!0;if(e.length!==s.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==s[n])return!1;return!0}function Go(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const xs=e=>{let{rects:s,activeIndex:n,overIndex:r,index:a}=e;const o=fs(s,r,n),l=s[a],c=o[a];return!c||!l?null:{x:c.left-l.left,y:c.top-l.top,scaleX:c.width/l.width,scaleY:c.height/l.height}},Pn="Sortable",On=Y.createContext({activeIndex:-1,containerId:Pn,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:xs,disabled:{draggable:!1,droppable:!1}});function _o(e){let{children:s,id:n,items:r,strategy:a=xs,disabled:o=!1}=e;const{active:l,dragOverlay:c,droppableRects:u,over:h,measureDroppableContainers:m}=Uo(),d=ft(Pn,n),x=c.rect!==null,f=i.useMemo(()=>r.map(S=>typeof S=="object"&&"id"in S?S.id:S),[r]),v=l!=null,p=l?f.indexOf(l.id):-1,b=h?f.indexOf(h.id):-1,y=i.useRef(f),g=!Ho(f,y.current),w=b!==-1&&p===-1||g,N=Go(o);fe(()=>{g&&v&&m(f)},[g,f,v,m]),i.useEffect(()=>{y.current=f},[f]);const j=i.useMemo(()=>({activeIndex:p,containerId:d,disabled:N,disableTransforms:w,items:f,overIndex:b,useDragOverlay:x,sortedRects:Vo(f,u),strategy:a}),[p,d,N.draggable,N.droppable,w,f,b,u,x,a]);return Y.createElement(On.Provider,{value:j},s)}const qo=e=>{let{id:s,items:n,activeIndex:r,overIndex:a}=e;return fs(n,r,a).indexOf(s)},Yo=e=>{let{containerId:s,isSorting:n,wasDragging:r,index:a,items:o,newIndex:l,previousItems:c,previousContainerId:u,transition:h}=e;return!h||!r||c!==o&&a===l?!1:n?!0:l!==a&&s===u},Xo={duration:200,easing:"ease"},Ln="transform",Ko=lt.Transition.toString({property:Ln,duration:0,easing:"linear"}),Zo={roleDescription:"sortable"};function Jo(e){let{disabled:s,index:n,node:r,rect:a}=e;const[o,l]=i.useState(null),c=i.useRef(n);return fe(()=>{if(!s&&n!==c.current&&r.current){const u=a.current;if(u){const h=Ge(r.current,{ignoreTransform:!0}),m={x:u.left-h.left,y:u.top-h.top,scaleX:u.width/h.width,scaleY:u.height/h.height};(m.x||m.y)&&l(m)}}n!==c.current&&(c.current=n)},[s,n,r,a]),i.useEffect(()=>{o&&l(null)},[o]),o}function Qo(e){let{animateLayoutChanges:s=Yo,attributes:n,disabled:r,data:a,getNewIndex:o=qo,id:l,strategy:c,resizeObserverConfig:u,transition:h=Xo}=e;const{items:m,containerId:d,activeIndex:x,disabled:f,disableTransforms:v,sortedRects:p,overIndex:b,useDragOverlay:y,strategy:g}=i.useContext(On),w=ei(r,f),N=m.indexOf(l),j=i.useMemo(()=>({sortable:{containerId:d,index:N,items:m},...a}),[d,a,N,m]),S=i.useMemo(()=>m.slice(m.indexOf(l)),[m,l]),{rect:D,node:C,isOver:k,setNodeRef:T}=Fo({id:l,data:j,disabled:w.droppable,resizeObserverConfig:{updateMeasurementsFor:S,...u}}),{active:I,activatorEvent:O,activeNodeRect:H,attributes:A,setNodeRef:G,listeners:de,isDragging:te,over:xt,setActivatorNodeRef:pe,transform:_e}=Bo({id:l,data:j,attributes:{...Zo,...n},disabled:w.draggable}),pt=va(T,G),J=!!I,ge=J&&!v&&wt(x)&&wt(b),Re=!y&&te,qe=Re&&ge?_e:null,gt=ge?qe??(c??g)({rects:p,activeNodeRect:H,activeIndex:x,overIndex:b,index:N}):null,Ce=wt(x)&&wt(b)?o({id:l,items:m,activeIndex:x,overIndex:b}):N,ve=I==null?void 0:I.id,R=i.useRef({activeId:ve,items:m,newIndex:Ce,containerId:d}),Ye=m!==R.current.items,ue=s({active:I,containerId:d,isDragging:te,isSorting:J,id:l,index:N,items:m,newIndex:R.current.newIndex,previousItems:R.current.items,previousContainerId:R.current.containerId,transition:h,wasDragging:R.current.activeId!=null}),ze=Jo({disabled:!ue,index:N,node:C,rect:D});return i.useEffect(()=>{J&&R.current.newIndex!==Ce&&(R.current.newIndex=Ce),d!==R.current.containerId&&(R.current.containerId=d),m!==R.current.items&&(R.current.items=m)},[J,Ce,d,m]),i.useEffect(()=>{if(ve===R.current.activeId)return;if(ve!=null&&R.current.activeId==null){R.current.activeId=ve;return}const Pe=setTimeout(()=>{R.current.activeId=ve},50);return()=>clearTimeout(Pe)},[ve]),{active:I,activeIndex:x,attributes:A,data:j,rect:D,index:N,newIndex:Ce,items:m,isOver:k,isSorting:J,isDragging:te,listeners:de,node:C,overIndex:b,over:xt,setNodeRef:pt,setActivatorNodeRef:pe,setDroppableNodeRef:T,setDraggableNodeRef:G,transform:ze??gt,transition:be()};function be(){if(ze||Ye&&R.current.newIndex===N)return Ko;if(!(Re&&!cs(O)||!h)&&(J||ue))return lt.Transition.toString({...h,property:Ln})}}function ei(e,s){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:s.draggable,droppable:(r=e==null?void 0:e.droppable)!=null?r:s.droppable}}function It(e){if(!e)return!1;const s=e.data.current;return!!(s&&"sortable"in s&&typeof s.sortable=="object"&&"containerId"in s.sortable&&"items"in s.sortable&&"index"in s.sortable)}const ti=[E.Down,E.Right,E.Up,E.Left],si=(e,s)=>{let{context:{active:n,collisionRect:r,droppableRects:a,droppableContainers:o,over:l,scrollableAncestors:c}}=s;if(ti.includes(e.code)){if(e.preventDefault(),!n||!r)return;const u=[];o.getEnabled().forEach(d=>{if(!d||d!=null&&d.disabled)return;const x=a.get(d.id);if(x)switch(e.code){case E.Down:r.top<x.top&&u.push(d);break;case E.Up:r.top>x.top&&u.push(d);break;case E.Left:r.left>x.left&&u.push(d);break;case E.Right:r.left<x.left&&u.push(d);break}});const h=Pa({active:n,collisionRect:r,droppableRects:a,droppableContainers:u,pointerCoordinates:null});let m=wn(h,"id");if(m===(l==null?void 0:l.id)&&h.length>1&&(m=h[1].id),m!=null){const d=o.get(n.id),x=o.get(m),f=x?a.get(x.id):null,v=x==null?void 0:x.node.current;if(v&&f&&d&&x){const b=Ot(v).some((S,D)=>c[D]!==S),y=Bn(d,x),g=ni(d,x),w=b||!y?{x:0,y:0}:{x:g?r.width-f.width:0,y:g?r.height-f.height:0},N={x:f.left,y:f.top};return w.x&&w.y?N:it(N,w)}}}};function Bn(e,s){return!It(e)||!It(s)?!1:e.data.current.sortable.containerId===s.data.current.sortable.containerId}function ni(e,s){return!It(e)||!It(s)||!Bn(e,s)?!1:e.data.current.sortable.index<s.data.current.sortable.index}const Nt=[{id:"smart-analyst",type:"smart-analyst",title:"Analista Inteligente",description:"Anlisis automtico de inventario",icon:na,visible:!0,order:0,size:"small",span:2,row:"top"},{id:"metrics-carousel",type:"metrics-carousel",title:"Mtricas Financieras",description:"Diferencia neta, negativos y positivos",icon:rt,visible:!0,order:1,size:"small",span:1,row:"top",mandatory:!0},{id:"active-products",type:"active-products",title:"Productos Activos",description:"Total de productos en inventarios",icon:rs,visible:!0,order:2,size:"small",span:1,row:"top"},{id:"inventory-summary",type:"inventory-summary",title:"Resumen de Inventario",description:"Progreso de productos en stock",icon:At,visible:!1,order:10,size:"large",span:1,row:"middle"},{id:"inventory-alerts",type:"inventory-alerts",title:"Alertas de Inventario",description:"Notificaciones importantes",icon:dt,visible:!0,order:6,size:"large",span:1,row:"middle"},{id:"upcoming-inventories",type:"upcoming-inventories",title:"Prximos Inventarios",description:"Inventarios programados",icon:xn,visible:!0,order:5,size:"large",span:1,row:"middle"},{id:"branches-table",type:"branches-table",title:"Tabla de Sucursales",description:"Listado completo de sucursales",icon:ra,visible:!0,order:7,size:"full",span:1,row:"bottom"},{id:"inventory-progress",type:"inventory-progress",title:"Progreso de Inventarios",description:"Porcentaje de inventarios completados",icon:Te,visible:!1,order:6,size:"small",span:1,row:"top"},{id:"critical-products",type:"critical-products",title:"Productos Crticos",description:"Productos con stock bajo o agotados",icon:ts,visible:!1,order:7,size:"small",span:1,row:"top"},{id:"total-stock-value",type:"total-stock-value",title:"Valor Total de Stock",description:"Valor monetario total del inventario",icon:rt,visible:!1,order:8,size:"small",span:1,row:"top"},{id:"active-users",type:"active-users",title:"Usuarios Activos",description:"Usuarios trabajando en tiempo real",icon:ln,visible:!1,order:9,size:"small",span:1,row:"top"},{id:"pending-inventories",type:"pending-inventories",title:"Inventarios Pendientes",description:"Inventarios sin completar",icon:ut,visible:!1,order:10,size:"small",span:1,row:"top"},{id:"trends-chart",type:"trends-chart",title:"Grfico de Tendencias",description:"Evolucin de diferencias en el tiempo",icon:aa,visible:!0,order:11,size:"large",span:1,row:"middle"},{id:"top-products",type:"top-products",title:"Top Productos con Diferencias",description:"Productos con mayores discrepancias",icon:ga,visible:!1,order:12,size:"large",span:1,row:"middle"},{id:"activity-timeline",type:"activity-timeline",title:"Actividad Reciente",description:"Timeline de ltimas acciones",icon:vr,visible:!1,order:13,size:"large",span:1,row:"middle"},{id:"category-distribution",type:"category-distribution",title:"Distribucin por Categora",description:"Porcentaje de productos por categora",icon:Rs,visible:!1,order:14,size:"large",span:1,row:"middle"},{id:"monthly-goals",type:"monthly-goals",title:"Objetivos del Mes",description:"Progreso hacia metas mensuales",icon:cn,visible:!1,order:15,size:"large",span:1,row:"middle"},{id:"sync-status",type:"sync-status",title:"Estado de Sincronizacin",description:"Conexin y datos pendientes",icon:dn,visible:!1,order:16,size:"large",span:1,row:"middle"},{id:"quick-actions",type:"quick-actions",title:"Acciones Rpidas",description:"Tareas frecuentes",icon:as,visible:!1,order:17,size:"large",span:1,row:"middle"},{id:"countdown",type:"countdown",title:"Contador de Das",description:"Das restantes para finalizar conteo cclico",icon:St,visible:!0,order:3,size:"small",span:1,row:"top"},{id:"category-progress",type:"category-progress",title:"Progreso por Rubros",description:"Avance de inventario por categora",icon:Rs,visible:!0,order:4,size:"large",span:1,row:"middle"}];function ri(e){const s=`dashboard - layout - v5 - ${e||"default"} `,[n,r]=i.useState(()=>{try{const v=localStorage.getItem(s);if(v){const p=JSON.parse(v);return Nt.map(y=>{const g=p.widgets.find(w=>w.id===y.id);return g?{...y,visible:g.visible,order:g.order,...y.mandatory?{visible:!0}:{}}:y}).sort((y,g)=>y.order-g.order)}}catch(v){console.error("Error loading dashboard layout:",v)}return Nt}),[a,o]=i.useState(!1);i.useEffect(()=>{const p={widgets:n.map(({id:b,visible:y,order:g})=>({id:b,visible:y,order:g})),lastUpdated:Date.now()};localStorage.setItem(s,JSON.stringify(p))},[n,s]);const l=(v,p)=>{r(b=>{const y=b.findIndex(N=>N.id===v),g=b.findIndex(N=>N.id===p);return fs(b,y,g).map((N,j)=>({...N,order:j}))})},c=v=>{r(p=>p.map(b=>b.id===v&&!b.mandatory?{...b,visible:!b.visible}:b))},u=()=>{r(Nt),o(!1)},h=(v,p)=>{r(b=>b.map(y=>y.id===v?{...y,size:p}:y))},m=(v,p)=>{r(b=>b.map(y=>y.id===v?{...y,span:p}:y))},d=v=>{r(p=>p.map(b=>({...b,visible:b.mandatory||v.includes(b.id)})))};i.useEffect(()=>{n.every(p=>p.title&&p.icon)||(console.warn("Detected corrupted widget state, resetting to defaults"),r(Nt))},[n]);const x=n.filter(v=>v.visible).sort((v,p)=>v.order-p.order),f=n.filter(v=>!v.visible).sort((v,p)=>(v.title||"").localeCompare(p.title||""));return{widgets:n,visibleWidgets:x,hiddenWidgets:f,isEditMode:a,setIsEditMode:o,reorderWidgets:l,toggleWidgetVisibility:c,updateWidgetSize:h,updateWidgetSpan:m,applyPreset:d,resetLayout:u}}const ai=()=>{const{user:e}=xe(),[s,n]=i.useState({totalStock:0,activeProducts:0,negativeStock:0,positiveStock:0,negativeUnits:0,positiveUnits:0,totalSystemUnits:0}),[r,a]=i.useState(0),[o,l]=i.useState(!0),[c,u]=i.useState(0),[h,m]=i.useState(null);return i.useEffect(()=>{(async()=>{if(e!=null&&e.branchName)try{const f=await Ne.getBranchConfig(e.branchName);u(f.days),m(f.startDate)}catch(f){console.error("Error loading branch config:",f)}})()},[e]),i.useEffect(()=>{(async()=>{l(!0);let f=0;try{f=await Jn()}catch(v){console.error("Error fetching product count:",v)}if(!(e!=null&&e.branchSheet)){n({totalStock:0,activeProducts:f,negativeStock:0,positiveStock:0,negativeUnits:0,positiveUnits:0,totalSystemUnits:0}),l(!1);return}try{const v=await Ne.getAllCyclicInventories(e.branchSheet),p=v.reduce((y,g)=>({negativeStock:y.negativeStock+g.negativeValue,positiveStock:y.positiveStock+g.positiveValue,totalStock:y.totalStock+g.differenceValue,negativeUnits:y.negativeUnits+g.negativeUnits,positiveUnits:y.positiveUnits+g.positiveUnits,totalSystemUnits:y.totalSystemUnits+g.totalSystemUnits,controlledCount:y.controlledCount+(g.status==="controlado"?1:0)}),{negativeStock:0,positiveStock:0,totalStock:0,negativeUnits:0,positiveUnits:0,totalSystemUnits:0,controlledCount:0}),b=v.length>0?Math.round(p.controlledCount/v.length*100):0;a(b),n({totalStock:p.totalStock,activeProducts:f,negativeStock:p.negativeStock,positiveStock:p.positiveStock,negativeUnits:p.negativeUnits,positiveUnits:p.positiveUnits,totalSystemUnits:p.totalSystemUnits})}catch(v){console.error("Error loading metrics:",v)}finally{l(!1)}})()},[e]),{metrics:s,globalProgress:r,assignedDays:c,cycleStartDate:h,updateConfig:async(x,f,v)=>{try{return await Ne.saveBranchConfig(x,f,v),await br.logAction({action:"CONFIG_UPDATE",entityType:"BRANCH_CONFIG",branchId:x,userId:e==null?void 0:e.id,details:{days:f,startDate:v}}),(e==null?void 0:e.branchName)===x&&(u(f),v&&m(v)),!0}catch(p){throw console.error("Error saving config:",p),p}},isLoading:o}},oi={small:"h-[200px]",medium:"h-[300px]",large:"h-[400px]",full:"h-auto"},ii={small:"col-span-1",medium:"col-span-1",large:"col-span-1",full:"col-span-full"},Ys={small:{label:"Pequeo",icon:da,description:"1/4 ancho (3 cols)"},medium:{label:"Mediano",icon:xa,description:"1/2 ancho (6 cols)"},large:{label:"Grande",icon:Ts,description:"1/3 ancho (4 cols)"},full:{label:"Ancho completo",icon:Ts,description:"Ancho completo (12 cols)"}};function li({currentSize:e,onChange:s,availableSizes:n=["small","medium","large"]}){const r=Ys[e].icon;return t.jsxs(jr,{children:[t.jsx(wr,{asChild:!0,children:t.jsx(M,{variant:"ghost",size:"icon",className:"h-6 w-6",title:"Cambiar tamao",children:t.jsx(r,{className:"h-4 w-4"})})}),t.jsx(Nr,{align:"end",children:n.map(a=>{const o=Ys[a],l=o.icon;return t.jsxs(Cr,{onClick:()=>s(a),className:L("flex items-center gap-2",e===a&&"bg-accent"),children:[t.jsx(l,{className:"h-4 w-4"}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-sm font-medium",children:o.label}),t.jsx("span",{className:"text-xs text-muted-foreground",children:o.description})]})]},a)})})]})}function ci({widget:e,isEditMode:s,onRemove:n,onSizeChange:r,children:a}){const{attributes:o,listeners:l,setNodeRef:c,transform:u,transition:h,isDragging:m}=Qo({id:e.id,disabled:!s}),d={transform:lt.Transform.toString(u),transition:h};return t.jsx("div",{ref:c,style:d,className:L(ii[e.size],m&&"opacity-50 z-50",s&&"cursor-move",oi[e.size]),children:t.jsx(yr,{hoverEffect:s?"none":"lift",className:"h-full",children:t.jsxs("div",{className:L("relative h-full transition-all rounded-lg",s&&"ring-2 ring-primary/20 hover:ring-primary/40"),children:[s&&t.jsxs("div",{className:"absolute top-2 right-2 z-10 flex gap-1",children:[r&&t.jsx(li,{currentSize:e.size,onChange:r}),t.jsx(M,{variant:"ghost",size:"icon",className:"h-6 w-6 cursor-grab active:cursor-grabbing",...o,...l,children:t.jsx(ia,{className:"h-4 w-4"})}),!e.mandatory&&n&&t.jsx(M,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-destructive hover:text-destructive-foreground",onClick:n,children:t.jsx(Zs,{className:"h-4 w-4"})})]}),t.jsx("div",{className:"h-full",children:a})]})})})}const Xs={metrics:{id:"metrics",name:"Mtricas",icon:rt,description:"Indicadores financieros y de rendimiento"},inventory:{id:"inventory",name:"Inventario",icon:Qn,description:"Gestin y control de inventarios"},analytics:{id:"analytics",name:"Anlisis",icon:At,description:"Grficos y reportes analticos"},actions:{id:"actions",name:"Acciones",icon:as,description:"Acciones rpidas y utilidades"},alerts:{id:"alerts",name:"Alertas",icon:dt,description:"Notificaciones y recordatorios"},activity:{id:"activity",name:"Actividad",icon:rs,description:"Seguimiento de actividad y usuarios"}},Xt={"metrics-carousel":"metrics","active-products":"inventory","inventory-summary":"inventory","inventory-alerts":"alerts","upcoming-inventories":"inventory","branches-table":"activity","inventory-progress":"inventory","critical-products":"alerts","total-stock-value":"metrics","active-users":"activity","pending-inventories":"inventory","trends-chart":"analytics","top-products":"analytics","activity-timeline":"activity","category-distribution":"analytics","monthly-goals":"metrics","sync-status":"actions","quick-actions":"actions",countdown:"alerts","category-progress":"analytics",calendar:"actions"},di=new Set(["metrics-carousel","active-products","inventory-alerts","trends-chart","quick-actions"]);function ui({open:e,onOpenChange:s,hiddenWidgets:n,onAddWidget:r}){const[a,o]=i.useState(""),[l,c]=i.useState(null),u=i.useMemo(()=>{let d=n;return a&&(d=d.filter(x=>x.title.toLowerCase().includes(a.toLowerCase())||x.description.toLowerCase().includes(a.toLowerCase()))),l&&(d=d.filter(x=>Xt[x.type]===l)),d},[n,a,l]),h=i.useMemo(()=>{const d={};return u.forEach(x=>{const f=Xt[x.type]||"other";d[f]||(d[f]=[]),d[f].push(x)}),d},[u]),m=d=>{r(d),n.length===1&&s(!1)};return t.jsx(Js,{open:e,onOpenChange:s,children:t.jsxs(Qs,{className:"max-h-[90vh]",children:[t.jsxs(en,{children:[t.jsx(tn,{children:"Galera de Widgets"}),t.jsx(er,{children:"Explora y agrega widgets para personalizar tu dashboard"})]}),t.jsxs("div",{className:"px-4 space-y-4",children:[t.jsxs("div",{className:"relative",children:[t.jsx(sn,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),t.jsx(Z,{placeholder:"Buscar widgets...",value:a,onChange:d=>o(d.target.value),className:"pl-9"})]}),t.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[t.jsx(M,{variant:l===null?"default":"outline",size:"sm",onClick:()=>c(null),children:"Todos"}),Object.values(Xs).map(d=>{const x=d.icon,f=n.filter(v=>Xt[v.type]===d.id).length;return f===0?null:t.jsxs(M,{variant:l===d.id?"default":"outline",size:"sm",onClick:()=>c(d.id),className:"flex items-center gap-2",children:[t.jsx(x,{className:"h-4 w-4"}),d.name,t.jsx(Q,{variant:"secondary",className:"ml-1",children:f})]},d.id)})]})]}),t.jsx("div",{className:"px-4 pb-4 max-h-[50vh] overflow-y-auto",children:u.length===0?t.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[t.jsx("p",{className:"text-lg font-medium",children:n.length===0?"Todos los widgets estn visibles":"No se encontraron widgets"}),a&&t.jsx("p",{className:"text-sm mt-2",children:"Intenta con otra bsqueda o categora"})]}):t.jsx("div",{className:"space-y-6",children:Object.entries(h).map(([d,x])=>{const f=Xs[d];if(!f||x.length===0)return null;const v=f.icon;return t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-2 sticky top-0 bg-background py-2 z-10",children:[t.jsx(v,{className:"h-5 w-5 text-primary"}),t.jsx("h3",{className:"font-semibold",children:f.name}),t.jsx(Q,{variant:"outline",children:x.length})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:x.map(p=>{const b=p.icon,y=di.has(p.id);return t.jsxs(z,{className:L("hover:border-primary transition-all hover:shadow-md",y&&"border-primary/50"),children:[t.jsx(W,{className:"pb-3",children:t.jsx("div",{className:"flex items-start justify-between",children:t.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[t.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:t.jsx(b,{className:"h-4 w-4 text-primary"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(F,{className:"text-sm truncate",children:p.title}),y&&t.jsx(Sr,{className:"h-3 w-3 fill-yellow-400 text-yellow-400 flex-shrink-0"})]}),t.jsx(tr,{className:"text-xs mt-1 line-clamp-2",children:p.description})]})]})})}),t.jsx(V,{className:"pt-0",children:t.jsxs(M,{size:"sm",className:"w-full",onClick:()=>m(p.id),children:[t.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Agregar"]})})]},p.id)})})]},d)})})}),t.jsx(sr,{children:t.jsx(nr,{asChild:!0,children:t.jsx(M,{variant:"outline",children:"Cerrar"})})})]})})}function Un({events:e=[],selected:s,onSelect:n}){const[r,a]=Y.useState(s||new Date);Y.useEffect(()=>{s&&a(s)},[s]);const o=Dr(r),l=kr(o),c=Er(o,{locale:yt,weekStartsOn:1}),u=Ir(l,{locale:yt,weekStartsOn:1}),h=[];let m=c;for(;m<=u;){const b=[];for(let y=0;y<7;y++)b.push(m),m=Ar(m,1);h.push(b)}const d=Y.useMemo(()=>{const b=new Map;return e.forEach(y=>{const g=y.date;b.has(g)||b.set(g,[]),b.get(g).push(y)}),b},[e]),x=new Date,f=()=>a(b=>Pr(b,1)),v=()=>a(b=>Or(b,1)),p="h-10 w-10";return t.jsxs("div",{className:"w-full",children:[t.jsxs("div",{className:"flex items-center justify-between px-2 pb-2",children:[t.jsx("button",{onClick:f,className:"p-1 rounded hover:bg-muted/50",children:t.jsx(Lr,{className:"h-5 w-5 text-muted-foreground"})}),t.jsx("div",{className:"text-sm font-semibold",children:Ds(o,"LLLL yyyy",{locale:yt})}),t.jsx("button",{onClick:v,className:"p-1 rounded hover:bg-muted/50",children:t.jsx(rr,{className:"h-5 w-5 text-muted-foreground"})})]}),t.jsx("div",{className:"grid grid-cols-7 gap-1 px-1 text-xs text-muted-foreground mb-1",children:["LU","MA","MI","JU","VI","SA","DO"].map((b,y)=>t.jsx("div",{className:"flex items-center justify-center",children:t.jsx("div",{className:"h-10 w-10 flex items-center justify-center font-medium uppercase",children:b})},y))}),t.jsx("div",{className:"space-y-1",children:h.map((b,y)=>t.jsx("div",{className:"grid grid-cols-7 gap-1",children:b.map(g=>{const w=g.toISOString().slice(0,10),N=Mr(g,o),j=d.get(w)||[],S=j.length>0,D=s?Rr(g,s):!1,C=j.some(I=>{const O=Tr(I.date),H=zr(O,x);return H>=2&&H<=5}),k=D?"bg-primary text-primary-foreground":C?"hover:bg-primary/10 ring-2 ring-accent":"hover:bg-primary/10",T=t.jsx("button",{onClick:()=>n&&n(g),className:`flex items-center justify-center ${p} rounded-full transition-colors focus:outline-none ${N?"text-foreground":"text-muted-foreground"} ${k}`,children:t.jsxs("div",{className:"relative flex items-center justify-center w-full h-full",children:[t.jsx("span",{className:"text-sm font-medium",children:Ds(g,"d",{locale:yt})}),S&&t.jsx("span",{className:"absolute bottom-1.5 h-1.5 w-1.5 rounded-full bg-blue-500"})]})},w);if(S){const I=t.jsxs("div",{className:"space-y-1",children:[j.slice(0,5).map(O=>t.jsxs("div",{className:"text-xs",children:[t.jsx("div",{className:"font-medium",children:O.title}),t.jsxs("div",{className:"text-muted-foreground",children:[O.branch,"  ",O.sector]})]},O.id)),j.length>5&&t.jsxs("div",{className:"text-xs text-muted-foreground",children:["+",j.length-5," ms"]})]});return t.jsxs(ar,{children:[t.jsx(or,{asChild:!0,children:T}),t.jsx(ir,{side:"top",children:I})]},w)}return T})},y))})]})}function mi(e){const[s,n]=i.useState(!1);return i.useEffect(()=>{function r(o){n(o.matches)}const a=matchMedia(e);return a.addEventListener("change",r),n(a.matches),()=>a.removeEventListener("change",r)},[e]),s}const We={async getEvents(e,s=!1){let n=Ft.from("inventory_events").select("*").order("date",{ascending:!0});!s&&e&&(n=n.eq("branch_name",e));const{data:r,error:a}=await n;return a?(console.error("Error fetching events:",a),[]):r||[]},async addEvent(e){const{data:s,error:n}=await Ft.rpc("manage_inventory_event",{p_action:"CREATE",p_title:e.title,p_branch:e.branch_name,p_sector:e.sector,p_date:e.date});return n?(console.error("Error adding event via RPC:",n),null):s},async deleteEvent(e){const{error:s}=await Ft.rpc("manage_inventory_event",{p_action:"DELETE",p_id:e});return s?(console.error("Error deleting event via RPC:",s),!1):!0}};function hi({open:e,onOpenChange:s,initialDate:n}){const r=mi("(min-width: 768px)"),{user:a}=xe(),o=(a==null?void 0:a.role)==="admin",[l,c]=i.useState(n||new Date),[u,h]=i.useState([]),[m,d]=i.useState(!1),[x,f]=i.useState(""),[v,p]=i.useState(""),[b,y]=i.useState(""),[g,w]=i.useState(new Date().toISOString().slice(0,10));i.useEffect(()=>{e&&(N(),n&&(c(n),w(n.toISOString().slice(0,10))))},[e,n,a==null?void 0:a.branchName]);const N=async()=>{try{const C=await We.getEvents(a==null?void 0:a.branchName,o);h(C)}catch(C){console.error("Error loading events",C)}},j=async()=>{if(!x||!v||!b||!g){ae.error("Error","Completa todos los campos");return}try{const C=await We.addEvent({title:x,branch_name:v,sector:b,date:g});C&&(ae.success("Operacin exitosa","Evento creado"),h(k=>[...k,C]),d(!1),f(""),p(""),y(""))}catch{ae.error("Error","Error al crear evento")}},S=C=>{const k=C.toISOString().slice(0,10);return u.filter(T=>T.date===k)},D=()=>t.jsxs("div",{className:`flex ${r?"flex-row gap-6":"flex-col gap-4"} mt-4 h-full`,children:[t.jsx("div",{className:r?"w-1/2":"w-full",children:t.jsx(Un,{events:u.map(C=>({...C,branch:C.branch_name})),selected:l,onSelect:C=>{C&&(c(C),w(C.toISOString().slice(0,10)))}})}),t.jsxs("div",{className:r?"w-1/2 flex flex-col":"w-full",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-medium capitalize",children:l.toLocaleDateString("es-AR",{weekday:"long",day:"numeric",month:"long"})}),o&&t.jsxs(M,{size:"sm",onClick:()=>d(!m),variant:m?"ghost":"default",children:[m?t.jsx(Zs,{className:"w-4 h-4"}):t.jsx(Fe,{className:"w-4 h-4 mr-2"}),m?"Cancelar":"Evento"]})]}),m?t.jsxs("div",{className:"space-y-3 p-4 border rounded-lg bg-muted/40 animate-in slide-in-from-top-2",children:[t.jsx("h4",{className:"font-medium text-sm",children:"Nuevo Evento"}),t.jsx(Z,{placeholder:"Ttulo",value:x,onChange:C=>f(C.target.value)}),t.jsx(Z,{placeholder:"Sucursal",value:v,onChange:C=>p(C.target.value)}),t.jsx(Z,{placeholder:"Sector",value:b,onChange:C=>y(C.target.value)}),t.jsx(Z,{type:"date",value:g,onChange:C=>w(C.target.value)}),t.jsx(M,{className:"w-full",onClick:j,children:"Guardar"})]}):t.jsx("div",{className:"flex-1 overflow-y-auto space-y-3 pr-2 max-h-[500px]",children:S(l).length===0?t.jsx("div",{className:"flex flex-col items-center justify-center py-10 text-muted-foreground border-2 border-dashed rounded-lg",children:t.jsx("p",{children:"No hay eventos para este da"})}):S(l).map(C=>t.jsx("div",{className:"p-3 bg-card border rounded-lg shadow-sm",children:t.jsx("div",{className:"flex justify-between items-start",children:t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-foreground",children:C.title}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:[C.branch_name," - ",C.sector]})]})})},C.id))})]})]});return r?t.jsx(Mt,{open:e,onOpenChange:s,children:t.jsxs(Rt,{className:"max-w-4xl w-[90vw] h-[80vh] flex flex-col",children:[t.jsx(Tt,{children:t.jsx(zt,{children:"Calendario de Inventarios"})}),t.jsx("div",{className:"flex-1 overflow-hidden",children:t.jsx(D,{})})]})}):t.jsx(Js,{open:e,onOpenChange:s,children:t.jsxs(Qs,{className:"h-[90vh]",children:[t.jsx(en,{children:t.jsx(tn,{children:"Calendario de Inventarios"})}),t.jsx("div",{className:"px-4 pb-8 h-full overflow-y-auto",children:t.jsx(D,{})})]})})}const $n=[{id:"executive",name:"Ejecutivo",description:"Vista enfocada en mtricas financieras y tendencias",icon:Te,widgetIds:["metrics-carousel","total-stock-value","trends-chart","category-distribution","monthly-goals","branches-table"]},{id:"operational",name:"Operativo",description:"Vista para operaciones diarias e inventarios",icon:as,widgetIds:["metrics-carousel","active-products","countdown","inventory-alerts","upcoming-inventories","pending-inventories","quick-actions","category-progress"]},{id:"analytical",name:"Analtico",description:"Vista con grficos y anlisis detallados",icon:At,widgetIds:["metrics-carousel","trends-chart","category-distribution","top-products","category-progress","inventory-progress","critical-products"]},{id:"complete",name:"Completo",description:"Todos los widgets disponibles",icon:pn,widgetIds:["metrics-carousel","active-products","countdown","inventory-summary","inventory-alerts","upcoming-inventories","branches-table","inventory-progress","critical-products","total-stock-value","active-users","pending-inventories","trends-chart","top-products","activity-timeline","category-distribution","monthly-goals","sync-status","quick-actions","category-progress"]}];function fi({open:e,onOpenChange:s,onApplyPreset:n}){const r=a=>{n(a),s(!1)};return t.jsx(Mt,{open:e,onOpenChange:s,children:t.jsxs(Rt,{className:"max-w-3xl",children:[t.jsxs(Tt,{children:[t.jsx(zt,{children:"Layouts Predefinidos"}),t.jsx(nn,{children:"Selecciona un layout predefinido para configurar tu dashboard rpidamente"})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 py-4",children:$n.map(a=>{const o=a.icon;return t.jsxs(z,{className:L("p-4 cursor-pointer transition-all hover:border-primary hover:shadow-md","flex flex-col gap-3"),onClick:()=>r(a.id),children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:t.jsx(o,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-base",children:a.name}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.description})]})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[t.jsx(rn,{className:"h-3 w-3"}),t.jsxs("span",{children:[a.widgetIds.length," widgets incluidos"]})]}),t.jsx(M,{variant:"outline",size:"sm",className:"w-full mt-2",onClick:l=>{l.stopPropagation(),r(a.id)},children:"Aplicar Layout"})]},a.id)})}),t.jsx("div",{className:"flex justify-end gap-2 pt-2 border-t",children:t.jsx(M,{variant:"outline",onClick:()=>s(!1),children:"Cancelar"})})]})})}const xi={hidden:{opacity:0,y:20},show:{opacity:1,y:0}};function pi({isEditMode:e,setIsEditMode:s,onOpenPresets:n,onOpenGallery:r,onResetLayout:a,hasHiddenWidgets:o}){const{user:l}=xe(),c=()=>{const u=new Date().getHours();return u>=6&&u<12?"Buenos das":u>=12&&u<20?"Buenas tardes":"Buenas noches"};return t.jsxs(B.div,{variants:xi,className:"space-y-1",children:[t.jsx("div",{className:"text-muted-foreground text-xs font-normal",children:new Date().toLocaleDateString("es-AR",{weekday:"long",month:"short",day:"2-digit",year:"numeric"})}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h1",{className:"text-2xl font-medium tracking-tight text-foreground",children:[c(),", ",(l==null?void 0:l.role)==="admin"||(l==null?void 0:l.role)==="mod"?l==null?void 0:l.name.split(" ")[0]:(l==null?void 0:l.branchName)||"Sucursal"," ",t.jsx("span",{className:"wave",children:""})]}),t.jsxs("div",{className:"flex gap-2",children:[e&&t.jsxs(t.Fragment,{children:[t.jsxs(M,{variant:"outline",size:"sm",onClick:n,children:[t.jsx(pn,{className:"h-4 w-4 mr-2"}),"Presets"]}),t.jsxs(M,{variant:"outline",size:"sm",onClick:r,disabled:!o,children:[t.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Agregar Widget"]}),t.jsxs(M,{variant:"outline",size:"sm",onClick:a,children:[t.jsx(Br,{className:"h-4 w-4 mr-2"}),"Resetear"]})]}),at(l,"EDIT_DASHBOARD_LAYOUT")&&t.jsx(B.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:t.jsx(M,{variant:e?"default":"outline",size:"sm",onClick:()=>s(!e),className:L("relative overflow-hidden transition-all duration-300",e&&"bg-green-600 hover:bg-green-700"),children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ns,{mode:"wait",children:e?t.jsx(B.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},children:t.jsx(rn,{className:"h-4 w-4"})},"check"):t.jsx(B.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},children:t.jsx(ma,{className:"h-4 w-4"})},"edit")}),t.jsx("span",{children:e?"Guardar":"Editar Dashboard"})]})})})]})]})]})}function gi(){const{user:e}=xe(),[s,n]=i.useState([]),[r,a]=i.useState(!0),[o,l]=i.useState(0),c=Zn();i.useEffect(()=>{u();const x=setInterval(u,5e3);return()=>clearInterval(x)},[e==null?void 0:e.branchName]),i.useEffect(()=>{if(s.length<=1)return;const x=setInterval(()=>{l(f=>(f+1)%s.length)},4e3);return()=>clearInterval(x)},[s.length]);const u=async()=>{try{const x=await Ur(e==null?void 0:e.branchName),f=new Date,v=f.getMonth()+1,p=f.getFullYear(),b=p*100+v,y=[],g=new Map;x.forEach(w=>{const N=g.get(w.ean);(!N||w.timestamp>N.timestamp)&&g.set(w.ean,w)}),g.forEach(w=>{w.batches.forEach(N=>{if(N.quantity<=0||N.status&&N.status!=="active")return;const j=N.reminderMonths;if(!j)return;const S=N.expirationDate.split("/");if(S.length<2)return;let D=parseInt(S[0]),C=parseInt(S[1]);C<100&&(C+=2e3);const k=C*100+D,T=C*12+D,I=p*12+v;if(T-I<=j){const A=new Date(C,D-1,1).getTime()-f.getTime(),G=Math.ceil(A/(1e3*60*60*24));y.push({productName:w.productName,batchNumber:N.batchNumber,expirationDate:N.expirationDate,reminderMonths:j,daysUntilExpiry:G})}})}),y.sort((w,N)=>w.daysUntilExpiry-N.daysUntilExpiry),n(w=>JSON.stringify(w)===JSON.stringify(y)?w:y)}catch(x){console.error("Smart Analyst Error:",x)}finally{a(!1)}};if(r)return null;const h=s.length,m=h===0,d=s[o];return t.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"h-full",children:t.jsxs(z,{className:"flex flex-col h-full bg-card border-border/50 shadow-sm relative overflow-hidden group hover:shadow-md transition-all cursor-pointer",onClick:()=>c("/smart-analyst"),role:"button",tabIndex:0,children:[t.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-primary/20 to-transparent opacity-50"}),t.jsx(W,{className:"pb-2 pt-4 px-4",children:t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"Control de Vencimientos"}),m?t.jsx(nt,{className:"w-4 h-4 text-emerald-500"}):t.jsx(sa,{className:"w-4 h-4 text-primary"})]})}),t.jsxs(V,{className:"flex-1 flex flex-col px-4 pb-4 pt-0 min-h-0",children:[t.jsxs("div",{className:"flex items-baseline gap-2 mb-2",children:[t.jsx("span",{className:`text-3xl font-bold ${m?"text-emerald-600 dark:text-emerald-400":"text-foreground"}`,children:m?"Todo en Orden":`${h}`}),!m&&t.jsx("span",{className:"text-sm text-muted-foreground",children:"Alertas"})]}),m&&t.jsx("p",{className:"text-xs text-muted-foreground line-clamp-3",children:"No detectamos productos prximos a vencer segn tus recordatorios configurados."}),!m&&d&&t.jsx("div",{className:"flex-1 relative min-h-0 mb-2",children:t.jsx(ns,{mode:"wait",children:t.jsxs(B.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.2},className:"absolute inset-0 flex flex-col justify-center border-l-2 border-primary/50 pl-3 py-1",children:[t.jsx("p",{className:"font-medium text-sm truncate text-foreground leading-tight mb-1",title:d.productName,children:d.productName}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground/80",children:[t.jsxs("span",{className:"font-mono bg-muted/50 px-1 rounded text-[10px]",children:["Lote: ",d.batchNumber]}),t.jsx("span",{children:""}),t.jsxs("span",{className:d.daysUntilExpiry<=30?"text-red-500 font-medium":"text-amber-500",children:["Vence: ",d.expirationDate]})]})]},`${d.productName}-${d.batchNumber}`)})}),!m&&s.length>1&&t.jsx("div",{className:"flex gap-1 mb-2",children:s.slice(0,5).map((x,f)=>t.jsx("div",{className:`h-1 rounded-full transition-all duration-300 ${f===o%5?"w-4 bg-primary":"w-1.5 bg-primary/20"}`},f))}),!m&&t.jsxs(M,{className:"w-full h-8 text-xs mt-auto",size:"sm",variant:"outline",onClick:()=>c("/smart-analyst"),children:["Ver Detalles ",t.jsx($r,{className:"w-3 h-3 ml-2"})]})]})]})})}function vi({metrics:e}){const s=(o,l)=>{if(l===0)return{value:0,isPositive:!0};const c=o/l*100;return{value:Math.abs(Number(c.toFixed(1))),isPositive:c>=0}},n=s(e.negativeUnits+e.positiveUnits,e.totalSystemUnits),r=s(e.negativeUnits,e.totalSystemUnits),a=s(e.positiveUnits,e.totalSystemUnits);return t.jsx(Wr,{items:[{id:"net",label:"Diferencia Neta",value:e.totalStock,color:e.totalStock<0?"text-destructive":e.totalStock>0?"text-success":"text-foreground",icon:rt,prefix:"$",trend:n},{id:"negative",label:"Negativo Total",value:e.negativeStock,color:"text-destructive",icon:ss,prefix:"$",trend:r},{id:"positive",label:"Positivo Total",value:e.positiveStock,color:"text-success",icon:Te,prefix:"$",trend:a}]})}function bi({activeProducts:e}){return t.jsxs(z,{className:"h-full flex flex-col justify-between",children:[t.jsxs(W,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(F,{className:"text-sm font-medium",children:"Productos Activos"}),t.jsx(rs,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsxs(V,{children:[(()=>{const s=new Intl.NumberFormat("es-AR").format(e);let n="text-3xl";return s.length>8?n="text-xl":s.length>6&&(n="text-2xl"),t.jsx("div",{className:`${n} font-bold`,children:t.jsx(mn,{value:e})})})(),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Total en base de datos"})]})]})}function yi(){return t.jsxs(z,{className:"p-6 h-full",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h2",{className:"text-sm font-medium text-muted-foreground",children:"Resumen de Inventario"}),t.jsx("button",{className:"text-sm text-muted-foreground hover:text-foreground",children:"Ver detalles"})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Productos en Stock"}),t.jsx("span",{className:"text-sm font-medium",children:"85%"})]}),t.jsx(Vt,{value:85})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Productos con Bajo Stock"}),t.jsx("span",{className:"text-sm font-medium text-warning",children:"12%"})]}),t.jsx(Vt,{value:12,variant:"warning"})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Productos Agotados"}),t.jsx("span",{className:"text-sm font-medium text-destructive",children:"3%"})]}),t.jsx(Vt,{value:3,variant:"destructive"})]})]})]})}const ji=[{label:"Diferencia de Stock",icon:ts,message:"Hola, he detectado una diferencia de stock importante en...",color:"bg-orange-500/10 text-orange-600 hover:bg-orange-500/20 border-orange-200"},{label:"Confirmar Cierre",icon:oa,message:"El cierre del inventario cclico ha sido completado y verificado.",color:"bg-green-500/10 text-green-600 hover:bg-green-500/20 border-green-200"},{label:"Solicitud Urgente",icon:la,message:"Necesito autorizacin urgente para...",color:"bg-blue-500/10 text-blue-600 hover:bg-blue-500/20 border-blue-200"}],K={dark:"#08102E",blue:"#045598",light:"#a5b1e1ff"},wi=()=>t.jsxs("div",{className:"relative w-32 h-32 flex items-center justify-center",children:[t.jsx(B.div,{className:"absolute inset-0 rounded-full blur-xl opacity-50",style:{background:`radial-gradient(circle at center, ${K.light}, ${K.blue})`},animate:{scale:[.8,1,.9,.8],opacity:[.4,.6,.5,.4]},transition:{duration:5,repeat:1/0,ease:"easeInOut",times:[0,.4,.8,1]}}),t.jsx(B.div,{className:"absolute w-28 h-28 rounded-full blur-lg mix-blend-screen",style:{background:`conic-gradient(from 0deg, ${K.dark}, ${K.blue}, ${K.light}, ${K.dark})`},animate:{rotate:360,scale:[.9,1.1,1,.9]},transition:{rotate:{duration:7,repeat:1/0,ease:"linear"},scale:{duration:6,repeat:1/0,ease:"easeInOut"}}}),t.jsx(B.div,{className:"absolute w-24 h-24 rounded-full blur-md mix-blend-overlay",style:{background:`conic-gradient(from 180deg, ${K.light}, ${K.blue}, ${K.dark}, ${K.light})`},animate:{rotate:-360,scale:[1.1,.9,.95,1.1]},transition:{rotate:{duration:9,repeat:1/0,ease:"linear"},scale:{duration:8,repeat:1/0,ease:"easeInOut"}}}),t.jsxs(B.div,{className:"absolute w-20 h-20 rounded-full backdrop-blur-md z-10 flex items-center justify-center overflow-hidden",style:{background:"linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.05) 100%)",border:"1px solid rgba(255,255,255,0.3)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.37), inset 0 0 0 1px rgba(255,255,255,0.1)"},animate:{boxShadow:[`0 0 20px ${K.blue}40, inset 0 0 10px rgba(255,255,255,0.1)`,`0 0 35px ${K.light}50, inset 0 0 20px rgba(255,255,255,0.2)`,`0 0 20px ${K.blue}40, inset 0 0 10px rgba(255,255,255,0.1)`]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},children:[t.jsx("div",{className:"absolute top-0 left-0 w-full h-1/2 bg-gradient-to-b from-white/20 to-transparent opacity-50 pointer-events-none"}),t.jsx(ca,{className:"w-10 h-10 text-white drop-shadow-md relative z-10",strokeWidth:2})]})]});function Ni(){var m;const{user:e}=xe(),[s,n]=i.useState(""),r=i.useRef(null),[a,o]=i.useState(!1),l=d=>{const v=`https://teams.microsoft.com/l/chat/0/0?users=GHCoz@farmaplus.com.ar&message=${encodeURIComponent(d)}`;window.open(v,"_blank"),n("")},c=()=>{s.trim()&&l(s)},u=d=>{l(d)},h=d=>{d.key==="Enter"&&c()};return t.jsxs(z,{className:"h-full flex flex-col border-border/50 bg-gradient-to-br from-card/50 to-muted/20 backdrop-blur-sm overflow-hidden relative group",children:[t.jsx("div",{className:"absolute top-0 right-0 w-full h-full opacity-5 pointer-events-none",style:{background:`radial-gradient(circle at top right, ${K.light}, transparent 70%)`}}),t.jsx(W,{className:"pb-2 flex flex-row items-center justify-between space-y-0 relative z-10",children:t.jsx(F,{className:"text-lg font-medium tracking-tight",children:"Chat Teams"})}),t.jsxs(V,{className:"flex-1 flex flex-col gap-4 relative z-10 p-4",children:[t.jsxs("div",{className:"flex-1 flex flex-col justify-center items-center text-center -mt-4",children:[t.jsx(wi,{}),t.jsxs(B.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5},className:"space-y-1 relative z-20 mt-2",children:[t.jsxs("h3",{className:"font-semibold text-lg",children:["Hola ",((m=e==null?void 0:e.name)==null?void 0:m.split(" ")[0])||"Gonzalo"]}),t.jsx("p",{className:"text-muted-foreground text-xs max-w-[200px] mx-auto",children:"En qu puedo ayudarte hoy?"})]})]}),t.jsx("div",{className:"flex flex-wrap gap-2 justify-center mb-1",children:ji.map((d,x)=>t.jsxs(B.button,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.8+x*.1},onClick:()=>u(d.message),className:L("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-[10px] font-medium border transition-all duration-200 hover:scale-105 active:scale-95 shadow-sm bg-background/50 backdrop-blur-sm",d.color),children:[t.jsx(d.icon,{className:"h-3 w-3"}),d.label]},d.label))}),t.jsx("div",{className:"relative mt-auto",children:t.jsxs("div",{className:"relative flex items-center bg-background/80 backdrop-blur border rounded-full shadow-sm focus-within:ring-2 transition-all group-hover:shadow-md",style:{borderColor:`${K.light}30`},children:[t.jsx(M,{variant:"ghost",size:"icon",className:"h-10 w-10 text-muted-foreground hover:text-primary rounded-full shrink-0 ml-1",onClick:()=>o(!a),title:"Adjuntar Reporte",children:t.jsx(ua,{className:"h-4 w-4"})}),t.jsx(Z,{ref:r,value:s,onChange:d=>n(d.target.value),onKeyDown:h,placeholder:"Escribe tu mensaje...",className:"border-none shadow-none focus-visible:ring-0 bg-transparent h-10 px-2 text-sm"}),t.jsx(M,{onClick:c,size:"icon",className:"h-9 w-9 rounded-full mr-1 transition-all shrink-0",style:{backgroundColor:s.trim()?K.blue:void 0,opacity:s.trim()?1:.5},disabled:!s.trim(),children:t.jsx(ha,{className:"h-4 w-4 text-white"})})]})})]})]})}function Ci({open:e,onOpenChange:s,onEventAdded:n}){const[r,a]=i.useState(!1),[o,l]=i.useState(""),[c,u]=i.useState(""),[h,m]=i.useState("Farmacia"),[d,x]=i.useState(new Date().toISOString().slice(0,10)),f=async v=>{if(v.preventDefault(),!c||!d){ae.error("Datos incompletos","Sucursal y fecha son requeridas");return}a(!0);try{const p=await We.addEvent({title:o||`Inventario ${c}`,branch_name:c,sector:h,date:d});p?(ae.success("Evento agregado","El evento se cre correctamente"),n(p),s(!1),l(""),u(""),m("Farmacia")):ae.error("Error","No se pudo crear el evento")}catch(p){console.error(p),ae.error("Error inesperado","Ocurri un error al procesar la solicitud")}finally{a(!1)}};return t.jsx(Mt,{open:e,onOpenChange:s,children:t.jsxs(Rt,{className:"sm:max-w-[425px]",children:[t.jsxs(Tt,{children:[t.jsx(zt,{children:"Programar Inventario"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Complete los datos del nuevo evento de inventario."})]}),t.jsxs("form",{onSubmit:f,className:"space-y-4 py-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(Me,{htmlFor:"branch",children:"Sucursal"}),t.jsxs(ks,{value:c,onValueChange:u,children:[t.jsx(Es,{children:t.jsx(Is,{placeholder:"Seleccionar sucursal"})}),t.jsx(As,{className:"max-h-[200px]",children:lr.map(v=>t.jsx(jt,{value:v,children:v},v))})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(Me,{htmlFor:"sector",children:"Sector"}),t.jsxs(ks,{value:h,onValueChange:m,children:[t.jsx(Es,{children:t.jsx(Is,{placeholder:"Seleccionar sector"})}),t.jsxs(As,{children:[t.jsx(jt,{value:"Farmacia",children:"Farmacia"}),t.jsx(jt,{value:"Perfumera",children:"Perfumera"}),t.jsx(jt,{value:"General",children:"General"})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(Me,{htmlFor:"date",children:"Fecha"}),t.jsx(Z,{id:"date",type:"date",value:d,onChange:v=>x(v.target.value),required:!0})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(Me,{htmlFor:"title",children:"Ttulo (Opcional)"}),t.jsx(Z,{id:"title",placeholder:"Ej. Inventario Anual",value:o,onChange:v=>l(v.target.value)})]}),t.jsxs(cr,{className:"pt-4",children:[t.jsx(M,{type:"button",variant:"outline",onClick:()=>s(!1),children:"Cancelar"}),t.jsxs(M,{type:"submit",disabled:r,children:[r&&t.jsx(Fr,{className:"mr-2 h-4 w-4 animate-spin"}),"Guardar Evento"]})]})]})]})})}function Si({onDateClick:e}){const{user:s}=xe(),n=(s==null?void 0:s.role)==="admin",[r,a]=i.useState([]),[o,l]=i.useState(!0),[c,u]=i.useState(!1);i.useEffect(()=>{h()},[s==null?void 0:s.branchName]);const h=async()=>{try{const m=await We.getEvents(s==null?void 0:s.branchName,n),d=new Date().toISOString().slice(0,10),x=m.filter(f=>f.date>=d).sort((f,v)=>f.date.localeCompare(v.date)).slice(0,5).map(f=>({id:f.id,branch:f.branch_name||f.branchId,sector:f.sector||f.description,date:f.date,formattedDate:new Date(f.date+"T12:00:00").toLocaleDateString("es-AR",{weekday:"long",day:"numeric",month:"long"})}));a(x)}catch(m){console.error("Error loading upcoming inventories:",m)}finally{l(!1)}};return t.jsxs(z,{className:"p-6 h-full flex flex-col relative",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-sm font-medium text-muted-foreground",children:"Prximos Inventarios"}),t.jsx("div",{className:"flex gap-1",children:at(s,"MANAGE_CALENDAR_EVENTS")&&t.jsx(M,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>u(!0),title:"Programar Nuevo",children:t.jsx(Fe,{className:"h-4 w-4"})})})]}),t.jsx("div",{className:"space-y-4 flex-1",children:o?t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-12 bg-muted/20 animate-pulse rounded-lg"}),t.jsx("div",{className:"h-12 bg-muted/20 animate-pulse rounded-lg"}),t.jsx("div",{className:"h-12 bg-muted/20 animate-pulse rounded-lg"}),t.jsx("div",{className:"h-12 bg-muted/20 animate-pulse rounded-lg"}),t.jsx("div",{className:"h-12 bg-muted/20 animate-pulse rounded-lg"})]}):r.length===0?t.jsx("div",{className:"h-full flex flex-col items-center justify-center text-center p-4 border rounded-lg border-dashed bg-muted/20",children:t.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"No hay inventarios prximos"})}):r.map(m=>t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-lg cursor-pointer hover:bg-muted transition-colors",onClick:()=>e==null?void 0:e(m.date),children:[t.jsx(xn,{className:"w-5 h-5 text-primary mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("p",{className:"text-sm font-medium text-foreground",children:[m.branch," - ",m.sector]}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1 text-left block",children:m.formattedDate})]})]},m.id))}),t.jsx(Ci,{open:c,onOpenChange:u,onSuccess:h})]})}const Ks=8;function Di({branches:e}){const{selectBranch:s,clearBranchSelection:n,user:r}=xe(),[a,o]=i.useState(""),[l,c]=i.useState(!1),[u,h]=i.useState([]),[m,d]=i.useState(!0),[x,f]=i.useState({key:"progress",direction:"descending"});i.useEffect(()=>{(async()=>{d(!0);try{const S=await Ne.getBranchesSummary();h(S)}catch(S){console.error("Failed to load branch summaries",S)}finally{d(!1)}})()},[]);const v=i.useMemo(()=>u.filter(j=>j.branchName.toLowerCase().includes(a.toLowerCase())),[u,a]),p=i.useMemo(()=>{let j=[...v];return x.key&&j.sort((S,D)=>{const C=S[x.key],k=D[x.key];return C<k?x.direction==="ascending"?-1:1:C>k?x.direction==="ascending"?1:-1:0}),j},[v,x]),b=j=>{let S="ascending";x.key===j&&x.direction==="ascending"&&(S="descending"),f({key:j,direction:S})},y=l?p:p.slice(0,Ks),g=j=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(j),w=j=>{(r==null?void 0:r.branchName)===j?n==null||n():s&&(s(j),window.scrollTo({top:0,behavior:"smooth"}))},N=j=>(r==null?void 0:r.branchName)===j;return t.jsx(B.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},className:"w-full",children:t.jsxs(z,{className:"p-6 overflow-hidden border-t-4 border-t-primary shadow-md",children:[t.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between mb-8 gap-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[t.jsx(Te,{className:"w-6 h-6 text-primary"}),"Monitor de Sucursales"]}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Estado en tiempo real de inventarios cclicos y cumplimiento."})]}),t.jsxs("div",{className:"relative w-full md:w-72",children:[t.jsx(sn,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),t.jsx(Z,{placeholder:"Buscar sucursal...",value:a,onChange:j=>o(j.target.value),className:"pl-10 h-10 bg-muted/50 border-0 focus-visible:ring-1 focus-visible:ring-primary"})]})]}),t.jsx("div",{className:"rounded-xl border bg-card/50 overflow-hidden",children:t.jsxs(Vr,{children:[t.jsx(Hr,{className:"bg-muted/40 hover:bg-muted/50 transition-colors",children:t.jsxs(Ht,{children:[t.jsx(je,{className:"w-[200px] cursor-pointer",onClick:()=>b("branchName"),children:t.jsxs("div",{className:"flex items-center font-semibold text-foreground",children:["Sucursal",t.jsx(Ss,{className:"ml-2 h-3 w-3 opacity-50"})]})}),t.jsx(je,{className:"text-center cursor-pointer hidden md:table-cell",onClick:()=>b("deploymentDate"),children:"Fecha Inicio"}),t.jsx(je,{className:"text-center hidden lg:table-cell",children:"Vuelta"}),t.jsx(je,{className:"text-center hidden lg:table-cell",children:"Obj. Mensual"}),t.jsx(je,{className:"text-center cursor-pointer",onClick:()=>b("progress"),children:t.jsxs("div",{className:"flex items-center justify-center font-semibold text-foreground",children:["% Avance",t.jsx(Ss,{className:"ml-2 h-3 w-3 opacity-50"})]})}),t.jsx(je,{className:"text-center hidden md:table-cell",children:"Un. Inventario"}),t.jsx(je,{className:"text-center cursor-pointer hidden md:table-cell",onClick:()=>b("differenceUnits"),children:"Diferencia"}),t.jsx(je,{className:"text-right cursor-pointer",onClick:()=>b("adjustmentsValue"),children:"$ Ajustes"}),t.jsx(je,{className:"text-center w-[120px]",children:"Status"})]})}),t.jsx(Gr,{children:m?Array.from({length:5}).map((j,S)=>t.jsxs(Ht,{children:[t.jsx(U,{children:t.jsx("div",{className:"h-5 w-32 bg-muted rounded animate-pulse"})}),t.jsx(U,{className:"hidden md:table-cell",children:t.jsx("div",{className:"h-5 w-20 bg-muted rounded animate-pulse mx-auto"})}),t.jsx(U,{className:"hidden lg:table-cell",children:t.jsx("div",{className:"h-5 w-10 bg-muted rounded animate-pulse mx-auto"})}),t.jsx(U,{className:"hidden lg:table-cell",children:t.jsx("div",{className:"h-5 w-12 bg-muted rounded animate-pulse mx-auto"})}),t.jsx(U,{children:t.jsx("div",{className:"h-5 w-16 bg-muted rounded animate-pulse mx-auto"})}),t.jsx(U,{className:"hidden md:table-cell",children:t.jsx("div",{className:"h-5 w-16 bg-muted rounded animate-pulse mx-auto"})}),t.jsx(U,{className:"hidden md:table-cell",children:t.jsx("div",{className:"h-5 w-16 bg-muted rounded animate-pulse mx-auto"})}),t.jsx(U,{className:"text-right",children:t.jsx("div",{className:"h-5 w-24 bg-muted rounded animate-pulse ml-auto"})}),t.jsx(U,{children:t.jsx("div",{className:"h-6 w-20 bg-muted rounded-full animate-pulse mx-auto"})})]},S)):y.length>0?y.map((j,S)=>t.jsxs(B.tr,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:S*.05},onClick:()=>w(j.branchName),className:L("group cursor-pointer hover:bg-muted/50 transition-all border-b last:border-0",N(j.branchName)&&"bg-primary/5 hover:bg-primary/10 border-l-4 border-l-primary"),children:[t.jsxs(U,{className:"font-medium text-foreground relative",children:[N(j.branchName)&&t.jsx(B.div,{layoutId:"active-indicator",className:"absolute left-0 top-0 bottom-0 w-1 bg-primary"}),j.branchName]}),t.jsx(U,{className:"text-center text-muted-foreground text-sm hidden md:table-cell",children:j.deploymentDate}),t.jsxs(U,{className:"text-center text-muted-foreground text-sm hidden lg:table-cell",children:[j.cyclicRound,""]}),t.jsx(U,{className:"text-center text-muted-foreground text-sm hidden lg:table-cell",children:j.monthlyGoal}),t.jsx(U,{className:"text-center",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsxs("span",{className:L("font-bold text-sm",j.progress>=j.monthlyGoal?"text-green-600":"text-foreground"),children:[j.progress,"%"]}),t.jsx("div",{className:"w-16 h-1.5 bg-muted rounded-full overflow-hidden mt-1",children:t.jsx("div",{className:L("h-full rounded-full transition-all",j.progress>=100?"bg-green-500":"bg-primary"),style:{width:`${Math.min(j.progress,100)}%`}})})]})}),t.jsx(U,{className:"text-center font-mono text-sm hidden md:table-cell",children:j.inventoryUnits}),t.jsx(U,{className:"text-center font-mono text-sm hidden md:table-cell",children:t.jsxs("span",{className:j.differenceUnits===0?"text-muted-foreground":j.differenceUnits>0?"text-green-600":"text-red-600",children:[j.differenceUnits>0?"+":"",j.differenceUnits]})}),t.jsx(U,{className:"text-right font-mono text-sm",children:t.jsx("span",{className:j.adjustmentsValue===0?"text-muted-foreground":j.adjustmentsValue>0?"text-green-600":"text-red-600",children:g(j.adjustmentsValue)})}),t.jsx(U,{className:"text-center",children:j.status==="controlado"?t.jsxs(Q,{variant:"outline",className:"font-normal border bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30",children:[t.jsx(dr,{className:"w-3 h-3 mr-1"})," FINALIZADA"]}):j.status==="por_controlar"?t.jsxs(Q,{variant:"outline",className:"font-normal border bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30",children:[t.jsx(ut,{className:"w-3 h-3 mr-1"})," EN PROCESO"]}):t.jsxs(Q,{variant:"outline",className:"font-normal border bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30",children:[t.jsx(dt,{className:"w-3 h-3 mr-1"})," PENDIENTE"]})})]},j.branchName)):t.jsx(Ht,{children:t.jsx(U,{colSpan:9,className:"h-24 text-center text-muted-foreground",children:"No se encontraron sucursales con esa bsqueda."})})})]})}),p.length>Ks&&t.jsx("div",{className:"mt-4 flex justify-center",children:t.jsx(M,{variant:"ghost",size:"sm",onClick:()=>c(!l),className:"text-muted-foreground hover:text-foreground",children:l?"Mostrar menos":`Ver todas las sucursales (${p.length})`})})]})})}function ki({completedCount:e,totalCount:s}){const n=s>0?Math.round(e/s*100):0,r=()=>n>=80?"text-success":n>=50?"text-warning":"text-destructive";return t.jsxs(z,{className:"h-full flex flex-col justify-between",children:[t.jsxs(W,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(F,{className:"text-sm font-medium",children:"Progreso"}),t.jsx(Te,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsxs(V,{children:[t.jsxs("div",{className:`text-xl font-bold ${r()}`,children:[n,"%"]}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e," de ",s," completados"]}),t.jsx(un,{value:n,className:"mt-2"})]})]})}function Ei({criticalCount:e,outOfStockCount:s}){const n=e>0||s>0;return t.jsxs(z,{className:"h-full flex flex-col justify-between",children:[t.jsxs(W,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(F,{className:"text-sm font-medium",children:"Crticos"}),t.jsx(ts,{className:`h-4 w-4 ${n?"text-destructive":"text-muted-foreground"}`})]}),t.jsxs(V,{children:[t.jsx("div",{className:`text-xl font-bold ${n?"text-destructive":"text-foreground"}`,children:e}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Productos con stock bajo"}),s>0&&t.jsxs(Q,{variant:"destructive",className:"mt-2",children:[s," agotados"]})]})]})}function Ii({totalValue:e,changePercentage:s}){const n=s!==void 0&&s>=0;return t.jsxs(z,{className:"h-full flex flex-col justify-between",children:[t.jsxs(W,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"Valor Total"}),t.jsx(rt,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsxs(V,{children:[t.jsxs("div",{className:"text-xl font-bold",children:["$",t.jsx(mn,{value:e})]}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Valor de inventario"}),s!==void 0&&t.jsxs("div",{className:`flex items-center gap-1 mt-2 text-xs ${n?"text-success":"text-destructive"}`,children:[n?t.jsx(Te,{className:"h-3 w-3"}):t.jsx(ss,{className:"h-3 w-3"}),t.jsxs("span",{children:[Math.abs(s).toFixed(1),"% vs mes anterior"]})]})]})]})}function Ai({activeCount:e,activeBranches:s}){return t.jsxs(z,{className:"h-full flex flex-col justify-between",children:[t.jsxs(W,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(F,{className:"text-sm font-medium",children:"Activos"}),t.jsxs("div",{className:"relative",children:[t.jsx(ln,{className:"h-4 w-4 text-muted-foreground"}),e>0&&t.jsx("span",{className:"absolute -top-1 -right-1 h-2 w-2 bg-success rounded-full animate-pulse"})]})]}),t.jsxs(V,{children:[t.jsx("div",{className:"text-xl font-bold",children:e}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Usuarios trabajando"}),s.length>0&&t.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[s.slice(0,2).map((n,r)=>t.jsx(Q,{variant:"secondary",className:"text-xs",children:n},r)),s.length>2&&t.jsxs(Q,{variant:"secondary",className:"text-xs",children:["+",s.length-2]})]})]})]})}function Mi({pendingCount:e,urgentCount:s}){return t.jsxs(z,{className:"h-full flex flex-col justify-between",children:[t.jsxs(W,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(F,{className:"text-sm font-medium",children:"Pendientes"}),t.jsx(ut,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsxs(V,{children:[t.jsx("div",{className:`text-xl font-bold ${e>0?"text-warning":"text-foreground"}`,children:e}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Inventarios sin completar"}),s>0&&t.jsxs(Q,{variant:"destructive",className:"mt-2",children:[s," urgentes"]})]})]})}function Ri({data:e=[]}){const[s,n]=i.useState("7d"),r=[{date:"01/12",negative:-1200,positive:800},{date:"02/12",negative:-950,positive:1100},{date:"03/12",negative:-1500,positive:900},{date:"04/12",negative:-800,positive:1300},{date:"05/12",negative:-1100,positive:950},{date:"06/12",negative:-900,positive:1200},{date:"07/12",negative:-1300,positive:1e3}],a=e.length>0?e:r;return t.jsxs(z,{className:"h-full",children:[t.jsxs(W,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[t.jsx(F,{className:"text-lg font-semibold",children:"Tendencias"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(M,{variant:s==="7d"?"default":"outline",size:"sm",onClick:()=>n("7d"),children:"7 das"}),t.jsx(M,{variant:s==="30d"?"default":"outline",size:"sm",onClick:()=>n("30d"),children:"30 das"})]})]}),t.jsx(V,{children:t.jsx(hn,{width:"100%",height:200,children:t.jsxs(_r,{data:a,children:[t.jsx(qr,{strokeDasharray:"3 3"}),t.jsx(Yr,{dataKey:"date",fontSize:12}),t.jsx(Xr,{fontSize:12}),t.jsx(fn,{}),t.jsx(Kr,{}),t.jsx(Ms,{type:"monotone",dataKey:"negative",stroke:"hsl(var(--destructive))",name:"Negativo",strokeWidth:2}),t.jsx(Ms,{type:"monotone",dataKey:"positive",stroke:"hsl(var(--success))",name:"Positivo",strokeWidth:2})]})})})]})}function Ti({products:e=[]}){const s=[{name:"Ibuprofeno 600mg",ean:"7798140250685",difference:-45,value:-2250,type:"negative"},{name:"Paracetamol 500mg",ean:"7798140250692",difference:32,value:1600,type:"positive"},{name:"Amoxicilina 500mg",ean:"7798140250708",difference:-28,value:-1680,type:"negative"},{name:"Omeprazol 20mg",ean:"7798140250715",difference:25,value:1500,type:"positive"},{name:"Losartn 50mg",ean:"7798140250722",difference:-20,value:-1200,type:"negative"}],n=e.length>0?e:s;return t.jsxs(z,{className:"h-full",children:[t.jsxs(W,{className:"pb-3",children:[t.jsx(F,{className:"text-lg font-semibold",children:"Top Diferencias"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Productos con mayores discrepancias"})]}),t.jsx(V,{children:t.jsx("div",{className:"space-y-3",children:n.map((r,a)=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("p",{className:"text-sm font-medium",children:r.name}),t.jsx(Q,{variant:r.type==="negative"?"destructive":"default",className:"text-xs",children:r.type==="negative"?"Faltante":"Sobrante"})]}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["EAN: ",r.ean]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:`flex items-center gap-1 ${r.type==="negative"?"text-destructive":"text-success"}`,children:[r.type==="negative"?t.jsx(ss,{className:"h-3 w-3"}):t.jsx(Te,{className:"h-3 w-3"}),t.jsx("span",{className:"text-sm font-semibold",children:Math.abs(r.difference)})]}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",Math.abs(r.value)]})]}),t.jsx(M,{variant:"ghost",size:"icon",className:"h-8 w-8",children:t.jsx(ea,{className:"h-4 w-4"})})]})]},a))})})]})}function zi({activities:e=[]}){const s=[{id:"1",type:"completed",title:"Inventario Farmacia completado",branch:"Belgrano IV",timestamp:"Hace 5 minutos",user:"Juan Prez"},{id:"2",type:"adjusted",title:"Ajustes realizados en Perfumera",branch:"Recoleta",timestamp:"Hace 15 minutos",user:"Mara Gonzlez"},{id:"3",type:"imported",title:"Inventario importado",branch:"Palermo II",timestamp:"Hace 1 hora",user:"Carlos Rodrguez"},{id:"4",type:"completed",title:"Pre-conteo finalizado",branch:"Microcentro",timestamp:"Hace 2 horas",user:"Ana Martnez"}],n=e.length>0?e:s,r=o=>{switch(o){case"completed":return t.jsx(nt,{className:"h-4 w-4 text-success"});case"adjusted":return t.jsx(fa,{className:"h-4 w-4 text-warning"});case"imported":return t.jsx(an,{className:"h-4 w-4 text-primary"})}},a=o=>{switch(o){case"completed":return"Completado";case"adjusted":return"Ajustado";case"imported":return"Importado"}};return t.jsxs(z,{className:"h-full",children:[t.jsxs(W,{className:"pb-3",children:[t.jsx(F,{className:"text-lg font-semibold",children:"Actividad Reciente"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"ltimas acciones realizadas"})]}),t.jsx(V,{children:t.jsx("div",{className:"space-y-4",children:n.map((o,l)=>t.jsxs("div",{className:"relative",children:[l<n.length-1&&t.jsx("div",{className:"absolute left-2 top-8 bottom-0 w-px bg-border"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"relative z-10 mt-1 rounded-full bg-background p-1 border",children:r(o.type)}),t.jsxs("div",{className:"flex-1 pb-4",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:o.title}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[o.branch,"  ",o.user]})]}),t.jsx(Q,{variant:"secondary",className:"text-xs",children:a(o.type)})]}),t.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-muted-foreground",children:[t.jsx(ut,{className:"h-3 w-3"}),t.jsx("span",{children:o.timestamp})]})]})]})]},o.id))})})]})}const we=["hsl(var(--chart-1))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))"];function Pi({data:e=[]}){const s=[{name:"Farmacia",value:450,color:we[0]},{name:"Perfumera",value:280,color:we[1]},{name:"Higiene",value:180,color:we[2]},{name:"Bebs",value:120,color:we[3]},{name:"Otros",value:90,color:we[4]}],n=e.length>0?e:s,r=n.reduce((a,o)=>a+o.value,0);return t.jsxs(z,{className:"h-full",children:[t.jsxs(W,{className:"pb-3",children:[t.jsx(F,{className:"text-lg font-semibold",children:"Distribucin por Categora"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Productos por categora"})]}),t.jsxs(V,{children:[t.jsx(hn,{width:"100%",height:200,children:t.jsxs(Zr,{children:[t.jsx(Jr,{data:n,cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:o})=>`${a} ${(o*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:n.map((a,o)=>t.jsx(Qr,{fill:a.color||we[o%we.length]},`cell-${o}`))}),t.jsx(fn,{})]})}),t.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2",children:n.map((a,o)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:a.color||we[o%we.length]}}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[a.name,": ",a.value," (",(a.value/r*100).toFixed(1),"%)"]})]},o))})]})]})}function Oi({goals:e=[]}){const s=[{title:"Inventarios Completados",current:45,target:60,badge:"75%"},{title:"Productos Controlados",current:1250,target:1500,badge:"83%"},{title:"Diferencias Resueltas",current:28,target:35,badge:"80%"}],n=e.length>0?e:s;return t.jsxs(z,{className:"h-full",children:[t.jsx(W,{className:"pb-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx(F,{className:"text-lg font-semibold",children:"Objetivos del Mes"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Progreso hacia metas"})]}),t.jsx(cn,{className:"h-5 w-5 text-primary"})]})}),t.jsx(V,{children:t.jsx("div",{className:"space-y-4",children:n.map((r,a)=>{const o=Math.round(r.current/r.target*100),l=o>=100;return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium",children:r.title}),l&&t.jsx(ta,{className:"h-4 w-4 text-success"})]}),t.jsxs(Q,{variant:l?"default":"secondary",children:[r.current,"/",r.target]})]}),t.jsx(un,{value:o,className:"h-2"}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:[o,"% completado"]})]},a)})})})]})}function Li({isOnline:e=!0,pendingCount:s=0,lastSync:n="Hace 5 minutos",onSync:r}){return t.jsxs(z,{className:"h-full",children:[t.jsx(W,{className:"pb-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(F,{className:"text-lg font-semibold",children:"Sincronizacin"}),e?t.jsx(dn,{className:"h-5 w-5 text-success"}):t.jsx(ur,{className:"h-5 w-5 text-destructive"})]})}),t.jsxs(V,{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Estado de Conexin"}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e?"Conectado":"Sin conexin"})]}),t.jsx(Q,{variant:e?"default":"destructive",children:e?"Online":"Offline"})]}),t.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Datos Pendientes"}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s>0?`${s} elementos`:"Todo sincronizado"})]}),s>0?t.jsx(Q,{variant:"warning",children:s}):t.jsx(nt,{className:"h-5 w-5 text-success"})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[t.jsx(ut,{className:"h-3 w-3"}),t.jsxs("span",{children:["ltima sincronizacin: ",n]})]}),t.jsxs(M,{className:"w-full",variant:s>0?"default":"outline",onClick:r,disabled:!e,children:[t.jsx(on,{className:"h-4 w-4 mr-2"}),s>0?"Sincronizar Ahora":"Actualizar"]})]})]})}function Bi({actions:e=[]}){const s=[{title:"Nuevo Pre-Conteo",description:"Iniciar nuevo pre-conteo",icon:Fe,onClick:()=>console.log("Nuevo Pre-Conteo"),variant:"default"},{title:"Importar Inventario",description:"Cargar desde Excel",icon:an,onClick:()=>console.log("Importar"),variant:"outline"},{title:"Ver Reportes",description:"Anlisis y estadsticas",icon:At,onClick:()=>console.log("Reportes"),variant:"outline"},{title:"Exportar Datos",description:"Descargar informacin",icon:mr,onClick:()=>console.log("Exportar"),variant:"outline"},{title:"Configuracin",description:"Ajustes del sistema",icon:hr,onClick:()=>console.log("Configuracin"),variant:"secondary"}],n=e.length>0?e:s;return t.jsxs(z,{className:"h-full",children:[t.jsxs(W,{className:"pb-3",children:[t.jsx(F,{className:"text-lg font-semibold",children:"Acciones Rpidas"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Tareas frecuentes"})]}),t.jsx(V,{children:t.jsx("div",{className:"grid grid-cols-2 gap-3",children:n.map((r,a)=>{const o=r.icon;return t.jsxs(M,{variant:r.variant||"outline",className:"h-auto flex-col items-start p-4 gap-2",onClick:r.onClick,children:[t.jsx(o,{className:"h-5 w-5"}),t.jsxs("div",{className:"text-left",children:[t.jsx("p",{className:"text-sm font-medium",children:r.title}),t.jsx("p",{className:"text-xs text-muted-foreground font-normal",children:r.description})]})]},a)})})})]})}function Ui({assignedDays:e=0,startDate:s,totalProgress:n=0,isEditable:r=!1,onEdit:a}){const o=i.useMemo(()=>{if(!s||e===0)return{daysRemaining:0,daysElapsed:0,timeProgress:0,status:"pending",expectedProgress:0,isDelayed:!1,segments:[0,0,0]};const h=new Date(s),d=new Date().getTime()-h.getTime(),x=Math.max(0,Math.floor(d/(1e3*60*60*24))),f=Math.max(0,e-x),v=Math.min(100,x/e*100),p=Math.round(v),b=n<p-5,y=n>p+15;let g="on-track";b?g="behind":y&&(g="ahead");const w=3,N=100/w,j=Array.from({length:w}).map((S,D)=>{const C=(D+1)*N;return n>=C?100:n<=D*N?0:(n-D*N)/N*100});return{daysRemaining:f,daysElapsed:x,timeProgress:v,status:g,expectedProgress:p,isDelayed:b,segments:j}},[s,e,n]),l=()=>e===0?"text-muted-foreground":o.status==="behind"?"text-destructive":o.status==="ahead"?"text-blue-500":"text-green-500",c=()=>e===0?"Sin configurar":o.status==="behind"?"Retrasado":o.status==="ahead"?"Adelantado":"Al da",u=()=>e===0?t.jsx(pa,{className:"h-4 w-4"}):o.status==="behind"?t.jsx(dt,{className:"h-4 w-4"}):o.status==="ahead"?t.jsx(nt,{className:"h-4 w-4"}):t.jsx(nt,{className:"h-4 w-4"});return t.jsxs(z,{className:"h-full flex flex-col overflow-hidden relative group/card border-border/50 bg-card/50 backdrop-blur-sm",children:[t.jsxs(W,{className:"flex flex-row items-center justify-between space-y-0 px-5 pt-4 pb-2",children:[t.jsx(F,{className:"text-sm font-semibold tracking-tight",children:"Plazo de Inventario"}),t.jsxs("div",{className:"flex items-center gap-2",children:[r&&t.jsx("button",{onPointerDown:h=>h.stopPropagation(),onClick:h=>{h.stopPropagation(),a==null||a()},className:"relative z-50 text-muted-foreground hover:text-primary transition-colors opacity-0 group-hover/card:opacity-100 cursor-pointer",title:"Configurar plazo",children:t.jsx(St,{className:"h-4 w-4"})}),!r&&t.jsx(St,{className:"h-4 w-4 text-muted-foreground"})]})]}),t.jsxs(V,{className:"flex flex-col justify-between flex-1 px-5 pb-5 pt-1 gap-4",children:[t.jsxs("div",{className:"flex items-end justify-between",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-[10px] text-muted-foreground font-bold uppercase tracking-widest mb-0.5",children:"Asignados"}),t.jsx("span",{className:"text-3xl font-black tracking-tighter text-foreground leading-none",children:e>0?e:"--"})]}),t.jsx("div",{className:"h-10 w-px bg-border/40 mx-2"}),t.jsxs("div",{className:"flex flex-col items-end",children:[t.jsx("span",{className:"text-[10px] text-muted-foreground font-bold uppercase tracking-widest mb-0.5",children:"Restantes"}),t.jsx("span",{className:L("text-3xl font-black tracking-tighter leading-none",o.daysRemaining<7&&e>0?"text-destructive":"text-foreground"),children:e>0?o.daysRemaining:"--"})]})]}),t.jsxs("div",{className:"bg-muted/30 rounded-xl p-3 border border-border/50",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"flex items-center gap-1.5",children:t.jsxs("span",{className:L("flex items-center gap-1 text-[10px] font-bold uppercase tracking-wider",l()),children:[u(),c()]})}),t.jsxs("span",{className:"text-xs font-bold",children:[n,"% ",t.jsx("span",{className:"text-[10px] font-normal text-muted-foreground ml-1",children:"real"})]})]}),t.jsxs("div",{className:"h-1.5 w-full bg-muted/50 rounded-full overflow-hidden relative",children:[t.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-foreground/20 z-10",style:{left:`${o.expectedProgress}%`}}),t.jsx("div",{className:L("h-full transition-all duration-700 rounded-full",o.status==="behind"?"bg-destructive":"bg-primary"),style:{width:`${n}%`}})]}),t.jsxs("div",{className:"flex justify-between mt-1 text-[9px] text-muted-foreground font-medium uppercase tracking-tighter",children:[t.jsx("span",{children:"Inicio"}),t.jsx("span",{style:{marginLeft:`${o.expectedProgress-5}%`},children:"Objetivo Hoy"}),t.jsx("span",{children:"Meta"})]})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsx("span",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-wider block",children:"Avance por Periodos"}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:o.segments.map((h,m)=>t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"h-1 w-full bg-muted/50 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-foreground/40 transition-all duration-1000",style:{width:`${h}%`}})}),t.jsxs("div",{className:"text-[9px] text-center font-bold text-muted-foreground/70",children:["M",m+1,": ",Math.round(h),"%"]})]},m))})]})]})]})}function $i(){const{user:e}=xe(),[s,n]=i.useState([]),[r,a]=i.useState(!0),[o,l]=i.useState(null);i.useEffect(()=>{(async()=>{if(!(e!=null&&e.branchSheet)){a(!1);return}try{const h=await pr(e.branchSheet),m=await Ne.getAllCyclicInventories(e.branchSheet)||[],d=new Map(m.map(g=>[g.labName,g.status])),x=await Ne.getBranchConfig(e.branchSheet);let f=0;if(x.startDate){const g=new Date(x.startDate),N=Math.abs(new Date().getTime()-g.getTime());f=Math.ceil(N/864e5)}const v=async(g,w,N)=>{if(f>=w){const j=await Ne.getCycleClosures(e.branchSheet,g);if(!(Object.keys(j).length>0)){console.log(`Auto-closing Period ${g} (Day ${w} reached)`);const D=Object.entries(N).map(([C,k])=>({name:C,percentage:k.total>0?Math.round(k.controlled/k.total*100):0}));return await Ne.saveCycleClosure(e.branchSheet,g,D),ae.success(`Cierre automtico del Periodo ${g} completado.`),!0}}return!1},p={Medicamentos:{total:0,controlled:0},Perfumera:{total:0,controlled:0},Accesorios:{total:0,controlled:0},Varios:{total:0,controlled:0}};h.forEach(g=>{let w="Varios";const N=(g.category||"").toUpperCase();N==="MEDICAMENTOS"?w="Medicamentos":N==="PERFUMERIA"?w="Perfumera":N==="ACCESORIOS"&&(w="Accesorios");const S=d.get(g.name)==="controlado";p[w].total+=1,S&&(p[w].controlled+=1)}),await v(1,30,p),await v(2,60,p);const b=await Ne.getCycleClosures(e.branchSheet||"",1),y=Object.entries(p).map(([g,w])=>{const N=w.total>0?Math.round(w.controlled/w.total*100):0,j=b[g.toUpperCase()]||0;return{name:g,totalItems:w.total,controlledItems:w.controlled,percentage:N,previousPercentage:Math.min(j,N)}});n(y)}catch(h){console.error("Error loading category progress:",h)}finally{a(!1)}})()},[e]);const c=i.useMemo(()=>{if(o)return s.find(d=>d.name===o)||null;const u=s.reduce((d,x)=>d+x.totalItems,0),h=s.reduce((d,x)=>d+x.controlledItems,0);return{name:"Avance Global",percentage:u>0?Math.round(h/u*100):0,totalItems:u,controlledItems:h}},[s,o]);return r?t.jsx(z,{className:"h-full border-none shadow-none flex items-center justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):t.jsxs(z,{className:"h-full flex flex-col border-border/50 bg-card/50 backdrop-blur-sm overflow-hidden",children:[t.jsxs(W,{className:"pb-0 pt-4 px-5 flex flex-row items-center justify-between space-y-0 text-foreground",children:[t.jsx(F,{className:"text-xl font-medium tracking-tight",children:o?`Rubro: ${o}`:"Progreso de Inventario"}),t.jsx("div",{className:"flex items-center gap-1",children:t.jsx("button",{onClick:()=>l(null),className:"h-8 w-8 rounded-full bg-muted/50 flex items-center justify-center hover:bg-muted transition-colors",title:"Ver Avance Global",children:t.jsx(fr,{className:L("h-4 w-4 transition-transform",!o&&"rotate-180")})})})]}),t.jsxs(V,{className:"flex-1 p-5 pt-4 flex flex-col gap-6",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("div",{className:"flex items-baseline gap-2",children:t.jsx(ns,{mode:"wait",children:t.jsxs(B.span,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"text-6xl font-bold tracking-tighter",children:[c==null?void 0:c.percentage,"%"]},c==null?void 0:c.percentage)})}),t.jsx("p",{className:"text-sm text-muted-foreground font-medium mt-1",children:o?`Avance en ${o}`:"Avance total acumulado"})]}),t.jsx("div",{className:"flex-1 flex flex-col justify-end",children:t.jsx("div",{className:"flex items-end justify-between gap-3 h-48 mb-2 px-1",children:s.map(u=>{const h=o===u.name,m=u.previousPercentage>0,d=Math.max(...s.map(f=>f.totalItems)),x=d>0?Math.max(20,u.totalItems/d*100):20;return t.jsxs("div",{className:"flex-1 flex flex-col items-center gap-2 group cursor-pointer h-full justify-end",onClick:()=>l(o===u.name?null:u.name),children:[t.jsx("span",{className:L("text-[10px] font-bold transition-colors mb-1",h?"text-primary":"text-muted-foreground/70"),children:u.totalItems}),t.jsxs(B.div,{className:L("w-full rounded-2xl overflow-hidden flex flex-col justify-end relative transition-all duration-300 bg-secondary dark:bg-muted/20",h?"ring-2 ring-primary ring-offset-2 ring-offset-background":"hover:bg-secondary/80 dark:hover:bg-muted/30"),initial:{height:0},animate:{height:`${x}%`},transition:{type:"spring",stiffness:300,damping:30},children:[t.jsxs("div",{className:"absolute -top-10 left-1/2 -translate-x-1/2 bg-foreground text-background text-[10px] font-bold px-2 py-1 rounded-md opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-20 shadow-lg pointer-events-none",children:[u.percentage,"% (",u.controlledItems,"/",u.totalItems,")"]}),t.jsx(B.div,{className:L("w-full absolute bottom-0 left-0 right-0 z-10 transition-colors duration-300",h?"bg-primary":"bg-muted-foreground/40 group-hover:bg-muted-foreground/50"),initial:{height:0},animate:{height:`${u.percentage}%`},transition:{duration:.5,delay:.1}}),m&&t.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-20 opacity-30 pointer-events-none",style:{height:`${u.previousPercentage}%`,backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 4px, currentColor 4px, currentColor 8px)",color:h?"white":"inherit"}}),u.percentage>0&&t.jsx(B.div,{className:"absolute left-1/2 -translate-x-1/2 w-1.5 h-1.5 bg-white rounded-full z-30 shadow-sm",style:{bottom:`calc(${u.percentage}% - 3px)`}})]}),t.jsx("span",{className:L("text-[10px] font-bold uppercase tracking-wider transition-colors",h?"text-foreground":"text-muted-foreground"),children:u.name.substring(0,3)})]},u.name)})})}),t.jsxs("div",{className:"pt-2 border-t border-border/40 flex justify-between items-center h-10",children:[t.jsxs("div",{className:"flex gap-4",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-widest leading-none",children:"Hechos"}),t.jsx("span",{className:"text-sm font-bold",children:c==null?void 0:c.controlledItems})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-widest leading-none",children:"Pendientes"}),t.jsx("span",{className:"text-sm font-bold",children:((c==null?void 0:c.totalItems)||0)-((c==null?void 0:c.controlledItems)||0)})]})]}),t.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-medium text-muted-foreground bg-muted/30 px-2 py-1 rounded-full border border-border/50",children:[t.jsx(xr,{className:"h-3 w-3"}),"Refresca cada 30 min"]})]})]})]})}function Wi(){const{user:e}=xe(),[s,n]=i.useState(new Date),[r,a]=i.useState([]),[o,l]=i.useState(!1),[c,u]=i.useState(""),[h,m]=i.useState(""),[d,x]=i.useState(""),[f,v]=i.useState(new Date().toISOString().slice(0,10));i.useEffect(()=>{p()},[e==null?void 0:e.branchName]);const p=async()=>{try{const w=(await We.getEvents()).map(N=>({id:N.id,title:N.title,branch:N.branch_name||N.branchId||"General",sector:N.sector||N.description||"",date:N.date.split("T")[0]}));a(w)}catch(g){console.error("Error loading events:",g)}},b=async()=>{if(!c||!h||!d||!f){ae.error("Error","Por favor completa todos los campos");return}try{await We.addEvent({title:c,branch_name:h,sector:d,date:f}),ae.success("Operacin exitosa","Evento agregado"),l(!1),u(""),m(""),x(""),v(new Date().toISOString().slice(0,10)),p()}catch{ae.error("Error","Error al crear evento")}},y=g=>{const w=g.toISOString().split("T")[0];return r.filter(N=>N.date===w)};return t.jsxs(z,{className:"h-full flex flex-col",children:[t.jsx(W,{className:"pb-2",children:t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(St,{className:"w-5 h-5 text-primary"}),t.jsx(F,{children:"Calendario"})]})})}),t.jsx(V,{className:"flex-1 p-4",children:t.jsxs("div",{className:"flex flex-col md:flex-row gap-6 h-full",children:[t.jsx("div",{className:"flex-1",children:t.jsx(Un,{selected:s,onSelect:n,events:r})}),t.jsxs("div",{className:"w-full md:w-80 flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"font-semibold capitalize",children:s.toLocaleDateString("es-AR",{weekday:"long",day:"numeric",month:"long"})}),t.jsx(M,{size:"sm",variant:o?"ghost":"outline",onClick:()=>l(!o),children:o?"Cancelar":t.jsxs(t.Fragment,{children:[t.jsx(Fe,{className:"w-4 h-4 mr-1"})," Evento"]})})]}),o?t.jsxs("div",{className:"p-3 bg-muted/50 border rounded-md space-y-3 mb-4 animate-in slide-in-from-top-2",children:[t.jsx(Z,{placeholder:"Ttulo",value:c,onChange:g=>u(g.target.value),className:"bg-background h-8"}),t.jsx(Z,{placeholder:"Sucursal",value:h,onChange:g=>m(g.target.value),className:"bg-background h-8"}),t.jsx(Z,{placeholder:"Sector",value:d,onChange:g=>x(g.target.value),className:"bg-background h-8"}),t.jsx(Z,{type:"date",value:f,onChange:g=>v(g.target.value),className:"bg-background h-8"}),t.jsx(M,{size:"sm",className:"w-full",onClick:b,children:"Guardar Evento"})]}):t.jsx("div",{className:"flex-1 overflow-auto space-y-2 pr-1",children:y(s).length===0?t.jsx("div",{className:"flex flex-col items-center justify-center h-20 text-muted-foreground text-sm border-2 border-dashed rounded-lg",children:"No hay eventos"}):y(s).map(g=>t.jsxs("div",{className:"p-3 bg-muted/50 hover:bg-muted border rounded-md transition-colors text-sm",children:[t.jsx("p",{className:"font-medium text-foreground",children:g.title}),t.jsxs("div",{className:"flex justify-between mt-1 text-xs text-muted-foreground",children:[t.jsx("span",{children:g.branch}),t.jsx("span",{children:g.sector})]})]},g.id))})]})]})})]})}const Fi=({widgetType:e,user:s,metrics:n,globalProgress:r,assignedDays:a,cycleStartDate:o,onDateClick:l,onEditConfig:c})=>{switch(e){case"smart-analyst":return t.jsx(gi,{});case"metrics-carousel":return t.jsx(vi,{metrics:n});case"active-products":return t.jsx(bi,{activeProducts:n.activeProducts});case"inventory-summary":return t.jsx(yi,{});case"inventory-alerts":return t.jsx(Ni,{});case"upcoming-inventories":return t.jsx(Si,{onDateClick:l});case"branches-table":return at(s,"VIEW_BRANCH_MONITOR")?t.jsx(Di,{branches:[{name:"Belgrano IV",address:"Av. Cabildo 2040",zonal:"Zona Norte",email:"belgrano4@farmaplus.com"},{name:"Recoleta",address:"Av. Santa Fe 1860",zonal:"Zona Centro",email:"recoleta@farmaplus.com"},{name:"Palermo II",address:"Av. Las Heras 3520",zonal:"Zona Norte",email:"palermo2@farmaplus.com"},{name:"Microcentro",address:"Florida 520",zonal:"Zona Centro",email:"microcentro@farmaplus.com"},{name:"Belgrano III",address:"Av. Cabildo 1520",zonal:"Zona Norte",email:"belgrano3@farmaplus.com"},{name:"Villa Urquiza II",address:"Av. Triunvirato 4280",zonal:"Zona Norte",email:"villaurquiza2@farmaplus.com"}]}):null;case"inventory-progress":return t.jsx(ki,{completedCount:r,totalCount:100});case"critical-products":return t.jsx(Ei,{criticalCount:15,outOfStockCount:3});case"total-stock-value":return t.jsx(Ii,{totalValue:n.totalStock,changePercentage:5.2});case"active-users":return t.jsx(Ai,{activeCount:5,activeBranches:["Belgrano IV","Recoleta","Palermo II"]});case"pending-inventories":return t.jsx(Mi,{pendingCount:7,urgentCount:2});case"trends-chart":return t.jsx(Ri,{});case"top-products":return t.jsx(Ti,{});case"activity-timeline":return t.jsx(zi,{});case"category-distribution":return t.jsx(Pi,{});case"monthly-goals":return t.jsx(Oi,{});case"sync-status":return t.jsx(Li,{isOnline:navigator.onLine,pendingCount:0});case"quick-actions":return t.jsx(Bi,{});case"calendar":return t.jsx(Wi,{});case"countdown":return t.jsx(Ui,{assignedDays:a,startDate:o,totalProgress:r,isEditable:at(s,"MANAGE_INVENTORY_CONFIG"),onEdit:c});case"category-progress":return t.jsx($i,{});default:return null}};class Vi extends i.Component{constructor(){super(...arguments);Cs(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,r){console.error("Uncaught error in widget:",n,r)}render(){var n;return this.state.hasError?t.jsxs("div",{className:"h-full w-full flex flex-col items-center justify-center p-4 bg-destructive/5 text-center space-y-3 rounded-lg border border-destructive/20",children:[t.jsx(dt,{className:"w-8 h-8 text-destructive opacity-80"}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("h3",{className:"font-medium text-destructive",children:"Error en el widget"}),t.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 max-w-[200px]",children:((n=this.state.error)==null?void 0:n.message)||"Algo sali mal"})]}),t.jsxs(M,{variant:"outline",size:"sm",className:"h-8 text-xs gap-2",onClick:()=>this.setState({hasError:!1}),children:[t.jsx(on,{className:"w-3 h-3"}),"Reintentar"]})]}):this.props.children}}function Hi({open:e,onOpenChange:s,user:n,currentAssignedDays:r,currentStartDate:a,onSave:o}){const[l,c]=i.useState(""),[u,h]=i.useState(90),[m,d]=i.useState(0),[x,f]=i.useState(new Date().toISOString().split("T")[0]);i.useEffect(()=>{if(e){const p=r||90,y=[180,150,120,90].find(g=>g<=p)||90;c((n==null?void 0:n.branchName)||""),h(y),d(Math.max(0,p-y)),f(a?a.split("T")[0]:new Date().toISOString().split("T")[0])}},[e,r,a,n]);const v=async()=>{if(!(n!=null&&n.branchName))return;const p=u+m;try{await o(n.branchName,p,x),ae.success("Operacin exitosa",`Plazo actualizado a ${p} das`),s(!1)}catch{ae.error("Error","Error al guardar")}};return t.jsx(Mt,{open:e,onOpenChange:s,children:t.jsxs(Rt,{className:"max-w-md",children:[t.jsxs(Tt,{children:[t.jsx(zt,{children:"Configurar Plazo de Inventario"}),t.jsx(nn,{children:"Ajusta los parmetros del ciclo de inventario para esta sucursal."})]}),t.jsxs("div",{className:"space-y-6 py-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(Me,{className:"text-muted-foreground",children:"Sucursal Seleccionada"}),t.jsx("div",{className:"text-lg font-semibold border p-3 rounded-md bg-muted/50",children:(n==null?void 0:n.branchName)||"Sin sucursal asignada"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(Me,{children:"Das Base"}),t.jsx("div",{className:"grid grid-cols-4 gap-3",children:[90,120,150,180].map(p=>t.jsx("button",{onClick:()=>h(p),className:L("flex flex-col items-center justify-center p-3 rounded-lg border-2 transition-all",u===p?"border-primary bg-primary/10 text-primary font-bold":"border-muted hover:border-primary/50 text-muted-foreground"),children:t.jsx("span",{className:"text-xl",children:p})},p))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(Me,{children:"Prroga (Das adicionales)"}),t.jsxs("div",{className:"flex gap-4 items-center",children:[t.jsx(Z,{type:"number",placeholder:"0",className:"text-lg font-medium",value:m,onChange:p=>d(Number(p.target.value)),min:0}),t.jsxs("div",{className:"text-sm text-muted-foreground text-nowrap",children:["Total: ",t.jsx("span",{className:"font-bold text-foreground mx-1 text-lg",children:u+m})," das"]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(Me,{children:"Fecha de Inicio del Ciclo"}),t.jsx(Z,{type:"date",value:x,onChange:p=>f(p.target.value),className:"bg-background"}),t.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Esta fecha se usa para calcular los das restantes y el ritmo de avance."})]}),t.jsx(M,{className:"w-full mt-2",onClick:v,children:"Guardar Configuracin"})]})]})})}const Gi={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}};function kl(){const{user:e}=xe(),{metrics:s,globalProgress:n,assignedDays:r,cycleStartDate:a,updateConfig:o,isLoading:l}=ai(),{visibleWidgets:c,hiddenWidgets:u,isEditMode:h,setIsEditMode:m,reorderWidgets:d,toggleWidgetVisibility:x,updateWidgetSize:f,applyPreset:v,resetLayout:p}=ri(e==null?void 0:e.branchName),[b,y]=i.useState(!1),[g,w]=i.useState(!1),[N,j]=i.useState(!1),[S,D]=i.useState(!1),[C,k]=i.useState(void 0),T=A=>{const G=A?new Date(A):new Date;G.setHours(12,0,0,0),k(G),D(!0)},I=Ra(Ps(hs,{activationConstraint:{distance:8}}),Ps(us,{coordinateGetter:si})),O=A=>{const{active:G,over:de}=A;de&&G.id!==de.id&&d(G.id,de.id)},H=i.useMemo(()=>c.filter(A=>A.type==="branches-table"?at(e,"VIEW_BRANCH_MONITOR"):!0),[c,e]);return l?t.jsx(gr,{}):t.jsxs(B.div,{className:"pt-3 pb-6 px-6 space-y-6",variants:Gi,initial:"hidden",animate:"show",children:[t.jsx(pi,{isEditMode:h,setIsEditMode:m,onOpenPresets:()=>w(!0),onOpenGallery:()=>y(!0),onResetLayout:p,hasHiddenWidgets:u.length>0}),t.jsx(Po,{sensors:I,collisionDetection:za,onDragEnd:O,children:t.jsx(_o,{items:H.map(A=>A.id),strategy:xs,children:t.jsx("div",{className:"grid grid-cols-12 gap-6 auto-rows-auto",children:H.map(A=>t.jsx("div",{className:L(A.size==="small"&&"col-span-12 md:col-span-6 lg:col-span-3",A.size==="large"&&"col-span-12 md:col-span-6 lg:col-span-4",A.size==="full"&&"col-span-12"),children:t.jsx(ci,{widget:A,isEditMode:h,onRemove:()=>x(A.id),onSizeChange:G=>f(A.id,G),children:t.jsx(Vi,{children:t.jsx(Fi,{widgetType:A.type,user:e,metrics:s,globalProgress:n,assignedDays:r,cycleStartDate:a,onDateClick:T,onEditConfig:()=>j(!0)})})})},A.id))})})}),t.jsx(fi,{open:g,onOpenChange:w,onApplyPreset:A=>{const G=$n.find(de=>de.id===A);G&&v(G.widgetIds)}}),t.jsx(ui,{open:b,onOpenChange:y,hiddenWidgets:u,onAddWidget:x}),t.jsx(Hi,{open:N,onOpenChange:j,user:e,currentAssignedDays:r,currentStartDate:a,onSave:o}),t.jsx(hi,{open:S,onOpenChange:D,initialDate:C})]})}export{kl as default};
