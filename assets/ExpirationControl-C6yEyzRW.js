import{j as e}from"./ui-vendor-CwIRxpyq.js";import{r as i,u as fe}from"./react-vendor-ylmX0jv_.js";import{F as ne,G as ie,P as H,H as le,J as oe,K as ce,B as o,X as je,a7 as Ne,h as X,O as U,Q as de,x as d,W as se,i as I,m as te,j as ve,k as be,p as ye,a5 as we,a6 as Ce}from"./index-CRCrhKU4.js";import{I as S}from"./input-DJmmUFgp.js";import{L as _}from"./label-BdVcOHK8.js";import{u as Se,A as ae,S as ke,B as Ee}from"./AnimatedCounter-BmsiFdEZ.js";import{P as De,a as Fe,b as Ae,u as Me}from"./popover-SUEyWvjx.js";import{F as Pe}from"./FabMenu-BXg2alHK.js";import{E as ze}from"./jspdf.es.min-DpSV_vF0.js";import{C as Ie,P as me}from"./Calculator-DLJeaUI0.js";import{C as xe,e as Be}from"./es-bGAlbXQo.js";import{C as Y}from"./clock-BTk_q2A-.js";import{A as V,m as B}from"./animation-DbfETv0H.js";import{P as ue}from"./plus-csKbdJUo.js";import{W as re}from"./wifi-Cacx2EdQ.js";import{H as Oe}from"./history-DtK1qlT7.js";import{A as Le}from"./arrow-right-DGwCY7FB.js";import{f as $e}from"./utils-DNiwW225.js";import"./excel-uoQkVabA.js";import"./scanner-D4NToCeH.js";import"./switch-Dfiy9-aF.js";import"./loader-circle-DVdQsWNG.js";import"./barcode-B8jNeywG.js";import"./expirationDB-_X_jzNjL.js";function Re({open:k,onOpenChange:b,productName:O,ean:N,initialBatches:L,onSave:G}){const[p,$]=i.useState([]),[g,c]=i.useState(""),[m,y]=i.useState(""),[u,w]=i.useState(""),[h,E]=i.useState(1),[D,F]=i.useState(!1),[v,l]=i.useState(""),x=t=>{w(Math.floor(t).toString())};i.useEffect(()=>{k&&($([...L]),A())},[k,L]);const A=()=>{c(""),y(""),w(""),E(1),l("")},M=t=>{if(t.length<m.length){y(t);return}let r=t.replace(/\D/g,"");if(r.length>=2){const f=parseInt(r.slice(0,2));(f===0||f>12)&&(r=r.slice(0,1))}r.length>=2&&(r=r.slice(0,2)+"/"+r.slice(2,4)),r.length>5&&(r=r.slice(0,5)),y(r)},R=()=>{if(!g.trim())return d.error("Datos incompletos","Falta el número de lote");if(m.length<5)return d.error("Fecha incompleta","Ingresa la fecha en formato MM/AA");if(!u||Number(u)<=0)return d.error("Cantidad inválida","La cantidad debe ser mayor a 0");const t=v?parseInt(v):h;if(isNaN(t)||t<=0)return d.error("Alerta inválida","Meses de alerta inválidos");const[r,f]=m.split("/"),P=parseInt(r),W=2e3+parseInt(f),C=new Date(W,P,0),z=new Date;if(z.setHours(0,0,0,0),C<z)return d.error("Fecha inválida","El producto ya está vencido. No se puede ingresar.");const J={batchNumber:g.toUpperCase(),expirationDate:m,quantity:Number(u),reminderMonths:t,status:"active"};$(K=>[...K,J]),d.success("Lote agregado","El lote se agregó correctamente"),A()},T=t=>{$(r=>r.filter((f,P)=>P!==t))},Q=()=>{G(p),b(!1)};return e.jsx(ne,{open:k,onOpenChange:b,children:e.jsxs(ie,{className:"max-w-md p-0 overflow-hidden gap-0 bg-background/95 backdrop-blur-xl border-white/10 shadow-2xl",onInteractOutside:t=>t.preventDefault(),children:[e.jsxs("div",{className:"bg-primary px-6 py-5 relative overflow-hidden",children:[e.jsx("div",{className:"absolute right-0 top-0 opacity-10 transform translate-x-1/3 -translate-y-1/3",children:e.jsx(H,{size:120})}),e.jsxs(le,{className:"relative z-10 text-primary-foreground text-left space-y-1",children:[e.jsx(oe,{className:"text-xl font-bold leading-tight pr-8 line-clamp-2",children:O}),e.jsxs(ce,{className:"text-primary-foreground/70 text-xs font-mono",children:["EAN: ",N]})]}),e.jsx(o,{variant:"ghost",size:"icon",className:"absolute right-2 top-2 text-primary-foreground/50 hover:text-primary-foreground hover:bg-white/10 rounded-full h-8 w-8 z-20",onClick:()=>b(!1),children:e.jsx(je,{size:18})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-3",children:[e.jsxs("div",{className:"col-span-5 space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-wider ml-1",children:"Nro. Lote"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground/50"}),e.jsx(S,{value:g,onChange:t=>c(t.target.value),placeholder:"A123",className:"pl-9 bg-muted/30 border-muted-foreground/20 focus:bg-background h-10 transition-colors uppercase",maxLength:10})]})]}),e.jsxs("div",{className:"col-span-4 space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-wider ml-1",children:"Vence"}),e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground/50"}),e.jsx(S,{value:m,onChange:t=>M(t.target.value),placeholder:"MM/AA",className:"pl-9 bg-muted/30 border-muted-foreground/20 focus:bg-background h-10 transition-colors text-center",maxLength:5})]})]}),e.jsxs("div",{className:"col-span-3 space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-wider ml-1 text-center",children:"Cant."}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"relative flex-1",children:e.jsx(S,{value:u,onChange:t=>w(t.target.value),placeholder:"0",className:"px-1 text-center bg-muted/30 border-muted-foreground/20 focus:bg-background h-10 transition-colors font-bold",type:"number"})}),e.jsxs(De,{children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(o,{variant:"outline",size:"icon",className:"h-10 w-10 shrink-0 border-muted-foreground/20 bg-muted/30 hover:bg-background relative",title:"Alerta de vencimiento",children:[e.jsx(Y,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-primary text-[8px] text-primary-foreground font-bold border border-background",children:v||h})]})}),e.jsx(Ae,{className:"w-64 p-3",align:"end",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-sm leading-none flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-primary"}),"Anticipación de Alerta"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"¿Cuantos meses antes quieres que te avisemos?"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[1,2,3,4,6,12].map(t=>e.jsxs(o,{variant:h===t&&!v?"default":"outline",size:"sm",className:"h-8 text-xs",onClick:()=>{E(t),l("")},children:[t," Mes",t>1?"es":""]},t))}),e.jsx("div",{className:"pt-2 border-t mt-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground whitespace-nowrap",children:"Personalizado:"}),e.jsx(S,{className:"h-7 text-xs",placeholder:"#",type:"number",value:v,onChange:t=>l(t.target.value)})]})})]})})]})]})]})]}),e.jsx(V,{children:D&&e.jsx(B.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border rounded-lg bg-muted/20",children:e.jsx(Ie,{onResult:x,onClose:()=>F(!1)})})}),e.jsxs(o,{className:"w-full bg-primary hover:bg-primary/90 text-white shadow-lg shadow-primary/20 h-11",onClick:R,children:[e.jsx(ue,{className:"mr-2 h-4 w-4"})," Agregar Lote"]})]}),e.jsx("div",{className:"bg-muted/30 rounded-xl p-1 min-h-[120px] max-h-[220px] overflow-y-auto border border-border/50",children:e.jsx(V,{initial:!1,mode:"popLayout",children:p.length===0?e.jsxs(B.div,{initial:{opacity:0},animate:{opacity:1},className:"h-full flex flex-col items-center justify-center text-muted-foreground py-8",children:[e.jsx(H,{className:"w-8 h-8 opacity-20 mb-2"}),e.jsx("p",{className:"text-xs",children:"No hay lotes agregados"})]}):p.map((t,r)=>e.jsxs(B.div,{layout:!0,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,x:-20},className:"bg-card p-3 rounded-lg shadow-sm border mb-2 flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-xs ring-1 ring-primary/20 shrink-0",children:r+1}),e.jsx("div",{className:"min-w-0",children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"font-mono font-bold text-sm tracking-tight truncate max-w-[80px] sm:max-w-none",children:t.batchNumber}),e.jsxs(X,{variant:"outline",className:"text-[10px] h-5 px-1.5 font-normal text-muted-foreground border-border whitespace-nowrap",children:["Vence: ",t.expirationDate]})]})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.reminderMonths&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] sm:text-xs font-medium bg-muted/50 px-2 py-1 rounded text-muted-foreground whitespace-nowrap",title:`${t.reminderMonths} meses de alerta`,children:[e.jsx(Y,{className:"w-3 h-3"}),e.jsxs("span",{children:[t.reminderMonths,"m"]})]}),e.jsxs("div",{className:"flex items-center gap-2 border-l pl-3 ml-1 h-8",children:[e.jsxs("span",{className:"text-lg font-bold tabular-nums",children:["x",t.quantity]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-primary hover:bg-primary/10",onClick:()=>{c(t.batchNumber),y(t.expirationDate),w(t.quantity.toString()),E(t.reminderMonths||1),T(r)},title:"Editar lote",children:e.jsx(me,{className:"w-3 h-3"})}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-destructive hover:bg-destructive/10",onClick:()=>T(r),title:"Eliminar lote",children:e.jsx(U,{className:"w-4 h-4"})})]})]})]})]},`${t.batchNumber}-${r}`))})})]}),e.jsxs(de,{className:"p-4 bg-muted/30 border-t flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 flex items-center text-sm font-medium text-muted-foreground",children:["Total: ",e.jsxs("span",{className:"ml-1 text-foreground font-bold",children:[p.reduce((t,r)=>t+r.quantity,0)," u."]})]}),e.jsx(o,{variant:"ghost",onClick:()=>b(!1),children:"Cancelar"}),e.jsx(o,{onClick:Q,disabled:p.length===0,className:"px-8",children:"Guardar"})]})]})})}function ds(){const k=fe(),[b,O]=i.useState("config"),[N,L]=i.useState(""),[G,p]=i.useState(!1),[$,g]=i.useState(""),[c,m]=i.useState(null),[y,u]=i.useState(!1),[w,h]=i.useState([]),[E,D]=i.useState(!1),[F,v]=i.useState(""),{session:l,items:x,totalProducts:A,totalUnits:M,isLoading:R,startSession:T,addItem:Q,deleteItem:t,finishSession:r,availableSessions:f,resumeSession:P,deleteSession:W}=Me(),{isOnline:C}=Se(),z=async()=>{if(!N.trim()){d.error("Error","Ingresa el nombre del sector");return}await T(N.trim()),O("counting")},J=async s=>{await Z(s),p(!1)},K=s=>{g(s.ean),m({name:s.productName,ean:s.ean}),h(s.batches),u(!0)},Z=async(s,a)=>{g(s);let n=a;if(!n){const q=await Ce(s);n=q?q.name:`Producto ${s}`}m({name:n,ean:s});const j=x.find(q=>q.ean===s);j?(h([...j.batches]),d.info("Información","Producto ya contado. Editando lotes existentes.")):h([]),u(!0)},he=()=>{D(!0)},pe=async()=>{if(!F.trim()){d.error("Error","Por favor ingresa el nombre del responsable");return}const s={id:crypto.randomUUID(),sector:(l==null?void 0:l.sector)||N,date:new Date().toISOString(),responsible:F,items:x,stats:{totalProducts:A,totalUnits:M}},a=JSON.parse(localStorage.getItem("expiration-reports")||"[]");localStorage.setItem("expiration-reports",JSON.stringify([s,...a])),await r(),d.success("Operación exitosa","Control guardado exitosamente"),k("/reports")},ee=s=>{if(!s)return"";if(s.match(/^\d{4}-\d{2}$/)){const[a,n]=s.split("-");return`${n}/${a.slice(2)}`}return s},ge=()=>{if(x.length===0){d.error("Error","No hay datos");return}const s=new ze;let a=20;s.setFontSize(16),s.text(`Control de Vencimientos: ${l==null?void 0:l.sector}`,10,a),s.setFontSize(10),s.text(`Fecha: ${new Date().toLocaleDateString()}`,10,a+6),a+=15,x.forEach(n=>{a>270&&(s.addPage(),a=20),s.setFont("helvetica","bold"),s.text(`${n.productName} (EAN: ${n.ean})`,10,a),s.text(`Total: ${n.totalQuantity}`,180,a,{align:"right"}),a+=6,s.setFont("helvetica","normal"),s.setFontSize(9),s.text("Lote",15,a),s.text("Vencimiento",80,a),s.text("Cantidad",150,a),a+=5,n.batches.forEach(j=>{s.text(j.batchNumber,15,a),s.text(ee(j.expirationDate),80,a),s.text(j.quantity.toString(),150,a),a+=5}),a+=5}),s.save(`Vencimientos_${l==null?void 0:l.sector}.pdf`),d.success("Operación exitosa","PDF Generado")};return e.jsxs("div",{className:"space-y-6 max-w-5xl mx-auto pb-20",children:[e.jsx(V,{mode:"wait",children:b==="config"?e.jsxs("div",{className:"p-4 md:p-6 max-w-7xl mx-auto space-y-8 animate-in fade-in duration-500",children:[e.jsx("div",{className:"flex justify-end",children:C?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-success/10 text-success rounded-full text-sm",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"En línea"})]}):e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-warning/10 text-warning rounded-full text-sm",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Sin conexión"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 items-start",children:[e.jsxs(I,{className:"border-muted/50 shadow-lg overflow-hidden relative group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-primary/20 group-hover:bg-primary transition-colors"}),e.jsxs(te,{className:"p-6 md:p-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 text-primary",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-xl",children:e.jsx(ue,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Nueva Sesión"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Genera un reporte de control de fechas de vencimiento para un sector o estantería."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground ml-1",children:"Nombre del Sector"}),e.jsx(S,{value:N,onChange:s=>L(s.target.value),placeholder:"Ej: Estantería A1",className:"h-12 text-lg bg-muted/30 border-muted-foreground/20 focus:border-primary transition-all",autoFocus:!0,onKeyDown:s=>s.key==="Enter"&&z()})]}),e.jsx(o,{className:"w-full h-12 text-lg font-medium shadow-md hover:shadow-lg transition-all",onClick:z,disabled:!N.trim()||R,children:R?"Iniciando...":"Comenzar Control"})]})]})]}),e.jsxs(I,{className:"border-muted/50 shadow-lg h-full",children:[e.jsx(ve,{className:"pb-4 border-b border-border/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-secondary rounded-lg text-secondary-foreground",children:e.jsx(Oe,{className:"w-5 h-5"})}),e.jsx(be,{className:"text-lg",children:"Sesiones Abiertas"})]})}),e.jsx(te,{className:"p-0",children:f.length===0?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:e.jsx("p",{children:"No hay sesiones activas"})}):e.jsx("div",{className:"divide-y divide-border/50 max-h-[400px] overflow-y-auto",children:f.map(s=>e.jsxs("div",{className:"p-4 hover:bg-muted/30 transition-colors flex items-center justify-between group",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-medium text-lg leading-none group-hover:text-primary transition-colors",children:s.sector}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(xe,{className:"w-3 h-3"}),e.jsx("span",{children:$e(new Date(s.startTime),"d MMM yyyy, HH:mm",{locale:Be})})]}),e.jsxs("div",{className:"flex gap-3 text-xs text-muted-foreground mt-1",children:[e.jsxs("span",{className:"bg-primary/5 px-2 py-0.5 rounded text-primary font-medium",children:[s.totalProducts||0," prod."]}),e.jsxs("span",{className:"bg-secondary px-2 py-0.5 rounded text-secondary-foreground font-medium",children:[s.totalUnits||0," unid."]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-destructive hover:bg-destructive/10",onClick:()=>W(s.id),title:"Eliminar sesión",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsxs(o,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",onClick:()=>{P(s),O("counting")},children:["Retomar",e.jsx(Le,{className:"w-4 h-4"})]})]})]},s.id))})})]})]})]}):e.jsx(e.Fragment,{children:e.jsxs(B.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"p-4 md:p-6 space-y-4 max-w-7xl mx-auto",children:[e.jsx(I,{className:"min-h-[120px] flex flex-col justify-center px-6 sm:px-8 bg-gradient-to-br from-secondary/40 to-secondary/20 border-muted/50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 min-w-0",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Sector"}),e.jsx("span",{className:"font-bold text-foreground text-lg sm:text-xl truncate",children:l==null?void 0:l.sector})]}),e.jsx("div",{className:"h-10 sm:h-12 w-px bg-border/40 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-8 sm:gap-12 flex-1 justify-center",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Productos"}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-primary",children:e.jsx(ae,{value:A,digits:4})})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Unidades"}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:e.jsx(ae,{value:M,digits:4})})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsx("div",{className:`p-2 rounded-full ${C?"bg-success/10 text-success":"bg-warning/10 text-warning"}`,title:C?"En línea":"Sin conexión",children:C?e.jsx(re,{className:"w-4 h-4"}):e.jsx(se,{className:"w-4 h-4"})})})]})}),e.jsx(I,{className:"p-2 sm:p-3 shadow-md border-primary/20 bg-card/80 backdrop-blur-sm relative z-50",children:e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex gap-4",children:e.jsx("div",{className:"flex-1 relative z-20",children:e.jsx(ke,{onSelect:s=>Z(s.ean,s.name),autoFocus:!0,className:"w-full"})})})})}),e.jsxs("div",{className:"space-y-2 relative z-10",children:[e.jsx("div",{className:"flex items-center justify-between px-1",children:e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wider",children:["Registros (",x.length,")"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:e.jsx(V,{mode:"popLayout",children:x.length===0?e.jsxs("div",{className:"col-span-full p-8 text-center text-muted-foreground border rounded-lg border-dashed bg-muted/20",children:[e.jsx(H,{className:"w-12 h-12 mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"No hay productos registrados aún"})]}):x.map((s,a)=>e.jsx(B.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},layout:!0,children:e.jsxs(I,{className:"h-full relative overflow-hidden group border-muted/60 shadow-sm hover:shadow-md transition-all",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-primary/20 group-hover:bg-primary transition-colors"}),e.jsxs("div",{className:"p-3 pl-4 flex flex-col h-full gap-2",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsx("h4",{className:"font-medium text-sm leading-tight line-clamp-2 text-foreground/90",title:s.productName,children:s.productName}),e.jsxs("div",{className:"text-xs font-bold bg-secondary/50 px-1.5 py-0.5 rounded text-foreground/70 text-right flex-shrink-0",children:["#",x.length-a]})]}),e.jsx("div",{children:e.jsx(X,{variant:"outline",className:"text-[10px] h-5 font-mono text-muted-foreground border-border/50 px-1.5 font-normal",children:s.ean})}),e.jsxs("div",{className:"flex flex-wrap gap-1.5 mt-2 content-start min-h-[1.5rem]",children:[s.batches.slice(0,3).map((n,j)=>e.jsxs("div",{className:"inline-flex items-center gap-2 text-xs bg-secondary/50 rounded px-2 py-1 border border-secondary-foreground/10",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(X,{variant:"outline",className:"text-[10px] h-4 px-1 font-normal text-muted-foreground border-border/50",children:ee(n.expirationDate)}),e.jsxs("span",{className:"font-bold tabular-nums text-[10px]",children:["x",n.quantity]})]}),n.reminderMonths&&e.jsxs("div",{className:"flex items-center gap-0.5 text-[9px] text-muted-foreground border-l pl-1.5 border-border/50",title:`${n.reminderMonths} meses de alerta`,children:[e.jsx(Y,{className:"w-2.5 h-2.5"}),e.jsxs("span",{className:"sr-only sm:not-sr-only",children:[n.reminderMonths,"m"]})]})]},j)),s.batches.length>3&&e.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] bg-muted text-muted-foreground",children:["+",s.batches.length-3]})]}),e.jsxs("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(o,{variant:"secondary",size:"icon",className:"h-6 w-6 shadow-sm mr-1",onClick:n=>{n.stopPropagation(),K(s)},children:e.jsx(me,{className:"w-3 h-3"})}),e.jsx(o,{variant:"destructive",size:"icon",className:"h-6 w-6 shadow-sm",onClick:n=>{n.stopPropagation(),t(s.id)},children:e.jsx(U,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 mt-auto border-t border-border/30",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-xl font-bold tracking-tight text-foreground",children:s.totalQuantity}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium uppercase tracking-wider",children:"total"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(o,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive hover:bg-destructive/5",onClick:()=>t(s.id),title:"Eliminar",children:e.jsx(U,{className:"w-4 h-4"})})})]})]})]})},s.id))})})]}),e.jsx(Pe,{actions:[{label:"Finalizar",icon:e.jsx(ye,{className:"w-5 h-5"}),onClick:he,variant:"default",color:"bg-primary text-primary-foreground"},{label:"Exportar PDF",icon:e.jsx(we,{className:"w-5 h-5"}),onClick:ge,variant:"secondary"}]})]},"counting")})}),e.jsx(Re,{open:y,onOpenChange:s=>{u(s),s||(g(""),m(null),h([]))},productName:(c==null?void 0:c.name)||"",ean:(c==null?void 0:c.ean)||"",initialBatches:w,onSave:async s=>{c&&(await Q(c.ean,c.name,s),u(!1),m(null),g(""),h([]),setTimeout(()=>{var a;(a=document.getElementById("smart-search-input"))==null||a.focus()},50))}}),e.jsx(ne,{open:E,onOpenChange:D,children:e.jsxs(ie,{children:[e.jsxs(le,{children:[e.jsx(oe,{children:"Finalizar Control de Vencimientos"}),e.jsx(ce,{children:"Por favor confirma los datos para guardar el reporte."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{className:"text-xs text-muted-foreground",children:"Fecha"}),e.jsx("div",{className:"font-medium",children:new Date().toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx(_,{className:"text-xs text-muted-foreground",children:"Hora"}),e.jsx("div",{className:"font-medium",children:new Date().toLocaleTimeString()})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"responsible",className:"mb-2 block",children:"Responsable del Control *"}),e.jsx(S,{id:"responsible",value:F,onChange:s=>v(s.target.value),placeholder:"Nombre y Apellido",autoFocus:!0})]}),e.jsxs("div",{className:"bg-primary/5 p-4 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Unidades Contadas"}),e.jsx("span",{className:"text-2xl font-bold text-primary",children:M})]})]}),e.jsxs(de,{children:[e.jsx(o,{variant:"outline",onClick:()=>D(!1),children:"Cancelar"}),e.jsx(o,{onClick:pe,children:"Guardar y Finalizar"})]})]})}),e.jsx(Ee,{open:G,onOpenChange:p,onScan:J})]})}export{ds as default};
