import{j as e}from"./ui-vendor-yOY8nbWe.js";import{r as i,u as fe}from"./react-vendor-ylmX0jv_.js";import{q as re,r as ne,P as $,t as ie,v as oe,M as le,B as o,X as je,a8 as Ne,h as _,V as H,x as ce,y as d,W as ee,i as z,m as se,j as ve,k as be,p as ye,a6 as we,a7 as Ce}from"./index-Te3a4jlC.js";import{I as S}from"./input-B7CUOkBD.js";import{L as X}from"./label-DVIuZ_s2.js";import{u as Se,A as ae,S as ke,B as De}from"./AnimatedCounter-CNwZVSO-.js";import{P as Ee,a as Me,b as Pe,u as Ae,g as Fe}from"./popover-usdBV7t8.js";import{F as Ie}from"./FabMenu-BeQyvZae.js";import{C as ze}from"./Calculator-BkLxJfKN.js";import{C as de}from"./calendar-BynJzVvo.js";import{C as Y}from"./clock-BxwJWHdI.js";import{A as V,m as B}from"./animation-B1XBg4Wj.js";import{P as me}from"./plus-C3vYEsfR.js";import{P as xe}from"./pencil-CiDsqELD.js";import{W as te}from"./wifi-Cfhof1vn.js";import{H as Be}from"./history-C2K7NO2q.js";import{A as Oe}from"./arrow-right-CK505oTi.js";import{f as Re}from"./utils-Cem6hW2W.js";import{e as Le}from"./es-CtQxi55C.js";import"./excel-uoQkVabA.js";import"./scanner-D4NToCeH.js";import"./switch-BjAGjEoy.js";import"./loader-circle-qWO_FBuQ.js";import"./barcode-DM0Yvr5e.js";import"./expirationDB-jGZ4kzP3.js";import"./jspdf.es.min-DZBtbnuY.js";function Te({open:k,onOpenChange:b,productName:O,ean:N,initialBatches:R,onSave:G}){const[g,L]=i.useState([]),[f,l]=i.useState(""),[x,y]=i.useState(""),[p,w]=i.useState(""),[h,D]=i.useState(1),[E,M]=i.useState(!1),[v,n]=i.useState(""),u=a=>{w(Math.floor(a).toString())};i.useEffect(()=>{k&&(L([...R]),P())},[k,R]);const P=()=>{l(""),y(""),w(""),D(1),n("")},A=a=>{if(a.length<x.length){y(a);return}let t=a.replace(/\D/g,"");if(t.length>=2){const j=parseInt(t.slice(0,2));(j===0||j>12)&&(t=t.slice(0,1))}t.length>=2&&(t=t.slice(0,2)+"/"+t.slice(2,4)),t.length>5&&(t=t.slice(0,5)),y(t)},T=()=>{if(!f.trim())return d.error("Datos incompletos","Falta el número de lote");if(x.length<5)return d.error("Fecha incompleta","Ingresa la fecha en formato MM/AA");if(!p||Number(p)<=0)return d.error("Cantidad inválida","La cantidad debe ser mayor a 0");const a=v?parseInt(v):h;if(isNaN(a)||a<=0)return d.error("Alerta inválida","Meses de alerta inválidos");const[t,j]=x.split("/"),F=parseInt(t),J=2e3+parseInt(j),C=new Date(J,F,0),I=new Date;if(I.setHours(0,0,0,0),C<I)return d.error("Fecha inválida","El producto ya está vencido. No se puede ingresar.");const Q={batchNumber:f.toUpperCase(),expirationDate:x,quantity:Number(p),reminderMonths:a,status:"active"};L(K=>[...K,Q]),d.success("Lote agregado","El lote se agregó correctamente"),P()},q=a=>{L(t=>t.filter((j,F)=>F!==a))},W=()=>{G(g),b(!1)};return e.jsx(re,{open:k,onOpenChange:b,children:e.jsxs(ne,{className:"max-w-md p-0 overflow-hidden gap-0 bg-background/95 backdrop-blur-xl border-white/10 shadow-2xl",onInteractOutside:a=>a.preventDefault(),children:[e.jsxs("div",{className:"bg-primary px-6 py-5 relative overflow-hidden",children:[e.jsx("div",{className:"absolute right-0 top-0 opacity-10 transform translate-x-1/3 -translate-y-1/3",children:e.jsx($,{size:120})}),e.jsxs(ie,{className:"relative z-10 text-primary-foreground text-left space-y-1",children:[e.jsx(oe,{className:"text-xl font-bold leading-tight pr-8 line-clamp-2",children:O}),e.jsxs(le,{className:"text-primary-foreground/70 text-xs font-mono",children:["EAN: ",N]})]}),e.jsx(o,{variant:"ghost",size:"icon",className:"absolute right-2 top-2 text-primary-foreground/50 hover:text-primary-foreground hover:bg-white/10 rounded-full h-8 w-8 z-20",onClick:()=>b(!1),children:e.jsx(je,{size:18})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-3",children:[e.jsxs("div",{className:"col-span-5 space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-wider ml-1",children:"Nro. Lote"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground/50"}),e.jsx(S,{value:f,onChange:a=>l(a.target.value),placeholder:"A123",className:"pl-9 bg-muted/30 border-muted-foreground/20 focus:bg-background h-10 transition-colors uppercase",maxLength:10})]})]}),e.jsxs("div",{className:"col-span-4 space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-wider ml-1",children:"Vence"}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground/50"}),e.jsx(S,{value:x,onChange:a=>A(a.target.value),placeholder:"MM/AA",className:"pl-9 bg-muted/30 border-muted-foreground/20 focus:bg-background h-10 transition-colors text-center",maxLength:5})]})]}),e.jsxs("div",{className:"col-span-3 space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-wider ml-1 text-center",children:"Cant."}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"relative flex-1",children:e.jsx(S,{value:p,onChange:a=>w(a.target.value),placeholder:"0",className:"px-1 text-center bg-muted/30 border-muted-foreground/20 focus:bg-background h-10 transition-colors font-bold",type:"number"})}),e.jsxs(Ee,{children:[e.jsx(Me,{asChild:!0,children:e.jsxs(o,{variant:"outline",size:"icon",className:"h-10 w-10 shrink-0 border-muted-foreground/20 bg-muted/30 hover:bg-background relative",title:"Alerta de vencimiento",children:[e.jsx(Y,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-primary text-[8px] text-primary-foreground font-bold border border-background",children:v||h})]})}),e.jsx(Pe,{className:"w-64 p-3",align:"end",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-sm leading-none flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-primary"}),"Anticipación de Alerta"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"¿Cuantos meses antes quieres que te avisemos?"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[1,2,3,4,6,12].map(a=>e.jsxs(o,{variant:h===a&&!v?"default":"outline",size:"sm",className:"h-8 text-xs",onClick:()=>{D(a),n("")},children:[a," Mes",a>1?"es":""]},a))}),e.jsx("div",{className:"pt-2 border-t mt-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground whitespace-nowrap",children:"Personalizado:"}),e.jsx(S,{className:"h-7 text-xs",placeholder:"#",type:"number",value:v,onChange:a=>n(a.target.value)})]})})]})})]})]})]})]}),e.jsx(V,{children:E&&e.jsx(B.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border rounded-lg bg-muted/20",children:e.jsx(ze,{onResult:u,onClose:()=>M(!1)})})}),e.jsxs(o,{className:"w-full bg-primary hover:bg-primary/90 text-white shadow-lg shadow-primary/20 h-11",onClick:T,children:[e.jsx(me,{className:"mr-2 h-4 w-4"})," Agregar Lote"]})]}),e.jsx("div",{className:"bg-muted/30 rounded-xl p-1 min-h-[120px] max-h-[220px] overflow-y-auto border border-border/50",children:e.jsx(V,{initial:!1,mode:"popLayout",children:g.length===0?e.jsxs(B.div,{initial:{opacity:0},animate:{opacity:1},className:"h-full flex flex-col items-center justify-center text-muted-foreground py-8",children:[e.jsx($,{className:"w-8 h-8 opacity-20 mb-2"}),e.jsx("p",{className:"text-xs",children:"No hay lotes agregados"})]}):g.map((a,t)=>e.jsxs(B.div,{layout:!0,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,x:-20},className:"bg-card p-3 rounded-lg shadow-sm border mb-2 flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-xs ring-1 ring-primary/20 shrink-0",children:t+1}),e.jsx("div",{className:"min-w-0",children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"font-mono font-bold text-sm tracking-tight truncate max-w-[80px] sm:max-w-none",children:a.batchNumber}),e.jsxs(_,{variant:"outline",className:"text-[10px] h-5 px-1.5 font-normal text-muted-foreground border-border whitespace-nowrap",children:["Vence: ",a.expirationDate]})]})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[a.reminderMonths&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] sm:text-xs font-medium bg-muted/50 px-2 py-1 rounded text-muted-foreground whitespace-nowrap",title:`${a.reminderMonths} meses de alerta`,children:[e.jsx(Y,{className:"w-3 h-3"}),e.jsxs("span",{children:[a.reminderMonths,"m"]})]}),e.jsxs("div",{className:"flex items-center gap-2 border-l pl-3 ml-1 h-8",children:[e.jsxs("span",{className:"text-lg font-bold tabular-nums",children:["x",a.quantity]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-primary hover:bg-primary/10",onClick:()=>{l(a.batchNumber),y(a.expirationDate),w(a.quantity.toString()),D(a.reminderMonths||1),q(t)},title:"Editar lote",children:e.jsx(xe,{className:"w-3 h-3"})}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-destructive hover:bg-destructive/10",onClick:()=>q(t),title:"Eliminar lote",children:e.jsx(H,{className:"w-4 h-4"})})]})]})]})]},`${a.batchNumber}-${t}`))})})]}),e.jsxs(ce,{className:"p-4 bg-muted/30 border-t flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 flex items-center text-sm font-medium text-muted-foreground",children:["Total: ",e.jsxs("span",{className:"ml-1 text-foreground font-bold",children:[g.reduce((a,t)=>a+t.quantity,0)," u."]})]}),e.jsx(o,{variant:"ghost",onClick:()=>b(!1),children:"Cancelar"}),e.jsx(o,{onClick:W,disabled:g.length===0,className:"px-8",children:"Guardar"})]})]})})}function xs(){const k=fe(),[b,O]=i.useState("config"),[N,R]=i.useState(""),[G,g]=i.useState(!1),[L,f]=i.useState(""),[l,x]=i.useState(null),[y,p]=i.useState(!1),[w,h]=i.useState([]),[D,E]=i.useState(!1),[M,v]=i.useState(""),{session:n,items:u,totalProducts:P,totalUnits:A,isLoading:T,startSession:q,addItem:W,deleteItem:a,finishSession:t,availableSessions:j,resumeSession:F,deleteSession:J}=Ae(),{isOnline:C}=Se(),I=async()=>{if(!N.trim()){d.error("Error","Ingresa el nombre del sector");return}await q(N.trim()),O("counting")},Q=async s=>{await Z(s),g(!1)},K=s=>{f(s.ean),x({name:s.productName,ean:s.ean}),h(s.batches),p(!0)},Z=async(s,c)=>{f(s);let r=c;if(!r){const U=await Ce(s);r=U?U.name:`Producto ${s}`}x({name:r,ean:s});const m=u.find(U=>U.ean===s);m?(h([...m.batches]),d.info("Información","Producto ya contado. Editando lotes existentes.")):h([]),p(!0)},ue=()=>{E(!0)},pe=async()=>{if(!M.trim()){d.error("Error","Por favor ingresa el nombre del responsable");return}const s={id:crypto.randomUUID(),sector:(n==null?void 0:n.sector)||N,date:new Date().toISOString(),responsible:M,items:u,stats:{totalProducts:P,totalUnits:A}},c=JSON.parse(localStorage.getItem("expiration-reports")||"[]");localStorage.setItem("expiration-reports",JSON.stringify([s,...c])),await t(),d.success("Operación exitosa","Control guardado exitosamente"),k("/reports")},he=s=>{if(!s)return"";if(s.match(/^\d{4}-\d{2}$/)){const[c,r]=s.split("-");return`${r}/${c.slice(2)}`}return s},ge=()=>{if(u.length===0){d.error("Error","No hay datos");return}const s=u.flatMap(r=>r.batches.map(m=>({id:crypto.randomUUID(),ean:r.ean,productName:r.productName,batchNumber:m.batchNumber,expirationDate:m.expirationDate,quantity:m.quantity,status:m.status||"active",actionDate:m.actionDate,destinationBranch:m.destinationBranch}))),c={format:"pdf",rangeType:"day",dateRange:{from:n!=null&&n.startTime?new Date(n.startTime):new Date,to:new Date},selectedStatuses:["all"]};Fe(s,c,(user==null?void 0:user.branchName)||(n==null?void 0:n.sector)||"Sucursal"),d.success("Operación exitosa","PDF Generado con nuevo formato profesional")};return e.jsxs("div",{className:"space-y-6 max-w-5xl mx-auto pb-20",children:[e.jsx(V,{mode:"wait",children:b==="config"?e.jsxs("div",{className:"p-4 md:p-6 max-w-7xl mx-auto space-y-8 animate-in fade-in duration-500",children:[e.jsx("div",{className:"flex justify-end",children:C?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-success/10 text-success rounded-full text-sm",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"En línea"})]}):e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-warning/10 text-warning rounded-full text-sm",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Sin conexión"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 items-start",children:[e.jsxs(z,{className:"border-muted/50 shadow-lg overflow-hidden relative group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-primary/20 group-hover:bg-primary transition-colors"}),e.jsxs(se,{className:"p-6 md:p-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 text-primary",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-xl",children:e.jsx(me,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Nueva Sesión"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Genera un reporte de control de fechas de vencimiento para un sector o estantería."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground ml-1",children:"Nombre del Sector"}),e.jsx(S,{value:N,onChange:s=>R(s.target.value),placeholder:"Ej: Estantería A1",className:"h-12 text-lg bg-muted/30 border-muted-foreground/20 focus:border-primary transition-all",autoFocus:!0,onKeyDown:s=>s.key==="Enter"&&I()})]}),e.jsx(o,{className:"w-full h-12 text-lg font-medium shadow-md hover:shadow-lg transition-all",onClick:I,disabled:!N.trim()||T,children:T?"Iniciando...":"Comenzar Control"})]})]})]}),e.jsxs(z,{className:"border-muted/50 shadow-lg h-full",children:[e.jsx(ve,{className:"pb-4 border-b border-border/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-secondary rounded-lg text-secondary-foreground",children:e.jsx(Be,{className:"w-5 h-5"})}),e.jsx(be,{className:"text-lg",children:"Sesiones Abiertas"})]})}),e.jsx(se,{className:"p-0",children:j.length===0?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:e.jsx("p",{children:"No hay sesiones activas"})}):e.jsx("div",{className:"divide-y divide-border/50 max-h-[400px] overflow-y-auto",children:j.map(s=>e.jsxs("div",{className:"p-4 hover:bg-muted/30 transition-colors flex items-center justify-between group",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-medium text-lg leading-none group-hover:text-primary transition-colors",children:s.sector}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(de,{className:"w-3 h-3"}),e.jsx("span",{children:Re(new Date(s.startTime),"d MMM yyyy, HH:mm",{locale:Le})})]}),e.jsxs("div",{className:"flex gap-3 text-xs text-muted-foreground mt-1",children:[e.jsxs("span",{className:"bg-primary/5 px-2 py-0.5 rounded text-primary font-medium",children:[s.totalProducts||0," prod."]}),e.jsxs("span",{className:"bg-secondary px-2 py-0.5 rounded text-secondary-foreground font-medium",children:[s.totalUnits||0," unid."]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-destructive hover:bg-destructive/10",onClick:()=>J(s.id),title:"Eliminar sesión",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsxs(o,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",onClick:()=>{F(s),O("counting")},children:["Retomar",e.jsx(Oe,{className:"w-4 h-4"})]})]})]},s.id))})})]})]})]}):e.jsx(e.Fragment,{children:e.jsxs(B.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"p-4 md:p-6 space-y-4 max-w-7xl mx-auto",children:[e.jsx(z,{className:"min-h-[120px] flex flex-col justify-center px-6 sm:px-8 bg-gradient-to-br from-secondary/40 to-secondary/20 border-muted/50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 min-w-0",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Sector"}),e.jsx("span",{className:"font-bold text-foreground text-lg sm:text-xl truncate",children:n==null?void 0:n.sector})]}),e.jsx("div",{className:"h-10 sm:h-12 w-px bg-border/40 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-8 sm:gap-12 flex-1 justify-center",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Productos"}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-primary",children:e.jsx(ae,{value:P,digits:4})})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Unidades"}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:e.jsx(ae,{value:A,digits:4})})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsx("div",{className:`p-2 rounded-full ${C?"bg-success/10 text-success":"bg-warning/10 text-warning"}`,title:C?"En línea":"Sin conexión",children:C?e.jsx(te,{className:"w-4 h-4"}):e.jsx(ee,{className:"w-4 h-4"})})})]})}),e.jsx(z,{className:"p-2 sm:p-3 shadow-md border-primary/20 bg-card/80 backdrop-blur-sm relative z-50",children:e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex gap-4",children:e.jsx("div",{className:"flex-1 relative z-20",children:e.jsx(ke,{onSelect:s=>Z(s.ean,s.name),autoFocus:!0,className:"w-full"})})})})}),e.jsxs("div",{className:"space-y-2 relative z-10",children:[e.jsx("div",{className:"flex items-center justify-between px-1",children:e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wider",children:["Registros (",u.length,")"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:e.jsx(V,{mode:"popLayout",children:u.length===0?e.jsxs("div",{className:"col-span-full p-8 text-center text-muted-foreground border rounded-lg border-dashed bg-muted/20",children:[e.jsx($,{className:"w-12 h-12 mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"No hay productos registrados aún"})]}):u.map((s,c)=>e.jsx(B.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},layout:!0,children:e.jsxs(z,{className:"h-full relative overflow-hidden group border-muted/60 shadow-sm hover:shadow-md transition-all",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-primary/20 group-hover:bg-primary transition-colors"}),e.jsxs("div",{className:"p-3 pl-4 flex flex-col h-full gap-2",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsx("h4",{className:"font-medium text-sm leading-tight line-clamp-2 text-foreground/90",title:s.productName,children:s.productName}),e.jsxs("div",{className:"text-xs font-bold bg-secondary/50 px-1.5 py-0.5 rounded text-foreground/70 text-right flex-shrink-0",children:["#",u.length-c]})]}),e.jsx("div",{children:e.jsx(_,{variant:"outline",className:"text-[10px] h-5 font-mono text-muted-foreground border-border/50 px-1.5 font-normal",children:s.ean})}),e.jsxs("div",{className:"flex flex-wrap gap-1.5 mt-2 content-start min-h-[1.5rem]",children:[s.batches.slice(0,3).map((r,m)=>e.jsxs("div",{className:"inline-flex items-center gap-2 text-xs bg-secondary/50 rounded px-2 py-1 border border-secondary-foreground/10",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(_,{variant:"outline",className:"text-[10px] h-4 px-1 font-normal text-muted-foreground border-border/50",children:he(r.expirationDate)}),e.jsxs("span",{className:"font-bold tabular-nums text-[10px]",children:["x",r.quantity]})]}),r.reminderMonths&&e.jsxs("div",{className:"flex items-center gap-0.5 text-[9px] text-muted-foreground border-l pl-1.5 border-border/50",title:`${r.reminderMonths} meses de alerta`,children:[e.jsx(Y,{className:"w-2.5 h-2.5"}),e.jsxs("span",{className:"sr-only sm:not-sr-only",children:[r.reminderMonths,"m"]})]})]},m)),s.batches.length>3&&e.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] bg-muted text-muted-foreground",children:["+",s.batches.length-3]})]}),e.jsxs("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(o,{variant:"secondary",size:"icon",className:"h-6 w-6 shadow-sm mr-1",onClick:r=>{r.stopPropagation(),K(s)},children:e.jsx(xe,{className:"w-3 h-3"})}),e.jsx(o,{variant:"destructive",size:"icon",className:"h-6 w-6 shadow-sm",onClick:r=>{r.stopPropagation(),a(s.id)},children:e.jsx(H,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 mt-auto border-t border-border/30",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-xl font-bold tracking-tight text-foreground",children:s.totalQuantity}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium uppercase tracking-wider",children:"total"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(o,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive hover:bg-destructive/5",onClick:()=>a(s.id),title:"Eliminar",children:e.jsx(H,{className:"w-4 h-4"})})})]})]})]})},s.id))})})]}),e.jsx(Ie,{actions:[{label:"Finalizar",icon:e.jsx(ye,{className:"w-5 h-5"}),onClick:ue,variant:"default",color:"bg-primary text-primary-foreground"},{label:"Exportar PDF",icon:e.jsx(we,{className:"w-5 h-5"}),onClick:ge,variant:"secondary"}]})]},"counting")})}),e.jsx(Te,{open:y,onOpenChange:s=>{p(s),s||(f(""),x(null),h([]))},productName:(l==null?void 0:l.name)||"",ean:(l==null?void 0:l.ean)||"",initialBatches:w,onSave:async s=>{l&&(await W(l.ean,l.name,s),p(!1),x(null),f(""),h([]),setTimeout(()=>{var c;(c=document.getElementById("smart-search-input"))==null||c.focus()},50))}}),e.jsx(re,{open:D,onOpenChange:E,children:e.jsxs(ne,{children:[e.jsxs(ie,{children:[e.jsx(oe,{children:"Finalizar Control de Vencimientos"}),e.jsx(le,{children:"Por favor confirma los datos para guardar el reporte."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(X,{className:"text-xs text-muted-foreground",children:"Fecha"}),e.jsx("div",{className:"font-medium",children:new Date().toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx(X,{className:"text-xs text-muted-foreground",children:"Hora"}),e.jsx("div",{className:"font-medium",children:new Date().toLocaleTimeString()})]})]}),e.jsxs("div",{children:[e.jsx(X,{htmlFor:"responsible",className:"mb-2 block",children:"Responsable del Control *"}),e.jsx(S,{id:"responsible",value:M,onChange:s=>v(s.target.value),placeholder:"Nombre y Apellido",autoFocus:!0})]}),e.jsxs("div",{className:"bg-primary/5 p-4 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Unidades Contadas"}),e.jsx("span",{className:"text-2xl font-bold text-primary",children:A})]})]}),e.jsxs(ce,{children:[e.jsx(o,{variant:"outline",onClick:()=>E(!1),children:"Cancelar"}),e.jsx(o,{onClick:pe,children:"Guardar y Finalizar"})]})]})}),e.jsx(De,{open:G,onOpenChange:g,onScan:Q})]})}export{xs as default};
