import{j as e}from"./ui-vendor-CsPCkCQp.js";import{r as l,u as ue}from"./react-vendor-ylmX0jv_.js";import{u as pe,A as i,E as ee,F as se,P as T,H as te,J as ae,B as g,X as he,N as G,O as re,W as K,h as P,l as X,i as ge,j as fe,o as Ne,a4 as je,G as be,a5 as ye}from"./index-DUrnJgle.js";import{I as B}from"./input-Di14ieSh.js";import{L as V}from"./label-CThsuvSb.js";import{B as oe}from"./badge-B4RqIKv2.js";import{u as ve,A as Y,S as we,B as Se}from"./AnimatedCounter-92kcrUA4.js";import{a as Ee,c as Ce,d as ke,u as Ie,b as Fe,e as De,f as Ae,h as ze}from"./expirationDB-CPuE5CZc.js";import{F as Pe}from"./FabMenu-DZ-S08Pf.js";import{E as Be}from"./jspdf.es.min-s_DZ6IJK.js";import{C as Le}from"./Calculator-IURxNso_.js";import{C as ne,e as $e}from"./es-DCsqZ6g8.js";import{C as Me}from"./calculator-Cvg_31x5.js";import{A as R,m as L}from"./animation-D9hY-91t.js";import{P as Q}from"./plus-DE0Jt5ht.js";import{W as Z}from"./wifi-BHqf2x6N.js";import{H as Oe}from"./history-DG_qql0-.js";import{A as Ue}from"./arrow-right-D4q-Ydz_.js";import{C as Te}from"./clock-KfjCT_ar.js";import{f as Re}from"./utils-CUsTgaRG.js";import"./excel-uoQkVabA.js";import"./scanner-D4NToCeH.js";import"./switch-CR6Zcwcp.js";import"./loader-circle-B5L_zNgT.js";import"./barcode-BBALs1Ia.js";function He(){const{user:c}=pe(),[d,b]=l.useState(null),[y,w]=l.useState([]),[A,u]=l.useState([]),[z,S]=l.useState(0),[p,v]=l.useState(0),[k,N]=l.useState(!0);l.useEffect(()=>{c!=null&&c.branchName?I(c.branchName):(b(null),u([]))},[c==null?void 0:c.branchName]);const I=async r=>{try{N(!0);const a=await Ee(r);w(a)}catch(a){console.error("Error loading expiration session:",a),i.error("Error","No se pudo cargar la sesión")}finally{N(!1)}},f=async r=>{const a=await ze(r);a.sort((m,t)=>t.timestamp-m.timestamp),u(a),S(a.length),v(a.reduce((m,t)=>m+t.totalQuantity,0))};return{session:d,items:A,totalProducts:z,totalUnits:p,isLoading:k,availableSessions:y,startSession:async r=>{try{if(!(c!=null&&c.branchName)){i.error("Error","No hay sucursal seleccionada");return}if(y.find(t=>t.sector===r)){i.error("Sesión duplicada","Ya existe una sesión para este sector");return}const m=await Ce(r,c.branchName);b(m),w(t=>[m,...t]),u([])}catch(a){console.error("Error starting session:",a),i.error("Error","No se pudo iniciar la sesión")}},resumeSession:async r=>{try{b(r),await f(r.id),i.success("Sesión retomada",`Continuando control de ${r.sector}`)}catch(a){console.error("Error resuming:",a),i.error("Error","No se pudo retomar la sesión")}},deleteSession:async r=>{if(confirm("¿Eliminar sesión?"))try{await ke(r),w(a=>a.filter(m=>m.id!==r)),(d==null?void 0:d.id)===r&&(b(null),u([])),i.success("Sesión eliminada","La sesión se eliminó correctamente")}catch(a){console.error("Error deleting:",a),i.error("Error","No se pudo eliminar la sesión")}},addItem:async(r,a,m)=>{try{const t=A.find(o=>o.ean===r);if(t)await Ie(t.id,{batches:m,timestamp:Date.now()}),i.success("Producto actualizado","Los datos del producto se actualizaron correctamente");else{if(!(c!=null&&c.branchName))throw new Error("No branch selected");await Fe({ean:r,productName:a,batches:m,totalQuantity:m.reduce((o,D)=>o+D.quantity,0)},c.branchName),i.success("Producto agregado",`${a} agregado al control`)}d&&await f(d.id)}catch(t){console.error("Error adding/updating item:",t),i.error("Error","No se pudo guardar el producto")}},deleteItem:async r=>{if(confirm("¿Estás seguro de eliminar este producto?"))try{await De(r),i.success("Producto eliminado","El producto se eliminó del control"),d&&await f(d.id)}catch(a){console.error("Error deleting item:",a),i.error("Error","No se pudo eliminar el producto")}},finishSession:async()=>{if(d&&confirm("¿Finalizar control de vencimientos?"))try{await Ae(d.id),w(r=>r.filter(a=>a.id!==d.id)),b(null),u([]),i.success("Control finalizado","El control de vencimientos se finalizó correctamente")}catch(r){console.error("Error finishing session:",r),i.error("Error","No se pudo finalizar el control")}}}}function qe({open:c,onOpenChange:d,productName:b,ean:y,initialBatches:w,onSave:A}){const[u,z]=l.useState([]),[S,p]=l.useState(""),[v,k]=l.useState(""),[N,I]=l.useState(""),[f,$]=l.useState(1),[E,F]=l.useState(!1),M=t=>{I(Math.floor(t).toString())};l.useEffect(()=>{c&&(z([...w]),x())},[c,w]);const x=()=>{p(""),k(""),I(""),$(1)},j=t=>{if(t.length<v.length){k(t);return}let o=t.replace(/\D/g,"");if(o.length>=2){const D=parseInt(o.slice(0,2));(D===0||D>12)&&(o=o.slice(0,1))}o.length>=2&&(o=o.slice(0,2)+"/"+o.slice(2,4)),o.length>5&&(o=o.slice(0,5)),k(o)},r=()=>{if(!S.trim())return i.error("Datos incompletos","Falta el número de lote");if(v.length<5)return i.error("Fecha incompleta","Ingresa la fecha en formato MM/AA");if(!N||Number(N)<=0)return i.error("Cantidad inválida","La cantidad debe ser mayor a 0");const t={batchNumber:S.toUpperCase(),expirationDate:v,quantity:Number(N),reminderMonths:typeof f=="string"?parseInt(f):f};z(o=>[...o,t]),i.success("Lote agregado","El lote se agregó correctamente"),x()},a=t=>{z(o=>o.filter((D,H)=>H!==t))},m=()=>{if(u.length===0)return i.warning("Sin lotes","Debes agregar al menos un lote");A(u),d(!1)};return e.jsx(ee,{open:c,onOpenChange:d,children:e.jsxs(se,{className:"sm:max-w-[500px] p-0 overflow-hidden gap-0 bg-background/95 backdrop-blur-xl border-border/50 shadow-2xl",children:[e.jsxs("div",{className:"bg-primary px-6 py-5 text-primary-foreground relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:e.jsx(T,{className:"w-24 h-24 rotate-12"})}),e.jsx(te,{className:"text-xl font-bold leading-tight pr-8 relative z-10",children:b}),e.jsxs(ae,{className:"text-primary-foreground/80 mt-1 font-mono text-xs relative z-10",children:["EAN: ",y]}),e.jsx(g,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 text-primary-foreground/50 hover:text-primary-foreground hover:bg-primary-foreground/10",onClick:()=>d(!1),children:e.jsx(he,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-3",children:[e.jsxs("div",{className:"col-span-12 sm:col-span-5",children:[e.jsx("label",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-1.5 block ml-1",children:"Nro. Lote"}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-2.5 w-4 h-4 text-muted-foreground"}),e.jsx(B,{value:S,onChange:t=>p(t.target.value.toUpperCase()),className:"pl-9 font-mono bg-muted/30 border-muted-foreground/20 focus-visible:ring-primary/20",placeholder:"A123",autoFocus:!0})]})]}),e.jsxs("div",{className:"col-span-7 sm:col-span-4",children:[e.jsx("label",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-1.5 block ml-1",children:"Vence"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-2.5 w-4 h-4 text-muted-foreground"}),e.jsx(B,{value:v,onChange:t=>j(t.target.value),className:"pl-9 text-center bg-muted/30 border-muted-foreground/20 focus-visible:ring-primary/20",placeholder:"MM/AA",maxLength:5})]})]}),e.jsxs("div",{className:"col-span-5 sm:col-span-3",children:[e.jsx("label",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-1.5 block ml-1",children:"Cant."}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(B,{type:"number",value:N,onChange:t=>I(t.target.value),className:"text-center font-bold text-lg bg-muted/30 border-muted-foreground/20 focus-visible:ring-primary/20",placeholder:"0"}),e.jsx(g,{variant:E?"secondary":"outline",size:"icon",className:"h-10 w-10 shrink-0",onClick:()=>F(!E),title:"Calculadora",children:e.jsx(Me,{className:"w-4 h-4"})})]})]})]}),e.jsx(R,{children:E&&e.jsx(L.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border rounded-lg bg-muted/20",children:e.jsx(Le,{onResult:M,onClose:()=>F(!1)})})}),e.jsxs(g,{onClick:r,className:"w-full text-sm h-11 shadow-lg shadow-primary/20",size:"lg",children:[e.jsx(Q,{className:"w-5 h-5 mr-2"})," Agregar Lote"]})]}),e.jsx("div",{className:"bg-muted/30 rounded-xl p-1 min-h-[120px] max-h-[220px] overflow-y-auto border border-border/50",children:e.jsx(R,{initial:!1,mode:"popLayout",children:u.length===0?e.jsxs(L.div,{initial:{opacity:0},animate:{opacity:1},className:"h-full flex flex-col items-center justify-center text-muted-foreground py-8",children:[e.jsx(T,{className:"w-8 h-8 opacity-20 mb-2"}),e.jsx("p",{className:"text-xs",children:"No hay lotes agregados"})]}):u.map((t,o)=>e.jsxs(L.div,{layout:!0,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,x:-20},className:"bg-card p-3 rounded-lg shadow-sm border mb-2 flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-xs ring-1 ring-primary/20",children:o+1}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"font-mono font-bold text-sm tracking-tight",children:t.batchNumber}),e.jsxs(oe,{variant:"outline",className:"text-[10px] h-5 px-1.5 font-normal text-muted-foreground border-border",children:["Vence: ",t.expirationDate]})]})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-lg font-bold tabular-nums",children:["x",t.quantity]}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-destructive hover:bg-destructive/10",onClick:()=>a(o),children:e.jsx(G,{className:"w-4 h-4"})})]})]},`${t.batchNumber}-${o}`))})})]}),e.jsxs(re,{className:"p-4 bg-muted/30 border-t flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 flex items-center text-sm font-medium text-muted-foreground",children:["Total: ",e.jsxs("span",{className:"ml-1 text-foreground font-bold",children:[u.reduce((t,o)=>t+o.quantity,0)," u."]})]}),e.jsx(g,{variant:"ghost",onClick:()=>d(!1),children:"Cancelar"}),e.jsx(g,{onClick:m,disabled:u.length===0,className:"px-8",children:"Guardar"})]})]})})}function hs(){const c=ue(),[d,b]=l.useState("config"),[y,w]=l.useState(""),[A,u]=l.useState(!1),[z,S]=l.useState(""),[p,v]=l.useState(null),[k,N]=l.useState(!1),[I,f]=l.useState([]),[$,E]=l.useState(!1),[F,M]=l.useState(""),{session:x,items:j,totalProducts:r,totalUnits:a,isLoading:m,startSession:t,addItem:o,deleteItem:D,finishSession:H,availableSessions:W,resumeSession:ie,deleteSession:le}=He(),{isOnline:O}=ve(),J=async()=>{if(!y.trim()){i.error("Error","Ingresa el nombre del sector");return}await t(y.trim()),b("counting")},ce=async s=>{await q(s),u(!1)},q=async(s,n)=>{S(s);let h=n;if(!h){const U=await ye(s);h=U?U.name:`Producto ${s}`}v({name:h,ean:s});const C=j.find(U=>U.ean===s);C?(f([...C.batches]),i.info("Información","Producto ya contado. Editando lotes existentes.")):f([]),N(!0)},de=()=>{E(!0)},me=async()=>{if(!F.trim()){i.error("Error","Por favor ingresa el nombre del responsable");return}const s={id:crypto.randomUUID(),sector:(x==null?void 0:x.sector)||y,date:new Date().toISOString(),responsible:F,items:j,stats:{totalProducts:r,totalUnits:a}},n=JSON.parse(localStorage.getItem("expiration-reports")||"[]");localStorage.setItem("expiration-reports",JSON.stringify([s,...n])),await H(),i.success("Operación exitosa","Control guardado exitosamente"),c("/reports")},_=s=>{if(!s)return"";if(s.match(/^\d{4}-\d{2}$/)){const[n,h]=s.split("-");return`${h}/${n.slice(2)}`}return s},xe=()=>{if(j.length===0)return i.error("Error","No hay datos");const s=new Be;let n=20;s.setFontSize(16),s.text(`Control de Vencimientos: ${x==null?void 0:x.sector}`,10,n),s.setFontSize(10),s.text(`Fecha: ${new Date().toLocaleDateString()}`,10,n+6),n+=15,j.forEach(h=>{n>270&&(s.addPage(),n=20),s.setFont("helvetica","bold"),s.text(`${h.productName} (EAN: ${h.ean})`,10,n),s.text(`Total: ${h.totalQuantity}`,180,n,{align:"right"}),n+=6,s.setFont("helvetica","normal"),s.setFontSize(9),s.text("Lote",15,n),s.text("Vencimiento",80,n),s.text("Cantidad",150,n),n+=5,h.batches.forEach(C=>{s.text(C.batchNumber,15,n),s.text(_(C.expirationDate),80,n),s.text(C.quantity.toString(),150,n),n+=5}),n+=5}),s.save(`Vencimientos_${x==null?void 0:x.sector}.pdf`),i.success("Operación exitosa","PDF Generado")};return e.jsxs("div",{className:"space-y-6 max-w-5xl mx-auto pb-20",children:[e.jsx(R,{mode:"wait",children:d==="config"?e.jsxs("div",{className:"p-4 md:p-6 max-w-7xl mx-auto space-y-8 animate-in fade-in duration-500",children:[e.jsx("div",{className:"flex justify-end",children:O?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-success/10 text-success rounded-full text-sm",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"En línea"})]}):e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-warning/10 text-warning rounded-full text-sm",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Sin conexión"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 items-start",children:[e.jsxs(P,{className:"border-muted/50 shadow-lg overflow-hidden relative group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-primary/20 group-hover:bg-primary transition-colors"}),e.jsxs(X,{className:"p-6 md:p-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 text-primary",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-xl",children:e.jsx(Q,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Nueva Sesión"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Genera un reporte de control de fechas de vencimiento para un sector o estantería."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground ml-1",children:"Nombre del Sector"}),e.jsx(B,{value:y,onChange:s=>w(s.target.value),placeholder:"Ej: Estantería A1",className:"h-12 text-lg bg-muted/30 border-muted-foreground/20 focus:border-primary transition-all",autoFocus:!0,onKeyDown:s=>s.key==="Enter"&&J()})]}),e.jsx(g,{className:"w-full h-12 text-lg font-medium shadow-md hover:shadow-lg transition-all",onClick:J,disabled:!y.trim()||m,children:m?"Iniciando...":"Comenzar Control"})]})]})]}),e.jsxs(P,{className:"border-muted/50 shadow-lg h-full",children:[e.jsx(ge,{className:"pb-4 border-b border-border/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-secondary rounded-lg text-secondary-foreground",children:e.jsx(Oe,{className:"w-5 h-5"})}),e.jsx(fe,{className:"text-lg",children:"Sesiones Abiertas"})]})}),e.jsx(X,{className:"p-0",children:W.length===0?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:e.jsx("p",{children:"No hay sesiones activas"})}):e.jsx("div",{className:"divide-y divide-border/50 max-h-[400px] overflow-y-auto",children:W.map(s=>e.jsxs("div",{className:"p-4 hover:bg-muted/30 transition-colors flex items-center justify-between group",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-medium text-lg leading-none group-hover:text-primary transition-colors",children:s.sector}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ne,{className:"w-3 h-3"}),e.jsx("span",{children:Re(new Date(s.startTime),"d MMM yyyy, HH:mm",{locale:$e})})]}),e.jsxs("div",{className:"flex gap-3 text-xs text-muted-foreground mt-1",children:[e.jsxs("span",{className:"bg-primary/5 px-2 py-0.5 rounded text-primary font-medium",children:[s.totalProducts||0," prod."]}),e.jsxs("span",{className:"bg-secondary px-2 py-0.5 rounded text-secondary-foreground font-medium",children:[s.totalUnits||0," unid."]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-destructive hover:bg-destructive/10",onClick:()=>le(s.id),title:"Eliminar sesión",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsxs(g,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",onClick:()=>{ie(s),b("counting")},children:["Retomar",e.jsx(Ue,{className:"w-4 h-4"})]})]})]},s.id))})})]})]})]}):e.jsx(e.Fragment,{children:e.jsxs(L.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"p-4 md:p-6 space-y-4 max-w-7xl mx-auto",children:[e.jsx(P,{className:"min-h-[120px] flex flex-col justify-center px-6 sm:px-8 bg-gradient-to-br from-secondary/40 to-secondary/20 border-muted/50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 min-w-0",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Sector"}),e.jsx("span",{className:"font-bold text-foreground text-lg sm:text-xl truncate",children:x==null?void 0:x.sector})]}),e.jsx("div",{className:"h-10 sm:h-12 w-px bg-border/40 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-8 sm:gap-12 flex-1 justify-center",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Productos"}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-primary",children:e.jsx(Y,{value:r,digits:4})})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Unidades"}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:e.jsx(Y,{value:a,digits:4})})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsx("div",{className:`p-2 rounded-full ${O?"bg-success/10 text-success":"bg-warning/10 text-warning"}`,title:O?"En línea":"Sin conexión",children:O?e.jsx(Z,{className:"w-4 h-4"}):e.jsx(K,{className:"w-4 h-4"})})})]})}),e.jsx(P,{className:"p-2 sm:p-3 shadow-md border-primary/20 bg-card/80 backdrop-blur-sm relative z-50",children:e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex gap-4",children:e.jsx("div",{className:"flex-1 relative z-20",children:e.jsx(we,{onSelect:s=>q(s.ean,s.name),autoFocus:!0,className:"w-full"})})})})}),e.jsxs("div",{className:"space-y-2 relative z-10",children:[e.jsx("div",{className:"flex items-center justify-between px-1",children:e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wider",children:["Registros (",j.length,")"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:e.jsx(R,{mode:"popLayout",children:j.length===0?e.jsxs("div",{className:"col-span-full p-8 text-center text-muted-foreground border rounded-lg border-dashed bg-muted/20",children:[e.jsx(T,{className:"w-12 h-12 mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"No hay productos registrados aún"})]}):j.map((s,n)=>e.jsx(L.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},layout:!0,children:e.jsxs(P,{className:"h-full relative overflow-hidden group border-muted/60 shadow-sm hover:shadow-md transition-all",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-primary/20 group-hover:bg-primary transition-colors"}),e.jsxs("div",{className:"p-3 pl-4 flex flex-col h-full gap-2",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsx("h4",{className:"font-medium text-sm leading-tight line-clamp-2 text-foreground/90",title:s.productName,children:s.productName}),e.jsxs("div",{className:"text-xs font-bold bg-secondary/50 px-1.5 py-0.5 rounded text-foreground/70 text-right flex-shrink-0",children:["#",j.length-n]})]}),e.jsx("div",{children:e.jsx(oe,{variant:"outline",className:"text-[10px] h-5 font-mono text-muted-foreground border-border/50 px-1.5 font-normal",children:s.ean})}),e.jsxs("div",{className:"flex flex-wrap gap-1 content-start flex-1 min-h-[1.5rem]",children:[s.batches.slice(0,3).map((h,C)=>e.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] bg-secondary text-secondary-foreground border border-secondary-foreground/10",title:`Lote: ${h.batchNumber}`,children:[e.jsx(Te,{className:"w-2.5 h-2.5 mr-1 opacity-70"}),_(h.expirationDate),e.jsx("span",{className:"mx-1 opacity-50",children:"|"}),"x",h.quantity]},C)),s.batches.length>3&&e.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] bg-muted text-muted-foreground",children:["+",s.batches.length-3]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 mt-auto border-t border-border/30",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-xl font-bold tracking-tight text-foreground",children:s.totalQuantity}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium uppercase tracking-wider",children:"total"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-primary hover:bg-primary/5",onClick:()=>q(s.ean,s.productName),title:"Editar / Agregar lote",children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx(g,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive hover:bg-destructive/5",onClick:()=>D(s.id),title:"Eliminar",children:e.jsx(G,{className:"w-4 h-4"})})]})]})]})]})},s.id))})})]}),e.jsx(Pe,{actions:[{label:"Finalizar",icon:e.jsx(Ne,{className:"w-5 h-5"}),onClick:de,variant:"default",color:"bg-primary text-primary-foreground"},{label:"Exportar PDF",icon:e.jsx(je,{className:"w-5 h-5"}),onClick:xe,variant:"secondary"}]})]},"counting")})}),e.jsx(qe,{open:k,onOpenChange:s=>{N(s),s||(S(""),v(null),f([]))},productName:(p==null?void 0:p.name)||"",ean:(p==null?void 0:p.ean)||"",initialBatches:I,onSave:async s=>{p&&(await o(p.ean,p.name,s),N(!1),v(null),S(""),f([]),setTimeout(()=>{var n;(n=document.getElementById("smart-search-input"))==null||n.focus()},50))}}),e.jsx(ee,{open:$,onOpenChange:E,children:e.jsxs(se,{children:[e.jsxs(be,{children:[e.jsx(te,{children:"Finalizar Control de Vencimientos"}),e.jsx(ae,{children:"Por favor confirma los datos para guardar el reporte."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(V,{className:"text-xs text-muted-foreground",children:"Fecha"}),e.jsx("div",{className:"font-medium",children:new Date().toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx(V,{className:"text-xs text-muted-foreground",children:"Hora"}),e.jsx("div",{className:"font-medium",children:new Date().toLocaleTimeString()})]})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"responsible",className:"mb-2 block",children:"Responsable del Control *"}),e.jsx(B,{id:"responsible",value:F,onChange:s=>M(s.target.value),placeholder:"Nombre y Apellido",autoFocus:!0})]}),e.jsxs("div",{className:"bg-primary/5 p-4 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Unidades Contadas"}),e.jsx("span",{className:"text-2xl font-bold text-primary",children:a})]})]}),e.jsxs(re,{children:[e.jsx(g,{variant:"outline",onClick:()=>E(!1),children:"Cancelar"}),e.jsx(g,{onClick:me,children:"Guardar y Finalizar"})]})]})}),e.jsx(Se,{open:A,onOpenChange:u,onScan:ce})]})}export{hs as default};
