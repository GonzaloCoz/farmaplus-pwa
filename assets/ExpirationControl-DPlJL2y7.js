import{j as e,s as je,v as ae,w as ve,x as be}from"./ui-vendor-B7e8T5zR.js";import{r as l,u as ye}from"./react-vendor-ylmX0jv_.js";import{u as we,A as o,b as Se,E as re,F as ne,P as U,G as oe,H as ie,J as le,B as h,X as Ce,a6 as Ee,N as H,O as ce,W as Z,h as O,l as ee,i as ke,j as ze,o as Ie,a4 as Pe,a5 as Ae}from"./index-DtE1zeX6.js";import{I as $}from"./input-BdU_B0sQ.js";import{L as W}from"./label-BnCnHRO5.js";import{B as J}from"./badge-Di4zDw6r.js";import{u as De,A as se,S as Fe,B as Me}from"./AnimatedCounter-BmLL83tY.js";import{a as Be,c as Le,d as $e,u as Oe,b as Re,e as Te,f as qe,h as Ue}from"./expirationDB-BGQ_U_qk.js";import{F as He}from"./FabMenu-C7dQHWi0.js";import{E as Ve}from"./jspdf.es.min-Beq_op9W.js";import{C as Ge,P as de}from"./Calculator-OeNDtzYh.js";import{C as me}from"./calendar-DKCJ43Kw.js";import{C as _}from"./clock-DGkwcgkP.js";import{A as V,m as R}from"./animation-DYtBTRHa.js";import{P as K}from"./plus--Vz3Uylw.js";import{W as te}from"./wifi-CtB2slF2.js";import{H as Qe}from"./history-oiCQOgEF.js";import{A as We}from"./arrow-right-C8qDe63I.js";import{f as Je}from"./utils-6kd64X-K.js";import{e as _e}from"./es-Ccl0IK8c.js";import"./excel-uoQkVabA.js";import"./scanner-D4NToCeH.js";import"./switch-DSvt-aqB.js";import"./loader-circle-IvW8_zOj.js";import"./barcode-CFn0xD93.js";function Ke(){const{user:c}=we(),[d,j]=l.useState(null),[v,y]=l.useState([]),[D,f]=l.useState([]),[F,C]=l.useState(0),[g,w]=l.useState(0),[E,b]=l.useState(!0);l.useEffect(()=>{c!=null&&c.branchName?k(c.branchName):(j(null),f([]))},[c==null?void 0:c.branchName]);const k=async r=>{try{b(!0);const a=await Be(r);y(a)}catch(a){console.error("Error loading expiration session:",a),o.error("Error","No se pudo cargar la sesión")}finally{b(!1)}},N=async r=>{const a=await Ue(r);a.sort((u,p)=>p.timestamp-u.timestamp),f(a),C(a.length),w(a.reduce((u,p)=>u+p.totalQuantity,0))};return{session:d,items:D,totalProducts:F,totalUnits:g,isLoading:E,availableSessions:v,startSession:async r=>{try{if(!(c!=null&&c.branchName)){o.error("Error","No hay sucursal seleccionada");return}if(v.find(p=>p.sector===r)){o.error("Sesión duplicada","Ya existe una sesión para este sector");return}const u=await Le(r,c.branchName);j(u),y(p=>[u,...p]),f([])}catch(a){console.error("Error starting session:",a),o.error("Error","No se pudo iniciar la sesión")}},resumeSession:async r=>{try{j(r),await N(r.id),o.success("Sesión retomada",`Continuando control de ${r.sector}`)}catch(a){console.error("Error resuming:",a),o.error("Error","No se pudo retomar la sesión")}},deleteSession:async r=>{if(confirm("¿Eliminar sesión?"))try{await $e(r),y(a=>a.filter(u=>u.id!==r)),(d==null?void 0:d.id)===r&&(j(null),f([])),o.success("Sesión eliminada","La sesión se eliminó correctamente")}catch(a){console.error("Error deleting:",a),o.error("Error","No se pudo eliminar la sesión")}},addItem:async(r,a,u)=>{try{const p=D.find(A=>A.ean===r);if(p)await Oe(p.id,{batches:u,timestamp:Date.now()}),o.success("Producto actualizado","Los datos del producto se actualizaron correctamente");else{if(!(c!=null&&c.branchName))throw new Error("No branch selected");await Re({ean:r,productName:a,batches:u,totalQuantity:u.reduce((A,t)=>A+t.quantity,0)},c.branchName),o.success("Producto agregado",`${a} agregado al control`)}d&&await N(d.id)}catch(p){console.error("Error adding/updating item:",p),o.error("Error","No se pudo guardar el producto")}},deleteItem:async r=>{if(confirm("¿Estás seguro de eliminar este producto?"))try{await Te(r),o.success("Producto eliminado","El producto se eliminó del control"),d&&await N(d.id)}catch(a){console.error("Error deleting item:",a),o.error("Error","No se pudo eliminar el producto")}},finishSession:async()=>{if(d&&confirm("¿Finalizar control de vencimientos?"))try{await qe(d.id),y(r=>r.filter(a=>a.id!==d.id)),j(null),f([]),o.success("Control finalizado","El control de vencimientos se finalizó correctamente")}catch(r){console.error("Error finishing session:",r),o.error("Error","No se pudo finalizar el control")}}}}const Xe=ve,Ye=be,xe=l.forwardRef(({className:c,align:d="center",sideOffset:j=4,...v},y)=>e.jsx(je,{children:e.jsx(ae,{ref:y,align:d,sideOffset:j,className:Se("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",c),...v})}));xe.displayName=ae.displayName;function Ze({open:c,onOpenChange:d,productName:j,ean:v,initialBatches:y,onSave:D}){const[f,F]=l.useState([]),[C,g]=l.useState(""),[w,E]=l.useState(""),[b,k]=l.useState(""),[N,M]=l.useState(1),[B,L]=l.useState(!1),[z,x]=l.useState(""),S=t=>{k(Math.floor(t).toString())};l.useEffect(()=>{c&&(F([...y]),r())},[c,y]);const r=()=>{g(""),E(""),k(""),M(1),x("")},a=t=>{if(t.length<w.length){E(t);return}let i=t.replace(/\D/g,"");if(i.length>=2){const I=parseInt(i.slice(0,2));(I===0||I>12)&&(i=i.slice(0,1))}i.length>=2&&(i=i.slice(0,2)+"/"+i.slice(2,4)),i.length>5&&(i=i.slice(0,5)),E(i)},u=()=>{if(!C.trim())return o.error("Datos incompletos","Falta el número de lote");if(w.length<5)return o.error("Fecha incompleta","Ingresa la fecha en formato MM/AA");if(!b||Number(b)<=0)return o.error("Cantidad inválida","La cantidad debe ser mayor a 0");const t=z?parseInt(z):N;if(isNaN(t)||t<=0)return o.error("Alerta inválida","Meses de alerta inválidos");const i={batchNumber:C.toUpperCase(),expirationDate:w,quantity:Number(b),reminderMonths:t,status:"active"};F(I=>[...I,i]),o.success("Lote agregado","El lote se agregó correctamente"),r()},p=t=>{F(i=>i.filter((I,G)=>G!==t))},A=()=>{D(f),d(!1)};return e.jsx(re,{open:c,onOpenChange:d,children:e.jsxs(ne,{className:"max-w-md p-0 overflow-hidden gap-0 bg-background/95 backdrop-blur-xl border-white/10 shadow-2xl",onInteractOutside:t=>t.preventDefault(),children:[e.jsxs("div",{className:"bg-primary px-6 py-5 relative overflow-hidden",children:[e.jsx("div",{className:"absolute right-0 top-0 opacity-10 transform translate-x-1/3 -translate-y-1/3",children:e.jsx(U,{size:120})}),e.jsxs(oe,{className:"relative z-10 text-primary-foreground text-left space-y-1",children:[e.jsx(ie,{className:"text-xl font-bold leading-tight pr-8 line-clamp-2",children:j}),e.jsxs(le,{className:"text-primary-foreground/70 text-xs font-mono",children:["EAN: ",v]})]}),e.jsx(h,{variant:"ghost",size:"icon",className:"absolute right-2 top-2 text-primary-foreground/50 hover:text-primary-foreground hover:bg-white/10 rounded-full h-8 w-8 z-20",onClick:()=>d(!1),children:e.jsx(Ce,{size:18})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-3",children:[e.jsxs("div",{className:"col-span-5 space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-wider ml-1",children:"Nro. Lote"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground/50"}),e.jsx($,{value:C,onChange:t=>g(t.target.value),placeholder:"A123",className:"pl-9 bg-muted/30 border-muted-foreground/20 focus:bg-background h-10 transition-colors uppercase",maxLength:10})]})]}),e.jsxs("div",{className:"col-span-4 space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-wider ml-1",children:"Vence"}),e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground/50"}),e.jsx($,{value:w,onChange:t=>a(t.target.value),placeholder:"MM/AA",className:"pl-9 bg-muted/30 border-muted-foreground/20 focus:bg-background h-10 transition-colors text-center",maxLength:5})]})]}),e.jsxs("div",{className:"col-span-3 space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-wider ml-1 text-center",children:"Cant."}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"relative flex-1",children:e.jsx($,{value:b,onChange:t=>k(t.target.value),placeholder:"0",className:"px-1 text-center bg-muted/30 border-muted-foreground/20 focus:bg-background h-10 transition-colors font-bold",type:"number"})}),e.jsxs(Xe,{children:[e.jsx(Ye,{asChild:!0,children:e.jsxs(h,{variant:"outline",size:"icon",className:"h-10 w-10 shrink-0 border-muted-foreground/20 bg-muted/30 hover:bg-background relative",title:"Alerta de vencimiento",children:[e.jsx(_,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-primary text-[8px] text-primary-foreground font-bold border border-background",children:z||N})]})}),e.jsx(xe,{className:"w-64 p-3",align:"end",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-sm leading-none flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-primary"}),"Anticipación de Alerta"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"¿Cuantos meses antes quieres que te avisemos?"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[1,2,3,4,6,12].map(t=>e.jsxs(h,{variant:N===t&&!z?"default":"outline",size:"sm",className:"h-8 text-xs",onClick:()=>{M(t),x("")},children:[t," Mes",t>1?"es":""]},t))}),e.jsx("div",{className:"pt-2 border-t mt-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground whitespace-nowrap",children:"Personalizado:"}),e.jsx($,{className:"h-7 text-xs",placeholder:"#",type:"number",value:z,onChange:t=>x(t.target.value)})]})})]})})]})]})]})]}),e.jsx(V,{children:B&&e.jsx(R.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border rounded-lg bg-muted/20",children:e.jsx(Ge,{onResult:S,onClose:()=>L(!1)})})}),e.jsxs(h,{className:"w-full bg-primary hover:bg-primary/90 text-white shadow-lg shadow-primary/20 h-11",onClick:u,children:[e.jsx(K,{className:"mr-2 h-4 w-4"})," Agregar Lote"]})]}),e.jsx("div",{className:"bg-muted/30 rounded-xl p-1 min-h-[120px] max-h-[220px] overflow-y-auto border border-border/50",children:e.jsx(V,{initial:!1,mode:"popLayout",children:f.length===0?e.jsxs(R.div,{initial:{opacity:0},animate:{opacity:1},className:"h-full flex flex-col items-center justify-center text-muted-foreground py-8",children:[e.jsx(U,{className:"w-8 h-8 opacity-20 mb-2"}),e.jsx("p",{className:"text-xs",children:"No hay lotes agregados"})]}):f.map((t,i)=>e.jsxs(R.div,{layout:!0,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,x:-20},className:"bg-card p-3 rounded-lg shadow-sm border mb-2 flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-xs ring-1 ring-primary/20 shrink-0",children:i+1}),e.jsx("div",{className:"min-w-0",children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"font-mono font-bold text-sm tracking-tight truncate max-w-[80px] sm:max-w-none",children:t.batchNumber}),e.jsxs(J,{variant:"outline",className:"text-[10px] h-5 px-1.5 font-normal text-muted-foreground border-border whitespace-nowrap",children:["Vence: ",t.expirationDate]})]})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.reminderMonths&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] sm:text-xs font-medium bg-muted/50 px-2 py-1 rounded text-muted-foreground whitespace-nowrap",title:`${t.reminderMonths} meses de alerta`,children:[e.jsx(_,{className:"w-3 h-3"}),e.jsxs("span",{children:[t.reminderMonths,"m"]})]}),e.jsxs("div",{className:"flex items-center gap-2 border-l pl-3 ml-1 h-8",children:[e.jsxs("span",{className:"text-lg font-bold tabular-nums",children:["x",t.quantity]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(h,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-primary hover:bg-primary/10",onClick:()=>{g(t.batchNumber),E(t.expirationDate),k(t.quantity.toString()),M(t.reminderMonths||1),p(i)},title:"Editar lote",children:e.jsx(de,{className:"w-3 h-3"})}),e.jsx(h,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-destructive hover:bg-destructive/10",onClick:()=>p(i),title:"Eliminar lote",children:e.jsx(H,{className:"w-4 h-4"})})]})]})]})]},`${t.batchNumber}-${i}`))})})]}),e.jsxs(ce,{className:"p-4 bg-muted/30 border-t flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 flex items-center text-sm font-medium text-muted-foreground",children:["Total: ",e.jsxs("span",{className:"ml-1 text-foreground font-bold",children:[f.reduce((t,i)=>t+i.quantity,0)," u."]})]}),e.jsx(h,{variant:"ghost",onClick:()=>d(!1),children:"Cancelar"}),e.jsx(h,{onClick:A,disabled:f.length===0,className:"px-8",children:"Guardar"})]})]})})}function Cs(){const c=ye(),[d,j]=l.useState("config"),[v,y]=l.useState(""),[D,f]=l.useState(!1),[F,C]=l.useState(""),[g,w]=l.useState(null),[E,b]=l.useState(!1),[k,N]=l.useState([]),[M,B]=l.useState(!1),[L,z]=l.useState(""),{session:x,items:S,totalProducts:r,totalUnits:a,isLoading:u,startSession:p,addItem:A,deleteItem:t,finishSession:i,availableSessions:I,resumeSession:G,deleteSession:ue}=Ke(),{isOnline:T}=De(),X=async()=>{if(!v.trim()){o.error("Error","Ingresa el nombre del sector");return}await p(v.trim()),j("counting")},pe=async s=>{await Q(s),f(!1)},he=s=>{C(s.ean),w({name:s.productName,ean:s.ean}),N(s.batches),b(!0)},Q=async(s,n)=>{C(s);let m=n;if(!m){const q=await Ae(s);m=q?q.name:`Producto ${s}`}w({name:m,ean:s});const P=S.find(q=>q.ean===s);P?(N([...P.batches]),o.info("Información","Producto ya contado. Editando lotes existentes.")):N([]),b(!0)},ge=()=>{B(!0)},fe=async()=>{if(!L.trim()){o.error("Error","Por favor ingresa el nombre del responsable");return}const s={id:crypto.randomUUID(),sector:(x==null?void 0:x.sector)||v,date:new Date().toISOString(),responsible:L,items:S,stats:{totalProducts:r,totalUnits:a}},n=JSON.parse(localStorage.getItem("expiration-reports")||"[]");localStorage.setItem("expiration-reports",JSON.stringify([s,...n])),await i(),o.success("Operación exitosa","Control guardado exitosamente"),c("/reports")},Y=s=>{if(!s)return"";if(s.match(/^\d{4}-\d{2}$/)){const[n,m]=s.split("-");return`${m}/${n.slice(2)}`}return s},Ne=()=>{if(S.length===0)return o.error("Error","No hay datos");const s=new Ve;let n=20;s.setFontSize(16),s.text(`Control de Vencimientos: ${x==null?void 0:x.sector}`,10,n),s.setFontSize(10),s.text(`Fecha: ${new Date().toLocaleDateString()}`,10,n+6),n+=15,S.forEach(m=>{n>270&&(s.addPage(),n=20),s.setFont("helvetica","bold"),s.text(`${m.productName} (EAN: ${m.ean})`,10,n),s.text(`Total: ${m.totalQuantity}`,180,n,{align:"right"}),n+=6,s.setFont("helvetica","normal"),s.setFontSize(9),s.text("Lote",15,n),s.text("Vencimiento",80,n),s.text("Cantidad",150,n),n+=5,m.batches.forEach(P=>{s.text(P.batchNumber,15,n),s.text(Y(P.expirationDate),80,n),s.text(P.quantity.toString(),150,n),n+=5}),n+=5}),s.save(`Vencimientos_${x==null?void 0:x.sector}.pdf`),o.success("Operación exitosa","PDF Generado")};return e.jsxs("div",{className:"space-y-6 max-w-5xl mx-auto pb-20",children:[e.jsx(V,{mode:"wait",children:d==="config"?e.jsxs("div",{className:"p-4 md:p-6 max-w-7xl mx-auto space-y-8 animate-in fade-in duration-500",children:[e.jsx("div",{className:"flex justify-end",children:T?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-success/10 text-success rounded-full text-sm",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"En línea"})]}):e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-warning/10 text-warning rounded-full text-sm",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Sin conexión"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 items-start",children:[e.jsxs(O,{className:"border-muted/50 shadow-lg overflow-hidden relative group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-primary/20 group-hover:bg-primary transition-colors"}),e.jsxs(ee,{className:"p-6 md:p-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 text-primary",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-xl",children:e.jsx(K,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Nueva Sesión"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Genera un reporte de control de fechas de vencimiento para un sector o estantería."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground ml-1",children:"Nombre del Sector"}),e.jsx($,{value:v,onChange:s=>y(s.target.value),placeholder:"Ej: Estantería A1",className:"h-12 text-lg bg-muted/30 border-muted-foreground/20 focus:border-primary transition-all",autoFocus:!0,onKeyDown:s=>s.key==="Enter"&&X()})]}),e.jsx(h,{className:"w-full h-12 text-lg font-medium shadow-md hover:shadow-lg transition-all",onClick:X,disabled:!v.trim()||u,children:u?"Iniciando...":"Comenzar Control"})]})]})]}),e.jsxs(O,{className:"border-muted/50 shadow-lg h-full",children:[e.jsx(ke,{className:"pb-4 border-b border-border/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-secondary rounded-lg text-secondary-foreground",children:e.jsx(Qe,{className:"w-5 h-5"})}),e.jsx(ze,{className:"text-lg",children:"Sesiones Abiertas"})]})}),e.jsx(ee,{className:"p-0",children:I.length===0?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:e.jsx("p",{children:"No hay sesiones activas"})}):e.jsx("div",{className:"divide-y divide-border/50 max-h-[400px] overflow-y-auto",children:I.map(s=>e.jsxs("div",{className:"p-4 hover:bg-muted/30 transition-colors flex items-center justify-between group",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-medium text-lg leading-none group-hover:text-primary transition-colors",children:s.sector}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(me,{className:"w-3 h-3"}),e.jsx("span",{children:Je(new Date(s.startTime),"d MMM yyyy, HH:mm",{locale:_e})})]}),e.jsxs("div",{className:"flex gap-3 text-xs text-muted-foreground mt-1",children:[e.jsxs("span",{className:"bg-primary/5 px-2 py-0.5 rounded text-primary font-medium",children:[s.totalProducts||0," prod."]}),e.jsxs("span",{className:"bg-secondary px-2 py-0.5 rounded text-secondary-foreground font-medium",children:[s.totalUnits||0," unid."]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-destructive hover:bg-destructive/10",onClick:()=>ue(s.id),title:"Eliminar sesión",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsxs(h,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",onClick:()=>{G(s),j("counting")},children:["Retomar",e.jsx(We,{className:"w-4 h-4"})]})]})]},s.id))})})]})]})]}):e.jsx(e.Fragment,{children:e.jsxs(R.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"p-4 md:p-6 space-y-4 max-w-7xl mx-auto",children:[e.jsx(O,{className:"min-h-[120px] flex flex-col justify-center px-6 sm:px-8 bg-gradient-to-br from-secondary/40 to-secondary/20 border-muted/50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 min-w-0",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Sector"}),e.jsx("span",{className:"font-bold text-foreground text-lg sm:text-xl truncate",children:x==null?void 0:x.sector})]}),e.jsx("div",{className:"h-10 sm:h-12 w-px bg-border/40 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-8 sm:gap-12 flex-1 justify-center",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Productos"}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-primary",children:e.jsx(se,{value:r,digits:4})})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Unidades"}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:e.jsx(se,{value:a,digits:4})})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsx("div",{className:`p-2 rounded-full ${T?"bg-success/10 text-success":"bg-warning/10 text-warning"}`,title:T?"En línea":"Sin conexión",children:T?e.jsx(te,{className:"w-4 h-4"}):e.jsx(Z,{className:"w-4 h-4"})})})]})}),e.jsx(O,{className:"p-2 sm:p-3 shadow-md border-primary/20 bg-card/80 backdrop-blur-sm relative z-50",children:e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex gap-4",children:e.jsx("div",{className:"flex-1 relative z-20",children:e.jsx(Fe,{onSelect:s=>Q(s.ean,s.name),autoFocus:!0,className:"w-full"})})})})}),e.jsxs("div",{className:"space-y-2 relative z-10",children:[e.jsx("div",{className:"flex items-center justify-between px-1",children:e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wider",children:["Registros (",S.length,")"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:e.jsx(V,{mode:"popLayout",children:S.length===0?e.jsxs("div",{className:"col-span-full p-8 text-center text-muted-foreground border rounded-lg border-dashed bg-muted/20",children:[e.jsx(U,{className:"w-12 h-12 mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"No hay productos registrados aún"})]}):S.map((s,n)=>e.jsx(R.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},layout:!0,children:e.jsxs(O,{className:"h-full relative overflow-hidden group border-muted/60 shadow-sm hover:shadow-md transition-all",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-primary/20 group-hover:bg-primary transition-colors"}),e.jsxs("div",{className:"p-3 pl-4 flex flex-col h-full gap-2",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsx("h4",{className:"font-medium text-sm leading-tight line-clamp-2 text-foreground/90",title:s.productName,children:s.productName}),e.jsxs("div",{className:"text-xs font-bold bg-secondary/50 px-1.5 py-0.5 rounded text-foreground/70 text-right flex-shrink-0",children:["#",S.length-n]})]}),e.jsx("div",{children:e.jsx(J,{variant:"outline",className:"text-[10px] h-5 font-mono text-muted-foreground border-border/50 px-1.5 font-normal",children:s.ean})}),e.jsxs("div",{className:"flex flex-wrap gap-1.5 mt-2 content-start min-h-[1.5rem]",children:[s.batches.slice(0,3).map((m,P)=>e.jsxs("div",{className:"inline-flex items-center gap-2 text-xs bg-secondary/50 rounded px-2 py-1 border border-secondary-foreground/10",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(J,{variant:"outline",className:"text-[10px] h-4 px-1 font-normal text-muted-foreground border-border/50",children:Y(m.expirationDate)}),e.jsxs("span",{className:"font-bold tabular-nums text-[10px]",children:["x",m.quantity]})]}),m.reminderMonths&&e.jsxs("div",{className:"flex items-center gap-0.5 text-[9px] text-muted-foreground border-l pl-1.5 border-border/50",title:`${m.reminderMonths} meses de alerta`,children:[e.jsx(_,{className:"w-2.5 h-2.5"}),e.jsxs("span",{className:"sr-only sm:not-sr-only",children:[m.reminderMonths,"m"]})]})]},P)),s.batches.length>3&&e.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] bg-muted text-muted-foreground",children:["+",s.batches.length-3]})]}),e.jsxs("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(h,{variant:"secondary",size:"icon",className:"h-6 w-6 shadow-sm mr-1",onClick:m=>{m.stopPropagation(),he(s)},children:e.jsx(de,{className:"w-3 h-3"})}),e.jsx(h,{variant:"destructive",size:"icon",className:"h-6 w-6 shadow-sm",onClick:m=>{m.stopPropagation(),t(s.id)},children:e.jsx(H,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 mt-auto border-t border-border/30",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-xl font-bold tracking-tight text-foreground",children:s.totalQuantity}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium uppercase tracking-wider",children:"total"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(h,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-primary hover:bg-primary/5",onClick:()=>Q(s.ean,s.productName),title:"Editar / Agregar lote",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx(h,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive hover:bg-destructive/5",onClick:()=>t(s.id),title:"Eliminar",children:e.jsx(H,{className:"w-4 h-4"})})]})]})]})]})},s.id))})})]}),e.jsx(He,{actions:[{label:"Finalizar",icon:e.jsx(Ie,{className:"w-5 h-5"}),onClick:ge,variant:"default",color:"bg-primary text-primary-foreground"},{label:"Exportar PDF",icon:e.jsx(Pe,{className:"w-5 h-5"}),onClick:Ne,variant:"secondary"}]})]},"counting")})}),e.jsx(Ze,{open:E,onOpenChange:s=>{b(s),s||(C(""),w(null),N([]))},productName:(g==null?void 0:g.name)||"",ean:(g==null?void 0:g.ean)||"",initialBatches:k,onSave:async s=>{g&&(await A(g.ean,g.name,s),b(!1),w(null),C(""),N([]),setTimeout(()=>{var n;(n=document.getElementById("smart-search-input"))==null||n.focus()},50))}}),e.jsx(re,{open:M,onOpenChange:B,children:e.jsxs(ne,{children:[e.jsxs(oe,{children:[e.jsx(ie,{children:"Finalizar Control de Vencimientos"}),e.jsx(le,{children:"Por favor confirma los datos para guardar el reporte."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(W,{className:"text-xs text-muted-foreground",children:"Fecha"}),e.jsx("div",{className:"font-medium",children:new Date().toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx(W,{className:"text-xs text-muted-foreground",children:"Hora"}),e.jsx("div",{className:"font-medium",children:new Date().toLocaleTimeString()})]})]}),e.jsxs("div",{children:[e.jsx(W,{htmlFor:"responsible",className:"mb-2 block",children:"Responsable del Control *"}),e.jsx($,{id:"responsible",value:L,onChange:s=>z(s.target.value),placeholder:"Nombre y Apellido",autoFocus:!0})]}),e.jsxs("div",{className:"bg-primary/5 p-4 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Unidades Contadas"}),e.jsx("span",{className:"text-2xl font-bold text-primary",children:a})]})]}),e.jsxs(ce,{children:[e.jsx(h,{variant:"outline",onClick:()=>B(!1),children:"Cancelar"}),e.jsx(h,{onClick:fe,children:"Guardar y Finalizar"})]})]})}),e.jsx(Me,{open:D,onOpenChange:f,onScan:pe})]})}export{Cs as default};
