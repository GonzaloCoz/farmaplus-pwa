import{j as e}from"./ui-vendor-CwIRxpyq.js";import{r as i,u as fe}from"./react-vendor-ylmX0jv_.js";import{E as te,F as ae,P as T,G as re,H as ne,J as ie,B as o,X as je,a6 as Ne,h as J,N as q,O as le,A as d,W as Y,i as M,m as Z,j as ve,k as be,p as ye,a4 as we,a5 as Ce}from"./index-4S8qSKY8.js";import{I as C}from"./input-N8FoNaiK.js";import{L as W}from"./label-Bq-JCdPU.js";import{u as Se,A as ee,S as ke,B as Ee}from"./AnimatedCounter-CYn97PCj.js";import{P as De,a as Fe,b as Ae,u as Me}from"./popover-JXzsw2Lw.js";import{F as Pe}from"./FabMenu--J0-tzKn.js";import{E as ze}from"./jspdf.es.min-8pzwaaXk.js";import{C as Ie,P as oe}from"./Calculator-BbJpnnIf.js";import{C as ce,e as Be}from"./es-K6a7ZvuD.js";import{C as Q}from"./clock-9bgXU4PT.js";import{A as H,m as P}from"./animation-DbfETv0H.js";import{P as de}from"./plus-Ds5SGdqx.js";import{W as se}from"./wifi-Yt91KO94.js";import{H as Oe}from"./history-p48GtpW_.js";import{A as Le}from"./arrow-right-BYGU_Lql.js";import{f as $e}from"./utils-DNiwW225.js";import"./excel-uoQkVabA.js";import"./scanner-D4NToCeH.js";import"./switch-BbRP8xhV.js";import"./loader-circle-DBkHespF.js";import"./barcode-ZH4kG-in.js";import"./expirationDB-CDs0AeDx.js";function Re({open:S,onOpenChange:b,productName:z,ean:N,initialBatches:I,onSave:U}){const[p,B]=i.useState([]),[g,c]=i.useState(""),[x,y]=i.useState(""),[u,w]=i.useState(""),[h,k]=i.useState(1),[E,D]=i.useState(!1),[v,l]=i.useState(""),m=t=>{w(Math.floor(t).toString())};i.useEffect(()=>{S&&(B([...I]),F())},[S,I]);const F=()=>{c(""),y(""),w(""),k(1),l("")},A=t=>{if(t.length<x.length){y(t);return}let r=t.replace(/\D/g,"");if(r.length>=2){const f=parseInt(r.slice(0,2));(f===0||f>12)&&(r=r.slice(0,1))}r.length>=2&&(r=r.slice(0,2)+"/"+r.slice(2,4)),r.length>5&&(r=r.slice(0,5)),y(r)},O=()=>{if(!g.trim())return d.error("Datos incompletos","Falta el número de lote");if(x.length<5)return d.error("Fecha incompleta","Ingresa la fecha en formato MM/AA");if(!u||Number(u)<=0)return d.error("Cantidad inválida","La cantidad debe ser mayor a 0");const t=v?parseInt(v):h;if(isNaN(t)||t<=0)return d.error("Alerta inválida","Meses de alerta inválidos");const r={batchNumber:g.toUpperCase(),expirationDate:x,quantity:Number(u),reminderMonths:t,status:"active"};B(f=>[...f,r]),d.success("Lote agregado","El lote se agregó correctamente"),F()},L=t=>{B(r=>r.filter((f,G)=>G!==t))},V=()=>{U(p),b(!1)};return e.jsx(te,{open:S,onOpenChange:b,children:e.jsxs(ae,{className:"max-w-md p-0 overflow-hidden gap-0 bg-background/95 backdrop-blur-xl border-white/10 shadow-2xl",onInteractOutside:t=>t.preventDefault(),children:[e.jsxs("div",{className:"bg-primary px-6 py-5 relative overflow-hidden",children:[e.jsx("div",{className:"absolute right-0 top-0 opacity-10 transform translate-x-1/3 -translate-y-1/3",children:e.jsx(T,{size:120})}),e.jsxs(re,{className:"relative z-10 text-primary-foreground text-left space-y-1",children:[e.jsx(ne,{className:"text-xl font-bold leading-tight pr-8 line-clamp-2",children:z}),e.jsxs(ie,{className:"text-primary-foreground/70 text-xs font-mono",children:["EAN: ",N]})]}),e.jsx(o,{variant:"ghost",size:"icon",className:"absolute right-2 top-2 text-primary-foreground/50 hover:text-primary-foreground hover:bg-white/10 rounded-full h-8 w-8 z-20",onClick:()=>b(!1),children:e.jsx(je,{size:18})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-3",children:[e.jsxs("div",{className:"col-span-5 space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-wider ml-1",children:"Nro. Lote"}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground/50"}),e.jsx(C,{value:g,onChange:t=>c(t.target.value),placeholder:"A123",className:"pl-9 bg-muted/30 border-muted-foreground/20 focus:bg-background h-10 transition-colors uppercase",maxLength:10})]})]}),e.jsxs("div",{className:"col-span-4 space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-wider ml-1",children:"Vence"}),e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground/50"}),e.jsx(C,{value:x,onChange:t=>A(t.target.value),placeholder:"MM/AA",className:"pl-9 bg-muted/30 border-muted-foreground/20 focus:bg-background h-10 transition-colors text-center",maxLength:5})]})]}),e.jsxs("div",{className:"col-span-3 space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-wider ml-1 text-center",children:"Cant."}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"relative flex-1",children:e.jsx(C,{value:u,onChange:t=>w(t.target.value),placeholder:"0",className:"px-1 text-center bg-muted/30 border-muted-foreground/20 focus:bg-background h-10 transition-colors font-bold",type:"number"})}),e.jsxs(De,{children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(o,{variant:"outline",size:"icon",className:"h-10 w-10 shrink-0 border-muted-foreground/20 bg-muted/30 hover:bg-background relative",title:"Alerta de vencimiento",children:[e.jsx(Q,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-primary text-[8px] text-primary-foreground font-bold border border-background",children:v||h})]})}),e.jsx(Ae,{className:"w-64 p-3",align:"end",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-sm leading-none flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-primary"}),"Anticipación de Alerta"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"¿Cuantos meses antes quieres que te avisemos?"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[1,2,3,4,6,12].map(t=>e.jsxs(o,{variant:h===t&&!v?"default":"outline",size:"sm",className:"h-8 text-xs",onClick:()=>{k(t),l("")},children:[t," Mes",t>1?"es":""]},t))}),e.jsx("div",{className:"pt-2 border-t mt-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground whitespace-nowrap",children:"Personalizado:"}),e.jsx(C,{className:"h-7 text-xs",placeholder:"#",type:"number",value:v,onChange:t=>l(t.target.value)})]})})]})})]})]})]})]}),e.jsx(H,{children:E&&e.jsx(P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border rounded-lg bg-muted/20",children:e.jsx(Ie,{onResult:m,onClose:()=>D(!1)})})}),e.jsxs(o,{className:"w-full bg-primary hover:bg-primary/90 text-white shadow-lg shadow-primary/20 h-11",onClick:O,children:[e.jsx(de,{className:"mr-2 h-4 w-4"})," Agregar Lote"]})]}),e.jsx("div",{className:"bg-muted/30 rounded-xl p-1 min-h-[120px] max-h-[220px] overflow-y-auto border border-border/50",children:e.jsx(H,{initial:!1,mode:"popLayout",children:p.length===0?e.jsxs(P.div,{initial:{opacity:0},animate:{opacity:1},className:"h-full flex flex-col items-center justify-center text-muted-foreground py-8",children:[e.jsx(T,{className:"w-8 h-8 opacity-20 mb-2"}),e.jsx("p",{className:"text-xs",children:"No hay lotes agregados"})]}):p.map((t,r)=>e.jsxs(P.div,{layout:!0,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,x:-20},className:"bg-card p-3 rounded-lg shadow-sm border mb-2 flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-xs ring-1 ring-primary/20 shrink-0",children:r+1}),e.jsx("div",{className:"min-w-0",children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"font-mono font-bold text-sm tracking-tight truncate max-w-[80px] sm:max-w-none",children:t.batchNumber}),e.jsxs(J,{variant:"outline",className:"text-[10px] h-5 px-1.5 font-normal text-muted-foreground border-border whitespace-nowrap",children:["Vence: ",t.expirationDate]})]})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.reminderMonths&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] sm:text-xs font-medium bg-muted/50 px-2 py-1 rounded text-muted-foreground whitespace-nowrap",title:`${t.reminderMonths} meses de alerta`,children:[e.jsx(Q,{className:"w-3 h-3"}),e.jsxs("span",{children:[t.reminderMonths,"m"]})]}),e.jsxs("div",{className:"flex items-center gap-2 border-l pl-3 ml-1 h-8",children:[e.jsxs("span",{className:"text-lg font-bold tabular-nums",children:["x",t.quantity]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-primary hover:bg-primary/10",onClick:()=>{c(t.batchNumber),y(t.expirationDate),w(t.quantity.toString()),k(t.reminderMonths||1),L(r)},title:"Editar lote",children:e.jsx(oe,{className:"w-3 h-3"})}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-destructive hover:bg-destructive/10",onClick:()=>L(r),title:"Eliminar lote",children:e.jsx(q,{className:"w-4 h-4"})})]})]})]})]},`${t.batchNumber}-${r}`))})})]}),e.jsxs(le,{className:"p-4 bg-muted/30 border-t flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 flex items-center text-sm font-medium text-muted-foreground",children:["Total: ",e.jsxs("span",{className:"ml-1 text-foreground font-bold",children:[p.reduce((t,r)=>t+r.quantity,0)," u."]})]}),e.jsx(o,{variant:"ghost",onClick:()=>b(!1),children:"Cancelar"}),e.jsx(o,{onClick:V,disabled:p.length===0,className:"px-8",children:"Guardar"})]})]})})}function ds(){const S=fe(),[b,z]=i.useState("config"),[N,I]=i.useState(""),[U,p]=i.useState(!1),[B,g]=i.useState(""),[c,x]=i.useState(null),[y,u]=i.useState(!1),[w,h]=i.useState([]),[k,E]=i.useState(!1),[D,v]=i.useState(""),{session:l,items:m,totalProducts:F,totalUnits:A,isLoading:O,startSession:L,addItem:V,deleteItem:t,finishSession:r,availableSessions:f,resumeSession:G,deleteSession:me}=Me(),{isOnline:$}=Se(),_=async()=>{if(!N.trim()){d.error("Error","Ingresa el nombre del sector");return}await L(N.trim()),z("counting")},xe=async s=>{await K(s),p(!1)},ue=s=>{g(s.ean),x({name:s.productName,ean:s.ean}),h(s.batches),u(!0)},K=async(s,a)=>{g(s);let n=a;if(!n){const R=await Ce(s);n=R?R.name:`Producto ${s}`}x({name:n,ean:s});const j=m.find(R=>R.ean===s);j?(h([...j.batches]),d.info("Información","Producto ya contado. Editando lotes existentes.")):h([]),u(!0)},he=()=>{E(!0)},pe=async()=>{if(!D.trim()){d.error("Error","Por favor ingresa el nombre del responsable");return}const s={id:crypto.randomUUID(),sector:(l==null?void 0:l.sector)||N,date:new Date().toISOString(),responsible:D,items:m,stats:{totalProducts:F,totalUnits:A}},a=JSON.parse(localStorage.getItem("expiration-reports")||"[]");localStorage.setItem("expiration-reports",JSON.stringify([s,...a])),await r(),d.success("Operación exitosa","Control guardado exitosamente"),S("/reports")},X=s=>{if(!s)return"";if(s.match(/^\d{4}-\d{2}$/)){const[a,n]=s.split("-");return`${n}/${a.slice(2)}`}return s},ge=()=>{if(m.length===0){d.error("Error","No hay datos");return}const s=new ze;let a=20;s.setFontSize(16),s.text(`Control de Vencimientos: ${l==null?void 0:l.sector}`,10,a),s.setFontSize(10),s.text(`Fecha: ${new Date().toLocaleDateString()}`,10,a+6),a+=15,m.forEach(n=>{a>270&&(s.addPage(),a=20),s.setFont("helvetica","bold"),s.text(`${n.productName} (EAN: ${n.ean})`,10,a),s.text(`Total: ${n.totalQuantity}`,180,a,{align:"right"}),a+=6,s.setFont("helvetica","normal"),s.setFontSize(9),s.text("Lote",15,a),s.text("Vencimiento",80,a),s.text("Cantidad",150,a),a+=5,n.batches.forEach(j=>{s.text(j.batchNumber,15,a),s.text(X(j.expirationDate),80,a),s.text(j.quantity.toString(),150,a),a+=5}),a+=5}),s.save(`Vencimientos_${l==null?void 0:l.sector}.pdf`),d.success("Operación exitosa","PDF Generado")};return e.jsxs("div",{className:"space-y-6 max-w-5xl mx-auto pb-20",children:[e.jsx(H,{mode:"wait",children:b==="config"?e.jsxs("div",{className:"p-4 md:p-6 max-w-7xl mx-auto space-y-8 animate-in fade-in duration-500",children:[e.jsx("div",{className:"flex justify-end",children:$?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-success/10 text-success rounded-full text-sm",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"En línea"})]}):e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-warning/10 text-warning rounded-full text-sm",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Sin conexión"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 items-start",children:[e.jsxs(M,{className:"border-muted/50 shadow-lg overflow-hidden relative group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-primary/20 group-hover:bg-primary transition-colors"}),e.jsxs(Z,{className:"p-6 md:p-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 text-primary",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-xl",children:e.jsx(de,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Nueva Sesión"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Genera un reporte de control de fechas de vencimiento para un sector o estantería."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground ml-1",children:"Nombre del Sector"}),e.jsx(C,{value:N,onChange:s=>I(s.target.value),placeholder:"Ej: Estantería A1",className:"h-12 text-lg bg-muted/30 border-muted-foreground/20 focus:border-primary transition-all",autoFocus:!0,onKeyDown:s=>s.key==="Enter"&&_()})]}),e.jsx(o,{className:"w-full h-12 text-lg font-medium shadow-md hover:shadow-lg transition-all",onClick:_,disabled:!N.trim()||O,children:O?"Iniciando...":"Comenzar Control"})]})]})]}),e.jsxs(M,{className:"border-muted/50 shadow-lg h-full",children:[e.jsx(ve,{className:"pb-4 border-b border-border/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-secondary rounded-lg text-secondary-foreground",children:e.jsx(Oe,{className:"w-5 h-5"})}),e.jsx(be,{className:"text-lg",children:"Sesiones Abiertas"})]})}),e.jsx(Z,{className:"p-0",children:f.length===0?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:e.jsx("p",{children:"No hay sesiones activas"})}):e.jsx("div",{className:"divide-y divide-border/50 max-h-[400px] overflow-y-auto",children:f.map(s=>e.jsxs("div",{className:"p-4 hover:bg-muted/30 transition-colors flex items-center justify-between group",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-medium text-lg leading-none group-hover:text-primary transition-colors",children:s.sector}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ce,{className:"w-3 h-3"}),e.jsx("span",{children:$e(new Date(s.startTime),"d MMM yyyy, HH:mm",{locale:Be})})]}),e.jsxs("div",{className:"flex gap-3 text-xs text-muted-foreground mt-1",children:[e.jsxs("span",{className:"bg-primary/5 px-2 py-0.5 rounded text-primary font-medium",children:[s.totalProducts||0," prod."]}),e.jsxs("span",{className:"bg-secondary px-2 py-0.5 rounded text-secondary-foreground font-medium",children:[s.totalUnits||0," unid."]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-destructive hover:bg-destructive/10",onClick:()=>me(s.id),title:"Eliminar sesión",children:e.jsx(q,{className:"w-4 h-4"})}),e.jsxs(o,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",onClick:()=>{G(s),z("counting")},children:["Retomar",e.jsx(Le,{className:"w-4 h-4"})]})]})]},s.id))})})]})]})]}):e.jsx(e.Fragment,{children:e.jsxs(P.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"p-4 md:p-6 space-y-4 max-w-7xl mx-auto",children:[e.jsx(M,{className:"min-h-[120px] flex flex-col justify-center px-6 sm:px-8 bg-gradient-to-br from-secondary/40 to-secondary/20 border-muted/50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 min-w-0",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Sector"}),e.jsx("span",{className:"font-bold text-foreground text-lg sm:text-xl truncate",children:l==null?void 0:l.sector})]}),e.jsx("div",{className:"h-10 sm:h-12 w-px bg-border/40 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-8 sm:gap-12 flex-1 justify-center",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Productos"}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-primary",children:e.jsx(ee,{value:F,digits:4})})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Unidades"}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:e.jsx(ee,{value:A,digits:4})})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsx("div",{className:`p-2 rounded-full ${$?"bg-success/10 text-success":"bg-warning/10 text-warning"}`,title:$?"En línea":"Sin conexión",children:$?e.jsx(se,{className:"w-4 h-4"}):e.jsx(Y,{className:"w-4 h-4"})})})]})}),e.jsx(M,{className:"p-2 sm:p-3 shadow-md border-primary/20 bg-card/80 backdrop-blur-sm relative z-50",children:e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex gap-4",children:e.jsx("div",{className:"flex-1 relative z-20",children:e.jsx(ke,{onSelect:s=>K(s.ean,s.name),autoFocus:!0,className:"w-full"})})})})}),e.jsxs("div",{className:"space-y-2 relative z-10",children:[e.jsx("div",{className:"flex items-center justify-between px-1",children:e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wider",children:["Registros (",m.length,")"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:e.jsx(H,{mode:"popLayout",children:m.length===0?e.jsxs("div",{className:"col-span-full p-8 text-center text-muted-foreground border rounded-lg border-dashed bg-muted/20",children:[e.jsx(T,{className:"w-12 h-12 mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"No hay productos registrados aún"})]}):m.map((s,a)=>e.jsx(P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},layout:!0,children:e.jsxs(M,{className:"h-full relative overflow-hidden group border-muted/60 shadow-sm hover:shadow-md transition-all",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-primary/20 group-hover:bg-primary transition-colors"}),e.jsxs("div",{className:"p-3 pl-4 flex flex-col h-full gap-2",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsx("h4",{className:"font-medium text-sm leading-tight line-clamp-2 text-foreground/90",title:s.productName,children:s.productName}),e.jsxs("div",{className:"text-xs font-bold bg-secondary/50 px-1.5 py-0.5 rounded text-foreground/70 text-right flex-shrink-0",children:["#",m.length-a]})]}),e.jsx("div",{children:e.jsx(J,{variant:"outline",className:"text-[10px] h-5 font-mono text-muted-foreground border-border/50 px-1.5 font-normal",children:s.ean})}),e.jsxs("div",{className:"flex flex-wrap gap-1.5 mt-2 content-start min-h-[1.5rem]",children:[s.batches.slice(0,3).map((n,j)=>e.jsxs("div",{className:"inline-flex items-center gap-2 text-xs bg-secondary/50 rounded px-2 py-1 border border-secondary-foreground/10",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(J,{variant:"outline",className:"text-[10px] h-4 px-1 font-normal text-muted-foreground border-border/50",children:X(n.expirationDate)}),e.jsxs("span",{className:"font-bold tabular-nums text-[10px]",children:["x",n.quantity]})]}),n.reminderMonths&&e.jsxs("div",{className:"flex items-center gap-0.5 text-[9px] text-muted-foreground border-l pl-1.5 border-border/50",title:`${n.reminderMonths} meses de alerta`,children:[e.jsx(Q,{className:"w-2.5 h-2.5"}),e.jsxs("span",{className:"sr-only sm:not-sr-only",children:[n.reminderMonths,"m"]})]})]},j)),s.batches.length>3&&e.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] bg-muted text-muted-foreground",children:["+",s.batches.length-3]})]}),e.jsxs("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(o,{variant:"secondary",size:"icon",className:"h-6 w-6 shadow-sm mr-1",onClick:n=>{n.stopPropagation(),ue(s)},children:e.jsx(oe,{className:"w-3 h-3"})}),e.jsx(o,{variant:"destructive",size:"icon",className:"h-6 w-6 shadow-sm",onClick:n=>{n.stopPropagation(),t(s.id)},children:e.jsx(q,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 mt-auto border-t border-border/30",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-xl font-bold tracking-tight text-foreground",children:s.totalQuantity}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium uppercase tracking-wider",children:"total"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(o,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive hover:bg-destructive/5",onClick:()=>t(s.id),title:"Eliminar",children:e.jsx(q,{className:"w-4 h-4"})})})]})]})]})},s.id))})})]}),e.jsx(Pe,{actions:[{label:"Finalizar",icon:e.jsx(ye,{className:"w-5 h-5"}),onClick:he,variant:"default",color:"bg-primary text-primary-foreground"},{label:"Exportar PDF",icon:e.jsx(we,{className:"w-5 h-5"}),onClick:ge,variant:"secondary"}]})]},"counting")})}),e.jsx(Re,{open:y,onOpenChange:s=>{u(s),s||(g(""),x(null),h([]))},productName:(c==null?void 0:c.name)||"",ean:(c==null?void 0:c.ean)||"",initialBatches:w,onSave:async s=>{c&&(await V(c.ean,c.name,s),u(!1),x(null),g(""),h([]),setTimeout(()=>{var a;(a=document.getElementById("smart-search-input"))==null||a.focus()},50))}}),e.jsx(te,{open:k,onOpenChange:E,children:e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(ne,{children:"Finalizar Control de Vencimientos"}),e.jsx(ie,{children:"Por favor confirma los datos para guardar el reporte."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(W,{className:"text-xs text-muted-foreground",children:"Fecha"}),e.jsx("div",{className:"font-medium",children:new Date().toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx(W,{className:"text-xs text-muted-foreground",children:"Hora"}),e.jsx("div",{className:"font-medium",children:new Date().toLocaleTimeString()})]})]}),e.jsxs("div",{children:[e.jsx(W,{htmlFor:"responsible",className:"mb-2 block",children:"Responsable del Control *"}),e.jsx(C,{id:"responsible",value:D,onChange:s=>v(s.target.value),placeholder:"Nombre y Apellido",autoFocus:!0})]}),e.jsxs("div",{className:"bg-primary/5 p-4 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Unidades Contadas"}),e.jsx("span",{className:"text-2xl font-bold text-primary",children:A})]})]}),e.jsxs(le,{children:[e.jsx(o,{variant:"outline",onClick:()=>E(!1),children:"Cancelar"}),e.jsx(o,{onClick:pe,children:"Guardar y Finalizar"})]})]})}),e.jsx(Ee,{open:U,onOpenChange:p,onScan:xe})]})}export{ds as default};
