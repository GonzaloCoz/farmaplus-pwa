import{c as Z,d as ne,R as U,w as ae,j as e,x as ie,r as o,y as he,z as Je,P as H,A as M,E as ge,F as Ye,b as le,D as ve,q as be,u as je,v as Ne,B as $,G as N,U as Ze,H as de,I as We}from"./index-BTPGtgx_.js";import{C as P}from"./card-BCEO6u_v.js";import{I as Y}from"./input-qq7wq8l8.js";import{r as Xe,u as k,w as ue}from"./xlsx-uoQkVabA.js";import{L as ee}from"./label-CqVpPqob.js";import{S as et}from"./search-D1AsLgmG.js";import{T as me,C as fe,a as xe}from"./trending-up-DY-IfflI.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=Z("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=Z("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=Z("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=Z("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=Z("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);function ot(t){const r=t+"CollectionProvider",[c,n]=ne(r),[s,x]=c(r,{collectionRef:{current:null},itemMap:new Map}),u=b=>{const{scope:i,children:j}=b,w=U.useRef(null),l=U.useRef(new Map).current;return e.jsx(s,{scope:i,itemMap:l,collectionRef:w,children:j})};u.displayName=r;const g=t+"CollectionSlot",v=ie(g),y=U.forwardRef((b,i)=>{const{scope:j,children:w}=b,l=x(g,j),S=ae(i,l.collectionRef);return e.jsx(v,{ref:S,children:w})});y.displayName=g;const d=t+"CollectionItemSlot",p="data-radix-collection-item",I=ie(d),T=U.forwardRef((b,i)=>{const{scope:j,children:w,...l}=b,S=U.useRef(null),B=ae(i,S),z=x(d,j);return U.useEffect(()=>(z.itemMap.set(S,{ref:S,...l}),()=>void z.itemMap.delete(S))),e.jsx(I,{[p]:"",ref:B,children:w})});T.displayName=d;function D(b){const i=x(t+"CollectionConsumer",b);return U.useCallback(()=>{const w=i.collectionRef.current;if(!w)return[];const l=Array.from(w.querySelectorAll(`[${p}]`));return Array.from(i.itemMap.values()).sort((z,Q)=>l.indexOf(z.ref.current)-l.indexOf(Q.ref.current))},[i.collectionRef,i.itemMap])}return[{Provider:u,Slot:y,ItemSlot:T},D,n]}var nt=o.createContext(void 0);function ye(t){const r=o.useContext(nt);return t||r||"ltr"}var se="rovingFocusGroup.onEntryFocus",lt={bubbles:!1,cancelable:!0},W="RovingFocusGroup",[re,Ie,ct]=ot(W),[it,Se]=ne(W,[ct]),[dt,ut]=it(W),Ce=o.forwardRef((t,r)=>e.jsx(re.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(re.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(mt,{...t,ref:r})})}));Ce.displayName=W;var mt=o.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:c,orientation:n,loop:s=!1,dir:x,currentTabStopId:u,defaultCurrentTabStopId:g,onCurrentTabStopIdChange:v,onEntryFocus:y,preventScrollOnEntryFocus:d=!1,...p}=t,I=o.useRef(null),T=ae(r,I),D=ye(x),[b,i]=he({prop:u,defaultProp:g??null,onChange:v,caller:W}),[j,w]=o.useState(!1),l=Je(y),S=Ie(c),B=o.useRef(!1),[z,Q]=o.useState(0);return o.useEffect(()=>{const F=I.current;if(F)return F.addEventListener(se,l),()=>F.removeEventListener(se,l)},[l]),e.jsx(dt,{scope:c,orientation:n,dir:D,loop:s,currentTabStopId:b,onItemFocus:o.useCallback(F=>i(F),[i]),onItemShiftTab:o.useCallback(()=>w(!0),[]),onFocusableItemAdd:o.useCallback(()=>Q(F=>F+1),[]),onFocusableItemRemove:o.useCallback(()=>Q(F=>F-1),[]),children:e.jsx(H.div,{tabIndex:j||z===0?-1:0,"data-orientation":n,...p,ref:T,style:{outline:"none",...t.style},onMouseDown:M(t.onMouseDown,()=>{B.current=!0}),onFocus:M(t.onFocus,F=>{const X=!B.current;if(F.target===F.currentTarget&&X&&!j){const K=new CustomEvent(se,lt);if(F.currentTarget.dispatchEvent(K),!K.defaultPrevented){const J=S().filter(C=>C.focusable),a=J.find(C=>C.active),m=J.find(C=>C.id===b),G=[a,m,...J].filter(Boolean).map(C=>C.ref.current);Te(G,d)}}B.current=!1}),onBlur:M(t.onBlur,()=>w(!1))})})}),we="RovingFocusGroupItem",Re=o.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:c,focusable:n=!0,active:s=!1,tabStopId:x,children:u,...g}=t,v=ge(),y=x||v,d=ut(we,c),p=d.currentTabStopId===y,I=Ie(c),{onFocusableItemAdd:T,onFocusableItemRemove:D,currentTabStopId:b}=d;return o.useEffect(()=>{if(n)return T(),()=>D()},[n,T,D]),e.jsx(re.ItemSlot,{scope:c,id:y,focusable:n,active:s,children:e.jsx(H.span,{tabIndex:p?0:-1,"data-orientation":d.orientation,...g,ref:r,onMouseDown:M(t.onMouseDown,i=>{n?d.onItemFocus(y):i.preventDefault()}),onFocus:M(t.onFocus,()=>d.onItemFocus(y)),onKeyDown:M(t.onKeyDown,i=>{if(i.key==="Tab"&&i.shiftKey){d.onItemShiftTab();return}if(i.target!==i.currentTarget)return;const j=pt(i,d.orientation,d.dir);if(j!==void 0){if(i.metaKey||i.ctrlKey||i.altKey||i.shiftKey)return;i.preventDefault();let l=I().filter(S=>S.focusable).map(S=>S.ref.current);if(j==="last")l.reverse();else if(j==="prev"||j==="next"){j==="prev"&&l.reverse();const S=l.indexOf(i.currentTarget);l=d.loop?ht(l,S+1):l.slice(S+1)}setTimeout(()=>Te(l))}}),children:typeof u=="function"?u({isCurrentTabStop:p,hasTabStop:b!=null}):u})})});Re.displayName=we;var ft={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function xt(t,r){return r!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function pt(t,r,c){const n=xt(t.key,c);if(!(r==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(r==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return ft[n]}function Te(t,r=!1){const c=document.activeElement;for(const n of t)if(n===c||(n.focus({preventScroll:r}),document.activeElement!==c))return}function ht(t,r){return t.map((c,n)=>t[(r+n)%t.length])}var gt=Ce,vt=Re,te="Tabs",[bt,Dt]=ne(te,[Se]),Fe=Se(),[jt,ce]=bt(te),Ee=o.forwardRef((t,r)=>{const{__scopeTabs:c,value:n,onValueChange:s,defaultValue:x,orientation:u="horizontal",dir:g,activationMode:v="automatic",...y}=t,d=ye(g),[p,I]=he({prop:n,onChange:s,defaultProp:x??"",caller:te});return e.jsx(jt,{scope:c,baseId:ge(),value:p,onValueChange:I,orientation:u,dir:d,activationMode:v,children:e.jsx(H.div,{dir:d,"data-orientation":u,...y,ref:r})})});Ee.displayName=te;var Ve="TabsList",ke=o.forwardRef((t,r)=>{const{__scopeTabs:c,loop:n=!0,...s}=t,x=ce(Ve,c),u=Fe(c);return e.jsx(gt,{asChild:!0,...u,orientation:x.orientation,dir:x.dir,loop:n,children:e.jsx(H.div,{role:"tablist","aria-orientation":x.orientation,...s,ref:r})})});ke.displayName=Ve;var De="TabsTrigger",_e=o.forwardRef((t,r)=>{const{__scopeTabs:c,value:n,disabled:s=!1,...x}=t,u=ce(De,c),g=Fe(c),v=Me(u.baseId,n),y=Be(u.baseId,n),d=n===u.value;return e.jsx(vt,{asChild:!0,...g,focusable:!s,active:d,children:e.jsx(H.button,{type:"button",role:"tab","aria-selected":d,"aria-controls":y,"data-state":d?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:v,...x,ref:r,onMouseDown:M(t.onMouseDown,p=>{!s&&p.button===0&&p.ctrlKey===!1?u.onValueChange(n):p.preventDefault()}),onKeyDown:M(t.onKeyDown,p=>{[" ","Enter"].includes(p.key)&&u.onValueChange(n)}),onFocus:M(t.onFocus,()=>{const p=u.activationMode!=="manual";!d&&!s&&p&&u.onValueChange(n)})})})});_e.displayName=De;var Ae="TabsContent",Pe=o.forwardRef((t,r)=>{const{__scopeTabs:c,value:n,forceMount:s,children:x,...u}=t,g=ce(Ae,c),v=Me(g.baseId,n),y=Be(g.baseId,n),d=n===g.value,p=o.useRef(d);return o.useEffect(()=>{const I=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(I)},[]),e.jsx(Ye,{present:s||d,children:({present:I})=>e.jsx(H.div,{"data-state":d?"active":"inactive","data-orientation":g.orientation,role:"tabpanel","aria-labelledby":v,hidden:!I,id:y,tabIndex:0,...u,ref:r,style:{...t.style,animationDuration:p.current?"0s":void 0},children:I&&x})})});Pe.displayName=Ae;function Me(t,r){return`${t}-trigger-${r}`}function Be(t,r){return`${t}-content-${r}`}var Nt=Ee,ze=ke,Le=_e,Oe=Pe;const yt=Nt,$e=o.forwardRef(({className:t,...r},c)=>e.jsx(ze,{ref:c,className:le("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...r}));$e.displayName=ze.displayName;const oe=o.forwardRef(({className:t,...r},c)=>e.jsx(Le,{ref:c,className:le("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",t),...r}));oe.displayName=Le.displayName;const It=o.forwardRef(({className:t,...r},c)=>e.jsx(Oe,{ref:c,className:le("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...r}));It.displayName=Oe.displayName;const St=["Belgrano VI","Barracas","Recoleta","Belgrano","Belgrano II","Belgrano III","Belgrano IV","Belgrano V","Belgrano VII","Belgrano VIII","Berazategui","Berazategui II","Caballito","Caballito II","Caballito III","Caballito IV","Chacarita","Devoto","Devoto II","Flores","Gonzalez Catan","Gonzalez Catan II","Gonzalez Catan III","Las Cañitas","Mercedes","Microcentro","Microcentro II","Morón","Nuñez","Padua","Palermo","Palermo II","Palermo III","Parque Centenario","Parque Patricios","Pilar","Pompeya","Quilmes","Ramos Mejia","Ramos Mejia II","Ramos Mejia III","Recoleta II","Recoleta III","Recoleta IV","Recoleta V","Retiro","Retiro II","Saladillo","San Isidro","San Isidro II","San Miguel","Tribunales","Villa Ballester","Villa Ballester II","Villa Crespo","Villa del Parque","Villa del Parque II","Villa Luro","Villa Urquiza","Villa Urquiza II","Villa Urquiza III"];function Ct({open:t,onOpenChange:r,onSave:c}){const[n,s]=o.useState(""),[x,u]=o.useState(""),[g,v]=o.useState(""),[y,d]=o.useState(!1),[p,I]=o.useState(""),[T,D]=o.useState(new Date().toISOString().split("T")[0]),[b,i]=o.useState(!1),j=o.useMemo(()=>St.filter(l=>l.toLowerCase().includes(g.toLowerCase())),[g]),w=()=>{if(!n.trim()){N.error("Por favor, ingresa un nombre para el reporte");return}if(!x){N.error("Por favor, selecciona una sucursal");return}if(!p.trim()){N.error("Por favor, ingresa el sector");return}if(!T){N.error("Por favor, selecciona una fecha");return}i(!0);try{c({name:n,branch:x,sector:p,date:T}),N.success("Reporte guardado correctamente"),s(""),u(""),v(""),I(""),D(new Date().toISOString().split("T")[0]),r(!1)}catch{N.error("Error al guardar el reporte")}finally{i(!1)}};return e.jsx(ve,{open:t,onOpenChange:r,children:e.jsxs(be,{className:"w-[480px] p-0",children:[e.jsx(je,{className:"p-4 border-b",children:e.jsx(Ne,{children:"Guardar Reporte"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"report-name",className:"text-sm font-medium",children:"Nombre del Reporte *"}),e.jsx(Y,{id:"report-name",placeholder:"Ej: Auditoria - Nov 2025",value:n,onChange:l=>s(l.target.value),className:"mt-2"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{htmlFor:"report-branch",className:"text-sm font-medium",children:"Sucursal *"}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx(et,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{id:"report-branch",placeholder:"Buscar sucursal...",value:g,onChange:l=>{v(l.target.value),d(!0)},onFocus:()=>d(!0),className:"pl-8"})]}),y&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-background border border-border rounded-md shadow-lg z-50 max-h-48 overflow-auto",children:j.length>0?j.map(l=>e.jsxs("button",{className:"w-full text-left px-3 py-2 hover:bg-accent flex items-center justify-between",onClick:()=>{u(l),v(""),d(!1)},children:[l,x===l&&e.jsx(tt,{className:"h-4 w-4 text-primary"})]},l)):e.jsx("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:"No se encontraron sucursales"})}),x&&e.jsxs("div",{className:"mt-2 px-3 py-2 bg-accent rounded-md text-sm",children:["Seleccionada: ",e.jsx("span",{className:"font-medium",children:x})]})]}),e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"report-sector",className:"text-sm font-medium",children:"Sector *"}),e.jsx(Y,{id:"report-sector",placeholder:"Ej: Farmacia, Perfumería, General",value:p,onChange:l=>I(l.target.value),className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"report-date",className:"text-sm font-medium",children:"Fecha del Inventario *"}),e.jsx(Y,{id:"report-date",type:"date",value:T,onChange:l=>D(l.target.value),className:"mt-2"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx($,{variant:"outline",onClick:()=>r(!1),disabled:b,className:"flex-1",children:"Cancelar"}),e.jsx($,{onClick:w,disabled:b,className:"flex-1",children:b?"Guardando...":"Guardar Reporte"})]})]})]})})}function _t(){const[t,r]=o.useState(null),[c,n]=o.useState(!1),[s,x]=o.useState(null),[u,g]=o.useState({headers:[],rows:[]}),[v,y]=o.useState("value"),[d,p]=o.useState(!1),[I,T]=o.useState(!1),[D,b]=o.useState(!1),[i,j]=o.useState("Inventario"),w=a=>{var E;const m=(E=a.target.files)==null?void 0:E[0];m&&(m.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||m.type==="application/vnd.ms-excel"?(r(m),x(null),g({headers:[],rows:[]}),N.success("Archivo cargado correctamente")):N.error("Por favor, selecciona un archivo Excel válido"))},l=async()=>{if(!t){N.error("Por favor, selecciona un archivo primero");return}n(!0),N.info("Analizando archivo...",{id:"analysis-toast"});try{const a=await t.arrayBuffer(),m=Xe(a),E=m.SheetNames[0],G=m.Sheets[E],C=k.sheet_to_json(G,{header:1}),L=C[0],V=C.slice(1),h=C.slice(1).map(f=>({codebar:f[6],name:f[10],physicalCount:Number(f[13])||0,systemStock:Number(f[15])||0,diffQty:Number(f[17])||0,cost:Number(f[19])||0,salePrice:Number(f[21])||0,diffValue:Number(f[22])||0})).filter(f=>f.codebar&&f.name);g({headers:L,rows:V});const R=h.filter(f=>f.diffQty<0),q=h.filter(f=>f.diffQty>0),O=h.filter(f=>f.diffQty===0).length,_=h.length>0?O/h.length*100:100,Ge=R.reduce((f,A)=>f+A.diffValue,0),Ue=q.reduce((f,A)=>f+A.diffValue,0),Qe=R.reduce((f,A)=>f+A.diffQty,0),qe=q.reduce((f,A)=>f+A.diffQty,0),He=[...R].sort((f,A)=>f.diffValue-A.diffValue).slice(0,10),Ke=[...q].sort((f,A)=>A.diffValue-f.diffValue).slice(0,10);x({totalProducts:h.length,allShortages:R,allSurpluses:q,topShortagesByValue:He,topSurplusesByValue:Ke,totalShortageValue:Math.abs(Ge),totalSurplusValue:Ue,totalShortageUnits:Math.abs(Qe),totalSurplusUnits:qe,inventoryAccuracy:_,totalProductsNoDifference:O}),N.success("Análisis completado",{id:"analysis-toast"})}catch(a){console.error("Error analyzing file:",a),N.error("Hubo un error al analizar el archivo.",{id:"analysis-toast"})}finally{n(!1)}},S=()=>{if(!s){N.error("No hay resultados para exportar.");return}N.info("Generando resumen en Excel...");const a=V=>V.map(h=>({"Código de Barras":h.codebar,Producto:h.name,"Diferencia (Unidades)":h.diffQty,"Valor Diferencia ($)":h.diffValue,"Stock Sistema":h.systemStock,"Conteo Físico":h.physicalCount,"Costo Unitario ($)":h.cost,"Precio Venta ($)":h.salePrice})),m=[...s.allShortages].sort((V,h)=>V.diffQty-h.diffQty).slice(0,15),E=[...s.allShortages].sort((V,h)=>V.diffValue-h.diffValue).slice(0,15),G=[...s.allSurpluses].sort((V,h)=>h.diffQty-V.diffQty).slice(0,15),C=[...s.allSurpluses].sort((V,h)=>h.diffValue-V.diffValue).slice(0,15),L=k.book_new();k.book_append_sheet(L,k.json_to_sheet(a(m)),"Faltantes por Cantidad"),k.book_append_sheet(L,k.json_to_sheet(a(E)),"Faltantes por Valor"),k.book_append_sheet(L,k.json_to_sheet(a(G)),"Sobrantes por Cantidad"),k.book_append_sheet(L,k.json_to_sheet(a(C)),"Sobrantes por Valor"),ue(L,"Resumen_Diferencias.xlsx"),N.success("Resumen Excel generado correctamente.")},B=()=>{if(!s||u.rows.length===0){N.error("No hay resultados para exportar.");return}b(!0)},z=()=>{if(!s||u.rows.length===0){N.error("No hay resultados para exportar.");return}N.info("Generando archivo Excel...");const a=[...u.headers];a[24]="ID DE AJUSTE",a[25]="CANTIDAD DE AJUSTE";const m=u.rows.map((R,q)=>{const O=q+2,_=[...R];return _[13]=Number(R[13])||0,_[15]=Number(R[15])||0,_[19]=Number(R[19])||0,_[21]=Number(R[21])||0,_[17]={f:`(N${O}+Z${O})-P${O}`},_[22]={f:`R${O}*T${O}`},_[24]="",_[25]=0,_}),E=k.aoa_to_sheet([a,...m]),G=a.length,C=[];for(let R=0;R<G;R++)C.push({hidden:!0});[6,10,13,15,17,19,21,22,24,25].forEach(R=>{C[R]&&(C[R]={hidden:!1,wch:20})}),E["!cols"]=C;const V=k.book_new();k.book_append_sheet(V,E,"Hoja de Ajuste");const h=`${i}.xlsx`;ue(V,h),N.success("Archivo Excel generado correctamente."),p(!0),b(!1),j("Inventario")},Q=o.useMemo(()=>s?v==="quantity"?[...s.allShortages].sort((a,m)=>a.diffQty-m.diffQty).slice(0,10):[...s.allShortages].sort((a,m)=>a.diffValue-m.diffValue).slice(0,10):[],[s,v]),F=o.useMemo(()=>s?v==="quantity"?[...s.allSurpluses].sort((a,m)=>m.diffQty-a.diffQty).slice(0,10):[...s.allSurpluses].sort((a,m)=>m.diffValue-a.diffValue).slice(0,10):[],[s,v]),X=a=>v==="quantity"?`${a.diffQty} uds.`:`$${a.diffValue.toLocaleString()}`,K=a=>{if(v==="quantity")return`Valor: $${a.diffValue.toLocaleString()}`;const m=Math.abs(a.diffQty)===1?"unidad":"unidades";return`Diferencia: ${a.diffQty>0?"+":""}${a.diffQty} ${m}`},J=a=>{if(!s){N.error("No hay resultados para guardar");return}const m={id:Date.now().toString(),name:a.name,branch:a.branch,sector:a.sector,date:a.date,timestamp:new Date().toISOString(),results:s},E=JSON.parse(localStorage.getItem("inventory-reports")||"[]");E.push(m),localStorage.setItem("inventory-reports",JSON.stringify(E)),T(!1)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Importar Inventario"}),e.jsx("p",{className:"text-muted-foreground",children:"Carga el archivo Excel de tu conteo físico para analizar discrepancias"})]}),e.jsx(P,{className:"p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{htmlFor:"dropzone-file",className:"flex flex-col items-center justify-center w-full h-64 border-2 border-border border-dashed rounded-2xl cursor-pointer bg-muted/30 hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(Ze,{className:"w-12 h-12 mb-4 text-muted-foreground"}),e.jsx("p",{className:"mb-2 text-sm text-foreground font-medium",children:t?t.name:"Haz clic para cargar o arrastra el archivo"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Archivos Excel (.xlsx, .xls)"})]}),e.jsx("input",{id:"dropzone-file",type:"file",className:"hidden",accept:".xlsx,.xls",onChange:w})]})}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-muted/50 rounded-lg",children:[e.jsx(pe,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Formato requerido"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"El archivo debe contener las columnas: Código, Producto, Stock Sistema, Stock Físico, Diferencia"})]})]}),e.jsx($,{onClick:l,disabled:!t||c,className:"w-full",size:"lg",children:c?"Analizando...":"Analizar Inventario"})]})}),s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(P,{className:"p-6 border-destructive/20",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-destructive/10 rounded-lg",children:e.jsx(me,{className:"w-5 h-5 text-destructive"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Valor Faltantes"}),e.jsxs("p",{className:"text-2xl font-bold text-destructive",children:["$",s.totalShortageValue.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.totalShortageUnits," unidades"]})]})]})}),e.jsx(P,{className:"p-6 border-warning/20",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-warning/10 rounded-lg",children:e.jsx(fe,{className:"w-5 h-5 text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Discrepancia"}),e.jsxs("p",{className:"text-2xl font-bold text-warning",children:["$",(s.totalShortageValue+s.totalSurplusValue).toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.totalShortageUnits+s.totalSurplusUnits," unidades en total"]})]})]})}),e.jsx(P,{className:"p-6 border-success/20",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-success/10 rounded-lg",children:e.jsx(xe,{className:"w-5 h-5 text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Valor Sobrantes"}),e.jsxs("p",{className:"text-2xl font-bold text-success",children:["$",s.totalSurplusValue.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",s.totalSurplusUnits," unidades"]})]})]})}),e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-muted rounded-lg",children:e.jsx(pe,{className:"w-5 h-5 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Productos"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:s.totalProducts})]})]})}),e.jsx(P,{className:"p-6 border-primary/20",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(st,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Productos sin Diferencia"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:s.totalProductsNoDifference})]})]})}),e.jsx(P,{className:"p-6 border-primary/20",children:e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(rt,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Precisión del Inventario"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[s.inventoryAccuracy.toFixed(2),"%"]})]})]})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(yt,{value:v,onValueChange:a=>y(a),className:"w-fit",children:e.jsxs($e,{children:[e.jsx(oe,{value:"value",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground hover:bg-primary hover:text-primary-foreground",children:"Ver por Valor ($)"}),e.jsx(oe,{value:"quantity",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground hover:bg-primary hover:text-primary-foreground",children:"Ver por Cantidad (Uds.)"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs($,{onClick:S,variant:"outline",className:"hover:bg-primary hover:text-primary-foreground",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Exportar Resumen"]}),e.jsxs($,{onClick:B,children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Exportar Inventario"]}),e.jsxs($,{onClick:()=>T(!0),disabled:!d,variant:"default",children:[e.jsx(at,{className:"mr-2 h-4 w-4"}),"Guardar Reporte"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(me,{className:"w-5 h-5 text-destructive"}),e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Productos con Más Faltantes"})]}),e.jsx("div",{className:"space-y-4",children:Q.map((a,m)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-destructive/5 rounded-lg border border-destructive/20",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-foreground",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:K(a)})]}),e.jsx("p",{className:"text-lg font-bold text-destructive",children:X(a)})]},m))})]}),e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(xe,{className:"w-5 h-5 text-success"}),e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Productos con Más Sobrantes"})]}),e.jsx("div",{className:"space-y-4",children:F.map((a,m)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-success/5 rounded-lg border border-success/20",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-foreground",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:K(a)})]}),e.jsx("p",{className:"text-lg font-bold text-success",children:X(a)})]},m))})]})]}),e.jsx(P,{className:"p-6 bg-muted/30",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-warning mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-foreground mb-2",children:"Recomendaciones"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsx("li",{children:"• Revisar los productos con mayor diferencia para verificar posibles errores de conteo"}),e.jsx("li",{children:"• Investigar las causas de los faltantes más significativos"}),e.jsx("li",{children:"• Ajustar el stock en el sistema según los resultados del inventario físico"}),e.jsx("li",{children:"• Programar inventarios cíclicos más frecuentes para productos con alta variación"})]})]})]})})]}),e.jsx(Ct,{open:I,onOpenChange:T,onSave:J}),e.jsx(ve,{open:D,onOpenChange:b,children:e.jsxs(be,{className:"w-[420px]",children:[e.jsxs(je,{children:[e.jsx(Ne,{children:"Exportar Inventario"}),e.jsx(We,{children:"Ingresa el nombre del archivo que deseas descargar. Se guardará como un archivo Excel (.xlsx)."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fileName",className:"block text-sm font-medium text-foreground mb-2",children:"Nombre del archivo"}),e.jsx(Y,{id:"fileName",type:"text",placeholder:"Inventario",value:i,onChange:a=>j(a.target.value),className:"w-full"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"La extensión .xlsx se agregará automáticamente"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx($,{variant:"outline",onClick:()=>b(!1),children:"Cancelar"}),e.jsx($,{onClick:z,disabled:!i.trim(),children:"Descargar"})]})]})]})})]})}export{_t as default};
