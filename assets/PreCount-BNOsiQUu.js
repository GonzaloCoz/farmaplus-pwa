import{j as e,h as de,i as me,k as ue,l as xe,A as fe,m as he,n as Ye,o as Qe}from"./ui-vendor-BshHF3Zg.js";import{r as s,u as Ve}from"./react-vendor-DdjUaGoS.js";import{c as pe,u as d,D as ge,h as ye,i as je,j as Ne,o as Ge,g as Ke,B as E,X as Je,s as Xe,p as w,P as U,q as ve,C as R,r as _e,t as Ze,v as es,w as ae,x as ss,y as re,z as ts,A as as,E as rs,F as ne,G as ns,H as oe,I as os,W as is,J as cs,K as ie,L as ls}from"./index-ByIwQOx7.js";import{I as B}from"./input-BB9T6pAr.js";import{H as ds}from"./scanner-ThRrwOEs.js";import{u as ms,S as us,P as xs}from"./SwipeableItem-RZLZAwuB.js";import{A as H,m as D}from"./animation-jqafwDaF.js";import{C as G}from"./circle-check-BotvtibV.js";import{S as fs}from"./search-DYWPmiNU.js";import{C as ce}from"./CounterAnimation-CLqfpDjG.js";import{E as hs}from"./jspdf.es.min-BKAAPVxu.js";import{J as le}from"./JsBarcode-B9pOLHC9.js";import{A as ps}from"./arrow-left-Cb1re84Y.js";import{W as gs}from"./wifi-DK7w3Reo.js";import{P as ys}from"./plus-BCgGJdcF.js";import"./utils-CUsTgaRG.js";import"./excel-uoQkVabA.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=pe("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=pe("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);function Ns({open:i,onOpenChange:c,onScan:r}){const[p,N]=s.useState(!1),[h,u]=s.useState(null),[l,a]=s.useState(null),[g,v]=s.useState(!1),j=s.useRef(null),C="barcode-reader",{trigger:m}=ms();s.useEffect(()=>(i&&!j.current&&!g&&f(),()=>{n()}),[i,g]);const x=async()=>{try{return(await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})).getTracks().forEach(z=>z.stop()),!0}catch(y){return console.error("Error requesting camera permission:",y),y instanceof DOMException&&(y.name==="NotAllowedError"||y.name==="PermissionDeniedError"?(v(!0),a("Permisos de cámara denegados. Por favor, habilita los permisos en la configuración de tu navegador.")):y.name==="NotFoundError"?a("No se encontró ninguna cámara en tu dispositivo."):y.name==="NotReadableError"?a("La cámara está siendo usada por otra aplicación."):a("Error al acceder a la cámara. Intenta nuevamente.")),!1}},f=async()=>{try{if(a(null),!await x())return;const z=new ds(C);j.current=z;const W={fps:15,qrbox:{width:280,height:280},aspectRatio:1,experimentalFeatures:{useBarCodeDetectorIfSupported:!0},formatsToSupport:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]};await z.start({facingMode:"environment"},W,T=>{o(T)},T=>{}),N(!0),d.success("Cámara iniciada")}catch(y){console.error("Error starting scanner:",y),y instanceof Error&&(y.message.includes("Permission")?(v(!0),a("Permisos de cámara denegados. Por favor, habilita los permisos en la configuración de tu navegador.")):a("Error al iniciar la cámara. Verifica que hayas dado permisos y que no esté siendo usada por otra aplicación.")),d.error("Error al iniciar la cámara")}},n=async()=>{if(j.current)try{j.current.isScanning&&await j.current.stop(),j.current.clear()}catch(y){console.error("Error stopping scanner:",y)}finally{j.current=null,N(!1)}},o=y=>{u(y),m("success"),setTimeout(()=>{r(y),b()},800)},b=async()=>{await n(),u(null),a(null),v(!1),c(!1)},P=()=>{a(null),v(!1),f()};return e.jsx(ge,{open:i,onOpenChange:b,children:e.jsxs(ye,{className:"sm:max-w-[500px]",children:[e.jsxs(je,{children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-primary"}),"Escanear Código de Barras"]}),e.jsx(Ge,{children:l?"Hubo un problema al acceder a la cámara":"Apunta la cámara al código de barras del producto"})]}),e.jsxs("div",{className:"space-y-4",children:[!l&&e.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-black min-h-[300px]",children:[e.jsx("div",{id:C,className:"w-full"}),e.jsx(H,{children:h&&e.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-success/90 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(D.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",duration:.5},children:e.jsx(G,{className:"w-16 h-16 mx-auto mb-4"})}),e.jsx("p",{className:"text-xl font-semibold",children:"¡Código detectado!"}),e.jsx("p",{className:"text-sm mt-2 font-mono",children:h})]})})})]}),l&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ke,{className:"w-6 h-6 text-destructive flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-destructive mb-2",children:"Error de Cámara"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:l}),g&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2 font-semibold",children:"Cómo habilitar permisos:"}),e.jsxs("ul",{className:"text-xs text-muted-foreground space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Chrome: Toca el ícono de candado en la barra de dirección"}),e.jsxs("li",{children:["Safari: Ve a Configuración ",">"," Safari ",">"," Cámara"]}),e.jsx("li",{children:"Firefox: Toca el ícono de información en la barra de dirección"})]})]}),e.jsx(E,{onClick:P,variant:"outline",size:"sm",className:"w-full",children:"Reintentar"})]})]})}),!l&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Mantén el código de barras dentro del cuadro de escaneo"}),e.jsx("p",{className:"text-xs text-muted-foreground text-center mt-2",children:"Funciona con códigos EAN, UPC, QR y más"})]}),e.jsxs(E,{onClick:b,variant:"outline",className:"w-full",children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Cancelar"]})]})]})})}function vs({onSelect:i,placeholder:c="Buscar producto por nombre o EAN...",className:r}){const[p,N]=s.useState(""),[h,u]=s.useState([]),[l,a]=s.useState(!1),[g,v]=s.useState(0),j=s.useRef(null),C=s.useRef(null);s.useEffect(()=>{const n=setTimeout(async()=>{if(p.trim().length>=2)try{const o=await Xe(p,8);u(o),a(o.length>0),v(0)}catch(o){console.error("Error searching products:",o),u([])}else u([]),a(!1)},300);return()=>clearTimeout(n)},[p]),s.useEffect(()=>{const n=o=>{var b;C.current&&!C.current.contains(o.target)&&!((b=j.current)!=null&&b.contains(o.target))&&a(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]);const m=n=>{if(!(!l||h.length===0))switch(n.key){case"ArrowDown":n.preventDefault(),v(o=>(o+1)%h.length);break;case"ArrowUp":n.preventDefault(),v(o=>(o-1+h.length)%h.length);break;case"Enter":n.preventDefault(),h[g]&&x(h[g]);break;case"Escape":a(!1);break}},x=n=>{var o;i(n),N(""),u([]),a(!1),(o=j.current)==null||o.blur()},f=(n,o)=>o.trim()?n.split(new RegExp(`(${o})`,"gi")).map((P,y)=>P.toLowerCase()===o.toLowerCase()?e.jsx("mark",{className:"bg-primary/20 text-primary font-semibold",children:P},y):P):n;return e.jsxs("div",{className:w("relative",r),children:[e.jsxs("div",{className:"relative",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx(B,{ref:j,type:"text",value:p,onChange:n=>N(n.target.value),onKeyDown:m,onFocus:()=>{h.length>0&&a(!0)},placeholder:c,className:"pl-10 pr-4"})]}),e.jsx(H,{children:l&&h.length>0&&e.jsxs(D.div,{ref:C,initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"absolute z-50 w-full mt-2 bg-card border border-border rounded-lg shadow-lg elevation-3 max-h-[400px] overflow-y-auto",children:[e.jsx("div",{className:"p-2 space-y-1",children:h.map((n,o)=>e.jsx(D.button,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:o*.05},onClick:()=>x(n),onMouseEnter:()=>v(o),className:w("w-full text-left p-3 rounded-lg transition-colors","hover:bg-primary hover:text-primary-foreground","focus:outline-none focus:ring-2 focus:ring-ring",g===o&&"bg-primary text-primary-foreground"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:w("p-2 rounded-lg flex-shrink-0",g===o?"bg-primary-foreground/20":"bg-muted"),children:e.jsx(U,{className:w("w-5 h-5",g===o?"text-primary-foreground":"text-muted-foreground")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:f(n.name,p)}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:w("text-xs font-mono",g===o?"text-primary-foreground/80":"text-muted-foreground"),children:["EAN: ",f(n.ean,p)]}),n.salePrice>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:w("text-xs",g===o?"text-primary-foreground/60":"text-muted-foreground"),children:"•"}),e.jsxs("span",{className:w("text-xs font-semibold",g===o?"text-primary-foreground/80":"text-muted-foreground"),children:["$",n.salePrice.toLocaleString()]})]})]})]})]})},n.ean))}),e.jsx("div",{className:"border-t border-border p-2 bg-muted/30",children:e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Usa ↑↓ para navegar, Enter para seleccionar"})})]})}),l&&p.trim().length>=2&&h.length===0&&e.jsx(D.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"absolute z-50 w-full mt-2 bg-card border border-border rounded-lg shadow-lg p-4",children:e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"No se encontraron productos"})})]})}const bs=Ye,ws=Qe,we=s.forwardRef(({className:i,...c},r)=>e.jsx(de,{className:w("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",i),...c,ref:r}));we.displayName=de.displayName;const Ce=s.forwardRef(({className:i,...c},r)=>e.jsxs(ws,{children:[e.jsx(we,{}),e.jsx(me,{ref:r,className:w("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",i),...c})]}));Ce.displayName=me.displayName;const Se=({className:i,...c})=>e.jsx("div",{className:w("flex flex-col space-y-2 text-center sm:text-left",i),...c});Se.displayName="AlertDialogHeader";const Ee=({className:i,...c})=>e.jsx("div",{className:w("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",i),...c});Ee.displayName="AlertDialogFooter";const Pe=s.forwardRef(({className:i,...c},r)=>e.jsx(ue,{ref:r,className:w("text-lg font-semibold",i),...c}));Pe.displayName=ue.displayName;const ke=s.forwardRef(({className:i,...c},r)=>e.jsx(xe,{ref:r,className:w("text-sm text-muted-foreground",i),...c}));ke.displayName=xe.displayName;const De=s.forwardRef(({className:i,...c},r)=>e.jsx(fe,{ref:r,className:w(ve(),i),...c}));De.displayName=fe.displayName;const Ie=s.forwardRef(({className:i,...c},r)=>e.jsx(he,{ref:r,className:w(ve({variant:"outline"}),"mt-2 sm:mt-0",i),...c}));Ie.displayName=he.displayName;function Cs({items:i,onUpdate:c,onDelete:r}){const[p,N]=s.useState(null),[h,u]=s.useState(""),[l,a]=s.useState(null),g=m=>{N(m.id),u(m.quantity.toString())},v=()=>{if(p&&h){const m=parseInt(h,10);m>0&&(c(p,m),N(null),u(""))}},j=()=>{N(null),u("")},C=()=>{l&&(r(l),a(null))};return i.length===0?e.jsxs(R,{className:"p-8 text-center",children:[e.jsx(U,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"No hay productos agregados aún"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Escanea o busca productos para comenzar"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3",children:e.jsx(H,{mode:"popLayout",children:i.map((m,x)=>e.jsx(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-100},transition:{delay:x*.05},layout:!0,children:e.jsx(us,{className:"mb-3",onEdit:()=>g(m),onDelete:()=>a(m.id),children:e.jsx(R,{className:"p-4 hover:shadow-md transition-shadow border-0 rounded-none sm:rounded-xl sm:border",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg flex-shrink-0",children:e.jsx(U,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-foreground truncate",children:m.productName}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-muted-foreground font-mono",children:["EAN: ",m.ean]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"•"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(js,{className:"w-3 h-3 text-muted-foreground"}),e.jsxs("span",{className:"text-sm font-semibold text-primary",children:[m.quantity," uds."]})]})]}),m.synced===0&&e.jsxs("span",{className:"inline-flex items-center gap-1 mt-2 px-2 py-0.5 bg-warning/10 text-warning text-xs rounded-full",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-warning rounded-full"}),"Pendiente de sincronizar"]})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2 flex-shrink-0",children:[e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>g(m),className:"hover:bg-primary hover:text-primary-foreground",children:e.jsx(xs,{className:"w-4 h-4"})}),e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>a(m.id),className:"hover:bg-destructive hover:text-destructive-foreground",children:e.jsx(_e,{className:"w-4 h-4"})})]})]})})})},m.id))})}),e.jsx(ge,{open:p!==null,onOpenChange:m=>!m&&j(),children:e.jsxs(ye,{children:[e.jsx(je,{children:e.jsx(Ne,{children:"Editar Cantidad"})}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Nueva cantidad"}),e.jsx(B,{type:"number",min:"1",value:h,onChange:m=>u(m.target.value),onKeyDown:m=>{m.key==="Enter"&&v()},placeholder:"Ingresa la cantidad",autoFocus:!0})]})}),e.jsxs(Ze,{children:[e.jsx(E,{variant:"outline",onClick:j,children:"Cancelar"}),e.jsx(E,{onClick:v,disabled:!h||parseInt(h)<=0,children:"Guardar"})]})]})}),e.jsx(bs,{open:l!==null,onOpenChange:m=>!m&&a(null),children:e.jsxs(Ce,{children:[e.jsxs(Se,{children:[e.jsx(Pe,{children:"¿Eliminar producto?"}),e.jsx(ke,{children:"Esta acción no se puede deshacer. El producto será eliminado del pre-conteo."})]}),e.jsxs(Ee,{children:[e.jsx(Ie,{children:"Cancelar"}),e.jsx(De,{onClick:C,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Eliminar"})]})]})})]})}function Ss(){const[i,c]=s.useState([]),[r,p]=s.useState(null),[N,h]=s.useState(!0);s.useEffect(()=>{(async()=>{try{await ns();const f=await ae();if(f){p(f);const n=await ne(f.sector);c(n)}}catch(f){console.error("Error initializing pre-count:",f),d.error("Error al inicializar el sistema de pre-conteo")}finally{h(!1)}})()},[]);const u=i.length,l=i.reduce((x,f)=>x+f.quantity,0);s.useEffect(()=>{r&&!r.endTime&&es(r.id,{totalProducts:u,totalUnits:l}).catch(x=>{console.error("Error updating session:",x)})},[r,u,l]);const a=s.useCallback(async x=>{try{if(h(!0),await ae()){d.error("Ya existe una sesión activa. Por favor, finalízala primero.");return}const n=await ss(x);p(n),c([]),d.success(`Sesión iniciada para el sector: ${x}`)}catch(f){console.error("Error starting session:",f),d.error("Error al iniciar la sesión")}finally{h(!1)}},[]),g=s.useCallback(async(x,f,n)=>{if(!r){d.error("No hay una sesión activa");return}if(n<=0){d.error("La cantidad debe ser mayor a 0");return}try{const o=i.find(b=>b.ean===x);if(o){const b=o.quantity+n;await re(o.id,{quantity:b}),c(P=>P.map(y=>y.id===o.id?{...y,quantity:b,synced:0}:y)),d.success(`Cantidad actualizada: ${f} (+${n})`)}else{const b=await ts({sector:r.sector,ean:x,productName:f,quantity:n});c(P=>[...P,b]),d.success(`Producto agregado: ${f}`)}}catch(o){console.error("Error adding item:",o),d.error("Error al agregar el producto")}},[r,i]),v=s.useCallback(async(x,f)=>{if(f<=0){d.error("La cantidad debe ser mayor a 0");return}try{await re(x,{quantity:f}),c(n=>n.map(o=>o.id===x?{...o,quantity:f,synced:0}:o)),d.success("Cantidad actualizada")}catch(n){console.error("Error updating item:",n),d.error("Error al actualizar el producto")}},[]),j=s.useCallback(async x=>{try{await as(x),c(f=>f.filter(n=>n.id!==x)),d.success("Producto eliminado")}catch(f){console.error("Error removing item:",f),d.error("Error al eliminar el producto")}},[]),C=s.useCallback(async()=>{if(!r){d.error("No hay una sesión activa");return}try{await rs(r.id),p(null),c([]),d.success("Sesión finalizada correctamente")}catch(x){console.error("Error finishing session:",x),d.error("Error al finalizar la sesión")}},[r]),m=s.useCallback(async()=>{if(r)try{const x=await ne(r.sector);c(x)}catch(x){console.error("Error refreshing items:",x),d.error("Error al actualizar los productos")}},[r]);return{items:i,session:r,totalProducts:u,totalUnits:l,isLoading:N,startSession:a,addItem:g,updateItem:v,removeItem:j,finishSession:C,refreshItems:m}}function Es(){const[i,c]=s.useState(navigator.onLine),[r,p]=s.useState(!1),[N,h]=s.useState(0);s.useEffect(()=>{const a=()=>{c(!0),d.success("Conexión restaurada",{description:"Los datos se sincronizarán automáticamente"}),l()},g=()=>{c(!1),d.warning("Sin conexión",{description:"Los datos se guardarán localmente"})};return window.addEventListener("online",a),window.addEventListener("offline",g),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",g)}},[]);const u=s.useCallback(async()=>{try{const a=await oe();h(a.length)}catch(a){console.error("Error counting unsynced items:",a)}},[]);s.useEffect(()=>{u();const a=setInterval(u,3e4);return()=>clearInterval(a)},[u]);const l=s.useCallback(async()=>{if(!i){d.error("No hay conexión a internet");return}if(!r)try{p(!0);const a=await oe();if(a.length===0){d.info("No hay datos pendientes de sincronización");return}console.log("Syncing items:",a),await new Promise(v=>setTimeout(v,1e3));const g=a.map(v=>v.id);await os(g),await u(),d.success("Sincronización completada",{description:`${a.length} productos sincronizados`})}catch(a){console.error("Error syncing data:",a),d.error("Error al sincronizar datos",{description:"Se reintentará automáticamente"})}finally{p(!1)}},[i,r,u]);return s.useEffect(()=>{if(i&&N>0&&!r){const a=setTimeout(()=>{l()},2e3);return()=>clearTimeout(a)}},[i,N,r,l]),{isOnline:i,isSyncing:r,unsyncedCount:N,syncNow:l}}function Ps({actions:i,className:c}){const[r,p]=s.useState(!0),[N,h]=s.useState(0);return s.useEffect(()=>{const u=()=>{const l=window.scrollY;l<N||l<50?p(!0):l>N&&l>50&&p(!1),h(l)};return window.addEventListener("scroll",u,{passive:!0}),()=>window.removeEventListener("scroll",u)},[N]),e.jsx(H,{children:r&&e.jsx(D.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{duration:.3},className:w("fixed bottom-24 right-6 flex flex-col gap-3 z-40",c),children:i.map((u,l)=>e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("span",{className:"bg-background/80 backdrop-blur-sm text-foreground text-xs font-medium px-2 py-1 rounded-md shadow-sm",children:u.label}),e.jsx(E,{variant:u.variant||"default",size:"icon",className:"h-12 w-12 rounded-full shadow-lg",onClick:u.onClick,children:u.icon})]},l))})})}function Qs(){const i=Ve(),[c,r]=s.useState("config"),[p,N]=s.useState(""),[h,u]=s.useState(!1),[l,a]=s.useState(""),[g,v]=s.useState("1"),[j,C]=s.useState(null),{items:m,session:x,totalProducts:f,totalUnits:n,isLoading:o,startSession:b,addItem:P,updateItem:y,removeItem:z,finishSession:W}=Ss(),{isOnline:T,isSyncing:K,unsyncedCount:J,syncNow:ze}=Es(),X=async()=>{if(!p.trim()){d.error("Por favor, ingresa el nombre del sector");return}await b(p.trim()),r("counting")},Ae=async t=>{try{const S=await ie(t);S?(C(S),a(t),d.success(`Producto encontrado: ${S.name}`)):(a(t),d.warning("Producto no encontrado en la base de datos",{description:"Puedes agregarlo manualmente"}))}catch(S){console.error("Error fetching product:",S),d.error("Error al buscar el producto")}},Fe=t=>{C(t),a(t.ean)},Le=async()=>{if(!l.trim()){d.error("Por favor, ingresa o escanea un código EAN");return}const t=parseInt(g,10);if(isNaN(t)||t<=0){d.error("Por favor, ingresa una cantidad válida");return}let S=j==null?void 0:j.name;if(!S)try{const A=await ie(l.trim());A&&(S=A.name)}catch(A){console.error("Error fetching product by EAN:",A)}S||(S=`Producto ${l}`),await P(l,S,t),a(""),v("1"),C(null)},Te=async()=>{if(m.length===0){d.error("No hay productos para finalizar");return}await W(),i("/stock")},Oe=()=>{if(m.length===0){d.error("No hay productos para exportar");return}try{const t=new hs,S=t.internal.pageSize.getWidth(),A=t.internal.pageSize.getHeight(),k=10,Y=3,Q=3,O=(S-k*2-Q*(Y-1))/Y,q=28;let F=k,I=k+15;t.setFontSize(14),t.text(`Pre-Conteo: ${p}`,k,k+5),t.setFontSize(8),t.text(`Fecha: ${new Date().toLocaleDateString()}`,S-k-30,k+5),m.forEach(($,He)=>{I+q>A-k&&(t.addPage(),I=k),t.setDrawColor(200),t.setLineWidth(.1),t.roundedRect(F,I,O,q,2,2,"S");const _=O-4,qe=F+2,$e=I+5;t.setFontSize(9),t.setFont("helvetica","bold");let M=$.productName;if(t.getTextWidth(M)>_){const L=Math.floor(_/2);M=M.substring(0,L)+"..."}t.text(M,qe,$e);const Me=O*.65,Ue=15,Z=F+2,ee=I+8,V=document.createElement("canvas");try{const L={displayValue:!0,fontSize:14,fontOptions:"bold",margin:0,height:40,width:2,background:"#ffffff",lineColor:"#000000",textMargin:0};try{le(V,$.ean,{...L,format:"EAN13"})}catch{le(V,$.ean,{...L,format:"CODE128"})}const We=V.toDataURL("image/png");t.addImage(We,"PNG",Z,ee,Me,Ue)}catch(L){console.error("Error generating barcode:",L),t.setFontSize(8),t.setTextColor(255,0,0),t.text("Error Barcode",Z,ee+10),t.setTextColor(0,0,0)}const se=F+O-2,te=I+q-6;t.setFontSize(24),t.setFont("helvetica","bold"),t.text($.quantity.toString(),se,te,{align:"right"}),t.setFontSize(6),t.setFont("helvetica","normal"),t.setTextColor(100),t.text("CANT",se,te-10,{align:"right"}),t.setTextColor(0),(He+1)%Y===0?(F=k,I+=q+Q):F+=O+Q});const Be=`PreConteo_${p}_${new Date().toISOString().split("T")[0]}.pdf`;t.save(Be),d.success("PDF generado correctamente")}catch(t){console.error("Error generating PDF:",t),d.error("Error al generar el PDF")}},Re=async()=>{await ls([{ean:"7790001234567",name:"Shampoo Dove 400ml",cost:850,salePrice:1200},{ean:"7790002345678",name:"Acondicionador Pantene 300ml",cost:920,salePrice:1350},{ean:"7790003456789",name:"Jabón Dove 90g",cost:180,salePrice:280},{ean:"7790004567890",name:"Desodorante Rexona 150ml",cost:650,salePrice:950},{ean:"7790005678901",name:"Crema Dental Colgate 90g",cost:420,salePrice:620},{ean:"7790006789012",name:"Enjuague Bucal Listerine 500ml",cost:1100,salePrice:1580},{ean:"7790007890123",name:"Papel Higiénico Elite x4",cost:890,salePrice:1250},{ean:"7790008901234",name:"Toallas Femeninas Always x8",cost:520,salePrice:780},{ean:"7790009012345",name:"Pañales Pampers M x30",cost:3200,salePrice:4500},{ean:"7790010123456",name:"Algodón Estrella 100g",cost:280,salePrice:420}]),d.success("Productos de ejemplo cargados")};return o?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Cargando..."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(D.div,{className:"space-y-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:[e.jsxs("div",{className:"flex items-start sm:items-center justify-between gap-4 flex-col sm:flex-row",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>c==="config"?i("/stock"):r("config"),className:"flex-shrink-0",children:e.jsx(ps,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:"Pre-Conteo Sucursal"}),x&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Sector: ",e.jsx("span",{className:"font-semibold text-foreground",children:x.sector})]})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:T?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-success/10 text-success rounded-full text-sm",children:[e.jsx(gs,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium hidden sm:inline",children:"En línea"})]}):e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-warning/10 text-warning rounded-full text-sm",children:[e.jsx(is,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium hidden sm:inline",children:"Sin conexión"})]})})]}),e.jsx(H,{mode:"wait",children:c==="config"?e.jsx(D.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"max-w-2xl mx-auto",children:e.jsx(R,{className:"p-6 sm:p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex p-4 bg-primary/10 rounded-2xl mb-4",children:e.jsx(U,{className:"w-12 h-12 text-primary"})}),e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-foreground mb-2",children:"Configuración del Pre-Conteo"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Ingresa el nombre del sector o estantería que vas a contar"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Nombre del Sector / Estantería *"}),e.jsx(B,{type:"text",value:p,onChange:t=>N(t.target.value),onKeyDown:t=>{t.key==="Enter"&&X()},placeholder:"Ej: Bebidas, Perfumería, Góndola 1, etc.",className:"text-base sm:text-lg",autoFocus:!0})]}),e.jsx(E,{onClick:X,disabled:!p.trim(),className:"w-full",size:"lg",children:"Comenzar Pre-Conteo"}),e.jsx(E,{onClick:Re,variant:"outline",className:"w-full",size:"sm",children:"Cargar productos de ejemplo"})]})]})})},"config"):e.jsxs(D.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"space-y-4 sm:space-y-6",children:[e.jsx(R,{className:"p-6 sm:p-8 bg-gradient-to-br from-primary/10 to-primary/5 border-primary/20 elevation-2",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Llevas"}),e.jsx("div",{className:"text-5xl sm:text-6xl font-bold text-primary mb-2",children:e.jsx(ce,{value:f})}),e.jsxs("p",{className:"text-xl sm:text-2xl font-semibold text-foreground",children:[f===1?"producto":"productos"," pre-contados"]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Total de unidades: ",e.jsx("span",{className:"font-semibold text-foreground",children:e.jsx(ce,{value:n})})]})]})}),e.jsxs(R,{className:"p-4 sm:p-6 elevation-1",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-foreground mb-4",children:"Agregar Producto"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(E,{onClick:()=>u(!0),className:"w-full",size:"lg",variant:"default",children:[e.jsx(be,{className:"w-5 h-5 mr-2"}),"Escanear Código de Barras"]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-card px-2 text-muted-foreground",children:"O busca manualmente"})})]}),e.jsx(vs,{onSelect:Fe,placeholder:"Buscar producto por nombre o EAN..."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Código EAN"}),e.jsx(B,{type:"text",value:l,onChange:t=>a(t.target.value),placeholder:"Ingresa el código EAN"}),j&&e.jsxs("p",{className:"text-sm text-success mt-1 flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4"}),j.name]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Cantidad"}),e.jsx(B,{type:"number",min:"1",value:g,onChange:t=>v(t.target.value),placeholder:"Cantidad"})]}),e.jsxs(E,{onClick:Le,disabled:!l.trim()||!g,className:"w-full",size:"lg",children:[e.jsx(ys,{className:"w-5 h-5 mr-2"}),"Guardar y Siguiente"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-foreground",children:["Productos Agregados (",f,")"]}),J>0&&e.jsx(E,{onClick:ze,disabled:!T||K,variant:"outline",size:"sm",className:"flex-shrink-0",children:K?"Sincronizando...":`Sincronizar (${J})`})]}),e.jsx(Cs,{items:m,onUpdate:y,onDelete:z})]})]},"counting")})]}),m.length>0&&c==="counting"&&e.jsx(Ps,{actions:[{icon:e.jsx(cs,{className:"w-5 h-5"}),label:"Exportar a PDF",onClick:Oe},{icon:e.jsx(G,{className:"w-5 h-5"}),label:"Finalizar Pre-Conteo",onClick:Te}]}),e.jsx(Ns,{open:h,onOpenChange:u,onScan:Ae},h?"open":"closed")]})}export{Qs as default};
