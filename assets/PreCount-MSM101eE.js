import{j as e,l as fe,m as je,n as Ne,o as ye,A as ve,p as be,q as Ge,r as Ke}from"./ui-vendor-CwIRxpyq.js";import{r as c,u as Ve}from"./react-vendor-ylmX0jv_.js";import{b as P,M as we,i as F,P as Xe,B as N,N as Ce,E as _e,F as Je,G as Ze,H as es,O as ss,Q as ts,A as r,V as le,Y as as,Z as rs,_ as de,$ as ns,a0 as os,a1 as is,a2 as cs,a3 as ls,W as me,p as ue,a4 as ds,a5 as xe,m as pe,j as ms,k as us}from"./index-4S8qSKY8.js";import{I as _}from"./input-N8FoNaiK.js";import{u as xs,A as X,S as ps,B as gs}from"./AnimatedCounter-CYn97PCj.js";import{A as U,m as I}from"./animation-DbfETv0H.js";import{P as hs,C as fs}from"./Calculator-BbJpnnIf.js";import{E as js}from"./jspdf.es.min-8pzwaaXk.js";import{J as Ns}from"./JsBarcode-BPRqDEDi.js";import{F as ys}from"./FabMenu--J0-tzKn.js";import{W as ge}from"./wifi-Yt91KO94.js";import{C as vs}from"./calculator-CdEJRbhb.js";import{P as he}from"./plus-Ds5SGdqx.js";import{H as bs}from"./history-p48GtpW_.js";import{C as ws,e as Cs}from"./es-K6a7ZvuD.js";import{A as Ss}from"./arrow-right-BYGU_Lql.js";import{f as Es}from"./utils-DNiwW225.js";import"./excel-uoQkVabA.js";import"./scanner-D4NToCeH.js";import"./switch-BbRP8xhV.js";import"./label-Bq-JCdPU.js";import"./loader-circle-DBkHespF.js";import"./barcode-ZH4kG-in.js";const Ps=Ge,ks=Ke,Se=c.forwardRef(({className:l,...n},a)=>e.jsx(fe,{className:P("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",l),...n,ref:a}));Se.displayName=fe.displayName;const Ee=c.forwardRef(({className:l,...n},a)=>e.jsxs(ks,{children:[e.jsx(Se,{}),e.jsx(je,{ref:a,className:P("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",l),...n})]}));Ee.displayName=je.displayName;const Pe=({className:l,...n})=>e.jsx("div",{className:P("flex flex-col space-y-2 text-center sm:text-left",l),...n});Pe.displayName="AlertDialogHeader";const ke=({className:l,...n})=>e.jsx("div",{className:P("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",l),...n});ke.displayName="AlertDialogFooter";const ze=c.forwardRef(({className:l,...n},a)=>e.jsx(Ne,{ref:a,className:P("text-lg font-semibold",l),...n}));ze.displayName=Ne.displayName;const De=c.forwardRef(({className:l,...n},a)=>e.jsx(ye,{ref:a,className:P("text-sm text-muted-foreground",l),...n}));De.displayName=ye.displayName;const Ae=c.forwardRef(({className:l,...n},a)=>e.jsx(ve,{ref:a,className:P(we(),l),...n}));Ae.displayName=ve.displayName;const Ie=c.forwardRef(({className:l,...n},a)=>e.jsx(be,{ref:a,className:P(we({variant:"outline"}),"mt-2 sm:mt-0",l),...n}));Ie.displayName=be.displayName;function zs({items:l,onUpdate:n,onDelete:a}){const[x,b]=c.useState(null),[h,w]=c.useState(""),[p,j]=c.useState(null),C=i=>{b(i.id),w(i.quantity.toString())},y=()=>{if(x&&h){const i=parseInt(h,10);i>0&&(n(x,i),b(null),w(""))}},g=()=>{b(null),w("")},S=()=>{p&&(a(p),j(null))};return l.length===0?e.jsxs(F,{className:"p-8 text-center",children:[e.jsx(Xe,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"No hay productos agregados aún"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Escanea o busca productos para comenzar"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:e.jsx(U,{mode:"popLayout",children:l.map((i,$)=>e.jsx(I.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},layout:!0,children:e.jsxs(F,{className:"h-full relative overflow-hidden group border-muted/60 shadow-sm hover:shadow-md transition-all",children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${i.synced===0?"bg-warning/50":"bg-primary/20 group-hover:bg-primary transition-colors"}`}),e.jsxs("div",{className:"p-3 pl-4 flex flex-col h-full gap-2",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsx("h4",{className:"font-medium text-sm leading-tight line-clamp-2 text-foreground/90",title:i.productName,children:i.productName}),e.jsx("div",{className:"flex flex-col items-end gap-1"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-auto",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground bg-muted/40 px-2 py-1 rounded-md border border-border/40",children:[e.jsx("span",{className:"text-[10px] font-bold opacity-70 uppercase tracking-widest",children:"EAN"}),e.jsx("span",{className:"text-xs sm:text-sm font-mono tracking-wide font-medium border-l border-border/30 pl-1.5 ml-0.5",children:i.ean})]}),i.synced===0&&e.jsxs("span",{className:"text-[10px] text-warning flex items-center gap-1 font-medium bg-warning/5 px-1.5 rounded",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-warning animate-pulse"}),"Sin sinc."]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 mt-1 border-t border-border/30",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-bold tracking-tight text-foreground",children:i.quantity}),e.jsx("span",{className:"text-xs text-muted-foreground font-medium uppercase tracking-wider",children:"unid."})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-primary hover:bg-primary/5",onClick:()=>C(i),children:e.jsx(hs,{className:"w-4 h-4"})}),e.jsx(N,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive hover:bg-destructive/5",onClick:()=>j(i.id),children:e.jsx(Ce,{className:"w-4 h-4"})})]})]})]})]})},i.id))})}),e.jsx(_e,{open:x!==null,onOpenChange:i=>!i&&g(),children:e.jsxs(Je,{children:[e.jsx(Ze,{children:e.jsx(es,{children:"Editar Cantidad"})}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Nueva cantidad"}),e.jsx(_,{type:"number",min:"1",value:h,onChange:i=>w(i.target.value),onKeyDown:i=>{i.key==="Enter"&&y()},placeholder:"Ingresa la cantidad",autoFocus:!0})]})}),e.jsxs(ss,{children:[e.jsx(N,{variant:"outline",onClick:g,children:"Cancelar"}),e.jsx(N,{onClick:y,disabled:!h||parseInt(h)<=0,children:"Guardar"})]})]})}),e.jsx(Ps,{open:p!==null,onOpenChange:i=>!i&&j(null),children:e.jsxs(Ee,{children:[e.jsxs(Pe,{children:[e.jsx(ze,{children:"¿Eliminar producto?"}),e.jsx(De,{children:"Esta acción no se puede deshacer. El producto será eliminado del pre-conteo."})]}),e.jsxs(ke,{children:[e.jsx(Ie,{children:"Cancelar"}),e.jsx(Ae,{onClick:S,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Eliminar"})]})]})})]})}function Ds(){const[l,n]=c.useState([]),[a,x]=c.useState(null),[b,h]=c.useState(0),[w,p]=c.useState([]),[j,C]=c.useState(!0);c.useEffect(()=>{const o=setTimeout(async()=>{try{await ns();const d=await os();p(d)}catch(d){console.error("Error initializing pre-count:",d),r.error("Error de inicialización","No se pudo inicializar el sistema de pre-conteo")}finally{C(!1)}},100);return()=>clearTimeout(o)},[]);const y=l.length,g=l.reduce((t,o)=>t+o.quantity,0);c.useEffect(()=>{a&&!a.endTime&&ts(a.id,{totalProducts:y,totalUnits:g,errorCount:b}).catch(t=>{console.error("Error updating session:",t)})},[a,y,g,b]);const S=async t=>{try{if(C(!0),w.find(u=>u.sector===t)){r.error("Sesión duplicada","Ya existe una sesión abierta para este sector");return}const d=await is(t);x(d),n([]),h(0),p(u=>[d,...u]),r.success("Sesión iniciada",`Pre-conteo de ${t} comenzado`)}catch(o){console.error("Error starting session:",o),r.error("Error","No se pudo iniciar la sesión")}finally{C(!1)}},i=async t=>{try{x(t);const o=await de(t.sector);n(o),h(t.errorCount||0),r.success("Sesión retomada",`Continuando pre-conteo de ${t.sector}`)}catch(o){console.error("Error resuming session:",o),r.error("Error","No se pudo retomar la sesión")}},$=async t=>{if(confirm("¿Estás seguro de eliminar esta sesión? Se perderán todos los datos escaneados."))try{await cs(t),p(o=>o.filter(d=>d.id!==t)),(a==null?void 0:a.id)===t&&(x(null),n([])),r.success("Sesión eliminada","La sesión se eliminó correctamente")}catch(o){console.error("Error deleting session:",o),r.error("Error","No se pudo eliminar la sesión")}},Q=c.useCallback(async(t,o,d)=>{if(!a){r.error("Sesión requerida","No hay una sesión activa");return}if(d<=0){r.error("Cantidad inválida","La cantidad debe ser mayor a 0");return}try{const u=l.find(E=>E.ean===t);if(u){const E=u.quantity+d;await le(u.id,{quantity:E}),n(D=>D.map(H=>H.id===u.id?{...H,quantity:E,synced:0}:H)),r.success("Cantidad actualizada",`${o} (+${d})`)}else{const E=await as({sector:a.sector,ean:t,productName:o,quantity:d});n(D=>[...D,E]),r.success("Producto agregado",`${o} - ${d} unidades`)}}catch(u){console.error("Error adding item:",u),r.error("Error","No se pudo agregar el producto")}},[a,l]),k=c.useCallback(async(t,o)=>{if(o<=0){r.error("Cantidad inválida","La cantidad debe ser mayor a 0");return}try{await le(t,{quantity:o}),n(d=>d.map(u=>u.id===t?{...u,quantity:o,synced:0}:u)),r.success("Cantidad actualizada","La cantidad del producto se actualizó correctamente")}catch(d){console.error("Error updating item:",d),r.error("Error","No se pudo actualizar el producto")}},[]),O=c.useCallback(async t=>{try{await rs(t),n(o=>o.filter(d=>d.id!==t)),r.success("Producto eliminado","El producto se eliminó del conteo")}catch(o){console.error("Error removing item:",o),r.error("Error","No se pudo eliminar el producto")}},[]),R=async()=>{if(a&&confirm("¿Finalizar sesión de conteo?"))try{await ls(a.id),x(null),n([]),p(t=>t.filter(o=>o.id!==a.id)),r.success("Sesión finalizada","El pre-conteo se finalizó correctamente")}catch(t){console.error("Error finishing session:",t),r.error("Error","No se pudo finalizar la sesión")}},Y=c.useCallback(async()=>{if(a)try{const t=await de(a.sector);n(t)}catch(t){console.error("Error refreshing items:",t),r.error("Error","No se pudieron actualizar los productos")}},[a]),T=c.useCallback(()=>{a&&h(t=>t+1)},[a]);return{items:l,session:a,totalProducts:y,totalUnits:g,errorCount:b,isLoading:j,availableSessions:w,startSession:S,resumeSession:i,deleteSession:$,addItem:Q,updateItem:k,removeItem:O,finishSession:R,refreshItems:Y,registerError:T}}function et(){const l=Ve(),[n,a]=c.useState("config"),[x,b]=c.useState(""),[h,w]=c.useState(!1),[p,j]=c.useState(""),[C,y]=c.useState("1"),[g,S]=c.useState(null),[i,$]=c.useState(!1),Q=s=>{y(Math.floor(s).toString())},{items:k,session:O,totalProducts:R,totalUnits:Y,isLoading:T,startSession:t,addItem:o,updateItem:d,removeItem:u,finishSession:E,availableSessions:D,deleteSession:H,resumeSession:Fe,errorCount:$e,registerError:J}=Ds(),{isOnline:B,isSyncing:Z,unsyncedCount:ee,syncNow:Oe}=xs(),se=async()=>{if(!x.trim()){r.error("Error","Por favor, ingresa el nombre del sector");return}await t(x.trim()),a("counting")},Te=async s=>{try{const m=await xe(s);m?(S(m),j(s),r.success("Operación exitosa",`Producto encontrado: ${m.name}`)):(j(s),r.warning("Advertencia","Producto no encontrado en la base de datos",{description:"Puedes agregarlo manualmente"}),J())}catch(m){console.error("Error fetching product:",m),r.error("Error","Error al buscar el producto")}},te=async()=>{if(!p.trim()){r.error("Error","Por favor, ingresa o escanea un código EAN");return}const s=parseInt(C,10);if(isNaN(s)||s<=0){r.error("Error","Por favor, ingresa una cantidad válida");return}let m=g==null?void 0:g.name;if(!m)try{const f=await xe(p.trim());f&&(m=f.name)}catch(f){console.error("Error fetching product by EAN:",f)}m||(m=`Producto ${p}`),await o(p,m,s),j(""),y("1"),S(null),setTimeout(()=>{var f;(f=document.getElementById("smart-search-input"))==null||f.focus()},10)},He=async()=>{if(k.length===0){r.error("Error","No hay productos para finalizar");return}await E(),l("/stock")},Be=()=>{if(k.length===0){r.error("Error","No hay productos para exportar");return}try{const s=new js,m=s.internal.pageSize.getWidth(),f=s.internal.pageSize.getHeight(),v=10,G=3,K=3,L=(m-v*2-K*(G-1))/G,W=28;let A=v,z=v+15;s.setFontSize(14),s.text(`Pre-Conteo: ${x}`,v,v+5),s.setFontSize(8),s.text(`Fecha: ${new Date().toLocaleDateString()}`,m-v-30,v+5),k.forEach((V,Re)=>{z+W>f-v&&(s.addPage(),z=v),s.setDrawColor(200),s.setLineWidth(.1),s.roundedRect(A,z,L,W,2,2,"S");const ae=L-4,We=A+2,Me=z+5;s.setFontSize(9),s.setFont("helvetica","bold");let M=V.productName;if(s.getTextWidth(M)>ae){const q=Math.floor(ae/2);M=M.substring(0,q)+"..."}s.text(M,We,Me);const Ue=L*.65,Qe=15,re=A+2,ne=z+8,oe=document.createElement("canvas");try{const q={displayValue:!0,fontSize:14,fontOptions:"bold",margin:0,height:40,width:2,background:"#ffffff",lineColor:"#000000",textMargin:0};Ns(oe,V.ean,{...q,format:"CODE128"});const Ye=oe.toDataURL("image/png");s.addImage(Ye,"PNG",re,ne,Ue,Qe)}catch(q){console.error("Error generating barcode:",q),s.setFontSize(8),s.setTextColor(255,0,0),s.text("Error Barcode",re,ne+10),s.setTextColor(0,0,0)}const ie=A+L-2,ce=z+W-6;s.setFontSize(24),s.setFont("helvetica","bold"),s.text(V.quantity.toString(),ie,ce,{align:"right"}),s.setFontSize(6),s.setFont("helvetica","normal"),s.setTextColor(100),s.text("CANT",ie,ce-10,{align:"right"}),s.setTextColor(0),(Re+1)%G===0?(A=v,z+=W+K):A+=L+K});const qe=`PreConteo_${x}_${new Date().toISOString().split("T")[0]}.pdf`;s.save(qe),r.success("Operación exitosa","PDF generado correctamente")}catch(s){console.error("Error generating PDF:",s),r.error("Error","Error al generar el PDF")}},Le=()=>e.jsx("div",{className:"max-w-5xl mx-auto space-y-8 animate-in fade-in duration-500",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 items-start",children:[e.jsxs(F,{className:"border-muted/50 shadow-lg overflow-hidden relative group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-primary/20 group-hover:bg-primary transition-colors"}),e.jsxs(pe,{className:"p-6 md:p-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 text-primary",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-xl",children:e.jsx(he,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Nueva Sesión"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Crea un nuevo espacio de trabajo para comenzar a escanear productos en un sector específico."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground ml-1",children:"Nombre del Sector"}),e.jsx(_,{value:x,onChange:s=>b(s.target.value),placeholder:"Ej: Estantería A1 - Farmacia",className:"h-12 text-lg bg-muted/30 border-muted-foreground/20 focus:border-primary transition-all",autoFocus:!0,onKeyDown:s=>s.key==="Enter"&&se()})]}),e.jsx(N,{className:"w-full h-12 text-lg font-medium shadow-md hover:shadow-lg transition-all",onClick:se,disabled:!x.trim()||T,children:T?"Iniciando...":"Comenzar Control"})]})]})]}),e.jsxs(F,{className:"border-muted/50 shadow-lg h-full",children:[e.jsx(ms,{className:"pb-4 border-b border-border/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-secondary rounded-lg text-secondary-foreground",children:e.jsx(bs,{className:"w-5 h-5"})}),e.jsx(us,{className:"text-lg",children:"Sesiones Abiertas"})]})}),e.jsx(pe,{className:"p-0",children:D.length===0?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:e.jsx("p",{children:"No hay sesiones activas"})}):e.jsx("div",{className:"divide-y divide-border/50 max-h-[400px] overflow-y-auto",children:D.map(s=>e.jsxs("div",{className:"p-4 hover:bg-muted/30 transition-colors flex items-center justify-between group",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-medium text-lg leading-none group-hover:text-primary transition-colors",children:s.sector}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ws,{className:"w-3 h-3"}),e.jsx("span",{children:Es(new Date(s.startTime),"d MMM yyyy, HH:mm",{locale:Cs})})]}),e.jsxs("div",{className:"flex gap-3 text-xs text-muted-foreground mt-1",children:[e.jsxs("span",{className:"bg-primary/5 px-2 py-0.5 rounded text-primary font-medium",children:[s.totalProducts||0," prod."]}),e.jsxs("span",{className:"bg-secondary px-2 py-0.5 rounded text-secondary-foreground font-medium",children:[s.totalUnits||0," unid."]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-destructive hover:bg-destructive/10",onClick:()=>H(s.id),title:"Eliminar sesión",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsxs(N,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",onClick:()=>{Fe(s),a("counting")},children:["Retomar",e.jsx(Ss,{className:"w-4 h-4"})]})]})]},s.id))})})]})]})});return T?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Cargando..."})]})}):e.jsxs(e.Fragment,{children:[e.jsx(I.div,{className:"space-y-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:e.jsx(U,{mode:"wait",children:n==="config"?e.jsxs(I.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"p-4 md:p-6 max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex justify-end mb-4",children:B?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-success/10 text-success rounded-full text-sm",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"En línea"})]}):e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-warning/10 text-warning rounded-full text-sm",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Sin conexión"})]})}),Le()]},"config"):e.jsxs(I.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"p-4 md:p-6 space-y-4 max-w-7xl mx-auto",children:[e.jsx(F,{className:"min-h-[120px] flex flex-col justify-center px-6 sm:px-8 bg-gradient-to-br from-secondary/40 to-secondary/20 border-muted/50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 min-w-0",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Sector"}),e.jsx("span",{className:"font-bold text-foreground text-lg sm:text-xl truncate",children:O==null?void 0:O.sector})]}),e.jsx("div",{className:"h-10 sm:h-12 w-px bg-border/40 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-8 sm:gap-12 flex-1 justify-center",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Productos"}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-primary",children:e.jsx(X,{value:R,digits:4})})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Unidades"}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:e.jsx(X,{value:Y,digits:4})})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground uppercase tracking-widest font-bold whitespace-nowrap",children:"Desconocidos"}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-amber-500",children:e.jsx(X,{value:$e,digits:3})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[ee>0&&e.jsxs(N,{onClick:Oe,disabled:!B||Z,variant:"ghost",size:"sm",className:"h-8 px-2 text-xs gap-1.5 text-warning hover:text-warning hover:bg-warning/10",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-warning animate-pulse"}),Z?"Sincronizando":`${ee} Pend.`]}),e.jsx("div",{className:`p-2 rounded-full ${B?"bg-success/10 text-success":"bg-warning/10 text-warning"}`,title:B?"En línea":"Sin conexión",children:B?e.jsx(ge,{className:"w-4 h-4"}):e.jsx(me,{className:"w-4 h-4"})})]})]})}),e.jsx(F,{className:"p-2 sm:p-3 shadow-md border-primary/20 bg-card/80 backdrop-blur-sm relative z-50",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("div",{className:"flex-1 relative z-20",children:e.jsx(ps,{onSelect:s=>{s.name?r.success("Operación exitosa",`Producto encontrado: ${s.name}`):(r.warning("Advertencia","Producto no encontrado en la base de datos",{description:"Puedes agregarlo manualmente"}),J()),j(s.ean),S({...s,stock:0,salePrice:0,cost:0}),setTimeout(()=>{var m,f;(m=document.getElementById("quantity-input"))==null||m.focus(),(f=document.getElementById("quantity-input"))==null||f.select()},50)},autoFocus:!0,className:"w-full"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-20",children:e.jsx(_,{id:"quantity-input",type:"number",className:"h-12 text-center text-lg font-medium bg-muted/30 border-muted-foreground/20 focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all",min:"1",value:C,onChange:s=>y(s.target.value),onKeyDown:s=>{s.key==="Enter"&&te()},placeholder:"#"})}),e.jsx(N,{variant:i?"secondary":"outline",size:"icon",className:"h-12 w-12 border-dashed border-border/60 hover:border-primary/50",onClick:()=>$(!i),title:"Calculadora",children:e.jsx(vs,{className:"w-5 h-5 opacity-70"})})]}),e.jsx(N,{onClick:te,size:"lg",className:"h-12 px-6 text-lg shadow-sm font-bold tracking-wide",disabled:!p.trim(),children:e.jsx(he,{className:"w-6 h-6"})})]})]}),e.jsx(U,{children:i&&e.jsx(I.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border rounded-lg bg-muted/20",children:e.jsx(fs,{onResult:Q,onClose:()=>$(!1)})})}),e.jsx(U,{children:g&&e.jsxs(I.div,{initial:{opacity:0,height:0,scale:.95},animate:{opacity:1,height:"auto",scale:1},exit:{opacity:0,height:0},className:"bg-primary/5 rounded border border-primary/10 flex items-center justify-between p-2 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(ue,{className:"w-4 h-4 text-primary shrink-0"}),e.jsxs("div",{className:"min-w-0 flex flex-col sm:flex-row sm:items-baseline gap-1",children:[e.jsx("span",{className:"font-semibold text-foreground text-sm truncate",children:g.name}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-mono truncate",children:g.ean})]})]}),e.jsx(N,{size:"sm",variant:"ghost",className:"h-6 text-[10px] px-2 text-muted-foreground hover:text-destructive",onClick:()=>{S(null),j("")},children:"Limpiar"})]})})]})}),e.jsxs("div",{className:"space-y-2 relative z-10",children:[e.jsx("div",{className:"flex items-center justify-between px-1",children:e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wider",children:["Historial (",R,")"]})}),e.jsx(zs,{items:k,onUpdate:d,onDelete:u})]})]},"counting")})}),k.length>0&&n==="counting"&&e.jsx(ys,{actions:[{label:"Finalizar",icon:e.jsx(ue,{className:"w-5 h-5"}),onClick:He,variant:"default",color:"bg-primary text-primary-foreground"},{label:"Exportar PDF",icon:e.jsx(ds,{className:"w-5 h-5"}),onClick:Be,variant:"secondary"}]}),e.jsx(gs,{open:h,onOpenChange:w,onScan:Te},h?"open":"closed")]})}export{et as default};
