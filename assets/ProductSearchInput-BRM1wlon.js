import{j as t}from"./ui-vendor-lsEhpTbO.js";import{r as n}from"./react-vendor-ylmX0jv_.js";import{I as k}from"./input-CVN6kQL1.js";import{a1 as S,f as l,S as P,P as R}from"./index-CEMh4a-E.js";import{A,m as g}from"./animation-DZFErbwn.js";function z({onSelect:j,placeholder:v="Buscar producto por nombre o EAN...",className:N}){const[o,h]=n.useState(""),[s,i]=n.useState([]),[m,c]=n.useState(!1),[a,d]=n.useState(0),u=n.useRef(null),f=n.useRef(null);n.useEffect(()=>{const r=setTimeout(async()=>{if(o.trim().length>=2)try{const e=await S(o,8);i(e),c(e.length>0),d(0)}catch(e){console.error("Error searching products:",e),i([])}else i([]),c(!1)},300);return()=>clearTimeout(r)},[o]),n.useEffect(()=>{const r=e=>{var p;f.current&&!f.current.contains(e.target)&&!((p=u.current)!=null&&p.contains(e.target))&&c(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const w=r=>{if(!(!m||s.length===0))switch(r.key){case"ArrowDown":r.preventDefault(),d(e=>(e+1)%s.length);break;case"ArrowUp":r.preventDefault(),d(e=>(e-1+s.length)%s.length);break;case"Enter":r.preventDefault(),s[a]&&y(s[a]);break;case"Escape":c(!1);break}},y=r=>{var e;j(r),h(""),i([]),c(!1),(e=u.current)==null||e.blur()},b=(r,e)=>e.trim()?r.split(new RegExp(`(${e})`,"gi")).map((x,E)=>x.toLowerCase()===e.toLowerCase()?t.jsx("mark",{className:"bg-primary/20 text-primary font-semibold",children:x},E):x):r;return t.jsxs("div",{className:l("relative",N),children:[t.jsxs("div",{className:"relative",children:[t.jsx(P,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),t.jsx(k,{ref:u,type:"text",value:o,onChange:r=>h(r.target.value),onKeyDown:w,onFocus:()=>{s.length>0&&c(!0)},placeholder:v,className:"pl-10 pr-4"})]}),t.jsx(A,{children:m&&s.length>0&&t.jsxs(g.div,{ref:f,initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"absolute z-50 w-full mt-2 bg-card border border-border rounded-lg shadow-lg elevation-3 max-h-[400px] overflow-y-auto",children:[t.jsx("div",{className:"p-2 space-y-1",children:s.map((r,e)=>t.jsx(g.button,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:e*.05},onClick:()=>y(r),onMouseEnter:()=>d(e),className:l("w-full text-left p-3 rounded-lg transition-colors","hover:bg-primary hover:text-primary-foreground","focus:outline-none focus:ring-2 focus:ring-ring",a===e&&"bg-primary text-primary-foreground"),children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:l("p-2 rounded-lg flex-shrink-0",a===e?"bg-primary-foreground/20":"bg-muted"),children:t.jsx(R,{className:l("w-5 h-5",a===e?"text-primary-foreground":"text-muted-foreground")})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"font-medium truncate",children:b(r.name,o)}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsxs("span",{className:l("text-xs font-mono",a===e?"text-primary-foreground/80":"text-muted-foreground"),children:["EAN: ",b(r.ean,o)]}),r.salePrice>0&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:l("text-xs",a===e?"text-primary-foreground/60":"text-muted-foreground"),children:"•"}),t.jsxs("span",{className:l("text-xs font-semibold",a===e?"text-primary-foreground/80":"text-muted-foreground"),children:["$",r.salePrice.toLocaleString()]})]})]})]})]})},r.ean))}),t.jsx("div",{className:"border-t border-border p-2 bg-muted/30",children:t.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Usa ↑↓ para navegar, Enter para seleccionar"})})]})}),m&&o.trim().length>=2&&s.length===0&&t.jsx(g.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"absolute z-50 w-full mt-2 bg-card border border-border rounded-lg shadow-lg p-4",children:t.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"No se encontraron productos"})})]})}export{z as P};
