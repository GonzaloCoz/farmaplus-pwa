import{j as e}from"./ui-vendor-lsEhpTbO.js";import{r as a}from"./react-vendor-ylmX0jv_.js";import{H as z}from"./scanner-D4NToCeH.js";import{c as T,y as F,q as H,r as O,t as q,v as U,$,l as K,B as y,E as Q,x as V,a2 as _,a as g,S as G,P as J}from"./index-fkPGpu1p.js";import{u as W}from"./useHaptic-9bqCYA5r.js";import{S as X}from"./switch-B3DXLxZa.js";import{L as Y}from"./label-DSPKJeUh.js";import{A as R,m as S}from"./animation-DZFErbwn.js";import{L as Z}from"./jspdf.es.min-CXUKU6cu.js";import{I as ee}from"./input-JyldaYdw.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=T("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);function ue({open:h,onOpenChange:C,onScan:k,onBatchScan:d}){const[D,o]=a.useState(!1),[x,m]=a.useState(null),[c,n]=a.useState(null),[p,v]=a.useState(!1),i=a.useRef(null),b="barcode-reader",{trigger:N}=W(),[u,r]=a.useState(!1),[s,f]=a.useState([]);a.useEffect(()=>(h&&!i.current&&!p&&w(),()=>{I()}),[h,p]),a.useEffect(()=>{h&&(f([]),r(!1))},[h]);const j=async()=>{try{return(await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})).getTracks().forEach(l=>l.stop()),!0}catch(t){return console.error("Error requesting camera permission:",t),t instanceof DOMException&&(t.name==="NotAllowedError"||t.name==="PermissionDeniedError"?(v(!0),n("Permisos de cámara denegados. Por favor, habilita los permisos en la configuración de tu navegador.")):n("Error al acceder a la cámara. Intenta nuevamente.")),!1}},w=async()=>{try{if(n(null),!await j())return;const l=new z(b);i.current=l;const L={fps:15,qrbox:{width:280,height:280},aspectRatio:1,experimentalFeatures:{useBarCodeDetectorIfSupported:!0}};await l.start({facingMode:"environment"},L,P=>{M(P)},()=>{}),o(!0)}catch(t){console.error("Error starting scanner:",t),n("Error al iniciar la cámara."),F.error("Error al iniciar la cámara")}},I=async()=>{if(i.current)try{i.current.isScanning&&await i.current.stop(),i.current.clear()}catch(t){console.error("Error stopping scanner:",t)}finally{i.current=null,o(!1)}},M=t=>{u&&s.length>0&&s[s.length-1],N("success"),u?(f(l=>[t,...l]),m(t),setTimeout(()=>m(null),1e3)):(m(t),setTimeout(()=>{k(t),E()},800))},E=async()=>{await I(),m(null),n(null),v(!1),C(!1)},A=()=>{d&&d(s),E()},B=t=>{f(l=>l.filter((L,P)=>P!==t))};return e.jsx(H,{open:h,onOpenChange:E,children:e.jsxs(O,{className:"sm:max-w-[500px] max-h-[90vh] flex flex-col p-0 gap-0 overflow-hidden",children:[e.jsxs(q,{className:"p-4 pb-2",children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-primary"}),"Escanear Código"]}),e.jsx($,{children:c?"Error de cámara":"Apunta al código de barras"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pt-0 space-y-4",children:[!c&&e.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-black min-h-[250px] shrink-0",children:[e.jsx("div",{id:b,className:"w-full"}),e.jsx(R,{children:x&&e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-success/80 flex items-center justify-center z-10",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{className:"font-mono font-bold",children:x})]})})})]}),e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(Y,{htmlFor:"batch-mode",className:"cursor-pointer",children:"Modo Ráfaga"})]}),e.jsx(X,{id:"batch-mode",checked:u,onCheckedChange:r})]}),u&&s.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Items Escaneados (",s.length,")"]}),e.jsx(y,{variant:"ghost",size:"sm",className:"h-6 text-xs text-destructive",onClick:()=>f([]),children:"Limpiar"})]}),e.jsx("div",{className:"max-h-[150px] overflow-y-auto space-y-1 border rounded-md p-2 bg-background",children:s.map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between text-sm p-1 hover:bg-muted rounded",children:[e.jsx("span",{className:"font-mono",children:t}),e.jsx(y,{variant:"ghost",size:"icon",className:"h-6 w-6 text-muted-foreground hover:text-destructive",onClick:()=>B(l),children:e.jsx(Q,{className:"w-3 h-3"})})]},l))})]}),c&&e.jsxs("div",{className:"p-4 bg-destructive/10 text-destructive rounded-lg text-sm",children:[c,e.jsx(y,{onClick:()=>w(),variant:"outline",size:"sm",className:"mt-2 w-full",children:"Reintentar"})]})]}),e.jsxs(V,{className:"p-4 pt-2 border-t bg-muted/20 flex-row gap-2 sm:justify-end",children:[e.jsx(y,{variant:"outline",onClick:E,className:"flex-1 sm:flex-none",children:"Cancelar"}),u&&e.jsxs(y,{onClick:A,disabled:s.length===0,className:"flex-1 sm:flex-none",children:["Procesar (",s.length,")"]})]})]})})}function fe({onSelect:h,placeholder:C="Buscar producto por nombre o EAN...",className:k}){const[d,D]=a.useState(""),[o,x]=a.useState([]),[m,c]=a.useState(!1),[n,p]=a.useState(0),v=a.useRef(null),i=a.useRef(null);a.useEffect(()=>{const r=setTimeout(async()=>{if(d.trim().length>=2)try{const s=await _(d,8);x(s),c(s.length>0),p(0)}catch(s){console.error("Error searching products:",s),x([])}else x([]),c(!1)},300);return()=>clearTimeout(r)},[d]),a.useEffect(()=>{const r=s=>{var f;i.current&&!i.current.contains(s.target)&&!((f=v.current)!=null&&f.contains(s.target))&&c(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const b=r=>{if(!(!m||o.length===0))switch(r.key){case"ArrowDown":r.preventDefault(),p(s=>(s+1)%o.length);break;case"ArrowUp":r.preventDefault(),p(s=>(s-1+o.length)%o.length);break;case"Enter":r.preventDefault(),o[n]&&N(o[n]);break;case"Escape":c(!1);break}},N=r=>{var s;h(r),D(""),x([]),c(!1),(s=v.current)==null||s.blur()},u=(r,s)=>s.trim()?r.split(new RegExp(`(${s})`,"gi")).map((j,w)=>j.toLowerCase()===s.toLowerCase()?e.jsx("mark",{className:"bg-primary/20 text-primary font-semibold",children:j},w):j):r;return e.jsxs("div",{className:g("relative",k),children:[e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx(ee,{ref:v,type:"text",value:d,onChange:r=>D(r.target.value),onKeyDown:b,onFocus:()=>{o.length>0&&c(!0)},placeholder:C,className:"pl-10 pr-4"})]}),e.jsx(R,{children:m&&o.length>0&&e.jsxs(S.div,{ref:i,initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"absolute z-50 w-full mt-2 bg-card border border-border rounded-lg shadow-lg elevation-3 max-h-[400px] overflow-y-auto",children:[e.jsx("div",{className:"p-2 space-y-1",children:o.map((r,s)=>e.jsx(S.button,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:s*.05},onClick:()=>N(r),onMouseEnter:()=>p(s),className:g("w-full text-left p-3 rounded-lg transition-colors","hover:bg-primary hover:text-primary-foreground","focus:outline-none focus:ring-2 focus:ring-ring",n===s&&"bg-primary text-primary-foreground"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:g("p-2 rounded-lg flex-shrink-0",n===s?"bg-primary-foreground/20":"bg-muted"),children:e.jsx(J,{className:g("w-5 h-5",n===s?"text-primary-foreground":"text-muted-foreground")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:u(r.name,d)}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:g("text-xs font-mono",n===s?"text-primary-foreground/80":"text-muted-foreground"),children:["EAN: ",u(r.ean,d)]}),r.salePrice>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:g("text-xs",n===s?"text-primary-foreground/60":"text-muted-foreground"),children:"•"}),e.jsxs("span",{className:g("text-xs font-semibold",n===s?"text-primary-foreground/80":"text-muted-foreground"),children:["$",r.salePrice.toLocaleString()]})]})]})]})]})},r.ean))}),e.jsx("div",{className:"border-t border-border p-2 bg-muted/30",children:e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Usa ↑↓ para navegar, Enter para seleccionar"})})]})}),m&&d.trim().length>=2&&o.length===0&&e.jsx(S.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"absolute z-50 w-full mt-2 bg-card border border-border rounded-lg shadow-lg p-4",children:e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"No se encontraron productos"})})]})}export{ue as B,se as C,fe as P};
