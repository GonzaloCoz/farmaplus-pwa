import{j as e,G as ge,V as ye,H as te,J as je,K as re,M as ae,N as be,Q as se,U as ve,W as oe,X as ne,Y as Ne,Z as we,_ as le}from"./ui-vendor-BshHF3Zg.js";import{r as l,g as Se,u as ke}from"./react-vendor-DdjUaGoS.js";import{c as y,p as f,B as u,D as Ce,h as _e,i as Ee,j as Oe,o as Te,u as x,V as De}from"./index-ByIwQOx7.js";import{I as X}from"./input-BB9T6pAr.js";import{L as Pe}from"./label-vb4M4ftU.js";import{a as Re}from"./JsBarcode-B9pOLHC9.js";import{p as Be}from"./chart-vendor-NOlrPRrG.js";import{T as Me,a as He,b as Q,c as T,d as Le,e as D}from"./table-BCn09s9U.js";import{C as Ie}from"./check-Cwx34Vh9.js";import{B as ze}from"./badge-D5F2dDZQ.js";import{m as Ve}from"./animation-jqafwDaF.js";import{A as Ae}from"./arrow-left-Cb1re84Y.js";import{S as W}from"./search-DYWPmiNU.js";import"./utils-CUsTgaRG.js";import"./excel-uoQkVabA.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=y("Barcode",[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=y("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=y("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=y("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=y("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),R="barcode-history",$e=8,qe=()=>{const[r,t]=l.useState([]);return l.useEffect(()=>{const i=localStorage.getItem(R);if(i)try{t(JSON.parse(i))}catch(d){console.error("Error loading history:",d)}},[]),{history:r,addToHistory:i=>{const d={code:i,timestamp:Date.now()};t(w=>{const m=w.filter(S=>S.code!==i),p=[d,...m].slice(0,$e);return localStorage.setItem(R,JSON.stringify(p)),p})},clearHistory:()=>{t([]),localStorage.removeItem(R)}}};function N(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?N=function(s){return typeof s}:N=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},N(r)}var h=V(l),Je=V(Re),n=V(Be);function V(r){return r&&r.__esModule?r:{default:r}}function Ye(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function Ke(r,t){for(var s=0;s<t.length;s++){var o=t[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(r,o.key,o)}}function Xe(r,t,s){return t&&Ke(r.prototype,t),r}function Qe(r,t){return t&&(N(t)==="object"||typeof t=="function")?t:de(r)}function M(r){return M=Object.setPrototypeOf?Object.getPrototypeOf:function(s){return s.__proto__||Object.getPrototypeOf(s)},M(r)}function de(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function We(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),t&&H(r,t)}function H(r,t){return H=Object.setPrototypeOf||function(o,i){return o.__proto__=i,o},H(r,t)}var L,B=h.default.version.split(/[.-]/);B[0]==="0"&&(B[1]==="13"||B[1]==="12")?L=function(t){return t.getDOMNode()}:L=function(t){return t};var A=function(r){We(t,r);function t(s){var o;return Ye(this,t),o=Qe(this,M(t).call(this,s)),o.renderElementRef=h.default.createRef(),o.update=o.update.bind(de(o)),o}return Xe(t,[{key:"shouldComponentUpdate",value:function(o){var i=this;return Object.keys(t.propTypes).some(function(d){return i.props[d]!==o[d]})}},{key:"componentDidMount",value:function(){this.update()}},{key:"componentDidUpdate",value:function(){this.update()}},{key:"update",value:function(){var o=L(this.renderElementRef.current);try{new Je.default(o,this.props.value,Object.assign({text:this.props.text||this.props.value},this.props))}catch(i){window.console.error(i)}}},{key:"render",value:function(){var o=this.props,i=o.id,d=o.className;if(this.props.renderer==="svg")return h.default.createElement("svg",{ref:this.renderElementRef,id:i,className:d});if(this.props.renderer==="canvas")return h.default.createElement("canvas",{ref:this.renderElementRef,id:i,className:d});if(this.props.renderer==="img")return h.default.createElement("img",{ref:this.renderElementRef,id:i,className:d})}}]),t}(h.default.Component);A.propTypes={value:n.default.string.isRequired,text:n.default.string,renderer:n.default.string,format:n.default.string,width:n.default.number,height:n.default.number,displayValue:n.default.bool,fontOptions:n.default.string,font:n.default.string,textAlign:n.default.string,textPosition:n.default.string,textMargin:n.default.number,fontSize:n.default.number,background:n.default.string,lineColor:n.default.string,margin:n.default.number,marginTop:n.default.number,marginBottom:n.default.number,marginLeft:n.default.number,marginRight:n.default.number,id:n.default.string,className:n.default.string,ean128:n.default.bool};A.defaultProps={format:"CODE128",renderer:"svg",width:2,height:100,displayValue:!0,fontOptions:"",font:"monospace",textAlign:"center",textPosition:"bottom",textMargin:2,fontSize:20,background:"#ffffff",lineColor:"#000000",margin:10,className:"",ean128:!1};var Ze=A;const et=Se(Ze);function tt({value:r}){return e.jsx("div",{className:"flex justify-center",children:e.jsx(et,{value:r,format:"CODE128",width:2,height:80,displayValue:!0,fontOptions:"bold",fontSize:18,background:"transparent",lineColor:"hsl(var(--foreground))"})})}const Z=ge,ee=ye,I=l.forwardRef(({className:r,children:t,...s},o)=>e.jsxs(te,{ref:o,className:f("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...s,children:[t,e.jsx(je,{asChild:!0,children:e.jsx(ie,{className:"h-4 w-4 opacity-50"})})]}));I.displayName=te.displayName;const ce=l.forwardRef(({className:r,...t},s)=>e.jsx(re,{ref:s,className:f("flex cursor-default items-center justify-center py-1",r),...t,children:e.jsx(Ue,{className:"h-4 w-4"})}));ce.displayName=re.displayName;const me=l.forwardRef(({className:r,...t},s)=>e.jsx(ae,{ref:s,className:f("flex cursor-default items-center justify-center py-1",r),...t,children:e.jsx(ie,{className:"h-4 w-4"})}));me.displayName=ae.displayName;const z=l.forwardRef(({className:r,children:t,position:s="popper",...o},i)=>e.jsx(be,{children:e.jsxs(se,{ref:i,className:f("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:s,...o,children:[e.jsx(ce,{}),e.jsx(ve,{className:f("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(me,{})]})}));z.displayName=se.displayName;const rt=l.forwardRef(({className:r,...t},s)=>e.jsx(oe,{ref:s,className:f("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...t}));rt.displayName=oe.displayName;const g=l.forwardRef(({className:r,children:t,...s},o)=>e.jsxs(ne,{ref:o,className:f("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ne,{children:e.jsx(Ie,{className:"h-4 w-4"})})}),e.jsx(we,{children:t})]}));g.displayName=ne.displayName;const at=l.forwardRef(({className:r,...t},s)=>e.jsx(le,{ref:s,className:f("-mx-1 my-1 h-px bg-muted",r),...t}));at.displayName=le.displayName;function jt(){const r=ke(),[t,s]=l.useState([]),[o,i]=l.useState(!0),[d,w]=l.useState(""),[m,p]=l.useState("all"),[S,k]=l.useState(!1),[U,j]=l.useState(""),[C,G]=l.useState(""),[F,$]=l.useState(null),[ue,q]=l.useState(null),{history:_,addToHistory:fe,clearHistory:pe}=qe();l.useEffect(()=>{(async()=>{try{i(!0);const c=await De();s(c)}catch(c){console.error("Error loading products:",c),x.error("Error al cargar los productos")}finally{i(!1)}})()},[]);const J=l.useMemo(()=>{const a=new Set(t.map(c=>c.laboratory).filter(Boolean));return Array.from(a).sort()},[t]),b=l.useMemo(()=>t.filter(a=>{const c=d.toLowerCase(),v=a.name.toLowerCase().includes(c)||a.ean.includes(c),O=m==="all"||a.laboratory===m;return v&&O}),[t,d,m]),E=a=>{const c=a.trim();if(!c||!/^\d+$/.test(c)){x.error("Por favor, ingresa un código numérico válido.");return}const v=t.find(O=>O.ean===c);$(v?v.name:null),G(c),q(c)},Y=()=>{const a=U.trim();if(!a){x.error("El campo de código está vacío.");return}E(a),fe(a),x.success("Código de barras generado correctamente")},he=a=>{j(a),E(a)},K=()=>{j(""),G(""),$(null),q(null)},xe=a=>{j(a.ean),E(a.ean),k(!0)};return e.jsxs(Ve.div,{className:"flex flex-col h-full",initial:{opacity:0},animate:{opacity:1},transition:{duration:.4},children:[e.jsxs("header",{className:"sticky top-0 z-10 bg-background/95 backdrop-blur border-b px-4 h-16 flex items-center justify-between shrink-0 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>r(-1),className:"md:hidden",children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Productos"}),e.jsxs("p",{className:"text-xs text-muted-foreground hidden sm:block",children:[t.length," productos registrados"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 justify-end max-w-3xl",children:[e.jsx("div",{className:"hidden md:block w-48",children:e.jsxs(Z,{value:m,onValueChange:p,children:[e.jsx(I,{className:"h-9",children:e.jsx(ee,{placeholder:"Laboratorio"})}),e.jsxs(z,{children:[e.jsx(g,{value:"all",children:"Todos los laboratorios"}),J.map(a=>e.jsx(g,{value:a,children:a},a))]})]})}),e.jsxs("div",{className:"relative w-full max-w-xs sm:max-w-sm",children:[e.jsx(W,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(X,{type:"search",placeholder:"Buscar por nombre o EAN...",value:d,onChange:a=>w(a.target.value),className:"pl-9 h-9 bg-muted/50 border-0"})]}),e.jsxs(u,{variant:"secondary",size:"sm",className:"gap-2 flex-shrink-0",onClick:()=>k(!0),children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Generador"})]})]})]}),e.jsx("div",{className:"p-4 md:hidden bg-background border-b flex gap-2 overflow-x-auto",children:e.jsxs(Z,{value:m,onValueChange:p,children:[e.jsx(I,{className:"h-9 w-full",children:e.jsx(ee,{placeholder:"Filtrar por Laboratorio"})}),e.jsxs(z,{children:[e.jsx(g,{value:"all",children:"Todos los laboratorios"}),J.map(a=>e.jsx(g,{value:a,children:a},a))]})]})}),e.jsx("div",{className:"flex-1 overflow-auto p-4 sm:p-6",children:e.jsxs("div",{className:"border rounded-xl overflow-hidden bg-card shadow-sm",children:[o?e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center text-muted-foreground",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{children:"Cargando productos..."})]}):b.length>0?e.jsxs(Me,{children:[e.jsx(He,{className:"bg-muted/50",children:e.jsxs(Q,{children:[e.jsx(T,{className:"w-[140px]",children:"EAN"}),e.jsx(T,{children:"Producto"}),e.jsx(T,{className:"hidden md:table-cell",children:"Laboratorio"})]})}),e.jsx(Le,{children:b.slice(0,100).map(a=>e.jsxs(Q,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>xe(a),children:[e.jsx(D,{className:"font-mono text-primary font-medium",children:a.ean}),e.jsxs(D,{children:[e.jsx("div",{className:"font-medium",children:a.name}),e.jsx("div",{className:"md:hidden text-xs text-muted-foreground mt-1",children:a.laboratory||"Sin laboratorio"})]}),e.jsx(D,{className:"hidden md:table-cell",children:a.laboratory?e.jsx(ze,{variant:"outline",className:"font-normal",children:a.laboratory}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})})]},a.ean))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center text-muted-foreground",children:[e.jsx(W,{className:"w-12 h-12 mb-4 opacity-20"}),e.jsx("p",{children:"No se encontraron productos."}),m!=="all"&&e.jsx(u,{variant:"link",onClick:()=>p("all"),className:"mt-2",children:"Limpiar filtros"})]}),!o&&b.length>100&&e.jsx("div",{className:"p-4 text-center border-t bg-muted/20",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Mostrando 100 de ",b.length," resultados."]})})]})}),e.jsx(Ce,{open:S,onOpenChange:a=>{k(a),a||K()},children:e.jsxs(_e,{className:"sm:max-w-3xl p-0 max-h-[90vh] overflow-y-auto gap-0 rounded-xl",children:[e.jsxs(Ee,{className:"p-6 border-b bg-muted/30",children:[e.jsxs(Oe,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),"Generar EAN manualmente"]}),e.jsx(Te,{children:"Ingresa un código, selecciónalo del historial o haz clic en la tabla para generar."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-0 divide-y md:divide-y-0 md:divide-x",children:[e.jsx("div",{className:"p-6 flex flex-col justify-center items-center min-h-[300px] bg-background",children:C?e.jsxs("div",{id:"barcode-to-print",className:"w-full text-center space-y-6",children:[e.jsx("div",{children:F?e.jsx("h3",{className:"text-lg font-semibold leading-tight",children:F}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Producto no encontrado en la base de datos."})}),e.jsx("div",{className:"p-4 bg-white rounded-lg inline-block shadow-sm border",children:e.jsx(tt,{value:C})}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsxs(u,{size:"sm",variant:"outline",onClick:async()=>{await navigator.clipboard.writeText(C),x.success("Código copiado")},children:[e.jsx(Ge,{className:"w-4 h-4 mr-2"})," Copiar"]}),e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>window.print(),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"})," Imprimir"]})]})]}):e.jsxs("div",{className:"text-center space-y-2 text-muted-foreground",children:[e.jsx(P,{className:"w-12 h-12 mx-auto opacity-20"}),e.jsx("p",{children:"Selecciona un producto o ingresa un código"})]})}),e.jsxs("div",{className:"p-6 bg-muted/10 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"}),"Historial Reciente"]}),_.length>0&&e.jsx(u,{variant:"ghost",size:"sm",onClick:pe,className:"h-6 text-xs text-muted-foreground hover:text-destructive px-2",children:"Borrar todo"})]}),_.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-[250px] overflow-y-auto pr-2",children:_.slice(0,8).map(a=>e.jsxs("button",{onClick:()=>he(a.code),className:`text-left px-3 py-2 rounded-md text-sm font-mono transition-colors flex items-center justify-between group ${ue===a.code?"bg-primary text-primary-foreground":"bg-background border hover:border-primary/50"}`,children:[e.jsx("span",{children:a.code}),e.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-[10px]",children:new Date(a.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},a.timestamp))}):e.jsx("div",{className:"text-center py-10 text-xs text-muted-foreground border-2 border-dashed rounded-lg",children:"Sin historial reciente"})]})]}),e.jsx("div",{className:"p-6 bg-muted/30 border-t",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1 w-full",children:[e.jsx(Pe,{htmlFor:"ean-code",children:"Código manual"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(X,{id:"ean-code",value:U,onChange:a=>j(a.target.value.replace(/\D/g,"")),onKeyDown:a=>{a.key==="Enter"&&Y()},placeholder:"Ej: 7791234567890",className:"font-mono"}),e.jsx(u,{onClick:Y,children:"Generar"})]})]}),e.jsx(u,{variant:"ghost",onClick:K,children:"Limpiar"})]})})]})})]})}export{jt as default};
