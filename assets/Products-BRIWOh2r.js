import{j as e}from"./ui-vendor-CMKjsfuk.js";import{r as l,g as Q,u as W}from"./react-vendor-C2WMxTOF.js";import{c as M,S as Z,B as m,p as ee,q as te,r as re,s as ae,_ as ne,E as p,t as oe}from"./index-ByHsDfok.js";import{I as se}from"./input-CYgORuOT.js";import{L as ie}from"./label-DYURCGEr.js";import{a as le}from"./JsBarcode-qaDSE1cv.js";import{p as de}from"./chart-vendor-B_NJQ0vx.js";import{P as ce}from"./ProductImageHover-JqG4ALSR.js";import{T as ue,a as me,b as V,c as C,d as fe,e as _}from"./table-BsvqpL9J.js";import{B as pe}from"./badge-Ck-z6OjO.js";import{m as he}from"./animation-DioOyNca.js";import"./utils-CUsTgaRG.js";import"./excel-uoQkVabA.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=M("Barcode",[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=M("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=M("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),E="barcode-history",ye=8,be=()=>{const[a,t]=l.useState([]);return l.useEffect(()=>{const i=localStorage.getItem(E);if(i)try{t(JSON.parse(i))}catch(c){console.error("Error loading history:",c)}},[]),{history:a,addToHistory:i=>{const c={code:i,timestamp:Date.now()};t(u=>{const j=u.filter(x=>x.code!==i),h=[c,...j].slice(0,ye);return localStorage.setItem(E,JSON.stringify(h)),h})},clearHistory:()=>{t([]),localStorage.removeItem(E)}}};function v(a){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?v=function(o){return typeof o}:v=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},v(a)}var f=H(l),ve=H(le),s=H(de);function H(a){return a&&a.__esModule?a:{default:a}}function je(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function Ne(a,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function we(a,t,o){return t&&Ne(a.prototype,t),a}function Se(a,t){return t&&(v(t)==="object"||typeof t=="function")?t:q(a)}function P(a){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},P(a)}function q(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function ke(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(t&&t.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),t&&T(a,t)}function T(a,t){return T=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},T(a,t)}var D,O=f.default.version.split(/[.-]/);O[0]==="0"&&(O[1]==="13"||O[1]==="12")?D=function(t){return t.getDOMNode()}:D=function(t){return t};var B=function(a){ke(t,a);function t(o){var n;return je(this,t),n=Se(this,P(t).call(this,o)),n.renderElementRef=f.default.createRef(),n.update=n.update.bind(q(n)),n}return we(t,[{key:"shouldComponentUpdate",value:function(n){var i=this;return Object.keys(t.propTypes).some(function(c){return i.props[c]!==n[c]})}},{key:"componentDidMount",value:function(){this.update()}},{key:"componentDidUpdate",value:function(){this.update()}},{key:"update",value:function(){var n=D(this.renderElementRef.current);try{new ve.default(n,this.props.value,Object.assign({text:this.props.text||this.props.value},this.props))}catch(i){window.console.error(i)}}},{key:"render",value:function(){var n=this.props,i=n.id,c=n.className;if(this.props.renderer==="svg")return f.default.createElement("svg",{ref:this.renderElementRef,id:i,className:c});if(this.props.renderer==="canvas")return f.default.createElement("canvas",{ref:this.renderElementRef,id:i,className:c});if(this.props.renderer==="img")return f.default.createElement("img",{ref:this.renderElementRef,id:i,className:c})}}]),t}(f.default.Component);B.propTypes={value:s.default.string.isRequired,text:s.default.string,renderer:s.default.string,format:s.default.string,width:s.default.number,height:s.default.number,displayValue:s.default.bool,fontOptions:s.default.string,font:s.default.string,textAlign:s.default.string,textPosition:s.default.string,textMargin:s.default.number,fontSize:s.default.number,background:s.default.string,lineColor:s.default.string,margin:s.default.number,marginTop:s.default.number,marginBottom:s.default.number,marginLeft:s.default.number,marginRight:s.default.number,id:s.default.string,className:s.default.string,ean128:s.default.bool};B.defaultProps={format:"CODE128",renderer:"svg",width:2,height:100,displayValue:!0,fontOptions:"",font:"monospace",textAlign:"center",textPosition:"bottom",textMargin:2,fontSize:20,background:"#ffffff",lineColor:"#000000",margin:10,className:"",ean128:!1};var Ce=B;const _e=Q(Ce);function Ee({value:a}){return e.jsx("div",{className:"flex justify-center",children:e.jsx(_e,{value:a,format:"CODE128",width:2,height:80,displayValue:!0,fontOptions:"bold",fontSize:18,background:"transparent",lineColor:"hsl(var(--foreground))"})})}function Fe(){W();const[a,t]=l.useState([]),[o,n]=l.useState(!0),[i,c]=l.useState(""),[u,j]=l.useState("all"),[h,x]=l.useState(!1),[R,g]=l.useState(""),[N,I]=l.useState(""),[L,z]=l.useState(null),[U,A]=l.useState(null),{history:w,addToHistory:J,clearHistory:Y}=be();l.useEffect(()=>{(async()=>{try{n(!0);const d=await oe();t(d)}catch(d){console.error("Error loading products:",d),p.error("Error al cargar los productos")}finally{n(!1)}})()},[]),l.useMemo(()=>{const r=new Set(a.map(d=>d.laboratory).filter(Boolean));return Array.from(r).sort()},[a]);const y=l.useMemo(()=>a.filter(r=>{const d=i.toLowerCase(),b=r.name.toLowerCase().includes(d)||r.ean.includes(d),k=u==="all"||r.laboratory===u;return b&&k}),[a,i,u]),S=r=>{const d=r.trim();if(!d||!/^\d+$/.test(d)){p.error("Por favor, ingresa un código numérico válido.");return}const b=a.find(k=>k.ean===d);z(b?b.name:null),I(d),A(d)},G=()=>{const r=R.trim();if(!r){p.error("El campo de código está vacío.");return}S(r),J(r),p.success("Código de barras generado correctamente")},K=r=>{g(r),S(r)},F=()=>{g(""),I(""),z(null),A(null)},X=r=>{g(r.ean),S(r.ean),x(!0)};return e.jsxs(he.div,{className:"flex flex-col h-full",initial:{opacity:0},animate:{opacity:1},transition:{duration:.4},children:[e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("div",{className:"border rounded-xl overflow-hidden bg-card shadow-sm",children:[o?e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center text-muted-foreground",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{children:"Cargando productos..."})]}):y.length>0?e.jsxs(ue,{children:[e.jsx(me,{className:"bg-muted/50",children:e.jsxs(V,{children:[e.jsx(C,{className:"w-[140px]",children:"EAN"}),e.jsx(C,{children:"Producto"}),e.jsx(C,{className:"hidden md:table-cell",children:"Laboratorio"})]})}),e.jsx(fe,{children:y.slice(0,100).map(r=>e.jsxs(V,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>X(r),children:[e.jsx(_,{className:"font-mono text-primary font-medium",children:r.ean}),e.jsxs(_,{children:[e.jsx(ce,{ean:r.ean,name:r.name,children:e.jsx("div",{className:"font-medium hover:underline decoration-dotted underline-offset-4 w-fit",children:r.name})}),e.jsx("div",{className:"md:hidden text-xs text-muted-foreground mt-1",children:r.laboratory||"Sin laboratorio"})]}),e.jsx(_,{className:"hidden md:table-cell",children:r.laboratory?e.jsx(pe,{variant:"outline",className:"font-normal",children:r.laboratory}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})})]},r.ean))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center text-muted-foreground",children:[e.jsx(Z,{className:"w-12 h-12 mb-4 opacity-20"}),e.jsx("p",{children:"No se encontraron productos."}),u!=="all"&&e.jsx(m,{variant:"link",onClick:()=>j("all"),className:"mt-2",children:"Limpiar filtros"})]}),!o&&y.length>100&&e.jsx("div",{className:"p-4 text-center border-t bg-muted/20",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Mostrando 100 de ",y.length," resultados."]})})]})}),e.jsx(ee,{open:h,onOpenChange:r=>{x(r),r||F()},children:e.jsxs(te,{className:"sm:max-w-3xl p-0 max-h-[90vh] overflow-y-auto gap-0 rounded-xl",children:[e.jsxs(re,{className:"p-6 border-b bg-muted/30",children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5"}),"Generar EAN manualmente"]}),e.jsx(ne,{children:"Ingresa un código, selecciónalo del historial o haz clic en la tabla para generar."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-0 divide-y md:divide-y-0 md:divide-x",children:[e.jsx("div",{className:"p-6 flex flex-col justify-center items-center min-h-[300px] bg-background",children:N?e.jsxs("div",{id:"barcode-to-print",className:"w-full text-center space-y-6",children:[e.jsx("div",{children:L?e.jsx("h3",{className:"text-lg font-semibold leading-tight",children:L}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Producto no encontrado en la base de datos."})}),e.jsx("div",{className:"p-4 bg-white rounded-lg inline-block shadow-sm border",children:e.jsx(Ee,{value:N})}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsxs(m,{size:"sm",variant:"outline",onClick:async()=>{await navigator.clipboard.writeText(N),p.success("Código copiado")},children:[e.jsx(xe,{className:"w-4 h-4 mr-2"})," Copiar"]}),e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>window.print(),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"})," Imprimir"]})]})]}):e.jsxs("div",{className:"text-center space-y-2 text-muted-foreground",children:[e.jsx($,{className:"w-12 h-12 mx-auto opacity-20"}),e.jsx("p",{children:"Selecciona un producto o ingresa un código"})]})}),e.jsxs("div",{className:"p-6 bg-muted/10 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"}),"Historial Reciente"]}),w.length>0&&e.jsx(m,{variant:"ghost",size:"sm",onClick:Y,className:"h-6 text-xs text-muted-foreground hover:text-destructive px-2",children:"Borrar todo"})]}),w.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-[250px] overflow-y-auto pr-2",children:w.slice(0,8).map(r=>e.jsxs("button",{onClick:()=>K(r.code),className:`text-left px-3 py-2 rounded-md text-sm font-mono transition-colors flex items-center justify-between group ${U===r.code?"bg-primary text-primary-foreground":"bg-background border hover:border-primary/50"}`,children:[e.jsx("span",{children:r.code}),e.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-[10px]",children:new Date(r.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},r.timestamp))}):e.jsx("div",{className:"text-center py-10 text-xs text-muted-foreground border-2 border-dashed rounded-lg",children:"Sin historial reciente"})]})]}),e.jsx("div",{className:"p-6 bg-muted/30 border-t",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1 w-full",children:[e.jsx(ie,{htmlFor:"ean-code",children:"Código manual"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(se,{id:"ean-code",value:R,onChange:r=>g(r.target.value.replace(/\D/g,"")),onKeyDown:r=>{r.key==="Enter"&&G()},placeholder:"Ej: 7791234567890",className:"font-mono"}),e.jsx(m,{onClick:G,children:"Generar"})]})]}),e.jsx(m,{variant:"ghost",onClick:F,children:"Limpiar"})]})})]})})]})}export{Fe as default};
