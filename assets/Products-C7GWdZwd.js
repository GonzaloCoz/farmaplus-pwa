import{j as e}from"./ui-vendor-DWmIoBIJ.js";import{r as c,g as be,u as ve}from"./react-vendor-ylmX0jv_.js";import{c as oe,P as je,B as h,U as Ne,S as we,t as Se,v as Ce,w as Ee,x as ke,_ as Pe,r as p,a4 as te,a5 as _e}from"./index-DbwJGGea.js";import{I as re}from"./input-BacYCGan.js";import{L as Oe}from"./label-DGYK63qN.js";import{a as De}from"./JsBarcode-BPRqDEDi.js";import{p as Te}from"./chart-vendor-Cu80epCr.js";import{P as He}from"./ProductImageHover-B981mXyv.js";import{r as Be,u as Le}from"./excel-uoQkVabA.js";import{T as Me,a as Re,b as ae,c as B,d as Ie,e as L}from"./table-DEno13cP.js";import{B as ze}from"./badge-DKLc_DLM.js";import{B as M}from"./barcode-C6sBs6zs.js";import"./utils-CUsTgaRG.js";import"./animation-Ch0GoCcm.js";import"./loader-circle-wQrOqgPS.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=oe("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=oe("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),R="barcode-history",Fe=8,Ge=()=>{const[a,r]=c.useState([]);return c.useEffect(()=>{const i=localStorage.getItem(R);if(i)try{r(JSON.parse(i))}catch(d){console.error("Error loading history:",d)}},[]),{history:a,addToHistory:i=>{const d={code:i,timestamp:Date.now()};r(y=>{const _=y.filter(v=>v.code!==i),N=[d,..._].slice(0,Fe);return localStorage.setItem(R,JSON.stringify(N)),N})},clearHistory:()=>{r([]),localStorage.removeItem(R)}}};function P(a){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?P=function(s){return typeof s}:P=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},P(a)}var b=F(c),$e=F(De),n=F(Te);function F(a){return a&&a.__esModule?a:{default:a}}function Je(a,r){if(!(a instanceof r))throw new TypeError("Cannot call a class as a function")}function Ve(a,r){for(var s=0;s<r.length;s++){var o=r[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(a,o.key,o)}}function qe(a,r,s){return r&&Ve(a.prototype,r),a}function Ye(a,r){return r&&(P(r)==="object"||typeof r=="function")?r:se(a)}function z(a){return z=Object.setPrototypeOf?Object.getPrototypeOf:function(s){return s.__proto__||Object.getPrototypeOf(s)},z(a)}function se(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Ke(a,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(r&&r.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),r&&A(a,r)}function A(a,r){return A=Object.setPrototypeOf||function(o,i){return o.__proto__=i,o},A(a,r)}var U,I=b.default.version.split(/[.-]/);I[0]==="0"&&(I[1]==="13"||I[1]==="12")?U=function(r){return r.getDOMNode()}:U=function(r){return r};var G=function(a){Ke(r,a);function r(s){var o;return Je(this,r),o=Ye(this,z(r).call(this,s)),o.renderElementRef=b.default.createRef(),o.update=o.update.bind(se(o)),o}return qe(r,[{key:"shouldComponentUpdate",value:function(o){var i=this;return Object.keys(r.propTypes).some(function(d){return i.props[d]!==o[d]})}},{key:"componentDidMount",value:function(){this.update()}},{key:"componentDidUpdate",value:function(){this.update()}},{key:"update",value:function(){var o=U(this.renderElementRef.current);try{new $e.default(o,this.props.value,Object.assign({text:this.props.text||this.props.value},this.props))}catch(i){window.console.error(i)}}},{key:"render",value:function(){var o=this.props,i=o.id,d=o.className;if(this.props.renderer==="svg")return b.default.createElement("svg",{ref:this.renderElementRef,id:i,className:d});if(this.props.renderer==="canvas")return b.default.createElement("canvas",{ref:this.renderElementRef,id:i,className:d});if(this.props.renderer==="img")return b.default.createElement("img",{ref:this.renderElementRef,id:i,className:d})}}]),r}(b.default.Component);G.propTypes={value:n.default.string.isRequired,text:n.default.string,renderer:n.default.string,format:n.default.string,width:n.default.number,height:n.default.number,displayValue:n.default.bool,fontOptions:n.default.string,font:n.default.string,textAlign:n.default.string,textPosition:n.default.string,textMargin:n.default.number,fontSize:n.default.number,background:n.default.string,lineColor:n.default.string,margin:n.default.number,marginTop:n.default.number,marginBottom:n.default.number,marginLeft:n.default.number,marginRight:n.default.number,id:n.default.string,className:n.default.string,ean128:n.default.bool};G.defaultProps={format:"CODE128",renderer:"svg",width:2,height:100,displayValue:!0,fontOptions:"",font:"monospace",textAlign:"center",textPosition:"bottom",textMargin:2,fontSize:20,background:"#ffffff",lineColor:"#000000",margin:10,className:"",ean128:!1};var Qe=G;const Xe=be(Qe);function We({value:a}){return e.jsx("div",{className:"flex justify-center",children:e.jsx(Xe,{value:a,format:"CODE128",width:2,height:80,displayValue:!0,fontOptions:"bold",fontSize:18,background:"transparent",lineColor:"#000000"})})}function xt(){ve();const[a,r]=c.useState([]),[s,o]=c.useState(!0),[i,d]=c.useState(""),[y,_]=c.useState("all"),[N,v]=c.useState(!1),[$,w]=c.useState(""),[O,J]=c.useState(""),[V,q]=c.useState(null),[ne,Y]=c.useState(null),{history:D,addToHistory:ie,clearHistory:le}=Ge();c.useEffect(()=>{(async()=>{try{o(!0);const l=await te();r(l)}catch(l){console.error("Error loading products:",l),p.error("Error al cargar los productos")}finally{o(!1)}})()},[]),c.useMemo(()=>{const t=new Set(a.map(l=>l.laboratory).filter(Boolean));return Array.from(t).sort()},[a]);const S=c.useMemo(()=>a.filter(t=>{const l=i.toLowerCase(),x=t.name.toLowerCase().includes(l)||t.ean.includes(l),m=y==="all"||t.laboratory===y;return x&&m}),[a,i,y]),T=t=>{const l=t.trim();if(!l||!/^\d+$/.test(l)){p.error("Por favor, ingresa un código numérico válido.");return}const x=a.find(m=>m.ean===l);q(x?x.name:null),J(l),Y(l)},K=()=>{const t=$.trim();if(!t){p.error("El campo de código está vacío.");return}T(t),ie(t),p.success("Código de barras generado correctamente")},ce=t=>{w(t),T(t)},Q=()=>{w(""),J(""),q(null),Y(null)},de=t=>{w(t.ean),T(t.ean),v(!0)},ue=async t=>{var x;const l=(x=t.target.files)==null?void 0:x[0];if(l)try{o(!0);const m=new FileReader;m.onload=async me=>{var X;try{const C=(X=me.target)==null?void 0:X.result,W=Be(C,{type:"binary"}),fe=W.SheetNames[0],he=W.Sheets[fe],Z=Le.sheet_to_json(he,{header:"A"}),ee=[];for(let f=1;f<Z.length;f++){const u=Z[f],g=u.D,k=u.Q;if(!g||!k)continue;const pe=String(g).trim(),xe=u.O?String(u.O).trim():void 0,ge=u.J?String(u.J).trim().toUpperCase():void 0,ye=u.L?Number(u.L):0;String(k).trim().split("-").map(j=>j.trim()).filter(j=>j.length>0).forEach(j=>{ee.push({ean:j,name:pe,laboratory:xe,category:ge,cost:ye,salePrice:0,stock:0})})}const H=new Map;ee.forEach(f=>{H.has(f.ean)||H.set(f.ean,f)});const E=Array.from(H.values());if(E.length>0){for(let g=0;g<E.length;g+=1e3){const k=E.slice(g,g+1e3);await _e(k)}p.success(`${E.length} productos actualizados correctamente.`);const u=await te();r(u)}else p.warning("No se encontraron productos válidos en el archivo.")}catch(C){console.error("Error processing file:",C),p.error(`Error: ${C.message||"Error desconocido al procesar el archivo"}`)}finally{o(!1),t.target.value=""}},m.readAsBinaryString(l)}catch(m){console.error("Upload error:",m),o(!1)}};return e.jsxs(je,{children:[e.jsxs("div",{className:"flex justify-end gap-2 mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(h,{variant:"outline",disabled:s,onClick:()=>{var t;return(t=document.getElementById("product-upload"))==null?void 0:t.click()},children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),s?"Cargando...":"Importar Excel"]}),e.jsx(re,{id:"product-upload",type:"file",accept:".xlsx, .xls",className:"hidden",onChange:ue,disabled:s})]}),e.jsxs(h,{onClick:()=>v(!0),children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Generar EAN"]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"border rounded-xl overflow-hidden bg-card shadow-sm",children:[s?e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center text-muted-foreground",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{children:"Cargando productos..."})]}):S.length>0?e.jsxs(Me,{children:[e.jsx(Re,{className:"bg-muted/50",children:e.jsxs(ae,{children:[e.jsx(B,{className:"w-[140px]",children:"EAN"}),e.jsx(B,{children:"Producto"}),e.jsx(B,{className:"hidden md:table-cell",children:"Laboratorio"})]})}),e.jsx(Ie,{children:S.slice(0,100).map(t=>e.jsxs(ae,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>de(t),children:[e.jsx(L,{className:"font-mono text-primary font-medium",children:t.ean}),e.jsxs(L,{children:[e.jsx(He,{ean:t.ean,name:t.name,children:e.jsx("div",{className:"font-medium hover:underline decoration-dotted underline-offset-4 w-fit",children:t.name})}),e.jsx("div",{className:"md:hidden text-xs text-muted-foreground mt-1",children:t.laboratory||"Sin laboratorio"})]}),e.jsx(L,{className:"hidden md:table-cell",children:t.laboratory?e.jsx(ze,{variant:"outline",className:"font-normal",children:t.laboratory}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})})]},t.ean))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center text-muted-foreground",children:[e.jsx(we,{className:"w-12 h-12 mb-4 opacity-20"}),e.jsx("p",{children:"No se encontraron productos."}),y!=="all"&&e.jsx(h,{variant:"link",onClick:()=>_("all"),className:"mt-2",children:"Limpiar filtros"})]}),!s&&S.length>100&&e.jsx("div",{className:"p-4 text-center border-t bg-muted/20",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Mostrando 100 de ",S.length," resultados."]})})]})}),e.jsx(Se,{open:N,onOpenChange:t=>{v(t),t||Q()},children:e.jsxs(Ce,{className:"sm:max-w-3xl p-0 max-h-[90vh] overflow-y-auto gap-0 rounded-xl",children:[e.jsxs(Ee,{className:"p-6 border-b bg-muted/30",children:[e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Generar EAN manualmente"]}),e.jsx(Pe,{children:"Ingresa un código, selecciónalo del historial o haz clic en la tabla para generar."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-0 divide-y md:divide-y-0 md:divide-x",children:[e.jsx("div",{className:"p-6 flex flex-col justify-center items-center min-h-[300px] bg-background",children:O?e.jsxs("div",{id:"barcode-to-print",className:"w-full text-center space-y-6",children:[e.jsx("div",{children:V?e.jsx("h3",{className:"text-lg font-semibold leading-tight",children:V}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Producto no encontrado en la base de datos."})}),e.jsx("div",{className:"p-4 bg-white rounded-lg inline-block shadow-sm border",children:e.jsx(We,{value:O})}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsxs(h,{size:"sm",variant:"outline",onClick:async()=>{await navigator.clipboard.writeText(O),p.success("Código copiado")},children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"})," Copiar"]}),e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>window.print(),children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"})," Imprimir"]})]})]}):e.jsxs("div",{className:"text-center space-y-2 text-muted-foreground",children:[e.jsx(M,{className:"w-12 h-12 mx-auto opacity-20"}),e.jsx("p",{children:"Selecciona un producto o ingresa un código"})]})}),e.jsxs("div",{className:"p-6 bg-muted/10 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"}),"Historial Reciente"]}),D.length>0&&e.jsx(h,{variant:"ghost",size:"sm",onClick:le,className:"h-6 text-xs text-muted-foreground hover:text-destructive px-2",children:"Borrar todo"})]}),D.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-[250px] overflow-y-auto pr-2",children:D.slice(0,8).map(t=>e.jsxs("button",{onClick:()=>ce(t.code),className:`text-left px-3 py-2 rounded-md text-sm font-mono transition-colors flex items-center justify-between group ${ne===t.code?"bg-primary text-primary-foreground":"bg-background border hover:border-primary/50"}`,children:[e.jsx("span",{children:t.code}),e.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-[10px]",children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},t.timestamp))}):e.jsx("div",{className:"text-center py-10 text-xs text-muted-foreground border-2 border-dashed rounded-lg",children:"Sin historial reciente"})]})]}),e.jsx("div",{className:"p-6 bg-muted/30 border-t",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1 w-full",children:[e.jsx(Oe,{htmlFor:"ean-code",children:"Código manual"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(re,{id:"ean-code",value:$,onChange:t=>w(t.target.value.replace(/\D/g,"")),onKeyDown:t=>{t.key==="Enter"&&K()},placeholder:"Ej: 7791234567890",className:"font-mono"}),e.jsx(h,{onClick:K,children:"Generar"})]})]}),e.jsx(h,{variant:"ghost",onClick:Q,children:"Limpiar"})]})})]})})]})}export{xt as default};
