import{j as e,G as ge,V as ye,H as te,J as je,K as re,M as ae,N as be,Q as se,U as ve,W as oe,X as ne,Y as Ne,Z as we,_ as le}from"./ui-vendor-B9YtwGJ-.js";import{r as l,g as Se,u as ke}from"./react-vendor-DdjUaGoS.js";import{c as y,o as f,B as u,D as Ce,h as _e,i as Ee,j as Pe,N as Oe,v as x,V as Te}from"./index-CfsGIlE1.js";import{I as X}from"./input-BNQlWmVc.js";import{L as De}from"./label-BY2Z0kLh.js";import{a as Re}from"./JsBarcode-B9pOLHC9.js";import{p as Be}from"./chart-vendor-NOlrPRrG.js";import{P as Me}from"./ProductImageHover-CvH0flXy.js";import{T as He,a as Ie,b as Q,c as O,d as Le,e as T}from"./table-DiohXEtS.js";import{C as ze}from"./check-CulDpGof.js";import{B as Ve}from"./badge-CzjD55xo.js";import{m as Ae}from"./animation-CvwzMRXu.js";import{A as Ue}from"./arrow-left-DrhDRTh-.js";import{S as W}from"./search-DovExvO1.js";import"./utils-CUsTgaRG.js";import"./excel-uoQkVabA.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=y("Barcode",[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=y("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=y("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=y("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=y("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),R="barcode-history",qe=8,Je=()=>{const[a,t]=l.useState([]);return l.useEffect(()=>{const i=localStorage.getItem(R);if(i)try{t(JSON.parse(i))}catch(d){console.error("Error loading history:",d)}},[]),{history:a,addToHistory:i=>{const d={code:i,timestamp:Date.now()};t(w=>{const m=w.filter(S=>S.code!==i),p=[d,...m].slice(0,qe);return localStorage.setItem(R,JSON.stringify(p)),p})},clearHistory:()=>{t([]),localStorage.removeItem(R)}}};function N(a){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?N=function(s){return typeof s}:N=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},N(a)}var h=V(l),Ye=V(Re),n=V(Be);function V(a){return a&&a.__esModule?a:{default:a}}function Ke(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function Xe(a,t){for(var s=0;s<t.length;s++){var o=t[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(a,o.key,o)}}function Qe(a,t,s){return t&&Xe(a.prototype,t),a}function We(a,t){return t&&(N(t)==="object"||typeof t=="function")?t:de(a)}function M(a){return M=Object.setPrototypeOf?Object.getPrototypeOf:function(s){return s.__proto__||Object.getPrototypeOf(s)},M(a)}function de(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Ze(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(t&&t.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),t&&H(a,t)}function H(a,t){return H=Object.setPrototypeOf||function(o,i){return o.__proto__=i,o},H(a,t)}var I,B=h.default.version.split(/[.-]/);B[0]==="0"&&(B[1]==="13"||B[1]==="12")?I=function(t){return t.getDOMNode()}:I=function(t){return t};var A=function(a){Ze(t,a);function t(s){var o;return Ke(this,t),o=We(this,M(t).call(this,s)),o.renderElementRef=h.default.createRef(),o.update=o.update.bind(de(o)),o}return Qe(t,[{key:"shouldComponentUpdate",value:function(o){var i=this;return Object.keys(t.propTypes).some(function(d){return i.props[d]!==o[d]})}},{key:"componentDidMount",value:function(){this.update()}},{key:"componentDidUpdate",value:function(){this.update()}},{key:"update",value:function(){var o=I(this.renderElementRef.current);try{new Ye.default(o,this.props.value,Object.assign({text:this.props.text||this.props.value},this.props))}catch(i){window.console.error(i)}}},{key:"render",value:function(){var o=this.props,i=o.id,d=o.className;if(this.props.renderer==="svg")return h.default.createElement("svg",{ref:this.renderElementRef,id:i,className:d});if(this.props.renderer==="canvas")return h.default.createElement("canvas",{ref:this.renderElementRef,id:i,className:d});if(this.props.renderer==="img")return h.default.createElement("img",{ref:this.renderElementRef,id:i,className:d})}}]),t}(h.default.Component);A.propTypes={value:n.default.string.isRequired,text:n.default.string,renderer:n.default.string,format:n.default.string,width:n.default.number,height:n.default.number,displayValue:n.default.bool,fontOptions:n.default.string,font:n.default.string,textAlign:n.default.string,textPosition:n.default.string,textMargin:n.default.number,fontSize:n.default.number,background:n.default.string,lineColor:n.default.string,margin:n.default.number,marginTop:n.default.number,marginBottom:n.default.number,marginLeft:n.default.number,marginRight:n.default.number,id:n.default.string,className:n.default.string,ean128:n.default.bool};A.defaultProps={format:"CODE128",renderer:"svg",width:2,height:100,displayValue:!0,fontOptions:"",font:"monospace",textAlign:"center",textPosition:"bottom",textMargin:2,fontSize:20,background:"#ffffff",lineColor:"#000000",margin:10,className:"",ean128:!1};var et=A;const tt=Se(et);function rt({value:a}){return e.jsx("div",{className:"flex justify-center",children:e.jsx(tt,{value:a,format:"CODE128",width:2,height:80,displayValue:!0,fontOptions:"bold",fontSize:18,background:"transparent",lineColor:"hsl(var(--foreground))"})})}const Z=ge,ee=ye,L=l.forwardRef(({className:a,children:t,...s},o)=>e.jsxs(te,{ref:o,className:f("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...s,children:[t,e.jsx(je,{asChild:!0,children:e.jsx(ie,{className:"h-4 w-4 opacity-50"})})]}));L.displayName=te.displayName;const ce=l.forwardRef(({className:a,...t},s)=>e.jsx(re,{ref:s,className:f("flex cursor-default items-center justify-center py-1",a),...t,children:e.jsx(Ge,{className:"h-4 w-4"})}));ce.displayName=re.displayName;const me=l.forwardRef(({className:a,...t},s)=>e.jsx(ae,{ref:s,className:f("flex cursor-default items-center justify-center py-1",a),...t,children:e.jsx(ie,{className:"h-4 w-4"})}));me.displayName=ae.displayName;const z=l.forwardRef(({className:a,children:t,position:s="popper",...o},i)=>e.jsx(be,{children:e.jsxs(se,{ref:i,className:f("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:s,...o,children:[e.jsx(ce,{}),e.jsx(ve,{className:f("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(me,{})]})}));z.displayName=se.displayName;const at=l.forwardRef(({className:a,...t},s)=>e.jsx(oe,{ref:s,className:f("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...t}));at.displayName=oe.displayName;const g=l.forwardRef(({className:a,children:t,...s},o)=>e.jsxs(ne,{ref:o,className:f("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",a),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ne,{children:e.jsx(ze,{className:"h-4 w-4"})})}),e.jsx(we,{children:t})]}));g.displayName=ne.displayName;const st=l.forwardRef(({className:a,...t},s)=>e.jsx(le,{ref:s,className:f("-mx-1 my-1 h-px bg-muted",a),...t}));st.displayName=le.displayName;function vt(){const a=ke(),[t,s]=l.useState([]),[o,i]=l.useState(!0),[d,w]=l.useState(""),[m,p]=l.useState("all"),[S,k]=l.useState(!1),[U,j]=l.useState(""),[C,G]=l.useState(""),[F,$]=l.useState(null),[ue,q]=l.useState(null),{history:_,addToHistory:fe,clearHistory:pe}=Je();l.useEffect(()=>{(async()=>{try{i(!0);const c=await Te();s(c)}catch(c){console.error("Error loading products:",c),x.error("Error al cargar los productos")}finally{i(!1)}})()},[]);const J=l.useMemo(()=>{const r=new Set(t.map(c=>c.laboratory).filter(Boolean));return Array.from(r).sort()},[t]),b=l.useMemo(()=>t.filter(r=>{const c=d.toLowerCase(),v=r.name.toLowerCase().includes(c)||r.ean.includes(c),P=m==="all"||r.laboratory===m;return v&&P}),[t,d,m]),E=r=>{const c=r.trim();if(!c||!/^\d+$/.test(c)){x.error("Por favor, ingresa un código numérico válido.");return}const v=t.find(P=>P.ean===c);$(v?v.name:null),G(c),q(c)},Y=()=>{const r=U.trim();if(!r){x.error("El campo de código está vacío.");return}E(r),fe(r),x.success("Código de barras generado correctamente")},he=r=>{j(r),E(r)},K=()=>{j(""),G(""),$(null),q(null)},xe=r=>{j(r.ean),E(r.ean),k(!0)};return e.jsxs(Ae.div,{className:"flex flex-col h-full",initial:{opacity:0},animate:{opacity:1},transition:{duration:.4},children:[e.jsxs("header",{className:"sticky top-0 z-10 bg-background/95 backdrop-blur border-b px-4 h-16 flex items-center justify-between shrink-0 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>a(-1),className:"md:hidden",children:e.jsx(Ue,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Productos"}),e.jsxs("p",{className:"text-xs text-muted-foreground hidden sm:block",children:[t.length," productos registrados"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 justify-end max-w-3xl",children:[e.jsx("div",{className:"hidden md:block w-48",children:e.jsxs(Z,{value:m,onValueChange:p,children:[e.jsx(L,{className:"h-9",children:e.jsx(ee,{placeholder:"Laboratorio"})}),e.jsxs(z,{children:[e.jsx(g,{value:"all",children:"Todos los laboratorios"}),J.map(r=>e.jsx(g,{value:r,children:r},r))]})]})}),e.jsxs("div",{className:"relative w-full max-w-xs sm:max-w-sm",children:[e.jsx(W,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(X,{type:"search",placeholder:"Buscar por nombre o EAN...",value:d,onChange:r=>w(r.target.value),className:"pl-9 h-9 bg-muted/50 border-0"})]}),e.jsxs(u,{variant:"secondary",size:"sm",className:"gap-2 flex-shrink-0",onClick:()=>k(!0),children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Generador"})]})]})]}),e.jsx("div",{className:"p-4 md:hidden bg-background border-b flex gap-2 overflow-x-auto",children:e.jsxs(Z,{value:m,onValueChange:p,children:[e.jsx(L,{className:"h-9 w-full",children:e.jsx(ee,{placeholder:"Filtrar por Laboratorio"})}),e.jsxs(z,{children:[e.jsx(g,{value:"all",children:"Todos los laboratorios"}),J.map(r=>e.jsx(g,{value:r,children:r},r))]})]})}),e.jsx("div",{className:"flex-1 overflow-auto p-4 sm:p-6",children:e.jsxs("div",{className:"border rounded-xl overflow-hidden bg-card shadow-sm",children:[o?e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center text-muted-foreground",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{children:"Cargando productos..."})]}):b.length>0?e.jsxs(He,{children:[e.jsx(Ie,{className:"bg-muted/50",children:e.jsxs(Q,{children:[e.jsx(O,{className:"w-[140px]",children:"EAN"}),e.jsx(O,{children:"Producto"}),e.jsx(O,{className:"hidden md:table-cell",children:"Laboratorio"})]})}),e.jsx(Le,{children:b.slice(0,100).map(r=>e.jsxs(Q,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>xe(r),children:[e.jsx(T,{className:"font-mono text-primary font-medium",children:r.ean}),e.jsxs(T,{children:[e.jsx(Me,{ean:r.ean,name:r.name,children:e.jsx("div",{className:"font-medium hover:underline decoration-dotted underline-offset-4 w-fit",children:r.name})}),e.jsx("div",{className:"md:hidden text-xs text-muted-foreground mt-1",children:r.laboratory||"Sin laboratorio"})]}),e.jsx(T,{className:"hidden md:table-cell",children:r.laboratory?e.jsx(Ve,{variant:"outline",className:"font-normal",children:r.laboratory}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})})]},r.ean))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center text-muted-foreground",children:[e.jsx(W,{className:"w-12 h-12 mb-4 opacity-20"}),e.jsx("p",{children:"No se encontraron productos."}),m!=="all"&&e.jsx(u,{variant:"link",onClick:()=>p("all"),className:"mt-2",children:"Limpiar filtros"})]}),!o&&b.length>100&&e.jsx("div",{className:"p-4 text-center border-t bg-muted/20",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Mostrando 100 de ",b.length," resultados."]})})]})}),e.jsx(Ce,{open:S,onOpenChange:r=>{k(r),r||K()},children:e.jsxs(_e,{className:"sm:max-w-3xl p-0 max-h-[90vh] overflow-y-auto gap-0 rounded-xl",children:[e.jsxs(Ee,{className:"p-6 border-b bg-muted/30",children:[e.jsxs(Pe,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"Generar EAN manualmente"]}),e.jsx(Oe,{children:"Ingresa un código, selecciónalo del historial o haz clic en la tabla para generar."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-0 divide-y md:divide-y-0 md:divide-x",children:[e.jsx("div",{className:"p-6 flex flex-col justify-center items-center min-h-[300px] bg-background",children:C?e.jsxs("div",{id:"barcode-to-print",className:"w-full text-center space-y-6",children:[e.jsx("div",{children:F?e.jsx("h3",{className:"text-lg font-semibold leading-tight",children:F}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Producto no encontrado en la base de datos."})}),e.jsx("div",{className:"p-4 bg-white rounded-lg inline-block shadow-sm border",children:e.jsx(rt,{value:C})}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsxs(u,{size:"sm",variant:"outline",onClick:async()=>{await navigator.clipboard.writeText(C),x.success("Código copiado")},children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"})," Copiar"]}),e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>window.print(),children:[e.jsx($e,{className:"w-4 h-4 mr-2"})," Imprimir"]})]})]}):e.jsxs("div",{className:"text-center space-y-2 text-muted-foreground",children:[e.jsx(D,{className:"w-12 h-12 mx-auto opacity-20"}),e.jsx("p",{children:"Selecciona un producto o ingresa un código"})]})}),e.jsxs("div",{className:"p-6 bg-muted/10 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"}),"Historial Reciente"]}),_.length>0&&e.jsx(u,{variant:"ghost",size:"sm",onClick:pe,className:"h-6 text-xs text-muted-foreground hover:text-destructive px-2",children:"Borrar todo"})]}),_.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-[250px] overflow-y-auto pr-2",children:_.slice(0,8).map(r=>e.jsxs("button",{onClick:()=>he(r.code),className:`text-left px-3 py-2 rounded-md text-sm font-mono transition-colors flex items-center justify-between group ${ue===r.code?"bg-primary text-primary-foreground":"bg-background border hover:border-primary/50"}`,children:[e.jsx("span",{children:r.code}),e.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-[10px]",children:new Date(r.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},r.timestamp))}):e.jsx("div",{className:"text-center py-10 text-xs text-muted-foreground border-2 border-dashed rounded-lg",children:"Sin historial reciente"})]})]}),e.jsx("div",{className:"p-6 bg-muted/30 border-t",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1 w-full",children:[e.jsx(De,{htmlFor:"ean-code",children:"Código manual"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(X,{id:"ean-code",value:U,onChange:r=>j(r.target.value.replace(/\D/g,"")),onKeyDown:r=>{r.key==="Enter"&&Y()},placeholder:"Ej: 7791234567890",className:"font-mono"}),e.jsx(u,{onClick:Y,children:"Generar"})]})]}),e.jsx(u,{variant:"ghost",onClick:K,children:"Limpiar"})]})})]})})]})}export{vt as default};
