import{j as e}from"./ui-vendor-lsEhpTbO.js";import{r as c,g as be,u as ve}from"./react-vendor-ylmX0jv_.js";import{c as $,B as h,U as je,S as Ne,q as we,r as Se,t as ke,v as Ce,$ as Ee,y as p,a3 as re,_ as _e}from"./index-UWuEarZD.js";import{I as ae}from"./input-BZuQPplQ.js";import{L as Pe}from"./label-CDVHdlf9.js";import{a as Oe}from"./JsBarcode-BPRqDEDi.js";import{p as De}from"./chart-vendor-Cu80epCr.js";import{P as Te}from"./ProductImageHover-DuLKujiM.js";import{r as Me,u as He}from"./excel-uoQkVabA.js";import{T as Be,a as Le,b as ne,c as H,d as Re,e as B}from"./table-al5mgoIB.js";import{B as Ie}from"./badge-BxTW-dgm.js";import{m as ze}from"./animation-DZFErbwn.js";import"./utils-CUsTgaRG.js";import"./loader-circle-CLUboJXv.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=$("Barcode",[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=$("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=$("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),R="barcode-history",$e=8,Fe=()=>{const[a,r]=c.useState([]);return c.useEffect(()=>{const i=localStorage.getItem(R);if(i)try{r(JSON.parse(i))}catch(d){console.error("Error loading history:",d)}},[]),{history:a,addToHistory:i=>{const d={code:i,timestamp:Date.now()};r(y=>{const P=y.filter(v=>v.code!==i),N=[d,...P].slice(0,$e);return localStorage.setItem(R,JSON.stringify(N)),N})},clearHistory:()=>{r([]),localStorage.removeItem(R)}}};function _(a){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_=function(s){return typeof s}:_=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},_(a)}var b=F(c),Ge=F(Oe),o=F(De);function F(a){return a&&a.__esModule?a:{default:a}}function qe(a,r){if(!(a instanceof r))throw new TypeError("Cannot call a class as a function")}function Je(a,r){for(var s=0;s<r.length;s++){var n=r[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function Ve(a,r,s){return r&&Je(a.prototype,r),a}function Ye(a,r){return r&&(_(r)==="object"||typeof r=="function")?r:se(a)}function z(a){return z=Object.setPrototypeOf?Object.getPrototypeOf:function(s){return s.__proto__||Object.getPrototypeOf(s)},z(a)}function se(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Ke(a,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(r&&r.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),r&&A(a,r)}function A(a,r){return A=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},A(a,r)}var U,I=b.default.version.split(/[.-]/);I[0]==="0"&&(I[1]==="13"||I[1]==="12")?U=function(r){return r.getDOMNode()}:U=function(r){return r};var G=function(a){Ke(r,a);function r(s){var n;return qe(this,r),n=Ye(this,z(r).call(this,s)),n.renderElementRef=b.default.createRef(),n.update=n.update.bind(se(n)),n}return Ve(r,[{key:"shouldComponentUpdate",value:function(n){var i=this;return Object.keys(r.propTypes).some(function(d){return i.props[d]!==n[d]})}},{key:"componentDidMount",value:function(){this.update()}},{key:"componentDidUpdate",value:function(){this.update()}},{key:"update",value:function(){var n=U(this.renderElementRef.current);try{new Ge.default(n,this.props.value,Object.assign({text:this.props.text||this.props.value},this.props))}catch(i){window.console.error(i)}}},{key:"render",value:function(){var n=this.props,i=n.id,d=n.className;if(this.props.renderer==="svg")return b.default.createElement("svg",{ref:this.renderElementRef,id:i,className:d});if(this.props.renderer==="canvas")return b.default.createElement("canvas",{ref:this.renderElementRef,id:i,className:d});if(this.props.renderer==="img")return b.default.createElement("img",{ref:this.renderElementRef,id:i,className:d})}}]),r}(b.default.Component);G.propTypes={value:o.default.string.isRequired,text:o.default.string,renderer:o.default.string,format:o.default.string,width:o.default.number,height:o.default.number,displayValue:o.default.bool,fontOptions:o.default.string,font:o.default.string,textAlign:o.default.string,textPosition:o.default.string,textMargin:o.default.number,fontSize:o.default.number,background:o.default.string,lineColor:o.default.string,margin:o.default.number,marginTop:o.default.number,marginBottom:o.default.number,marginLeft:o.default.number,marginRight:o.default.number,id:o.default.string,className:o.default.string,ean128:o.default.bool};G.defaultProps={format:"CODE128",renderer:"svg",width:2,height:100,displayValue:!0,fontOptions:"",font:"monospace",textAlign:"center",textPosition:"bottom",textMargin:2,fontSize:20,background:"#ffffff",lineColor:"#000000",margin:10,className:"",ean128:!1};var Qe=G;const Xe=be(Qe);function We({value:a}){return e.jsx("div",{className:"flex justify-center",children:e.jsx(Xe,{value:a,format:"CODE128",width:2,height:80,displayValue:!0,fontOptions:"bold",fontSize:18,background:"transparent",lineColor:"#000000"})})}function pt(){ve();const[a,r]=c.useState([]),[s,n]=c.useState(!0),[i,d]=c.useState(""),[y,P]=c.useState("all"),[N,v]=c.useState(!1),[q,w]=c.useState(""),[O,J]=c.useState(""),[V,Y]=c.useState(null),[oe,K]=c.useState(null),{history:D,addToHistory:ie,clearHistory:le}=Fe();c.useEffect(()=>{(async()=>{try{n(!0);const l=await re();r(l)}catch(l){console.error("Error loading products:",l),p.error("Error al cargar los productos")}finally{n(!1)}})()},[]),c.useMemo(()=>{const t=new Set(a.map(l=>l.laboratory).filter(Boolean));return Array.from(t).sort()},[a]);const S=c.useMemo(()=>a.filter(t=>{const l=i.toLowerCase(),x=t.name.toLowerCase().includes(l)||t.ean.includes(l),m=y==="all"||t.laboratory===y;return x&&m}),[a,i,y]),T=t=>{const l=t.trim();if(!l||!/^\d+$/.test(l)){p.error("Por favor, ingresa un código numérico válido.");return}const x=a.find(m=>m.ean===l);Y(x?x.name:null),J(l),K(l)},Q=()=>{const t=q.trim();if(!t){p.error("El campo de código está vacío.");return}T(t),ie(t),p.success("Código de barras generado correctamente")},ce=t=>{w(t),T(t)},X=()=>{w(""),J(""),Y(null),K(null)},de=t=>{w(t.ean),T(t.ean),v(!0)},ue=async t=>{var x;const l=(x=t.target.files)==null?void 0:x[0];if(l)try{n(!0);const m=new FileReader;m.onload=async me=>{var W;try{const k=(W=me.target)==null?void 0:W.result,Z=Me(k,{type:"binary"}),fe=Z.SheetNames[0],he=Z.Sheets[fe],ee=He.sheet_to_json(he,{header:"A"}),te=[];for(let f=1;f<ee.length;f++){const u=ee[f],g=u.D,E=u.Q;if(!g||!E)continue;const pe=String(g).trim(),xe=u.O?String(u.O).trim():void 0,ge=u.J?String(u.J).trim().toUpperCase():void 0,ye=u.L?Number(u.L):0;String(E).trim().split("-").map(j=>j.trim()).filter(j=>j.length>0).forEach(j=>{te.push({ean:j,name:pe,laboratory:xe,category:ge,cost:ye,salePrice:0,stock:0})})}const M=new Map;te.forEach(f=>{M.has(f.ean)||M.set(f.ean,f)});const C=Array.from(M.values());if(C.length>0){for(let g=0;g<C.length;g+=1e3){const E=C.slice(g,g+1e3);await _e(E)}p.success(`${C.length} productos actualizados correctamente.`);const u=await re();r(u)}else p.warning("No se encontraron productos válidos en el archivo.")}catch(k){console.error("Error processing file:",k),p.error(`Error: ${k.message||"Error desconocido al procesar el archivo"}`)}finally{n(!1),t.target.value=""}},m.readAsBinaryString(l)}catch(m){console.error("Upload error:",m),n(!1)}};return e.jsxs(ze.div,{className:"flex flex-col h-full",initial:{opacity:0},animate:{opacity:1},transition:{duration:.4},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 pb-0",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Productos"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(h,{variant:"outline",disabled:s,onClick:()=>{var t;return(t=document.getElementById("product-upload"))==null?void 0:t.click()},children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),s?"Cargando...":"Importar Excel"]}),e.jsx(ae,{id:"product-upload",type:"file",accept:".xlsx, .xls",className:"hidden",onChange:ue,disabled:s})]}),e.jsxs(h,{onClick:()=>v(!0),children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Generar EAN"]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("div",{className:"border rounded-xl overflow-hidden bg-card shadow-sm",children:[s?e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center text-muted-foreground",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{children:"Cargando productos..."})]}):S.length>0?e.jsxs(Be,{children:[e.jsx(Le,{className:"bg-muted/50",children:e.jsxs(ne,{children:[e.jsx(H,{className:"w-[140px]",children:"EAN"}),e.jsx(H,{children:"Producto"}),e.jsx(H,{className:"hidden md:table-cell",children:"Laboratorio"})]})}),e.jsx(Re,{children:S.slice(0,100).map(t=>e.jsxs(ne,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>de(t),children:[e.jsx(B,{className:"font-mono text-primary font-medium",children:t.ean}),e.jsxs(B,{children:[e.jsx(Te,{ean:t.ean,name:t.name,children:e.jsx("div",{className:"font-medium hover:underline decoration-dotted underline-offset-4 w-fit",children:t.name})}),e.jsx("div",{className:"md:hidden text-xs text-muted-foreground mt-1",children:t.laboratory||"Sin laboratorio"})]}),e.jsx(B,{className:"hidden md:table-cell",children:t.laboratory?e.jsx(Ie,{variant:"outline",className:"font-normal",children:t.laboratory}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})})]},t.ean))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center text-muted-foreground",children:[e.jsx(Ne,{className:"w-12 h-12 mb-4 opacity-20"}),e.jsx("p",{children:"No se encontraron productos."}),y!=="all"&&e.jsx(h,{variant:"link",onClick:()=>P("all"),className:"mt-2",children:"Limpiar filtros"})]}),!s&&S.length>100&&e.jsx("div",{className:"p-4 text-center border-t bg-muted/20",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Mostrando 100 de ",S.length," resultados."]})})]})}),e.jsx(we,{open:N,onOpenChange:t=>{v(t),t||X()},children:e.jsxs(Se,{className:"sm:max-w-3xl p-0 max-h-[90vh] overflow-y-auto gap-0 rounded-xl",children:[e.jsxs(ke,{className:"p-6 border-b bg-muted/30",children:[e.jsxs(Ce,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"Generar EAN manualmente"]}),e.jsx(Ee,{children:"Ingresa un código, selecciónalo del historial o haz clic en la tabla para generar."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-0 divide-y md:divide-y-0 md:divide-x",children:[e.jsx("div",{className:"p-6 flex flex-col justify-center items-center min-h-[300px] bg-background",children:O?e.jsxs("div",{id:"barcode-to-print",className:"w-full text-center space-y-6",children:[e.jsx("div",{children:V?e.jsx("h3",{className:"text-lg font-semibold leading-tight",children:V}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Producto no encontrado en la base de datos."})}),e.jsx("div",{className:"p-4 bg-white rounded-lg inline-block shadow-sm border",children:e.jsx(We,{value:O})}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsxs(h,{size:"sm",variant:"outline",onClick:async()=>{await navigator.clipboard.writeText(O),p.success("Código copiado")},children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"})," Copiar"]}),e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>window.print(),children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"})," Imprimir"]})]})]}):e.jsxs("div",{className:"text-center space-y-2 text-muted-foreground",children:[e.jsx(L,{className:"w-12 h-12 mx-auto opacity-20"}),e.jsx("p",{children:"Selecciona un producto o ingresa un código"})]})}),e.jsxs("div",{className:"p-6 bg-muted/10 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"}),"Historial Reciente"]}),D.length>0&&e.jsx(h,{variant:"ghost",size:"sm",onClick:le,className:"h-6 text-xs text-muted-foreground hover:text-destructive px-2",children:"Borrar todo"})]}),D.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-[250px] overflow-y-auto pr-2",children:D.slice(0,8).map(t=>e.jsxs("button",{onClick:()=>ce(t.code),className:`text-left px-3 py-2 rounded-md text-sm font-mono transition-colors flex items-center justify-between group ${oe===t.code?"bg-primary text-primary-foreground":"bg-background border hover:border-primary/50"}`,children:[e.jsx("span",{children:t.code}),e.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-[10px]",children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},t.timestamp))}):e.jsx("div",{className:"text-center py-10 text-xs text-muted-foreground border-2 border-dashed rounded-lg",children:"Sin historial reciente"})]})]}),e.jsx("div",{className:"p-6 bg-muted/30 border-t",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1 w-full",children:[e.jsx(Pe,{htmlFor:"ean-code",children:"Código manual"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ae,{id:"ean-code",value:q,onChange:t=>w(t.target.value.replace(/\D/g,"")),onKeyDown:t=>{t.key==="Enter"&&Q()},placeholder:"Ej: 7791234567890",className:"font-mono"}),e.jsx(h,{onClick:Q,children:"Generar"})]})]}),e.jsx(h,{variant:"ghost",onClick:X,children:"Limpiar"})]})})]})})]})}export{pt as default};
