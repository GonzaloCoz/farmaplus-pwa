import{j as e,a0 as he,a1 as ze,a2 as Re,a3 as Le,O as pe,a as fe,b as De,c as ge,D as je,d as Oe,g as Te,e as Ue,a4 as be,a5 as Ne,a6 as Me}from"./ui-vendor-DpWgbapL.js";import{r as i,c as Ve,u as Be}from"./react-vendor-ylmX0jv_.js";import{c as ve,b as p,X as $e,af as Ge,ad as He,B as j,an as qe,R as re,W as Fe,H as We,z as h,ao as ye,u as we,j as E,n as A,k as L,l as D,m as O,S as le,M as Ze,ap as Qe,al as ce,i as de,v as T,aq as Ye,V as Xe,N as Je,y as Ke,ar as es,as as ss,aj as as}from"./index-nj5uYoc8.js";import{L as w}from"./label-DK45WQiY.js";import{S as q}from"./switch-o3NHipUN.js";import{W as Se}from"./wifi-Dh1ERag9.js";import{I as te}from"./input-DwEKUKzf.js";import{r as me,u as xe}from"./excel-uoQkVabA.js";import{C as rs}from"./circle-DNmM3q1k.js";import{U as ts,P as ns,R as os,h as is}from"./permissions-D9KtUNZK.js";import{S as se,M as ls}from"./shield-CCIyl1X9.js";import{T as ke}from"./trash-2-QgeEM5Fq.js";import{A as cs,m as ds}from"./animation-D5s1b1Vs.js";import{M as ms}from"./map-pin-M2BOHUnQ.js";import{C as xs}from"./calendar-CqAyxpNB.js";import{L as us}from"./lock-D6Qe5YRh.js";import{D as ue}from"./database-CUYNuZF-.js";import"./utils-B3_ieZWp.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=ve("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=ve("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),Ce=i.forwardRef(({className:r,...t},n)=>e.jsxs(he,{ref:n,className:p("relative flex w-full touch-none select-none items-center",r),...t,children:[e.jsx(ze,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(Re,{className:"absolute h-full bg-primary"})}),e.jsx(Le,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));Ce.displayName=he.displayName;const ps=Oe,fs=Te,gs=Ue,Ee=i.forwardRef(({className:r,...t},n)=>e.jsx(pe,{className:p("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...t,ref:n}));Ee.displayName=pe.displayName;const js=Ge("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Ae=i.forwardRef(({side:r="right",className:t,children:n,...o},y)=>e.jsxs(gs,{children:[e.jsx(Ee,{}),e.jsxs(fe,{ref:y,className:p(js({side:r}),t),...o,children:[n,e.jsxs(De,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ae.displayName=fe.displayName;const _e=({className:r,...t})=>e.jsx("div",{className:p("flex flex-col space-y-2 text-center sm:text-left",r),...t});_e.displayName="SheetHeader";const Ie=i.forwardRef(({className:r,...t},n)=>e.jsx(ge,{ref:n,className:p("text-lg font-semibold text-foreground",r),...t}));Ie.displayName=ge.displayName;const bs=i.forwardRef(({className:r,...t},n)=>e.jsx(je,{ref:n,className:p("text-sm text-muted-foreground",r),...t}));bs.displayName=je.displayName;function Ns({children:r}){const[t,n]=i.useState(!1),[o,y]=i.useState(navigator.onLine),[f,B]=i.useState([]),[_,I]=i.useState(!1);i.useEffect(()=>{const x=()=>y(!0),U=()=>y(!1);window.addEventListener("online",x),window.addEventListener("offline",U),P();const M=setInterval(P,5e3);return()=>{window.removeEventListener("online",x),window.removeEventListener("offline",U),clearInterval(M)}},[]);const P=async()=>{try{const x=await He();B(x)}catch(x){console.error("Error loading unsynced items",x)}},S=async()=>{if(!o){h.error("Error","No hay conexión a internet");return}I(!0);try{await new Promise(x=>setTimeout(x,2e3)),h.success("Operación exitosa","Sincronización completada (Simulada)"),await P()}catch{h.error("Error","Error al sincronizar")}finally{I(!1)}};return e.jsxs(ps,{open:t,onOpenChange:n,children:[e.jsx(fs,{asChild:!0,children:r||e.jsxs(j,{variant:"ghost",size:"icon",className:"relative",children:[o?f.length>0?e.jsx(ne,{className:"h-5 w-5 text-warning"}):e.jsx(ne,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(qe,{className:"h-5 w-5 text-destructive"}),f.length>0&&e.jsx("span",{className:"absolute top-1 right-1 h-2 w-2 rounded-full bg-destructive animate-pulse"})]})}),e.jsxs(Ae,{side:"bottom",className:"h-[50vh] rounded-t-3xl",children:[e.jsx(_e,{className:"mb-6",children:e.jsxs(Ie,{className:"flex items-center gap-2",children:[e.jsx(re,{className:p("h-5 w-5",_&&"animate-spin")}),"Centro de Sincronización"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:p("p-4 rounded-xl border flex items-center justify-between",o?"bg-success/10 border-success/20":"bg-destructive/10 border-destructive/20"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[o?e.jsx(Se,{className:"h-5 w-5 text-success"}):e.jsx(Fe,{className:"h-5 w-5 text-destructive"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:o?"Conectado":"Sin conexión"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o?"Listo para sincronizar":"Los cambios se guardarán localmente"})]})]})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-3",children:["Pendientes de subida (",f.length,")"]}),f.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-muted-foreground",children:[e.jsx(We,{className:"h-12 w-12 mb-2 opacity-20"}),e.jsx("p",{children:"Todo está sincronizado"})]}):e.jsxs("div",{className:"space-y-2 max-h-[150px] overflow-auto",children:[f.slice(0,5).map(x=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg text-sm",children:[e.jsx("span",{className:"truncate max-w-[200px]",children:x.productName}),e.jsxs("span",{className:"font-mono text-xs",children:[x.quantity," un."]})]},x.id)),f.length>5&&e.jsxs("p",{className:"text-xs text-center text-muted-foreground pt-2",children:["+ ",f.length-5," más..."]})]})]}),e.jsx(j,{className:"w-full",size:"lg",onClick:S,disabled:!o||f.length===0||_,children:_?"Sincronizando...":"Sincronizar Ahora"})]})]})]})}const ae=({position:r})=>e.jsx("div",{className:"relative w-full h-32 bg-muted/30 rounded-lg border overflow-hidden",children:e.jsxs("div",{className:"absolute inset-2 border-2 border-muted-foreground/20 rounded",children:[e.jsxs("div",{className:"h-3 bg-muted-foreground/10 border-b border-muted-foreground/20 flex items-center px-1.5 gap-1",children:[e.jsx(ye,{className:"w-2 h-2 text-muted-foreground/40"}),e.jsxs("div",{className:"flex-1 flex gap-0.5",children:[e.jsx("div",{className:"h-1 w-8 bg-muted-foreground/20 rounded-full"}),e.jsx("div",{className:"h-1 w-6 bg-muted-foreground/20 rounded-full"})]})]}),e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsx("div",{className:"h-1.5 w-full bg-muted-foreground/10 rounded"}),e.jsx("div",{className:"h-1.5 w-3/4 bg-muted-foreground/10 rounded"}),e.jsx("div",{className:"h-1.5 w-5/6 bg-muted-foreground/10 rounded"}),e.jsx("div",{className:"h-1.5 w-2/3 bg-muted-foreground/10 rounded"})]}),e.jsx("div",{className:p("absolute w-16 h-6 bg-primary/90 rounded shadow-lg flex items-center justify-center",r==="top-right"&&"top-2 right-2",r==="bottom-right"&&"bottom-2 right-2",r==="bottom-center"&&"bottom-2 left-1/2 -translate-x-1/2"),children:e.jsx("div",{className:"w-10 h-3 bg-background/90 rounded-sm"})})]})});function vs({value:r,onChange:t}){const n=[{value:"top-right",label:"Arriba a la derecha",preview:e.jsx(ae,{position:"top-right"})},{value:"bottom-right",label:"Abajo a la derecha",preview:e.jsx(ae,{position:"bottom-right"})},{value:"bottom-center",label:"Abajo al centro",preview:e.jsx(ae,{position:"bottom-center"})}];return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:n.map(o=>e.jsxs("button",{onClick:()=>t(o.value),className:p("relative flex flex-col gap-3 p-4 rounded-xl border-2 transition-all hover:border-primary/50",r===o.value?"border-primary bg-primary/5":"border-border bg-background"),children:[o.preview,e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:p("w-4 h-4 rounded-full border-2 flex items-center justify-center transition-all",r===o.value?"border-primary":"border-muted-foreground/30"),children:r===o.value&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})}),e.jsx("span",{className:p("text-sm font-medium transition-colors",r===o.value?"text-foreground":"text-muted-foreground"),children:o.label})]})]},o.value))})}const Pe=i.forwardRef(({className:r,...t},n)=>e.jsx(be,{className:p("grid gap-2",r),...t,ref:n}));Pe.displayName=be.displayName;const Y=i.forwardRef(({className:r,...t},n)=>e.jsx(Ne,{ref:n,className:p("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...t,children:e.jsx(Me,{className:"flex items-center justify-center",children:e.jsx(rs,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Y.displayName=Ne.displayName;const ys=[{id:"VIEW_ADMIN_DASHBOARD",label:"Ver Panel Administrador",group:"Visibilidad"},{id:"VIEW_BRANCH_MONITOR",label:"Ver Monitor de Sucursales",group:"Visibilidad"},{id:"EDIT_DASHBOARD_LAYOUT",label:"Editar Diseño del Panel",group:"Personalización"},{id:"MANAGE_CALENDAR_EVENTS",label:"Gestionar Eventos de Calendario",group:"Operaciones"},{id:"MANAGE_INVENTORY_CONFIG",label:"Configurar Plazos de Inventario",group:"Operaciones"},{id:"IMPERSONATE_BRANCH",label:"Simular Sucursal",group:"Administración"},{id:"EDIT_SETTINGS",label:"Modificar Ajustes de App",group:"Administración"}];function ws(){const{user:r}=we(),[t,n]=i.useState([]),[o,y]=i.useState(!0),[f,B]=i.useState(""),[_,I]=i.useState(null),[P,S]=i.useState(null);if((r==null?void 0:r.username)!=="gcoz")return e.jsx(E,{className:"border-none shadow-md bg-muted/10",children:e.jsxs(A,{className:"flex flex-col items-center justify-center py-12 text-center text-muted-foreground",children:[e.jsx(se,{className:"w-12 h-12 mb-4 text-muted-foreground/50"}),e.jsx("p",{className:"text-lg font-bold",children:"Acceso Restringido"}),e.jsx("p",{className:"text-sm",children:"Esta sección es para uso exclusivo del administrador del sistema (gcoz)."})]})});const x=async()=>{y(!0);try{const{data:s,error:m}=await T.from("profiles").select("*").order("role",{ascending:!0}).order("username",{ascending:!0});if(m)throw m;const l=(s||[]).map(a=>({id:a.id||a.user_id||"unknown",username:a.username,full_name:a.full_name,role:a.role,active:a.active??!0,created_at:a.created_at,branch_id:a.branch_id,permissions:a.permissions||[]}));n(l)}catch(s){console.error("Error fetching profiles:",s),h.error("Error","No se pudieron cargar los usuarios.")}finally{y(!1)}};i.useEffect(()=>{x()},[]);const U=async(s,m)=>{S(s);const l=!m;n(a=>a.map(c=>c.id===s?{...c,active:l}:c));try{const{error:a}=await T.from("profiles").update({active:l}).eq("id",s);if(a)throw a;h.success(l?"Usuario Activado":"Usuario Desactivado",`El usuario ha sido ${l?"habilitado":"inhabilitado"} correctamente.`)}catch(a){console.error("Error toggling status:",a),n(c=>c.map(u=>u.id===s?{...u,active:m}:u)),h.error("Error","No se pudo actualizar el estado. ¿Ejecutaste el script SQL?")}finally{S(null)}},M=async(s,m)=>{S(s);try{const{error:l}=await T.from("profiles").update({role:m}).eq("id",s);if(l)throw l;n(a=>a.map(c=>c.id===s?{...c,role:m}:c)),h.success("Rol Actualizado",`El usuario ahora tiene el rol de ${m}.`)}catch{h.error("Error","No se pudo actualizar el rol.")}finally{S(null)}},F=async(s,m,l=[])=>{const a=!l.includes(m),c=a?[...l,m]:l.filter(u=>u!==m);try{const{error:u}=await T.from("profiles").update({permissions:c}).eq("id",s);if(u)throw u;n(g=>g.map(b=>b.id===s?{...b,permissions:c}:b)),h.success("Permiso Actualizado",a?"Permiso añadido.":"Permiso removido.")}catch(u){console.warn("Attempted to update missing 'permissions' column:",u),h.error("Advertencia","No se pudo guardar: la base de datos requiere la columna 'permissions'.")}},$=t.filter(s=>{var m;return s.username.toLowerCase().includes(f.toLowerCase())||(((m=s.full_name)==null?void 0:m.toLowerCase())||"").includes(f.toLowerCase())}),W=s=>{switch(s){case"admin":return{label:"Administrador",color:"bg-red-500/10 text-red-600 border-red-200"};case"mod":return{label:"Zonal (Mod)",color:"bg-indigo-500/10 text-indigo-600 border-indigo-200"};default:return{label:"Sucursal",color:"bg-emerald-500/10 text-emerald-600 border-emerald-200"}}};return e.jsxs(E,{className:"border-none shadow-2xl bg-white dark:bg-zinc-950 overflow-hidden rounded-[2rem]",children:[e.jsxs(L,{className:"px-8 pt-8 pb-6 bg-gradient-to-b from-muted/20 to-transparent",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-14 w-14 bg-primary rounded-[1.25rem] flex items-center justify-center shadow-lg shadow-primary/20",children:e.jsx(ts,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx(D,{className:"text-2xl font-black tracking-tight text-foreground",children:"Control de Usuarios"}),e.jsxs(O,{className:"font-semibold text-muted-foreground",children:[t.length," usuarios registrados en la plataforma"]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(j,{variant:"secondary",size:"sm",onClick:x,disabled:o,className:"rounded-xl font-bold px-4 h-11",children:[e.jsx(re,{className:p("w-4 h-4 mr-2",o&&"animate-spin")}),"Actualizar"]}),e.jsx(j,{className:"rounded-xl font-bold px-6 h-11 shadow-lg shadow-primary/20",children:"+ Añadir Usuario"})]})]}),e.jsxs("div",{className:"mt-8 relative max-w-2xl",children:[e.jsx(le,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground/50"}),e.jsx(te,{placeholder:"Buscar por nombre, usuario o correo...",className:"pl-12 h-14 bg-muted/30 border-none rounded-2xl focus-visible:ring-primary/20 text-md font-medium",value:f,onChange:s=>B(s.target.value)})]})]}),e.jsxs(A,{className:"px-0 pb-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border/10",children:[e.jsx("th",{className:"pl-8 pr-4 py-4 text-left text-[11px] font-black text-muted-foreground/60 uppercase tracking-[0.1em] w-[40px]"}),e.jsx("th",{className:"px-4 py-4 text-left text-[11px] font-black text-muted-foreground/60 uppercase tracking-[0.1em]",children:"Usuario"}),e.jsx("th",{className:"px-4 py-4 text-left text-[11px] font-black text-muted-foreground/60 uppercase tracking-[0.1em]",children:"Cargo / Rol"}),e.jsx("th",{className:"px-4 py-4 text-center text-[11px] font-black text-muted-foreground/60 uppercase tracking-[0.1em]",children:"Estado"}),e.jsx("th",{className:"pl-4 pr-8 py-4 text-right text-[11px] font-black text-muted-foreground/60 uppercase tracking-[0.1em]",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-border/5",children:$.map(s=>{const m=W(s.role),l=_===s.id;return e.jsxs(Ve.Fragment,{children:[e.jsxs("tr",{className:p("transition-colors duration-200",l?"bg-primary/5 shadow-inner":"hover:bg-muted/30"),children:[e.jsx("td",{className:"pl-8 pr-4 py-5",children:e.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-lg hover:bg-primary/10",onClick:()=>I(l?null:s.id),children:l?e.jsx(Ze,{className:"h-4 w-4 text-primary"}):e.jsx(Qe,{className:"h-4 w-4"})})}),e.jsx("td",{className:"px-4 py-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-2xl overflow-hidden bg-muted flex items-center justify-center border-2 border-white shadow-sm",children:s.full_name?e.jsx("div",{className:"h-full w-full bg-primary/10 flex items-center justify-center font-black text-primary text-xl uppercase",children:s.full_name.charAt(0)}):e.jsx(ce,{className:"w-6 h-6 text-muted-foreground"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-bold text-foreground text-md leading-none",children:s.full_name||"@"+s.username}),e.jsxs("span",{className:"text-xs font-semibold text-muted-foreground/60 mt-1",children:[s.username,"@farmaplus.com"]})]})]})}),e.jsx("td",{className:"px-4 py-5",children:e.jsxs("div",{className:p("inline-flex items-center px-3 py-1.5 rounded-xl border text-xs font-black uppercase tracking-wider",m.color),children:[e.jsx(se,{className:"w-3 h-3 mr-2"}),m.label]})}),e.jsx("td",{className:"px-4 py-5",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(q,{checked:s.active,disabled:P===s.id,onCheckedChange:()=>U(s.id,s.active),className:"data-[state=checked]:bg-emerald-500 scale-110"}),e.jsx(de,{variant:"outline",className:p("px-2 py-0 border-none font-black text-[10px] uppercase",s.active?"text-emerald-500":"text-red-500"),children:s.active?"Activo":"Inactivo"})]})}),e.jsx("td",{className:"pl-4 pr-8 py-5 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-xl hover:bg-primary/10 hover:text-primary transition-all",onClick:()=>I(l?null:s.id),children:e.jsx(ns,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-xl hover:bg-red-500/10 hover:text-red-500 transition-all opacity-40 hover:opacity-100",children:e.jsx(ke,{className:"h-4 w-4"})})]})})]}),e.jsx(cs,{children:l&&e.jsx(ds.tr,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"bg-primary/[0.02]",children:e.jsx("td",{colSpan:5,className:"p-0",children:e.jsxs("div",{className:"px-24 py-12 grid grid-cols-1 lg:grid-cols-2 gap-16 border-b border-primary/5",children:[e.jsxs("div",{className:"space-y-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-[11px] font-black text-primary uppercase tracking-[0.2em] mb-6 flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"})," Información Personal"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-black text-muted-foreground/40 uppercase",children:"Nombre Completo"}),e.jsx("p",{className:"font-bold flex items-center gap-2",children:s.full_name||"No especificado"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-black text-muted-foreground/40 uppercase",children:"Email Corporativo"}),e.jsxs("p",{className:"font-bold flex items-center gap-2 text-primary",children:[e.jsx(ls,{className:"w-4 h-4"})," ",s.username,"@farmaplus.com"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-black text-muted-foreground/40 uppercase",children:"Empresa / Sucursal"}),e.jsxs("p",{className:"font-bold flex items-center gap-2",children:[e.jsx(ms,{className:"w-4 h-4"})," Casa Central"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-black text-muted-foreground/40 uppercase",children:"Fecha de Ingreso"}),e.jsxs("p",{className:"font-bold flex items-center gap-2",children:[e.jsx(xs,{className:"w-4 h-4"})," ",new Date(s.created_at).toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:"pt-6 border-t border-border/10",children:[e.jsxs("h4",{className:"text-[11px] font-black text-primary uppercase tracking-[0.2em] mb-6 flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"})," Gestión de Rol"]}),e.jsx("div",{className:"flex gap-3",children:["admin","mod","branch"].map(a=>e.jsx(j,{variant:s.role===a?"default":"outline",size:"sm",className:"rounded-xl font-black uppercase text-[10px] h-9 px-4",onClick:()=>M(s.id,a),children:a==="mod"?"Zonal":a==="admin"?"Admin":"Sucursal"},a))})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("h4",{className:"text-[11px] font-black text-primary uppercase tracking-[0.2em] mb-6 flex items-center gap-2",children:[e.jsx(us,{className:"w-4 h-4"})," Privilegios y Accesos"]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 h-full",children:ys.map(a=>{var g,b;const c=(g=os[s.role])==null?void 0:g.includes(a.id),u=((b=s.permissions)==null?void 0:b.includes(a.id))||c;return e.jsxs("div",{className:p("flex items-center justify-between p-4 rounded-2xl border transition-all",u?"bg-white dark:bg-zinc-900 shadow-sm border-primary/20":"bg-muted/10 opacity-40 border-transparent grayscale"),children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-black tracking-tight",children:a.label}),e.jsx("span",{className:"text-[10px] font-bold text-muted-foreground/60",children:a.group})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[c&&e.jsx(de,{className:"rounded-md font-black text-[8px] bg-primary/10 text-primary border-none",children:"POR ROL"}),e.jsx(q,{checked:u,disabled:c,onCheckedChange:()=>F(s.id,a.id,s.permissions)})]})]},a.id)})})]})]})})})})]},s.id)})})]})}),$.length===0&&!o&&e.jsxs("div",{className:"p-32 flex flex-col items-center gap-6",children:[e.jsx("div",{className:"h-24 w-24 bg-muted/20 rounded-full flex items-center justify-center",children:e.jsx(le,{className:"w-10 h-10 text-muted-foreground/30"})}),e.jsx("p",{className:"font-bold text-muted-foreground italic",children:"No se encontraron usuarios"})]}),o&&e.jsxs("div",{className:"p-32 flex flex-col items-center gap-6",children:[e.jsx(re,{className:"w-10 h-10 text-primary animate-spin"}),e.jsx("p",{className:"font-black text-primary uppercase tracking-widest text-[11px]",children:"Cargando Sistema..."})]})]})]})}function $s(){const r=Be(),{user:t}=we(),{preferences:n,setPosition:o,setReminderType:y}=Ye(),[f,B]=i.useState(!0),[_,I]=i.useState(!1),[P,S]=i.useState(!0),[x,U]=i.useState([50]),[M,F]=i.useState(!1),[$,W]=i.useState(!1),s=async a=>{var u;const c=(u=a.target.files)==null?void 0:u[0];if(c){if(!confirm("¿Deseas importar las asignaciones de laboratorios? Esto limpiará y actualizará la tabla branch_laboratories.")){a.target.value="";return}W(!0);try{const g=await c.arrayBuffer(),b=me(g),Z=new Map;b.SheetNames.forEach(d=>Z.set(d.toLowerCase().trim(),d));let X=0;const z=[];for(const d of Ke){const v=Z.get(d.toLowerCase().trim());if(!v){console.warn(`No sheet found for branch: ${d}`);continue}const C=xe.sheet_to_json(b.Sheets[v],{header:1});if(C.length<2)continue;const J=C[1];for(let N=0;N<J.length;N++){const oe=String(J[N]||"").trim();if(oe)for(let K=2;K<C.length;K++){const ee=C[K];if(ee&&ee[N]){const ie=String(ee[N]).trim();ie.length>0&&(z.push({branch:d,lab:ie.toUpperCase(),category:oe.toUpperCase()}),X++)}}}}if(z.length===0){h.error("Error","No se encontraron laboratorios en el archivo."),a.target.value="";return}const{error:k}=await T.from("branch_laboratories").delete().gte("created_at","1970-01-01T00:00:00Z");k&&console.warn("Could not delete existing records:",k);const R=new Map;z.forEach(d=>{const v=`${d.branch}|${d.lab}`;R.has(v)||R.set(v,d)});const V=Array.from(R.values()).map(d=>({branch_name:d.branch,laboratory:d.lab,category:d.category,total_items:0,controlled_items:0,adjusted_items:0,pending_items:0,progress_percentage:0,total_system_units:0,net_units:0,net_value:0,negative_value:0,positive_value:0,status:"pending"})),G=500;let H=0;for(let d=0;d<V.length;d+=G){const v=V.slice(d,d+G),{error:C}=await T.from("branch_laboratories").upsert(v,{onConflict:"branch_name,laboratory,category",ignoreDuplicates:!1});if(C)throw new Error(`Error insertando chunk ${d}: ${C.message}`);H+=v.length}const{error:Q}=await T.rpc("update_lab_progress_from_inventories");Q&&console.warn("RPC not available, updating manually..."),h.success("Importación exitosa",`${H} laboratorios importados/actualizados correctamente.`),a.target.value=""}catch(g){console.error("Import error:",g),h.error("Error",`No se pudo completar la importación: ${g instanceof Error?g.message:"Error desconocido"}`),a.target.value=""}finally{W(!1)}}},m=async()=>{if(confirm("¿Estás seguro de que deseas borrar todos los datos locales? Esta acción no se puede deshacer."))try{await es(),h.success("Operación exitosa","Datos locales eliminados correctamente"),window.location.reload()}catch{h.error("Error","Error al eliminar datos")}},l=async a=>{var u;const c=(u=a.target.files)==null?void 0:u[0];if(c){F(!0);try{const g=await c.arrayBuffer(),b=me(g),Z=b.SheetNames[0],X=b.Sheets[Z],z=xe.sheet_to_json(X,{header:"A"}),k=[];for(let R=1;R<z.length;R++){const V=z[R],G=V.D,H=V.O,Q=V.Q;if(!G||!Q)continue;const d=String(G).trim(),v=H?String(H).trim():void 0;String(Q).trim().split("-").map(N=>N.trim()).filter(N=>N.length>0).forEach(N=>{k.push({ean:N,name:d,cost:0,salePrice:0,laboratory:v,category:"",stock:0})})}if(k.length===0){h.error("Error","No se encontraron productos válidos. Verifica las columnas (D=Producto, Q=EAN).");return}confirm(`Se encontraron ${k.length} códigos EAN (de ${z.length-1} filas). ¿Deseas reemplazar la base de datos actual?`)&&(await ss(),await as(k),h.success("Operación exitosa",`${k.length} productos importados correctamente.`)),a.target.value=""}catch(g){console.error("Error importing products:",g),h.error("Error","Error al importar el archivo. Asegúrate de que sea un Excel válido.")}finally{F(!1)}}};return e.jsx(Xe,{children:e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(E,{children:[e.jsxs(L,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-primary"}),e.jsx(D,{children:"Notificaciones"})]}),e.jsx(O,{children:"Personaliza cómo y dónde aparecen las notificaciones."})]}),e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(w,{className:"text-base",children:"Recordatorios"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Estas son notificaciones para recordarte actividad que has perdido o citas próximas."})]}),e.jsxs(Pe,{value:n.reminderType,onValueChange:a=>y(a),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{value:"center-only",id:"center-only"}),e.jsx(w,{htmlFor:"center-only",className:"font-normal cursor-pointer",children:"Mostrar nuevos recordatorios en el centro de notificaciones pero no como banners."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{value:"all",id:"all"}),e.jsx(w,{htmlFor:"all",className:"font-normal cursor-pointer",children:"Notificarme para todos los recordatorios"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{value:"none",id:"none"}),e.jsx(w,{htmlFor:"none",className:"font-normal cursor-pointer",children:"No notificarme."})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(w,{className:"text-base",children:"Posición de notificación"}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>h.info("Notificación de prueba","Esta es una vista previa de cómo aparecerán tus notificaciones."),children:"Probar"})]}),e.jsx(vs,{value:n.position,onChange:o})]})]})]}),e.jsxs(E,{children:[e.jsxs(L,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hs,{className:"w-5 h-5 text-primary"}),e.jsx(D,{children:"Inventario y Escáner"})]}),e.jsx(O,{children:"Configuración del lector de código de barras y feedback."})]}),e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(w,{className:"text-base",children:"Vibración (Haptics)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Vibrar al escanear correctamente un producto."})]}),e.jsx(q,{checked:f,onCheckedChange:B})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(w,{className:"text-base",children:"Sonidos"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Reproducir sonido de confirmación."})]}),e.jsx(q,{checked:_,onCheckedChange:I})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(w,{children:"Sensibilidad del Escáner"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[x,"%"]})]}),e.jsx(Ce,{value:x,onValueChange:U,max:100,step:10,className:"w-full"})]})]})]}),e.jsxs(E,{children:[e.jsxs(L,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5 text-primary"}),e.jsx(D,{children:"Sincronización"})]}),e.jsx(O,{children:"Gestión de datos offline y subida."})]}),e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(w,{className:"text-base",children:"Sincronización Automática"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Subir cambios automáticamente cuando haya conexión."})]}),e.jsx(q,{checked:P,onCheckedChange:S})]}),e.jsx("div",{className:"pt-2",children:e.jsx(Ns,{children:e.jsxs(j,{variant:"outline",className:"w-full justify-start",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Abrir Centro de Sincronización"]})})})]})]}),e.jsxs(E,{children:[e.jsxs(L,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-primary"}),e.jsx(D,{children:"Base de Datos de Productos"})]}),e.jsx(O,{children:"Gestiona el catálogo de productos local."})]}),e.jsx(A,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 border rounded-lg bg-muted/30 space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-1",children:"Importar Productos desde Excel"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:'Actualiza la base de datos con un archivo .xlsx. El archivo debe tener columnas "EAN" y "Descripcion".'}),e.jsx("div",{className:"flex gap-2",children:e.jsx(te,{type:"file",accept:".xlsx, .xls",onChange:l,disabled:M,className:"cursor-pointer"})}),M&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2 animate-pulse",children:"Procesando archivo..."})]})}),e.jsxs("div",{className:"pt-2",children:[e.jsxs(j,{variant:"destructive",className:"w-full sm:w-auto",onClick:m,children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Borrar datos locales y caché"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Utiliza esto si experimentas problemas con la aplicación. Se borrarán los datos no sincronizados."})]})]})})]}),(t==null?void 0:t.role)==="admin"&&e.jsxs(E,{children:[e.jsxs(L,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-primary"}),e.jsx(D,{children:"Administración"})]}),e.jsx(O,{children:"Gestión de sucursales y configuraciones globales (solo administradores)."})]}),e.jsxs(A,{className:"space-y-3",children:[e.jsx(j,{variant:"outline",className:"w-full justify-start",onClick:()=>r("/admin/branches"),children:"Administrar Sucursales"}),e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Asignación de Laboratorios"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"Importa el archivo lab_sucu.xlsx con las asignaciones de laboratorios por sucursal."}),e.jsx(te,{type:"file",accept:".xlsx, .xls",onChange:s,disabled:$,className:"cursor-pointer"}),$&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2 animate-pulse",children:"Procesando archivo..."})]})]})]}),is(t,"MANAGE_USERS")&&e.jsx(ws,{}),e.jsxs(E,{children:[e.jsxs(L,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-primary"}),e.jsx(D,{children:"Sistema"})]}),e.jsx(O,{children:"Información de la versión y mantenimiento."})]}),e.jsx(A,{className:"space-y-6",children:e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Versión de la App"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"v1.2.0 (Build 2025.11.24)"})]}),e.jsx(j,{variant:"outline",size:"sm",disabled:!0,children:"Actualizada"})]})})]})]})})}export{$s as default};
