import{j as e}from"./ui-vendor-DpWgbapL.js";import{r as c}from"./react-vendor-ylmX0jv_.js";import{c as A,w as Se,x as ke,A as Ie,E as Ce,S as te,G,B as v,z as m,j as b,U as Ae,b as B,i as ge,P as Te,J as je,K as Ue,F as _e}from"./index-nj5uYoc8.js";import{C as I}from"./CounterAnimation-Cxw_j9vI.js";import{T as Le,a as Qe,b as ve}from"./tabs-BVAjLjQ1.js";import{I as C}from"./input-DwEKUKzf.js";import{r as $e,u as j,w as Ne}from"./excel-uoQkVabA.js";import{L as X}from"./label-DK45WQiY.js";import{F as Oe}from"./FabMenu-CEdjWaJx.js";import{T as oe,D as Ge,a as He,A as Je,b as Ke,d as We,e as Ze,c as Y}from"./dropdown-menu-CnGp-N5L.js";import{m as ne}from"./animation-D5s1b1Vs.js";import{F as be}from"./file-spreadsheet-Cshr_IQM.js";import{T as ye}from"./target-C2m_HDZr.js";import{T as ie}from"./trending-up-VhUTPing.js";import{C as we}from"./calculator-PzLE4GOY.js";import{P as Xe}from"./pencil-BLhIvw7Z.js";import{S as Ye}from"./save-D4Ilx3qL.js";import"./utils-B3_ieZWp.js";import"./plus-CJ6Vo5rc.js";import"./circle-DNmM3q1k.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=A("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=A("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=A("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=A("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=A("ListFilter",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M7 12h10",key:"b7w52i"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=A("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),ts=["Belgrano VI","Barracas","Recoleta","Belgrano","Belgrano II","Belgrano III","Belgrano IV","Belgrano V","Belgrano VII","Belgrano VIII","Berazategui","Berazategui II","Caballito","Caballito II","Caballito III","Caballito IV","Chacarita","Devoto","Devoto II","Flores","Gonzalez Catan","Gonzalez Catan II","Gonzalez Catan III","Las Cañitas","Mercedes","Microcentro","Microcentro II","Morón","Nuñez","Padua","Palermo","Palermo II","Palermo III","Parque Centenario","Parque Patricios","Pilar","Pompeya","Quilmes","Ramos Mejia","Ramos Mejia II","Ramos Mejia III","Recoleta II","Recoleta III","Recoleta IV","Recoleta V","Retiro","Retiro II","Saladillo","San Isidro","San Isidro II","San Miguel","Tribunales","Villa Ballester","Villa Ballester II","Villa Crespo","Villa del Parque","Villa del Parque II","Villa Luro","Villa Urquiza","Villa Urquiza II","Villa Urquiza III"];function as({open:S,onOpenChange:T,onSave:V}){const[D,U]=c.useState(""),[k,r]=c.useState(""),[P,g]=c.useState(""),[_,y]=c.useState(!1),[E,H]=c.useState(""),[L,J]=c.useState(new Date().toISOString().split("T")[0]),[z,K]=c.useState(!1),M=c.useMemo(()=>ts.filter(h=>h.toLowerCase().includes(P.toLowerCase())),[P]),Q=()=>{if(!D.trim()){m.error("Datos incompletos","Por favor, ingresa un nombre para el reporte");return}if(!k){m.error("Datos incompletos","Por favor, selecciona una sucursal");return}if(!E.trim()){m.error("Datos incompletos","Por favor, ingresa el sector");return}if(!L){m.error("Datos incompletos","Por favor, selecciona una fecha");return}K(!0);try{V({name:D,branch:k,sector:E,date:L}),m.success("Reporte guardado","El reporte se guardó correctamente"),U(""),r(""),g(""),H(""),J(new Date().toISOString().split("T")[0]),T(!1)}catch{m.error("Error al guardar","No se pudo guardar el reporte")}finally{K(!1)}};return e.jsx(Se,{open:S,onOpenChange:T,children:e.jsxs(ke,{className:"w-[480px] p-0",children:[e.jsx(Ie,{className:"p-4 border-b",children:e.jsx(Ce,{children:"Guardar Reporte"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(X,{htmlFor:"report-name",className:"text-sm font-medium",children:"Nombre del Reporte *"}),e.jsx(C,{id:"report-name",placeholder:"Ej: Auditoria - Nov 2025",value:D,onChange:h=>U(h.target.value),className:"mt-2"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{htmlFor:"report-branch",className:"text-sm font-medium",children:"Sucursal *"}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx(te,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(C,{id:"report-branch",placeholder:"Buscar sucursal...",value:P,onChange:h=>{g(h.target.value),y(!0)},onFocus:()=>y(!0),className:"pl-8"})]}),_&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-background border border-border rounded-md shadow-lg z-50 max-h-48 overflow-auto",children:M.length>0?M.map(h=>e.jsxs("button",{className:"w-full text-left px-3 py-2 hover:bg-accent flex items-center justify-between",onClick:()=>{r(h),g(""),y(!1)},children:[h,k===h&&e.jsx(G,{className:"h-4 w-4 text-primary"})]},h)):e.jsx("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:"No se encontraron sucursales"})}),k&&e.jsxs("div",{className:"mt-2 px-3 py-2 bg-accent rounded-md text-sm",children:["Seleccionada: ",e.jsx("span",{className:"font-medium",children:k})]})]}),e.jsxs("div",{children:[e.jsx(X,{htmlFor:"report-sector",className:"text-sm font-medium",children:"Sector *"}),e.jsx(C,{id:"report-sector",placeholder:"Ej: Farmacia, Perfumería, General",value:E,onChange:h=>H(h.target.value),className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(X,{htmlFor:"report-date",className:"text-sm font-medium",children:"Fecha del Inventario *"}),e.jsx(C,{id:"report-date",type:"date",value:L,onChange:h=>J(h.target.value),className:"mt-2"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(v,{variant:"outline",onClick:()=>T(!1),disabled:z,className:"flex-1",children:"Cancelar"}),e.jsx(v,{onClick:Q,disabled:z,className:"flex-1",children:z?"Guardando...":"Guardar Reporte"})]})]})]})})}function ks(){const[S,T]=c.useState("inventory"),[V,D]=c.useState(null),[U,k]=c.useState(!1),[r,P]=c.useState(null),[g,_]=c.useState(null),[y,E]=c.useState({headers:[],rows:[]}),[H,L]=c.useState(!1),[J,z]=c.useState(!1),[K,M]=c.useState(!1),[Q,h]=c.useState("Inventario"),[R,ue]=c.useState(""),[w,W]=c.useState("all"),[me,rs]=c.useState("negative"),[$,Ve]=c.useState(!1),[u,q]=c.useState({field:"value",direction:"desc"}),[ae,xe]=c.useState(null),[re,he]=c.useState(null),le=c.useRef(null),De=s=>{var a;const t=(a=s.target.files)==null?void 0:a[0];t&&(t.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||t.type==="application/vnd.ms-excel"?(D(t),D(t),P(null),_(null),E({headers:[],rows:[]}),m.success("Operación exitosa","Archivo cargado correctamente")):m.error("Error","Por favor, selecciona un archivo Excel válido"))},pe=s=>{const t=s.map((l,f)=>({codebar:l[6],name:l[10],physicalCount:l[13]===""?"":Number(l[13])||0,systemStock:Number(l[15])||0,diffQty:Number(l[17])||0,cost:Number(l[19])||0,salePrice:Number(l[21])||0,diffValue:Number(l[22])||0,rowIndex:f})).filter(l=>l.codebar&&l.name),a=t.filter(l=>l.diffQty<0),n=t.filter(l=>l.diffQty>0),x=t.filter(l=>l.diffQty===0).length,o=t.length>0?x/t.length*100:100,i=a.reduce((l,f)=>l+f.diffValue,0),d=n.reduce((l,f)=>l+f.diffValue,0),p=a.reduce((l,f)=>l+f.diffQty,0),Z=n.reduce((l,f)=>l+f.diffQty,0),F=[...a].sort((l,f)=>l.diffValue-f.diffValue).slice(0,10),N=[...n].sort((l,f)=>f.diffValue-l.diffValue).slice(0,10);P({totalProducts:t.length,allShortages:a,allSurpluses:n,topShortagesByValue:F,topSurplusesByValue:N,totalShortageValue:Math.abs(i),totalSurplusValue:d,totalShortageUnits:Math.abs(p),totalSurplusUnits:Z,inventoryAccuracy:o,totalProductsNoDifference:x,netDiscrepancyValue:d+i,netDiscrepancyUnits:Z+p,totalScannedUnits:t.reduce((l,f)=>l+(Number(f.physicalCount)||0),0),allProducts:t})},Pe=s=>{const t=s.map((o,i)=>({codebar:o[2]?String(o[2]):"",name:o[3]?String(o[3]):"",quantity:Number(o[4])||0,price:Number(o[10])||0,totalValue:(Number(o[4])||0)*(Number(o[10])||0),rowIndex:i})).filter(o=>o.codebar&&o.name),a=t.length,n=t.reduce((o,i)=>o+i.quantity,0),x=t.reduce((o,i)=>o+i.totalValue,0);_({totalProducts:a,totalUnits:n,totalValue:x,items:t})},Ee=async()=>{if(!V){m.error("Error","Por favor, selecciona un archivo primero");return}k(!0),m.info("Información","Analizando archivo...",{id:"analysis-toast"});try{const s=await V.arrayBuffer(),t=$e(s),a=t.SheetNames[0],n=t.Sheets[a],x=j.sheet_to_json(n,{header:1}),o=x[0],i=x.slice(1);E({headers:o,rows:i}),S==="inventory"?pe(i):Pe(i),m.success("Operación exitosa","Análisis completado",{id:"analysis-toast"}),setTimeout(()=>{var d;(d=le.current)==null||d.scrollIntoView({behavior:"smooth",block:"start"})},300)}catch(s){console.error("Error analyzing file:",s),m.error("Error","Hubo un error al analizar el archivo.",{id:"analysis-toast"})}finally{k(!1)}},ze=(s,t)=>{const a=[...y.rows],n=[...a[s]];a[s]=n,n[13]=t;const x=t===""?0:Number(t),o=Number(n[15])||0,i=x-o;n[17]=i;const d=Number(n[19])||0;n[22]=i*d,E(p=>({...p,rows:a})),pe(a)},Me=()=>{if(!r){m.error("Error","No hay resultados para exportar.");return}m.info("Información","Generando resumen en Excel...");const s=i=>i.map(d=>({"Código de Barras":d.codebar,Producto:d.name,"Diferencia (Unidades)":d.diffQty,"Valor Diferencia ($)":d.diffValue,"Stock Sistema":d.systemStock,"Conteo Físico":d.physicalCount,"Costo Unitario ($)":d.cost,"Precio Venta ($)":d.salePrice})),t=[...r.allShortages].sort((i,d)=>i.diffQty-d.diffQty).slice(0,15),a=[...r.allShortages].sort((i,d)=>i.diffValue-d.diffValue).slice(0,15),n=[...r.allSurpluses].sort((i,d)=>d.diffQty-i.diffQty).slice(0,15),x=[...r.allSurpluses].sort((i,d)=>d.diffValue-i.diffValue).slice(0,15),o=j.book_new();j.book_append_sheet(o,j.json_to_sheet(s(t)),"Faltantes por Cantidad"),j.book_append_sheet(o,j.json_to_sheet(s(a)),"Faltantes por Valor"),j.book_append_sheet(o,j.json_to_sheet(s(n)),"Sobrantes por Cantidad"),j.book_append_sheet(o,j.json_to_sheet(s(x)),"Sobrantes por Valor"),Ne(o,"Resumen_Diferencias.xlsx"),m.success("Operación exitosa","Resumen Excel generado correctamente.")},Re=()=>{if(!r||y.rows.length===0){m.error("Error","No hay resultados para exportar.");return}M(!0)},Fe=()=>{if(!r||y.rows.length===0){m.error("Error","No hay resultados para exportar.");return}m.info("Información","Generando archivo Excel...");const s=[...y.headers];s[24]="ID DE AJUSTE",s[25]="CANTIDAD DE AJUSTE";const t=y.rows.map((p,Z)=>{const F=Z+2,N=[...p];return N[13]=Number(p[13])||0,N[15]=Number(p[15])||0,N[19]=Number(p[19])||0,N[21]=Number(p[21])||0,N[17]={f:`(N${F}+Z${F})-P${F}`},N[22]={f:`R${F}*T${F}`},N[24]="",N[25]=0,N}),a=j.aoa_to_sheet([s,...t]),n=s.length,x=[];for(let p=0;p<n;p++)x.push({hidden:!0});[6,10,13,15,17,19,21,22,24,25].forEach(p=>{x[p]&&(x[p]={hidden:!1,wch:20})}),a["!cols"]=x;const i=j.book_new();j.book_append_sheet(i,a,"Hoja de Ajuste");const d=`${Q}.xlsx`;Ne(i,d),m.success("Operación exitosa","Archivo Excel generado correctamente."),L(!0),M(!1),h("Inventario")},O=c.useMemo(()=>{if(!r)return[];r.allShortages.concat(r.allSurpluses);let s=[...r.allShortages,...r.allSurpluses];if(w==="shortage"?s=r.allShortages:w==="surplus"?s=r.allSurpluses:w==="match"?s=[]:w==="zero_stock"&&(s=r.allSurpluses.filter(a=>a.systemStock===0&&Number(a.physicalCount)>0)),R){const a=R.toLowerCase();s=s.filter(n=>n.name.toLowerCase().includes(a)||n.codebar.toLowerCase().includes(a))}const t=s.sort((a,n)=>{const x=u.field==="value"?a.diffValue:a.diffQty,o=u.field==="value"?n.diffValue:n.diffQty;return u.direction==="desc"?o-x:x-o});return ae!==null&&re&&r.allProducts?re.map(a=>r.allProducts.find(n=>n.rowIndex===a)).filter(a=>a!==void 0):t},[r,w,R,u,ae,re]),qe=s=>{xe(s),he(O.map(t=>t.rowIndex))},fe=()=>{xe(null),he(null)},Be=s=>{if(!r){m.error("Error","No hay resultados para guardar");return}const t={id:Date.now().toString(),name:s.name,branch:s.branch,sector:s.sector,date:s.date,timestamp:new Date().toISOString(),results:r},a=JSON.parse(localStorage.getItem("inventory-reports")||"[]");a.push(t),localStorage.setItem("inventory-reports",JSON.stringify(a)),z(!1)};return e.jsxs(ne.div,{className:"p-6 space-y-6 pb-32 lg:pb-10",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:[e.jsx(b,{className:"p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Le,{defaultValue:"inventory",value:S,onValueChange:s=>{T(s),P(null),_(null),D(null)},className:"w-full",children:[e.jsxs(Qe,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(ve,{value:"inventory",children:"Análisis de Inventario"}),e.jsx(ve,{value:"negative_preview",children:"Previsión Negativos"})]}),e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{htmlFor:"dropzone-file",className:"flex flex-col items-center justify-center w-full h-64 border-2 border-border border-dashed rounded-2xl cursor-pointer bg-muted/30 hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(Ae,{className:"w-12 h-12 mb-4 text-muted-foreground"}),e.jsx("p",{className:"mb-2 text-sm text-foreground font-medium",children:V?V.name:"Haz clic para cargar o arrastra el archivo"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Archivos Excel (.xlsx, .xls)"})]}),e.jsx("input",{id:"dropzone-file",type:"file",className:"hidden",accept:".xlsx,.xls",onChange:De})]})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-muted/50 rounded-lg",children:[e.jsx(be,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-foreground",children:["Formato requerido (",S==="inventory"?"Inventario":"Negativos",")"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:S==="inventory"?"El archivo debe contener las columnas: Código, Producto, Stock Sistema, Stock Físico, Diferencia":"El archivo debe contener las columnas: Codebar (C), Producto (D), Cantidad (E), Precio (K)"})]})]}),e.jsx(v,{onClick:Ee,disabled:!V||U,className:"w-full",size:"lg",children:U?"Analizando...":"Analizar Archivo"})]})}),S==="negative_preview"&&g&&e.jsxs(ne.div,{ref:le,className:"space-y-8",initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(b,{className:"p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Total Productos"}),e.jsx("h3",{className:"text-2xl font-bold text-foreground",children:g.totalProducts})]}),e.jsx("div",{className:"h-12 w-12 bg-primary/10 rounded-xl flex items-center justify-center",children:e.jsx(ye,{className:"w-6 h-6 text-primary"})})]})}),e.jsx(b,{className:"p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Items Negativos"}),e.jsx("h3",{className:"text-2xl font-bold text-destructive",children:g.items.filter(s=>s.quantity<0).length})]}),e.jsx("div",{className:"h-12 w-12 bg-destructive/10 rounded-xl flex items-center justify-center",children:e.jsx(oe,{className:"w-6 h-6 text-destructive"})})]})}),e.jsx(b,{className:"p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Items Positivos"}),e.jsx("h3",{className:"text-2xl font-bold text-success",children:g.items.filter(s=>s.quantity>0).length})]}),e.jsx("div",{className:"h-12 w-12 bg-success/10 rounded-xl flex items-center justify-center",children:e.jsx(ie,{className:"w-6 h-6 text-success"})})]})}),e.jsx(b,{className:"p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Total Unidades Negativas"}),e.jsx("h3",{className:"text-2xl font-bold text-destructive",children:g.items.filter(s=>s.quantity<0).reduce((s,t)=>s+Math.abs(t.quantity),0).toLocaleString()})]}),e.jsx("div",{className:"h-12 w-12 bg-destructive/10 rounded-xl flex items-center justify-center",children:e.jsx(we,{className:"w-6 h-6 text-destructive"})})]})}),e.jsx(b,{className:"p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Valor Items Negativos"}),e.jsx("h3",{className:"text-2xl font-bold text-destructive",children:e.jsx(I,{value:g.items.filter(s=>s.quantity<0).reduce((s,t)=>s+Math.abs(t.totalValue),0),prefix:"$"})})]}),e.jsx("div",{className:"h-12 w-12 bg-destructive/10 rounded-xl flex items-center justify-center",children:e.jsx(de,{className:"w-6 h-6 text-destructive"})})]})}),e.jsx(b,{className:"p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Valor Total"}),e.jsx("h3",{className:"text-2xl font-bold text-foreground",children:e.jsx(I,{value:g.totalValue,prefix:"$"})})]}),e.jsx("div",{className:"h-12 w-12 bg-blue-500/10 rounded-xl flex items-center justify-center",children:e.jsx(de,{className:"w-6 h-6 text-blue-500"})})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 py-4 sticky top-0 z-20 bg-background/80 backdrop-blur-md border-b",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"bg-destructive/10 px-4 py-2 rounded-xl",children:e.jsxs("p",{className:"text-sm font-semibold text-destructive",children:["Mostrando Faltantes (",g.items.filter(s=>s.quantity<0).length,")"]})})}),e.jsx("div",{className:"flex items-center gap-3 w-full md:w-auto",children:e.jsxs("div",{className:"relative w-full md:w-80",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(C,{placeholder:"Buscar producto, EAN...",value:R,onChange:s=>ue(s.target.value),className:"pl-9 h-10 bg-muted/30 border-muted-foreground/20 rounded-xl focus-visible:ring-primary"})]})})]}),e.jsxs(b,{className:"border-muted/40 shadow-sm overflow-hidden bg-card",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4 border-b bg-muted/30 text-xs font-semibold text-muted-foreground uppercase tracking-wider shrink-0",children:[e.jsx("div",{className:"col-span-6 md:col-span-4 pl-2",children:"Producto"}),e.jsx("div",{className:"col-span-2 hidden md:block text-right",children:"Precio"}),e.jsxs("div",{className:"col-span-3 md:col-span-3 text-center flex items-center justify-center cursor-pointer hover:text-foreground transition-colors group",onClick:()=>q({field:"quantity",direction:u.field==="quantity"&&u.direction==="desc"?"asc":"desc"}),children:["Cantidad",e.jsxs("div",{className:"ml-1 opacity-50 group-hover:opacity-100",children:[u.field==="quantity"&&(u.direction==="desc"?e.jsx(ee,{className:"w-3 h-3"}):e.jsx(se,{className:"w-3 h-3"})),u.field!=="quantity"&&e.jsx(ce,{className:"w-3 h-3 rotate-90 opacity-20"})]})]}),e.jsxs("div",{className:"col-span-3 md:col-span-3 text-right cursor-pointer hover:text-foreground transition-colors flex items-center justify-end pr-2 group",onClick:()=>q({field:"value",direction:u.field==="value"&&u.direction==="desc"?"asc":"desc"}),children:["Total ($)",e.jsxs("div",{className:"ml-1 opacity-50 group-hover:opacity-100",children:[u.field==="value"&&(u.direction==="desc"?e.jsx(ee,{className:"w-3 h-3"}):e.jsx(se,{className:"w-3 h-3"})),u.field!=="value"&&e.jsx(ce,{className:"w-3 h-3 rotate-90 opacity-20"})]})]})]}),e.jsx("div",{className:"divide-y divide-border/40 max-h-[600px] overflow-y-auto",children:g.items.filter(s=>{if(me==="negative"&&s.quantity>=0||me==="positive"&&s.quantity<=0)return!1;if(R){const t=R.toLowerCase();return s.name.toLowerCase().includes(t)||s.codebar.toLowerCase().includes(t)}return!0}).sort((s,t)=>{const a=u.field==="value"?s.totalValue:s.quantity,n=u.field==="value"?t.totalValue:t.quantity;return u.direction==="desc"?n-a:a-n}).map((s,t)=>e.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4 items-center hover:bg-muted/10 transition-colors group",children:[e.jsxs("div",{className:"col-span-6 md:col-span-4 flex items-center gap-3 pl-2 min-w-0",children:[e.jsx("div",{className:B("p-2 rounded-lg shrink-0",s.quantity<0?"bg-destructive/10 text-destructive":"bg-success/10 text-success"),children:s.quantity<0?e.jsx(oe,{className:"w-5 h-5"}):e.jsx(ie,{className:"w-5 h-5"})}),e.jsxs("div",{className:"min-w-0 flex flex-col justify-center",children:[e.jsx("p",{className:"font-semibold text-sm text-foreground truncate",title:s.name,children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx(ge,{variant:"outline",className:"text-[10px] h-5 font-mono text-muted-foreground border-border/60 font-normal hidden sm:inline-flex",children:s.codebar}),e.jsx("span",{className:"text-[10px] text-muted-foreground sm:hidden",children:s.codebar})]})]})]}),e.jsxs("div",{className:"col-span-2 hidden md:block text-right self-center",children:[e.jsxs("p",{className:"text-sm font-medium",children:["$",s.price.toLocaleString()]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Costo Unit."})]}),e.jsx("div",{className:"col-span-3 md:col-span-3 flex justify-center self-center",children:e.jsxs("div",{className:B("flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold w-20 justify-center",s.quantity<0?"bg-destructive/10 text-destructive":"bg-success/10 text-success"),children:[s.quantity<0?e.jsx(ee,{className:"w-3 h-3"}):e.jsx(se,{className:"w-3 h-3"}),s.quantity]})}),e.jsx("div",{className:"col-span-3 md:col-span-3 text-right pr-2 self-center",children:e.jsxs("p",{className:B("font-bold text-sm",s.quantity<0?"text-destructive":"text-success"),children:["$",s.totalValue.toLocaleString()]})})]},t))})]})]}),S==="inventory"&&r&&e.jsxs(ne.div,{ref:le,className:"space-y-8",initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(b,{className:"p-6 md:p-8 shadow-md border-muted/60 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-6 opacity-5",children:e.jsx(de,{className:"w-32 h-32"})}),e.jsxs("div",{className:"relative z-10 space-y-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-sm font-semibold text-muted-foreground tracking-wide uppercase",children:$?"Total Discrepancia":"Balance de Inventario"})}),e.jsx(v,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-muted/50 rounded-full",onClick:()=>Ve(!$),title:"Cambiar vista",children:e.jsx(ce,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-4xl md:text-5xl font-bold tracking-tight text-foreground transition-all duration-300",children:e.jsx(I,{value:$?r.totalShortageValue+r.totalSurplusValue:Math.abs(r.netDiscrepancyValue),prefix:"$"})}),!$&&e.jsx("span",{className:`text-xl font-bold ${r.netDiscrepancyValue>=0?"text-success":"text-destructive"}`,children:r.netDiscrepancyValue>=0?"(+)":"(-)"})]}),$&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Suma absoluta de todas las diferencias"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-1 uppercase tracking-wider",children:"Total Faltante"}),e.jsx("p",{className:"text-xl font-bold text-destructive",children:e.jsx(I,{value:r.totalShortageValue,prefix:"$"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-1 uppercase tracking-wider",children:"Total Sobrante"}),e.jsx("p",{className:"text-xl font-bold text-success",children:e.jsx(I,{value:r.totalSurplusValue,prefix:"$"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-1 uppercase tracking-wider",children:"Precisión"}),e.jsx("p",{className:"text-xl font-bold text-primary",children:e.jsx(I,{value:r.inventoryAccuracy,decimals:1,suffix:"%"})})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4 border-t border-border/40",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Valor Faltante (Unidades)"}),e.jsxs("p",{className:"font-semibold text-foreground",children:[e.jsx(I,{value:r.totalShortageUnits})," ",e.jsx("span",{className:"text-destructive font-bold",children:"(-)"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Valor Sobrante (Unidades)"}),e.jsxs("p",{className:"font-semibold text-foreground",children:[e.jsx(I,{value:r.totalSurplusUnits})," ",e.jsx("span",{className:"text-success font-bold",children:"(+)"})]})]})]})]})]}),e.jsxs(b,{className:"p-6 md:p-8 shadow-md border-none bg-primary text-primary-foreground relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:e.jsx(Te,{className:"w-40 h-40 transform rotate-12 translate-x-10 -translate-y-10"})}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full justify-between space-y-6",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-2 opacity-90",children:e.jsx("span",{className:"text-sm font-semibold tracking-wide uppercase",children:"Estado del Proceso"})}),e.jsxs("div",{className:"flex items-baseline gap-3",children:[e.jsx("span",{className:"text-4xl md:text-5xl font-bold tracking-tight",children:"Finalizado"}),e.jsx("div",{className:"bg-white/20 p-1.5 rounded-full backdrop-blur-sm",children:e.jsx(je,{className:"w-5 h-5"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{className:"bg-white/10 rounded-2xl p-4 backdrop-blur-md border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ye,{className:"w-8 h-8 opacity-80"}),e.jsx("span",{className:"text-2xl font-bold",children:r.totalProducts})]}),e.jsx("p",{className:"text-xs font-medium opacity-70 uppercase tracking-wider",children:"Total Productos"})]}),e.jsxs("div",{className:"bg-white/10 rounded-2xl p-4 backdrop-blur-md border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ss,{className:"w-8 h-8 opacity-80"}),e.jsx("span",{className:"text-2xl font-bold",children:r.totalScannedUnits})]}),e.jsx("p",{className:"text-xs font-medium opacity-70 uppercase tracking-wider",children:"Unidades Escaneadas"})]}),e.jsxs("div",{className:"bg-white/10 rounded-2xl p-4 backdrop-blur-md border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(we,{className:"w-8 h-8 opacity-80"}),e.jsx("div",{className:"flex items-baseline gap-1",children:e.jsxs("span",{className:"text-2xl font-bold",children:[r.netDiscrepancyUnits>0?"+":"",r.netDiscrepancyUnits]})})]}),e.jsx("p",{className:"text-xs font-medium opacity-70 uppercase tracking-wider",children:"Unidades Netas (Ajuste)"})]}),e.jsxs("div",{className:"bg-white/10 rounded-2xl p-4 backdrop-blur-md border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(je,{className:"w-8 h-8 opacity-80"}),e.jsx("span",{className:"text-2xl font-bold",children:r.totalProductsNoDifference})]}),e.jsx("p",{className:"text-xs font-medium opacity-70 uppercase tracking-wider",children:"Productos sin Diferencia"})]})]})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 py-4 sticky top-0 z-20 bg-background/80 backdrop-blur-md border-b",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-muted/50 p-1 rounded-xl w-full md:w-auto overflow-x-auto",children:[e.jsx(v,{variant:w==="all"?"default":"ghost",size:"sm",onClick:()=>W("all"),className:"rounded-lg text-xs font-medium h-9 px-4",children:"Todos"}),e.jsxs(v,{variant:w==="shortage"?"default":"ghost",size:"sm",onClick:()=>W("shortage"),className:"rounded-lg text-xs font-medium h-9 px-4 hover:text-destructive hover:bg-destructive/10 data-[state=active]:bg-destructive data-[state=active]:text-destructive-foreground",children:["Faltantes (",r.allShortages.length,")"]}),e.jsxs(v,{variant:w==="surplus"?"default":"ghost",size:"sm",onClick:()=>W("surplus"),className:"rounded-lg text-xs font-medium h-9 px-4 hover:text-success hover:bg-success/10",children:["Sobrantes (",r.allSurpluses.length,")"]}),e.jsxs(v,{variant:w==="zero_stock"?"default":"ghost",size:"sm",onClick:()=>W("zero_stock"),className:"rounded-lg text-xs font-medium h-9 px-4 hover:text-blue-500 hover:bg-blue-500/10 data-[state=active]:bg-blue-600 data-[state=active]:text-white",children:["Stock 0 (",r.allSurpluses.filter(s=>s.systemStock===0).length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"relative w-full md:w-80",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(C,{placeholder:"Buscar producto, EAN...",value:R,onChange:s=>ue(s.target.value),className:"pl-9 h-10 bg-muted/30 border-muted-foreground/20 rounded-xl focus-visible:ring-primary"})]}),e.jsxs(Ge,{children:[e.jsx(He,{asChild:!0,children:e.jsx(v,{variant:"outline",size:"icon",className:"h-10 w-10 rounded-xl border-muted-foreground/20",children:e.jsx(Je,{className:"w-4 h-4 text-muted-foreground"})})}),e.jsxs(Ke,{align:"end",className:"w-48",children:[e.jsx(We,{children:"Ordenar por"}),e.jsx(Ze,{}),e.jsx(Y,{onClick:()=>q({field:"quantity",direction:"desc"}),children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:"Mayor Cantidad (+)"}),u.field==="quantity"&&u.direction==="desc"&&e.jsx(G,{className:"w-4 h-4"})]})}),e.jsx(Y,{onClick:()=>q({field:"quantity",direction:"asc"}),children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:"Mayor Cantidad (-)"}),u.field==="quantity"&&u.direction==="asc"&&e.jsx(G,{className:"w-4 h-4"})]})}),e.jsx(Y,{onClick:()=>q({field:"value",direction:"desc"}),children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:"Mayor Importe (+)"}),u.field==="value"&&u.direction==="desc"&&e.jsx(G,{className:"w-4 h-4"})]})}),e.jsx(Y,{onClick:()=>q({field:"value",direction:"asc"}),children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:"Mayor Importe (-)"}),u.field==="value"&&u.direction==="asc"&&e.jsx(G,{className:"w-4 h-4"})]})})]})]})]})]}),e.jsxs(b,{className:"border-muted/40 shadow-sm overflow-hidden bg-card",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4 border-b bg-muted/30 text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:[e.jsx("div",{className:"col-span-5 md:col-span-4 pl-2",children:"Producto"}),e.jsx("div",{className:"col-span-2 text-right hidden md:block",children:"Precio"}),e.jsx("div",{className:"col-span-3 md:col-span-2 text-center",children:"Diferencia"}),e.jsx("div",{className:"col-span-2 text-center hidden sm:block",children:"Físico / Sistema"}),e.jsx("div",{className:"col-span-2 md:col-span-2 text-right pr-2",children:"Total ($)"})]}),e.jsx("div",{className:"divide-y divide-border/40",children:O.length===0?e.jsxs("div",{className:"p-12 text-center text-muted-foreground",children:[e.jsx(te,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No se encontraron productos"})]}):O.map((s,t)=>e.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4 items-center hover:bg-muted/10 transition-colors group",children:["                     ",e.jsxs("div",{className:"col-span-5 md:col-span-4 flex items-center gap-3 pl-2 min-w-0",children:[e.jsx("div",{className:B("p-2 rounded-lg shrink-0",s.diffQty<0?"bg-destructive/10 text-destructive":"bg-success/10 text-success"),children:s.diffQty<0?e.jsx(oe,{className:"w-5 h-5"}):e.jsx(ie,{className:"w-5 h-5"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm text-foreground truncate",title:s.name,children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx(ge,{variant:"outline",className:"text-[10px] h-5 font-mono text-muted-foreground border-border/60 font-normal hidden sm:inline-flex",children:s.codebar}),e.jsx("span",{className:"text-[10px] text-muted-foreground sm:hidden",children:s.codebar})]})]})]}),e.jsxs("div",{className:"col-span-2 text-right hidden md:block self-center",children:[e.jsxs("p",{className:"text-sm font-medium",children:["$",s.cost.toLocaleString()]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Costo Unit."})]}),e.jsx("div",{className:"col-span-3 md:col-span-2 flex justify-center self-center",children:e.jsxs("div",{className:B("flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold w-20 justify-center",s.diffQty<0?"bg-destructive/10 text-destructive":"bg-success/10 text-success"),children:[s.diffQty>0?e.jsx(se,{className:"w-3 h-3"}):e.jsx(ee,{className:"w-3 h-3"}),s.diffQty>0?"+":"",s.diffQty]})}),e.jsx("div",{className:"col-span-2 text-center hidden sm:block self-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1 text-sm relative",children:[ae===s.rowIndex?e.jsx(C,{type:"number",autoFocus:!0,className:"w-16 h-7 text-right pr-2 font-bold p-0",value:s.physicalCount,onBlur:fe,onKeyDown:a=>{a.key==="Enter"&&fe()},onChange:a=>ze(s.rowIndex,a.target.value),onClick:a=>a.stopPropagation()}):e.jsxs("div",{className:"w-16 h-7 flex items-center justify-end pr-2 relative cursor-pointer group/edit rounded hover:bg-muted/50 transition-colors",onClick:a=>{a.stopPropagation(),qe(s.rowIndex)},children:[e.jsx("span",{className:"font-bold",children:s.physicalCount}),e.jsx(Xe,{className:"w-3 h-3 text-muted-foreground opacity-0 group-hover/edit:opacity-100 transition-opacity absolute left-1"})]}),e.jsx("span",{className:"text-muted-foreground mx-1",children:"/"}),e.jsx("span",{className:"text-muted-foreground",children:s.systemStock})]})}),e.jsxs("div",{className:"col-span-2 md:col-span-2 text-right pr-2 self-center",children:[e.jsxs("p",{className:B("text-sm font-bold",s.diffValue<0?"text-destructive":"text-success"),children:[s.diffValue>0?"+":"","$",Math.abs(s.diffValue).toLocaleString()]}),e.jsx("div",{className:"flex justify-end mt-1 md:hidden",children:e.jsx(es,{className:"w-4 h-4 text-muted-foreground"})})]})]},s.rowIndex))}),e.jsxs("div",{className:"p-4 border-t bg-muted/20 flex justify-between items-center text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Mostrando ",O.length," registros"]}),O.length>20&&e.jsx(v,{variant:"ghost",size:"sm",className:"h-7 text-xs",children:"Ver más"})]})]}),e.jsx(Oe,{actions:[{label:"Guardar Reporte",icon:e.jsx(Ye,{className:"w-5 h-5"}),onClick:()=>z(!0),variant:"default",color:"bg-primary text-primary-foreground",disabled:!H},{label:"Exportar Inventario",icon:e.jsx(Ue,{className:"w-5 h-5"}),onClick:Re,variant:"secondary"},{label:"Exportar Resumen",icon:e.jsx(be,{className:"w-5 h-5"}),onClick:Me,variant:"secondary",color:"text-green-600"}]})]}),e.jsx(as,{open:J,onOpenChange:z,onSave:Be}),e.jsx(Se,{open:K,onOpenChange:M,children:e.jsxs(ke,{className:"w-[420px]",children:[e.jsxs(Ie,{children:[e.jsx(Ce,{children:"Exportar Inventario"}),e.jsx(_e,{children:"Ingresa el nombre del archivo que deseas descargar. Se guardará como un archivo Excel (.xlsx)."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fileName",className:"block text-sm font-medium text-foreground mb-2",children:"Nombre del archivo"}),e.jsx(C,{id:"fileName",type:"text",placeholder:"Inventario",value:Q,onChange:s=>h(s.target.value),className:"w-full"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"La extensión .xlsx se agregará automáticamente"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(v,{variant:"outline",onClick:()=>M(!1),children:"Cancelar"}),e.jsx(v,{onClick:Fe,disabled:!Q.trim(),children:"Descargar"})]})]})]})})]})}export{ks as default};
