import{c as z,v as q,D as F,h as O,i as _,j as V,N as Q,B as b,q as U,r as G,o as k}from"./index-79gJsbWV.js";import{j as e}from"./ui-vendor-Bb_mGnpn.js";import{r as t}from"./react-vendor-DdjUaGoS.js";import{H as J}from"./scanner-ThRrwOEs.js";import{S as K}from"./switch-CtVpFNTc.js";import{L as W}from"./label-DS6fhhCU.js";import{A as X,m as y,u as Y,a as P}from"./animation-_rLC-yhr.js";import{C as Z}from"./circle-check-CkBJYZ1s.js";import{L as $}from"./jspdf.es.min-DSvf6SN5.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=z("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=z("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);function L(){return{trigger:t.useCallback((a="light")=>{if(!("vibrate"in navigator))return;const d={light:10,medium:20,heavy:30,selection:[5,10],success:[10,50,10],warning:[20,100,20],error:[30,100,30,100,30]}[a];try{Array.isArray(d),navigator.vibrate(d)}catch(n){console.warn("Haptic feedback failed:",n)}},[])}}function me({open:m,onOpenChange:a,onScan:r,onBatchScan:d}){const[n,u]=t.useState(!1),[f,v]=t.useState(null),[x,g]=t.useState(null),[N,w]=t.useState(!1),l=t.useRef(null),C="barcode-reader",{trigger:j}=L(),[p,S]=t.useState(!1),[c,o]=t.useState([]);t.useEffect(()=>(m&&!l.current&&!N&&I(),()=>{M()}),[m,N]),t.useEffect(()=>{m&&(o([]),S(!1))},[m]);const h=async()=>{try{return(await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})).getTracks().forEach(i=>i.stop()),!0}catch(s){return console.error("Error requesting camera permission:",s),s instanceof DOMException&&(s.name==="NotAllowedError"||s.name==="PermissionDeniedError"?(w(!0),g("Permisos de cámara denegados. Por favor, habilita los permisos en la configuración de tu navegador.")):g("Error al acceder a la cámara. Intenta nuevamente.")),!1}},I=async()=>{try{if(g(null),!await h())return;const i=new J(C);l.current=i;const T={fps:15,qrbox:{width:280,height:280},aspectRatio:1,experimentalFeatures:{useBarCodeDetectorIfSupported:!0}};await i.start({facingMode:"environment"},T,D=>{B(D)},()=>{}),u(!0)}catch(s){console.error("Error starting scanner:",s),g("Error al iniciar la cámara."),q.error("Error al iniciar la cámara")}},M=async()=>{if(l.current)try{l.current.isScanning&&await l.current.stop(),l.current.clear()}catch(s){console.error("Error stopping scanner:",s)}finally{l.current=null,u(!1)}},B=s=>{p&&c.length>0&&c[c.length-1],j("success"),p?(o(i=>[s,...i]),v(s),setTimeout(()=>v(null),1e3)):(v(s),setTimeout(()=>{r(s),E()},800))},E=async()=>{await M(),v(null),g(null),w(!1),a(!1)},H=()=>{d&&d(c),E()},R=s=>{o(i=>i.filter((T,D)=>D!==s))};return e.jsx(F,{open:m,onOpenChange:E,children:e.jsxs(O,{className:"sm:max-w-[500px] max-h-[90vh] flex flex-col p-0 gap-0 overflow-hidden",children:[e.jsxs(_,{className:"p-4 pb-2",children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-primary"}),"Escanear Código"]}),e.jsx(Q,{children:x?"Error de cámara":"Apunta al código de barras"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pt-0 space-y-4",children:[!x&&e.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-black min-h-[250px] shrink-0",children:[e.jsx("div",{id:C,className:"w-full"}),e.jsx(X,{children:f&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-success/80 flex items-center justify-center z-10",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(Z,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{className:"font-mono font-bold",children:f})]})})})]}),e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(W,{htmlFor:"batch-mode",className:"cursor-pointer",children:"Modo Ráfaga"})]}),e.jsx(K,{id:"batch-mode",checked:p,onCheckedChange:S})]}),p&&c.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Items Escaneados (",c.length,")"]}),e.jsx(b,{variant:"ghost",size:"sm",className:"h-6 text-xs text-destructive",onClick:()=>o([]),children:"Limpiar"})]}),e.jsx("div",{className:"max-h-[150px] overflow-y-auto space-y-1 border rounded-md p-2 bg-background",children:c.map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between text-sm p-1 hover:bg-muted rounded",children:[e.jsx("span",{className:"font-mono",children:s}),e.jsx(b,{variant:"ghost",size:"icon",className:"h-6 w-6 text-muted-foreground hover:text-destructive",onClick:()=>R(i),children:e.jsx(U,{className:"w-3 h-3"})})]},i))})]}),x&&e.jsxs("div",{className:"p-4 bg-destructive/10 text-destructive rounded-lg text-sm",children:[x,e.jsx(b,{onClick:()=>I(),variant:"outline",size:"sm",className:"mt-2 w-full",children:"Reintentar"})]})]}),e.jsxs(G,{className:"p-4 pt-2 border-t bg-muted/20 flex-row gap-2 sm:justify-end",children:[e.jsx(b,{variant:"outline",onClick:E,className:"flex-1 sm:flex-none",children:"Cancelar"}),p&&e.jsxs(b,{onClick:H,disabled:c.length===0,className:"flex-1 sm:flex-none",children:["Procesar (",c.length,")"]})]})]})})}function de({children:m,leftAction:a,rightAction:r,className:d,threshold:n=60,disabled:u=!1}){const f=Y(0),[v,x]=t.useState(!1),g=P(f,[0,n],[0,1]),N=P(f,[-n,0],[1,0]),w=P(f,[-n,0,n],[(r==null?void 0:r.bgColor)||"rgba(0,0,0,0)","rgba(0,0,0,0)",(a==null?void 0:a.bgColor)||"rgba(0,0,0,0)"]),{trigger:l}=L(),[C,j]=t.useState(!1),p=(c,o)=>{x(!1),j(!1),!u&&(o.offset.x<-n&&r?r.onAction():o.offset.x>n&&a&&a.onAction())},S=(c,o)=>{if(u)return;const h=o.offset.x;C?h>-n&&h<n&&j(!1):(h<-n&&r||h>n&&a)&&(l("selection"),j(!0))};return e.jsxs("div",{className:k("relative overflow-hidden rounded-xl",d),children:[e.jsxs(y.div,{className:"absolute inset-0 flex items-center justify-between px-4 pointer-events-none",style:{backgroundColor:w},children:[e.jsxs(y.div,{style:{opacity:g},className:k("flex items-center",a==null?void 0:a.color),children:[a==null?void 0:a.icon,e.jsx("span",{className:"font-medium ml-2",children:a==null?void 0:a.label})]}),e.jsxs(y.div,{style:{opacity:N},className:k("flex items-center",r==null?void 0:r.color),children:[e.jsx("span",{className:"font-medium mr-2",children:r==null?void 0:r.label}),r==null?void 0:r.icon]})]}),e.jsx(y.div,{drag:u?!1:"x",dragConstraints:{left:0,right:0},dragElastic:.7,onDragStart:()=>x(!0),onDrag:S,onDragEnd:p,style:{x:f,touchAction:"none"},className:"relative bg-card z-10",whileTap:{cursor:u?"default":"grabbing"},children:m})]})}export{me as B,A as C,oe as P,de as S};
